<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.Atomics.Internal</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Data.Atomics.Internal.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">atomic-primops-0.8.1: A safe approach to CAS and other atomic ops in Haskell.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Atomics.Internal</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Very unsafe, not to be used</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides only the raw primops (and necessary types) for atomic
 operations.  </p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:casIntArray-35-">casIntArray#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutableByteArray-35-">MutableByteArray#</a> d -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d -&gt; (#<a href="../base-4.10.0.0/GHC-Exts.html#v:TupleRep">TupleRep</a> ([] <a href="../base-4.10.0.0/GHC-Exts.html#t:RuntimeRep">RuntimeRep</a>), <a href="../base-4.10.0.0/GHC-Exts.html#v:IntRep">IntRep</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>#)</li><li class="src short"><a href="#v:fetchAddIntArray-35-">fetchAddIntArray#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutableByteArray-35-">MutableByteArray#</a> d -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d -&gt; (#<a href="../base-4.10.0.0/GHC-Exts.html#v:TupleRep">TupleRep</a> ([] <a href="../base-4.10.0.0/GHC-Exts.html#t:RuntimeRep">RuntimeRep</a>), <a href="../base-4.10.0.0/GHC-Exts.html#v:IntRep">IntRep</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>#)</li><li class="src short"><a href="#v:readForCAS-35-">readForCAS#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; (#<a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a>, <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a#)</li><li class="src short"><a href="#v:casMutVarTicketed-35-">casMutVarTicketed#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; (#<a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a#)</li><li class="src short"><a href="#v:casArrayTicketed-35-">casArrayTicketed#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutableArray-35-">MutableArray#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; (#<a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a#)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Ticket">Ticket</a> a</li><li class="src short"><a href="#v:ptrEq">ptrEq</a> :: a -&gt; a -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:casIntArray-35-" class="def">casIntArray#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutableByteArray-35-">MutableByteArray#</a> d -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d -&gt; (#<a href="../base-4.10.0.0/GHC-Exts.html#v:TupleRep">TupleRep</a> ([] <a href="../base-4.10.0.0/GHC-Exts.html#t:RuntimeRep">RuntimeRep</a>), <a href="../base-4.10.0.0/GHC-Exts.html#v:IntRep">IntRep</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>#) <a href="#v:casIntArray-35-" class="selflink">#</a></p><div class="doc"><p>Given an array, an offset in Int units, the expected old value, and
     the new value, perform an atomic compare and swap i.e. write the new
     value if the current value matches the provided old value. Returns
     the value of the element before the operation. Implies a full memory
     barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchAddIntArray-35-" class="def">fetchAddIntArray#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutableByteArray-35-">MutableByteArray#</a> d -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d -&gt; (#<a href="../base-4.10.0.0/GHC-Exts.html#v:TupleRep">TupleRep</a> ([] <a href="../base-4.10.0.0/GHC-Exts.html#t:RuntimeRep">RuntimeRep</a>), <a href="../base-4.10.0.0/GHC-Exts.html#v:IntRep">IntRep</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> d, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>#) <a href="#v:fetchAddIntArray-35-" class="selflink">#</a></p><div class="doc"><p>Given an array, and offset in Int units, and a value to add,
     atomically add the value to the element. Returns the value of the
     element before the operation. Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:readForCAS-35-" class="def">readForCAS#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; (#<a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a>, <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a#) <a href="src/Data.Atomics.Internal.html#readForCAS%23" class="link">Source</a> <a href="#v:readForCAS-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:casMutVarTicketed-35-" class="def">casMutVarTicketed#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; (#<a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a#) <a href="src/Data.Atomics.Internal.html#casMutVarTicketed%23" class="link">Source</a> <a href="#v:casMutVarTicketed-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:casArrayTicketed-35-" class="def">casArrayTicketed#</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutableArray-35-">MutableArray#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a> -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; (#<a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:State-35-">State#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a>, <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:Int-35-">Int#</a>, <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a#) <a href="src/Data.Atomics.Internal.html#casArrayTicketed%23" class="link">Source</a> <a href="#v:casArrayTicketed-35-" class="selflink">#</a></p><div class="doc"><p>Unsafe, machine-level atomic compare and swap on an element within an Array.  </p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Ticket" class="def">Ticket</a> a <a href="src/Data.Atomics.Internal.html#Ticket" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></p><div class="doc"><p>When performing compare-and-swaps, the <em>ticket</em> encapsulates proof
 that a thread observed a specific previous value of a mutable
 variable.  It is provided in lieu of the &quot;old&quot; value to
 compare-and-swap.</p><p>Design note: <code><a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a></code>s exist to hide objects from the GHC compiler, which
 can normally perform many optimizations that change pointer equality.  A Ticket,
 on the other hand, is a first-class object that can be handled by the user,
 but will not have its pointer identity changed by compiler optimizations
 (but will of course, change addresses during garbage collection).</p></div><div class="subs instances"><p id="control.i:Ticket" class="caption collapser" onclick="toggleSection('i:Ticket')">Instances</p><div id="section.i:Ticket" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Ticket:Eq:1" class="instance expander" onclick="toggleSection('i:id:Ticket:Eq:1')"></span> <a href="../base-4.10.0.0/Data-Eq.html#t:Eq">Eq</a> (<a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a)</span> <a href="src/Data.Atomics.Internal.html#line-81" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Ticket:Eq:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Ticket:Show:2" class="instance expander" onclick="toggleSection('i:id:Ticket:Show:2')"></span> <a href="../base-4.10.0.0/Text-Show.html#t:Show">Show</a> (<a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a)</span> <a href="src/Data.Atomics.Internal.html#line-74" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Ticket:Show:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Data-Atomics-Internal.html#t:Ticket">Ticket</a> a] -&gt; <a href="../base-4.10.0.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><h1 id="g:1">Very unsafe, not to be used</h1><div class="top"><p class="src"><a id="v:ptrEq" class="def">ptrEq</a> :: a -&gt; a -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Data.Atomics.Internal.html#ptrEq" class="link">Source</a> <a href="#v:ptrEq" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>