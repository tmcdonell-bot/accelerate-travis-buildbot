<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.Atomics</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Data.Atomics.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">atomic-primops-0.8.1: A safe approach to CAS and other atomic ops in Haskell.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Atomics</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types for atomic operations</a></li><li><a href="#g:2">Atomic operations on IORefs</a></li><li><a href="#g:3">Atomic operations on mutable arrays</a></li><li><a href="#g:4">Atomic operations on byte arrays</a></li><li><a href="#g:5">Atomic operations on raw MutVars</a></li><li><a href="#g:6">Memory barriers</a></li><li><a href="#g:7">Deprecated Functions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Provides atomic memory operations on IORefs and Mutable Arrays.</p><p>Pointer equality need not be maintained by a Haskell compiler.  For example, Int
   values will frequently be boxed and unboxed, changing the pointer identity of
   the thunk.  To deal with this, the compare-and-swap (CAS) approach used in this
   module is uses a <em>sealed</em> representation of pointers into the Haskell heap
   (<code>Tickets</code>).  Currently, the user cannot coin new tickets, rather a <code><a href="Data-Atomics.html#t:Ticket">Ticket</a></code>
   provides evidence of a past observation, and grants permission to make a future
   change.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Ticket">Ticket</a> a</li><li class="src short"><a href="#v:peekTicket">peekTicket</a> :: <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a</li><li class="src short"><a href="#v:readForCAS">readForCAS</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:casIORef">casIORef</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:casIORef2">casIORef2</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:atomicModifyIORefCAS">atomicModifyIORefCAS</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a -&gt; (a -&gt; (a, b)) -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> b</li><li class="src short"><a href="#v:atomicModifyIORefCAS_">atomicModifyIORefCAS_</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> t -&gt; (t -&gt; t) -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:casArrayElem">casArrayElem</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-Array.html#t:MutableArray">MutableArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:casArrayElem2">casArrayElem2</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-Array.html#t:MutableArray">MutableArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:readArrayElem">readArrayElem</a> :: <span class="keyword">forall</span> a. <a href="../primitive-0.6.2.0/Data-Primitive-Array.html#t:MutableArray">MutableArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:casByteArrayInt">casByteArrayInt</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:fetchAddIntArray">fetchAddIntArray</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:fetchSubIntArray">fetchSubIntArray</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:fetchAndIntArray">fetchAndIntArray</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:fetchNandIntArray">fetchNandIntArray</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:fetchOrIntArray">fetchOrIntArray</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:fetchXorIntArray">fetchXorIntArray</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:readMutVarForCAS">readMutVarForCAS</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:casMutVar">casMutVar</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:casMutVar2">casMutVar2</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</li><li class="src short"><a href="#v:storeLoadBarrier">storeLoadBarrier</a> :: <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:loadLoadBarrier">loadLoadBarrier</a> :: <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:writeBarrier">writeBarrier</a> :: <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:fetchAddByteArrayInt">fetchAddByteArrayInt</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li></ul></div><div id="interface"><h1 id="g:1">Types for atomic operations</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Ticket" class="def">Ticket</a> a <a href="src/Data.Atomics.Internal.html#Ticket" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></p><div class="doc"><p>When performing compare-and-swaps, the <em>ticket</em> encapsulates proof
 that a thread observed a specific previous value of a mutable
 variable.  It is provided in lieu of the &quot;old&quot; value to
 compare-and-swap.</p><p>Design note: <code><a href="Data-Atomics.html#t:Ticket">Ticket</a></code>s exist to hide objects from the GHC compiler, which
 can normally perform many optimizations that change pointer equality.  A Ticket,
 on the other hand, is a first-class object that can be handled by the user,
 but will not have its pointer identity changed by compiler optimizations
 (but will of course, change addresses during garbage collection).</p></div><div class="subs instances"><p id="control.i:Ticket" class="caption collapser" onclick="toggleSection('i:Ticket')">Instances</p><div id="section.i:Ticket" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Ticket:Eq:1" class="instance expander" onclick="toggleSection('i:id:Ticket:Eq:1')"></span> <a href="../base-4.10.0.0/Data-Eq.html#t:Eq">Eq</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</span> <a href="src/Data.Atomics.Internal.html#line-81" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Ticket:Eq:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Ticket:Show:2" class="instance expander" onclick="toggleSection('i:id:Ticket:Show:2')"></span> <a href="../base-4.10.0.0/Text-Show.html#t:Show">Show</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</span> <a href="src/Data.Atomics.Internal.html#line-74" class="link">Source</a> <a href="#t:Ticket" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Ticket:Show:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Data-Atomics.html#t:Ticket">Ticket</a> a] -&gt; <a href="../base-4.10.0.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:peekTicket" class="def">peekTicket</a> :: <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a <a href="src/Data.Atomics.html#peekTicket" class="link">Source</a> <a href="#v:peekTicket" class="selflink">#</a></p><div class="doc"><p>A ticket contains or can get the usable Haskell value.
   This function does just that.</p></div></div><h1 id="g:2">Atomic operations on IORefs</h1><div class="top"><p class="src"><a id="v:readForCAS" class="def">readForCAS</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#readForCAS" class="link">Source</a> <a href="#v:readForCAS" class="selflink">#</a></p><div class="doc"><p>Ordinary processor load instruction (non-atomic, not implying any memory barriers).</p><p>The difference between this function and <code><a href="../base-4.10.0.0/Data-IORef.html#v:readIORef">readIORef</a></code>, is that it returns a <em>ticket</em>,
   for use in future compare-and-swap operations.</p></div></div><div class="top"><p class="src"><a id="v:casIORef" class="def">casIORef</a> <a href="src/Data.Atomics.html#casIORef" class="link">Source</a> <a href="#v:casIORef" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a</td><td class="doc"><p>The <code><a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a></code> containing a value <code>current</code></p></td></tr><tr><td class="src">-&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a</td><td class="doc"><p>A ticket for the <code>old</code> value</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>The <code>new</code> value to replace <code>current</code> if <code>old == current</code></p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</td><td class="doc"><p>Success flag, plus ticket for the NEXT operation.</p></td></tr></table></div><div class="doc"><p>Performs a machine-level compare and swap (CAS) operation on an
 <code><a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a></code>. Returns a tuple containing a <code><a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a></code> which is <code><a href="../base-4.10.0.0/Data-Bool.html#v:True">True</a></code> when a
 swap is performed, along with the most <code>current</code> value from the <code><a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a></code>.
 Note that this differs from the more common CAS behavior, which is to
 return the <em>old</em> value before the CAS occured.</p><p>The reason for the difference is the ticket API.  This function always returns the
 ticket that you should use in your next CAS attempt.  In case of success, this ticket
 corresponds to the <code>new</code> value which you yourself installed in the <code><a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a></code>, whereas
 in the case of failure it represents the preexisting value currently in the IORef.</p><p>Note &quot;compare&quot; here means pointer equality in the sense of
 <code><a href="../ghc-prim-0.5.1.0/GHC-Prim.html#v:reallyUnsafePtrEquality-35-">reallyUnsafePtrEquality#</a></code>.  However, the ticket API absolves
 the user of this module from needing to worry about the pointer equality of their
 values, which in general requires reasoning about the details of the Haskell
 implementation (GHC).</p><p>By convention this function is strict in the &quot;new&quot; value argument.  This isn't
 absolutely necesary, but we think it's a bad habit to use unevaluated thunks in
 this context.</p></div></div><div class="top"><p class="src"><a id="v:casIORef2" class="def">casIORef2</a> <a href="src/Data.Atomics.html#casIORef2" class="link">Source</a> <a href="#v:casIORef2" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a</td><td class="doc"><p>A ticket for the <code>old</code> value</p></td></tr><tr><td class="src">-&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a</td><td class="doc"><p>A ticket for the <code>new</code> value</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>This variant takes two tickets, i.e. the <code>new</code> value is a ticket rather than an
 arbitrary, lifted, Haskell value.</p></div></div><div class="top"><p class="src"><a id="v:atomicModifyIORefCAS" class="def">atomicModifyIORefCAS</a> <a href="src/Data.Atomics.html#atomicModifyIORefCAS" class="link">Source</a> <a href="#v:atomicModifyIORefCAS" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> a</td><td class="doc"><p>Mutable location to modify</p></td></tr><tr><td class="src">-&gt; (a -&gt; (a, b))</td><td class="doc"><p>Computation runs one or more times (speculation)</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> b</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>A drop-in replacement for <code><a href="Data-Atomics.html#v:atomicModifyIORefCAS">atomicModifyIORefCAS</a></code> that
   optimistically attempts to compute the new value and CAS it into
   place without introducing new thunks or locking anything.  Note
   that this is more STRICT than its standard counterpart and will only
   place evaluated (WHNF) values in the IORef.</p><p>The upside is that sometimes we see a performance benefit.
   The downside is that this version is speculative -- when it
   retries, it must reexecute the compution.</p></div></div><div class="top"><p class="src"><a id="v:atomicModifyIORefCAS_" class="def">atomicModifyIORefCAS_</a> :: <a href="../base-4.10.0.0/Data-IORef.html#t:IORef">IORef</a> t -&gt; (t -&gt; t) -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> () <a href="src/Data.Atomics.html#atomicModifyIORefCAS_" class="link">Source</a> <a href="#v:atomicModifyIORefCAS_" class="selflink">#</a></p><div class="doc"><p>A simpler version that modifies the state but does not return anything.</p></div></div><h1 id="g:3">Atomic operations on mutable arrays</h1><div class="top"><p class="src"><a id="v:casArrayElem" class="def">casArrayElem</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-Array.html#t:MutableArray">MutableArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#casArrayElem" class="link">Source</a> <a href="#v:casArrayElem" class="selflink">#</a></p><div class="doc"><p>Compare-and-swap.  Follows the same rules as <code><a href="Data-Atomics.html#v:casIORef">casIORef</a></code>, returning the ticket for
   then next operation.</p><p>By convention this is WHNF strict in the &quot;new&quot; value provided.</p></div></div><div class="top"><p class="src"><a id="v:casArrayElem2" class="def">casArrayElem2</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-Array.html#t:MutableArray">MutableArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#casArrayElem2" class="link">Source</a> <a href="#v:casArrayElem2" class="selflink">#</a></p><div class="doc"><p>This variant takes two tickets: the <code>new</code> value is a ticket rather than an
 arbitrary, lifted, Haskell value.</p></div></div><div class="top"><p class="src"><a id="v:readArrayElem" class="def">readArrayElem</a> :: <span class="keyword">forall</span> a. <a href="../primitive-0.6.2.0/Data-Primitive-Array.html#t:MutableArray">MutableArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#readArrayElem" class="link">Source</a> <a href="#v:readArrayElem" class="selflink">#</a></p><div class="doc"><p>Ordinary processor load instruction (non-atomic, not implying any memory barriers).</p></div></div><h1 id="g:4">Atomic operations on byte arrays</h1><div class="top"><p class="src"><a id="v:casByteArrayInt" class="def">casByteArrayInt</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> <a href="src/Data.Atomics.html#casByteArrayInt" class="link">Source</a> <a href="#v:casByteArrayInt" class="selflink">#</a></p><div class="doc"><p>Compare and swap on word-sized chunks of a byte-array.  For indexing purposes
 the bytearray is treated as an array of words (<code><a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></code>s).  Note that UNLIKE
 <code><a href="Data-Atomics.html#v:casIORef">casIORef</a></code> and <code>casArrayTicketed</code>, this does not need to operate on tickets.</p><p>Further, this version always returns the <em>old value</em>, that was read from the array during
 the CAS operation.  That is, it follows the normal protocol for CAS operations
 (and matches the underlying instruction on most architectures).</p><p>Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchAddIntArray" class="def">fetchAddIntArray</a> <a href="src/Data.Atomics.html#fetchAddIntArray" class="link">Source</a> <a href="#v:fetchAddIntArray" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The offset into the array</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value to be added</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value *before* the addition</p></td></tr></table></div><div class="doc"><p>Atomically add to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>, returning
 the value *before* the operation. Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchSubIntArray" class="def">fetchSubIntArray</a> <a href="src/Data.Atomics.html#fetchSubIntArray" class="link">Source</a> <a href="#v:fetchSubIntArray" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The offset into the array</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value to be subtracted</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value *before* the addition</p></td></tr></table></div><div class="doc"><p>Atomically subtract to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>,
 returning the value *before* the operation. Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchAndIntArray" class="def">fetchAndIntArray</a> <a href="src/Data.Atomics.html#fetchAndIntArray" class="link">Source</a> <a href="#v:fetchAndIntArray" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The offset into the array</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value to be AND-ed</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value *before* the addition</p></td></tr></table></div><div class="doc"><p>Atomically bitwise AND to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>,
 returning the value *before* the operation. Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchNandIntArray" class="def">fetchNandIntArray</a> <a href="src/Data.Atomics.html#fetchNandIntArray" class="link">Source</a> <a href="#v:fetchNandIntArray" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The offset into the array</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value to be NAND-ed</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value *before* the addition</p></td></tr></table></div><div class="doc"><p>Atomically bitwise NAND to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>,
 returning the value *before* the operation. Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchOrIntArray" class="def">fetchOrIntArray</a> <a href="src/Data.Atomics.html#fetchOrIntArray" class="link">Source</a> <a href="#v:fetchOrIntArray" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The offset into the array</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value to be OR-ed</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value *before* the addition</p></td></tr></table></div><div class="doc"><p>Atomically bitwise OR to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>,
 returning the value *before* the operation. Implies a full memory barrier.</p></div></div><div class="top"><p class="src"><a id="v:fetchXorIntArray" class="def">fetchXorIntArray</a> <a href="src/Data.Atomics.html#fetchXorIntArray" class="link">Source</a> <a href="#v:fetchXorIntArray" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The offset into the array</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value to be XOR-ed</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The value *before* the addition</p></td></tr></table></div><div class="doc"><p>Atomically bitwise XOR to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>,
 returning the value *before* the operation. Implies a full memory barrier.</p></div></div><h1 id="g:5">Atomic operations on raw MutVars</h1><div class="doc"><p>A lower-level version of the IORef interface.</p></div><div class="top"><p class="src"><a id="v:readMutVarForCAS" class="def">readMutVarForCAS</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#readMutVarForCAS" class="link">Source</a> <a href="#v:readMutVarForCAS" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Data-Atomics.html#v:readForCAS">readForCAS</a></code>, but for <code><a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:casMutVar" class="def">casMutVar</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#casMutVar" class="link">Source</a> <a href="#v:casMutVar" class="selflink">#</a></p><div class="doc"><p>MutVar counterpart of <code><a href="Data-Atomics.html#v:casIORef">casIORef</a></code>.</p><p>By convention this is WHNF strict in the &quot;new&quot; value provided.</p></div></div><div class="top"><p class="src"><a id="v:casMutVar2" class="def">casMutVar2</a> :: <a href="../ghc-prim-0.5.1.0/GHC-Prim.html#t:MutVar-35-">MutVar#</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="Data-Atomics.html#t:Ticket">Ticket</a> a -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a>, <a href="Data-Atomics.html#t:Ticket">Ticket</a> a) <a href="src/Data.Atomics.html#casMutVar2" class="link">Source</a> <a href="#v:casMutVar2" class="selflink">#</a></p><div class="doc"><p>This variant takes two tickets, i.e. the <code>new</code> value is a ticket rather than an
 arbitrary, lifted, Haskell value.</p></div></div><h1 id="g:6">Memory barriers</h1><div class="top"><p class="src"><a id="v:storeLoadBarrier" class="def">storeLoadBarrier</a> :: <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> () <a href="src/Data.Atomics.html#storeLoadBarrier" class="link">Source</a> <a href="#v:storeLoadBarrier" class="selflink">#</a></p><div class="doc"><p>Memory barrier implemented by the GHC rts (see SMP.h).
 storeLoadBarrier :: IO ()</p><p>Memory barrier implemented by the GHC rts (see SMP.h).
 loadLoadBarrier :: IO ()</p><p>Memory barrier implemented by the GHC rts (see SMP.h).
 writeBarrier :: IO ()</p><p>Memory barrier implemented by the GHC rts (see SMP.h).</p></div></div><div class="top"><p class="src"><a id="v:loadLoadBarrier" class="def">loadLoadBarrier</a> :: <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> () <a href="src/Data.Atomics.html#loadLoadBarrier" class="link">Source</a> <a href="#v:loadLoadBarrier" class="selflink">#</a></p><div class="doc"><p>Memory barrier implemented by the GHC rts (see SMP.h).</p></div></div><div class="top"><p class="src"><a id="v:writeBarrier" class="def">writeBarrier</a> :: <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> () <a href="src/Data.Atomics.html#writeBarrier" class="link">Source</a> <a href="#v:writeBarrier" class="selflink">#</a></p><div class="doc"><p>Memory barrier implemented by the GHC rts (see SMP.h).</p></div></div><h1 id="g:7">Deprecated Functions</h1><div class="top"><p class="src"><a id="v:fetchAddByteArrayInt" class="def">fetchAddByteArrayInt</a> :: <a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a> <a href="../base-4.10.0.0/Control-Monad-ST-Safe.html#t:RealWorld">RealWorld</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/System-IO.html#t:IO">IO</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> <a href="src/Data.Atomics.html#fetchAddByteArrayInt" class="link">Source</a> <a href="#v:fetchAddByteArrayInt" class="selflink">#</a></p><div class="doc"><div class="warning"><p>Deprecated: Replaced by fetchAddIntArray which returns the OLD value</p></div><p>Atomically add to a word of memory within a <code><a href="../primitive-0.6.2.0/Data-Primitive-ByteArray.html#t:MutableByteArray">MutableByteArray</a></code>.</p><p>This function returns the NEW value of the location after the increment.
   Thus, it is a bit misnamed, and in other contexts might be called &quot;add-and-fetch&quot;,
   such as in GCC's <code>__sync_add_and_fetch</code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>