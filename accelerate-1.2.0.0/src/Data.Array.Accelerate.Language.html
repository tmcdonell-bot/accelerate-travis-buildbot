<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds     #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns        #-}</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Module      : Data.Array.Accelerate.Language</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Copyright   : [2008..2017] Manuel M T Chakravarty, Gabriele Keller</span><span>
</span><a name="line-10"></a><span class="hs-comment">--               [2009..2017] Trevor L. McDonell</span><span>
</span><a name="line-11"></a><span class="hs-comment">--               [2014..2014] Frederik M. Madsen</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- License     : BSD3</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Maintainer  : Trevor L. McDonell &lt;tmcdonell@cse.unsw.edu.au&gt;</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- Portability : non-portable (GHC extensions)</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- We use the dictionary view of overloaded operations (such as arithmetic and</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- bit manipulation) to reify such expressions.  With non-overloaded</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- operations (such as, the logical connectives) and partially overloaded</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- operations (such as comparisons), we use the standard operator names with a</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- \'*\' attached.  We keep the standard alphanumeric names as they can be</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- easily qualified.</span><span>
</span><a name="line-24"></a><span class="hs-comment">--</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Language</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-comment">-- * Array and scalar expressions</span><span>
</span><a name="line-29"></a><span>  </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span class="hs-special">,</span><span>                                 </span><span class="hs-comment">-- re-exporting from 'Smart'</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">-- * Scalar introduction</span><span>
</span><a name="line-32"></a><span>  </span><a href="Data.Array.Accelerate.Smart.html#constant"><span class="hs-identifier hs-var">constant</span></a><span class="hs-special">,</span><span>                                 </span><span class="hs-comment">-- re-exporting from 'Smart'</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>  </span><span class="hs-comment">-- * Array construction</span><span>
</span><a name="line-35"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#use"><span class="hs-identifier hs-var">use</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#unit"><span class="hs-identifier hs-var">unit</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#replicate"><span class="hs-identifier hs-var">replicate</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#generate"><span class="hs-identifier hs-var">generate</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-comment">-- * Shape manipulation</span><span>
</span><a name="line-38"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#reshape"><span class="hs-identifier hs-var">reshape</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-comment">-- * Extraction of sub-arrays</span><span>
</span><a name="line-41"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#slice"><span class="hs-identifier hs-var">slice</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-comment">-- * Map-like functions</span><span>
</span><a name="line-44"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#map"><span class="hs-identifier hs-var">map</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">-- -- * Sequence collection</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-comment">-- collect,</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-comment">-- -- * Sequence producers</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-comment">-- streamIn, toSeq,</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-comment">-- -- * Sequence transducers</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-comment">-- mapSeq, zipWithSeq, scanSeq,</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-comment">-- -- * Sequence consumers</span><span>
</span><a name="line-56"></a><span>  </span><span class="hs-comment">-- foldSeq, foldSeqFlatten,</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-comment">-- * Reductions</span><span>
</span><a name="line-59"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#fold"><span class="hs-identifier hs-var">fold</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#fold1"><span class="hs-identifier hs-var">fold1</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#foldSeg"><span class="hs-identifier hs-var">foldSeg</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#fold1Seg"><span class="hs-identifier hs-var">fold1Seg</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>  </span><span class="hs-comment">-- * Scan functions</span><span>
</span><a name="line-62"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#scanl"><span class="hs-identifier hs-var">scanl</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#scanl%27"><span class="hs-identifier hs-var">scanl'</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#scanl1"><span class="hs-identifier hs-var">scanl1</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#scanr"><span class="hs-identifier hs-var">scanr</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#scanr%27"><span class="hs-identifier hs-var">scanr'</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#scanr1"><span class="hs-identifier hs-var">scanr1</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>  </span><span class="hs-comment">-- * Permutations</span><span>
</span><a name="line-65"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#permute"><span class="hs-identifier hs-var">permute</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#backpermute"><span class="hs-identifier hs-var">backpermute</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>  </span><span class="hs-comment">-- * Stencil operations</span><span>
</span><a name="line-68"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#stencil"><span class="hs-identifier hs-var">stencil</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#stencil2"><span class="hs-identifier hs-var">stencil2</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span>  </span><span class="hs-comment">-- ** Stencil specification</span><span>
</span><a name="line-71"></a><span>  </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#clamp"><span class="hs-identifier hs-var">clamp</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#mirror"><span class="hs-identifier hs-var">mirror</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#wrap"><span class="hs-identifier hs-var">wrap</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#function"><span class="hs-identifier hs-var">function</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-comment">-- ** Common stencil types</span><span>
</span><a name="line-76"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil7"><span class="hs-identifier hs-type">Stencil7</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil9"><span class="hs-identifier hs-type">Stencil9</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3x3"><span class="hs-identifier hs-type">Stencil3x3x3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3x3"><span class="hs-identifier hs-type">Stencil5x3x3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5x3"><span class="hs-identifier hs-type">Stencil3x5x3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3x5"><span class="hs-identifier hs-type">Stencil3x3x5</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5x3"><span class="hs-identifier hs-type">Stencil5x5x3</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3x5"><span class="hs-identifier hs-type">Stencil5x3x5</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5x5"><span class="hs-identifier hs-type">Stencil3x5x5</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5x5"><span class="hs-identifier hs-type">Stencil5x5x5</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-comment">-- * Foreign functions</span><span>
</span><a name="line-82"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#foreignAcc"><span class="hs-identifier hs-var">foreignAcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#foreignExp"><span class="hs-identifier hs-var">foreignExp</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>  </span><span class="hs-comment">-- * Pipelining</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#%3E-%3E"><span class="hs-operator hs-var">&gt;-&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-comment">-- * Index construction and destruction</span><span>
</span><a name="line-89"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#indexHead"><span class="hs-identifier hs-var">indexHead</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#indexTail"><span class="hs-identifier hs-var">indexTail</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#toIndex"><span class="hs-identifier hs-var">toIndex</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#fromIndex"><span class="hs-identifier hs-var">fromIndex</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#intersect"><span class="hs-identifier hs-var">intersect</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#union"><span class="hs-identifier hs-var">union</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-comment">-- * Flow-control</span><span>
</span><a name="line-93"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#acond"><span class="hs-identifier hs-var">acond</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#awhile"><span class="hs-identifier hs-var">awhile</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">,</span><span>  </span><a href="Data.Array.Accelerate.Language.html#while"><span class="hs-identifier hs-var">while</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-comment">-- * Array operations with a scalar result</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#%21%21"><span class="hs-operator hs-var">!!</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#shape"><span class="hs-identifier hs-var">shape</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#size"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#shapeSize"><span class="hs-identifier hs-var">shapeSize</span></a><span class="hs-special">,</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span>  </span><span class="hs-comment">-- * Numeric functions</span><span>
</span><a name="line-100"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#subtract"><span class="hs-identifier hs-var">subtract</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#even"><span class="hs-identifier hs-var">even</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#odd"><span class="hs-identifier hs-var">odd</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#gcd"><span class="hs-identifier hs-var">gcd</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#lcm"><span class="hs-identifier hs-var">lcm</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#%5E"><span class="hs-operator hs-var">^</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#%5E%5E"><span class="hs-operator hs-var">^^</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>  </span><span class="hs-comment">-- * Conversions</span><span>
</span><a name="line-103"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#ord"><span class="hs-identifier hs-var">ord</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#chr"><span class="hs-identifier hs-var">chr</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#boolToInt"><span class="hs-identifier hs-var">boolToInt</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#bitcast"><span class="hs-identifier hs-var">bitcast</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>  </span><span class="hs-comment">-- * Constants</span><span>
</span><a name="line-106"></a><span>  </span><a href="Data.Array.Accelerate.Language.html#ignore"><span class="hs-identifier hs-var">ignore</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">-- friends</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Sugar</span></a><span>                            </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#ignore"><span class="hs-identifier hs-var">ignore</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#shape"><span class="hs-identifier hs-var">shape</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#size"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#toIndex"><span class="hs-identifier hs-var">toIndex</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#fromIndex"><span class="hs-identifier hs-var">fromIndex</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#intersect"><span class="hs-identifier hs-var">intersect</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#union"><span class="hs-identifier hs-var">union</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Smart.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Smart</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Type.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span></a><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Sugar</span></a><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Sugar</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span class="hs-operator">.</span><span class="hs-identifier">Eq</span></a><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Classes.Fractional.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span class="hs-operator">.</span><span class="hs-identifier">Fractional</span></a><span>
</span><a name="line-118"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span class="hs-operator">.</span><span class="hs-identifier">Integral</span></a><span>
</span><a name="line-119"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Classes.Num.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span class="hs-operator">.</span><span class="hs-identifier">Num</span></a><span>
</span><a name="line-120"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Array.Accelerate.Classes.Ord.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">Accelerate</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- standard libraries</span><span>
</span><a name="line-123"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>                                                      </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- $setup</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- &gt;&gt;&gt; :seti -XFlexibleContexts</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- &gt;&gt;&gt; :seti -XScopedTypeVariables</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- &gt;&gt;&gt; :seti -XTypeOperators</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- &gt;&gt;&gt; :seti -XViewPatterns</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Array.Accelerate</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Array.Accelerate.Interpreter</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-133"></a><span class="hs-comment">--   let runExp :: Elt e =&gt; Exp e -&gt; e</span><span>
</span><a name="line-134"></a><span class="hs-comment">--       runExp e = indexArray (run (unit e)) Z</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- Array introduction</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- ------------------</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- | Make an array from vanilla Haskell available for processing within embedded</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- Accelerate computations.</span><span>
</span><a name="line-142"></a><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- Depending upon which backend is used to eventually execute array</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- computations, 'use' may entail data transfer (e.g. to a GPU).</span><span>
</span><a name="line-145"></a><span class="hs-comment">--</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- 'use' is overloaded so that it can accept tuples of 'Arrays':</span><span>
</span><a name="line-147"></a><span class="hs-comment">--</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec = fromList (Z:.10) [0..] :: Vector Int</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- &gt;&gt;&gt; vec</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- Vector (Z :. 10) [0,1,2,3,4,5,6,7,8,9]</span><span>
</span><a name="line-151"></a><span class="hs-comment">--</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-155"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-156"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-157"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-158"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-159"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-160"></a><span class="hs-comment">--</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec' = use vec         :: Acc (Vector Int)</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat' = use mat         :: Acc (Matrix Int)</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- &gt;&gt;&gt; let tup  = use (vec, mat)  :: Acc (Vector Int, Matrix Int)</span><span>
</span><a name="line-164"></a><span class="hs-comment">--</span><span>
</span><a name="line-165"></a><span class="hs-identifier">use</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680142028"><span class="hs-identifier hs-type">arrays</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680142028"><span class="hs-identifier hs-type">arrays</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680142028"><span class="hs-identifier hs-type">arrays</span></a><span>
</span><a name="line-166"></a><a name="use"><a href="Data.Array.Accelerate.Language.html#use"><span class="hs-identifier">use</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Use"><span class="hs-identifier hs-var">Use</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- | Construct a singleton (one element) array from a scalar value (or tuple of</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- scalar values).</span><span>
</span><a name="line-170"></a><span class="hs-comment">--</span><span>
</span><a name="line-171"></a><span class="hs-identifier">unit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142027"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142027"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a><span> </span><a href="#local-6989586621680142027"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><a name="unit"><a href="Data.Array.Accelerate.Language.html#unit"><span class="hs-identifier">unit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Unit"><span class="hs-identifier hs-var">Unit</span></a><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Replicate an array across one or more dimensions as specified by the</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- /generalised/ array index provided as the first argument.</span><span>
</span><a name="line-176"></a><span class="hs-comment">--</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- For example, given the following vector:</span><span>
</span><a name="line-178"></a><span class="hs-comment">--</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec = fromList (Z:.10) [0..] :: Vector Int</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- &gt;&gt;&gt; vec</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- Vector (Z :. 10) [0,1,2,3,4,5,6,7,8,9]</span><span>
</span><a name="line-182"></a><span class="hs-comment">--</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- ...we can replicate these elements to form a two-dimensional array either by</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- replicating those elements as new rows:</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ replicate (constant (Z :. (4::Int) :. All)) (use vec)</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- Matrix (Z :. 4 :. 10)</span><span>
</span><a name="line-188"></a><span class="hs-comment">--   [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-189"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-190"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-191"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><span>
</span><a name="line-192"></a><span class="hs-comment">--</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- ...or as columns:</span><span>
</span><a name="line-194"></a><span class="hs-comment">--</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ replicate (lift (Z :. All :. (4::Int))) (use vec)</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- Matrix (Z :. 10 :. 4)</span><span>
</span><a name="line-197"></a><span class="hs-comment">--   [ 0, 0, 0, 0,</span><span>
</span><a name="line-198"></a><span class="hs-comment">--     1, 1, 1, 1,</span><span>
</span><a name="line-199"></a><span class="hs-comment">--     2, 2, 2, 2,</span><span>
</span><a name="line-200"></a><span class="hs-comment">--     3, 3, 3, 3,</span><span>
</span><a name="line-201"></a><span class="hs-comment">--     4, 4, 4, 4,</span><span>
</span><a name="line-202"></a><span class="hs-comment">--     5, 5, 5, 5,</span><span>
</span><a name="line-203"></a><span class="hs-comment">--     6, 6, 6, 6,</span><span>
</span><a name="line-204"></a><span class="hs-comment">--     7, 7, 7, 7,</span><span>
</span><a name="line-205"></a><span class="hs-comment">--     8, 8, 8, 8,</span><span>
</span><a name="line-206"></a><span class="hs-comment">--     9, 9, 9, 9]</span><span>
</span><a name="line-207"></a><span class="hs-comment">--</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- Replication along more than one dimension is also possible. Here we replicate</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- twice across the first dimension and three times across the third dimension:</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ replicate (constant (Z :. (2::Int) :. All :. (3::Int))) (use vec)</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- Array (Z :. 2 :. 10 :. 3) [0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9]</span><span>
</span><a name="line-213"></a><span class="hs-comment">--</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- The marker 'Any' can be used in the slice specification to match against some</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- arbitrary dimension. For example, here 'Any' matches against whatever shape</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- type variable @sh@ takes.</span><span>
</span><a name="line-217"></a><span class="hs-comment">--</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-219"></a><span class="hs-comment">--   let rep0 :: (Shape sh, Elt e) =&gt; Exp Int -&gt; Acc (Array sh e) -&gt; Acc (Array (sh :. Int) e)</span><span>
</span><a name="line-220"></a><span class="hs-comment">--       rep0 n a = replicate (lift (Any :. n)) a</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-222"></a><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- &gt;&gt;&gt; let x = unit 42 :: Acc (Scalar Int)</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ rep0 10 x</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- Vector (Z :. 10) [42,42,42,42,42,42,42,42,42,42]</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ rep0 5 (use vec)</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- Matrix (Z :. 10 :. 5)</span><span>
</span><a name="line-229"></a><span class="hs-comment">--   [ 0, 0, 0, 0, 0,</span><span>
</span><a name="line-230"></a><span class="hs-comment">--     1, 1, 1, 1, 1,</span><span>
</span><a name="line-231"></a><span class="hs-comment">--     2, 2, 2, 2, 2,</span><span>
</span><a name="line-232"></a><span class="hs-comment">--     3, 3, 3, 3, 3,</span><span>
</span><a name="line-233"></a><span class="hs-comment">--     4, 4, 4, 4, 4,</span><span>
</span><a name="line-234"></a><span class="hs-comment">--     5, 5, 5, 5, 5,</span><span>
</span><a name="line-235"></a><span class="hs-comment">--     6, 6, 6, 6, 6,</span><span>
</span><a name="line-236"></a><span class="hs-comment">--     7, 7, 7, 7, 7,</span><span>
</span><a name="line-237"></a><span class="hs-comment">--     8, 8, 8, 8, 8,</span><span>
</span><a name="line-238"></a><span class="hs-comment">--     9, 9, 9, 9, 9]</span><span>
</span><a name="line-239"></a><span class="hs-comment">--</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- Of course, 'Any' and 'All' can be used together.</span><span>
</span><a name="line-241"></a><span class="hs-comment">--</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-243"></a><span class="hs-comment">--   let rep1 :: (Shape sh, Elt e) =&gt; Exp Int -&gt; Acc (Array (sh :. Int) e) -&gt; Acc (Array (sh :. Int :. Int) e)</span><span>
</span><a name="line-244"></a><span class="hs-comment">--       rep1 n a = replicate (lift (Any :. n :. All)) a</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-246"></a><span class="hs-comment">--</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ rep1 5 (use vec)</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-249"></a><span class="hs-comment">--   [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-250"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-251"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-252"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9,</span><span>
</span><a name="line-253"></a><span class="hs-comment">--     0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><span>
</span><a name="line-254"></a><span class="hs-comment">--</span><span>
</span><a name="line-255"></a><span class="hs-identifier">replicate</span><span>
</span><a name="line-256"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Slice"><span class="hs-identifier hs-type">Slice</span></a><span> </span><a href="#local-6989586621680142025"><span class="hs-identifier hs-type">slix</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142026"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142025"><span class="hs-identifier hs-type">slix</span></a><span>
</span><a name="line-258"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#SliceShape"><span class="hs-identifier hs-type">SliceShape</span></a><span> </span><a href="#local-6989586621680142025"><span class="hs-identifier hs-type">slix</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142026"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#FullShape"><span class="hs-identifier hs-type">FullShape</span></a><span>  </span><a href="#local-6989586621680142025"><span class="hs-identifier hs-type">slix</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142026"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><a name="replicate"><a href="Data.Array.Accelerate.Language.html#replicate"><span class="hs-identifier">replicate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Replicate"><span class="hs-identifier hs-var">Replicate</span></a><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-comment">-- | Construct a new array by applying a function to each index.</span><span>
</span><a name="line-263"></a><span class="hs-comment">--</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- For example, the following will generate a one-dimensional array</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- (`Vector`) of three floating point numbers:</span><span>
</span><a name="line-266"></a><span class="hs-comment">--</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ generate (index1 3) (\_ -&gt; 1.2) :: Vector Float</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- Vector (Z :. 3) [1.2,1.2,1.2]</span><span>
</span><a name="line-269"></a><span class="hs-comment">--</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- Or equivalently:</span><span>
</span><a name="line-271"></a><span class="hs-comment">--</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ fill (constant (Z :. 3)) 1.2 :: Vector Float</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- Vector (Z :. 3) [1.2,1.2,1.2]</span><span>
</span><a name="line-274"></a><span class="hs-comment">--</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- The following will create a vector with the elements @[1..10]@:</span><span>
</span><a name="line-276"></a><span class="hs-comment">--</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ generate (index1 10) (\ix -&gt; unindex1 ix + 1) :: Vector Int</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- Vector (Z :. 10) [1,2,3,4,5,6,7,8,9,10]</span><span>
</span><a name="line-279"></a><span class="hs-comment">--</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- [/NOTE:/]</span><span>
</span><a name="line-281"></a><span class="hs-comment">--</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- Using 'generate', it is possible to introduce nested data parallelism, which</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- will cause the program to fail.</span><span>
</span><a name="line-284"></a><span class="hs-comment">--</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- If the index given by the scalar function is then used to dispatch further</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- parallel work, whose result is returned into 'Exp' terms by array indexing</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- operations such as ('!') or 'Data.Array.Accelerate.Prelude.the', the program</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- will fail with the error:</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- @.\/Data\/Array\/Accelerate\/Trafo\/Sharing.hs:447 (convertSharingExp): inconsistent valuation \@ shared \'Exp\' tree ...@.</span><span>
</span><a name="line-290"></a><span class="hs-comment">--</span><span>
</span><a name="line-291"></a><span class="hs-identifier">generate</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142023"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142024"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142023"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-294"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142023"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142024"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-295"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142023"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142024"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-296"></a><a name="generate"><a href="Data.Array.Accelerate.Language.html#generate"><span class="hs-identifier">generate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Generate"><span class="hs-identifier hs-var">Generate</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- Shape manipulation</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- ------------------</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- | Change the shape of an array without altering its contents. The 'size' of</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- the source and result arrays must be identical.</span><span>
</span><a name="line-303"></a><span class="hs-comment">--</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- &gt; precondition: shapeSize sh == shapeSize sh'</span><span>
</span><a name="line-305"></a><span class="hs-comment">--</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- If the argument array is manifest in memory, 'reshape' is a no-op. If the</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- argument is to be fused into a subsequent operation, 'reshape' corresponds to</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- an index transformation in the fused code.</span><span>
</span><a name="line-309"></a><span class="hs-comment">--</span><span>
</span><a name="line-310"></a><span class="hs-identifier">reshape</span><span>
</span><a name="line-311"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142020"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142021"><span class="hs-identifier hs-type">sh'</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142022"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142020"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-313"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142021"><span class="hs-identifier hs-type">sh'</span></a><span> </span><a href="#local-6989586621680142022"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142020"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142022"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><a name="reshape"><a href="Data.Array.Accelerate.Language.html#reshape"><span class="hs-identifier">reshape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Reshape"><span class="hs-identifier hs-var">Reshape</span></a><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-comment">-- Extraction of sub-arrays</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- ------------------------</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | Index an array with a /generalised/ array index, supplied as the second</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- argument. The result is a new array (possibly a singleton) containing the</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- selected dimensions ('All's) in their entirety.</span><span>
</span><a name="line-323"></a><span class="hs-comment">--</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- 'slice' is the opposite of 'replicate', and can be used to /cut out/ entire</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- dimensions. For example, for the two dimensional array 'mat':</span><span>
</span><a name="line-326"></a><span class="hs-comment">--</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-330"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-331"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-332"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-333"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-334"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-335"></a><span class="hs-comment">--</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- ...will can select a specific row to yield a one dimensional result by fixing</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- the row index (2) while allowing the column index to vary (via 'All'):</span><span>
</span><a name="line-338"></a><span class="hs-comment">--</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ slice (use mat) (constant (Z :. (2::Int) :. All))</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- Vector (Z :. 10) [20,21,22,23,24,25,26,27,28,29]</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- A fully specified index (with no 'All's) returns a single element (zero</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- dimensional array).</span><span>
</span><a name="line-344"></a><span class="hs-comment">--</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ slice (use mat) (constant (Z :. 4 :. 2 :: DIM2))</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- Scalar Z [42]</span><span>
</span><a name="line-347"></a><span class="hs-comment">--</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- The marker 'Any' can be used in the slice specification to match against some</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- arbitrary (lower) dimension. Here 'Any' matches whatever shape type variable</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- @sh@ takes:</span><span>
</span><a name="line-351"></a><span class="hs-comment">--</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-353"></a><span class="hs-comment">--   let</span><span>
</span><a name="line-354"></a><span class="hs-comment">--       sl0 :: (Shape sh, Elt e) =&gt; Acc (Array (sh:.Int) e) -&gt; Exp Int -&gt; Acc (Array sh e)</span><span>
</span><a name="line-355"></a><span class="hs-comment">--       sl0 a n = slice a (lift (Any :. n))</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-357"></a><span class="hs-comment">--</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec = fromList (Z:.10) [0..] :: Vector Int</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ sl0 (use vec) 4</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- Scalar Z [4]</span><span>
</span><a name="line-361"></a><span class="hs-comment">--</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ sl0 (use mat) 4</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- Vector (Z :. 5) [4,14,24,34,44]</span><span>
</span><a name="line-364"></a><span class="hs-comment">--</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- Of course, 'Any' and 'All' can be used together.</span><span>
</span><a name="line-366"></a><span class="hs-comment">--</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-368"></a><span class="hs-comment">--   let sl1 :: (Shape sh, Elt e) =&gt; Acc (Array (sh:.Int:.Int) e) -&gt; Exp Int -&gt; Acc (Array (sh:.Int) e)</span><span>
</span><a name="line-369"></a><span class="hs-comment">--       sl1 a n = slice a (lift (Any :. n :. All))</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-371"></a><span class="hs-comment">--</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ sl1 (use mat) 4</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- Vector (Z :. 10) [40,41,42,43,44,45,46,47,48,49]</span><span>
</span><a name="line-374"></a><span class="hs-comment">--</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- &gt;&gt;&gt; let cube = fromList (Z:.3:.4:.5) [0..] :: Array DIM3 Int</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- &gt;&gt;&gt; cube</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- Array (Z :. 3 :. 4 :. 5) [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59]</span><span>
</span><a name="line-378"></a><span class="hs-comment">--</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ sl1 (use cube) 2</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- Matrix (Z :. 3 :. 5)</span><span>
</span><a name="line-381"></a><span class="hs-comment">--   [ 10, 11, 12, 13, 14,</span><span>
</span><a name="line-382"></a><span class="hs-comment">--     30, 31, 32, 33, 34,</span><span>
</span><a name="line-383"></a><span class="hs-comment">--     50, 51, 52, 53, 54]</span><span>
</span><a name="line-384"></a><span class="hs-comment">--</span><span>
</span><a name="line-385"></a><span class="hs-identifier">slice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Slice"><span class="hs-identifier hs-type">Slice</span></a><span> </span><a href="#local-6989586621680142018"><span class="hs-identifier hs-type">slix</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142019"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#FullShape"><span class="hs-identifier hs-type">FullShape</span></a><span> </span><a href="#local-6989586621680142018"><span class="hs-identifier hs-type">slix</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142019"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142018"><span class="hs-identifier hs-type">slix</span></a><span>
</span><a name="line-388"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#SliceShape"><span class="hs-identifier hs-type">SliceShape</span></a><span> </span><a href="#local-6989586621680142018"><span class="hs-identifier hs-type">slix</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142019"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><a name="slice"><a href="Data.Array.Accelerate.Language.html#slice"><span class="hs-identifier">slice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Slice"><span class="hs-identifier hs-var">Slice</span></a><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">-- Map-like functions</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- ------------------</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-comment">-- | Apply the given function element-wise to an array. Denotationally we have:</span><span>
</span><a name="line-395"></a><span class="hs-comment">--</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- &gt; map f [x1, x2, ... xn] = [f x1, f x2, ... f xn]</span><span>
</span><a name="line-397"></a><span class="hs-comment">--</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- &gt;&gt;&gt; let xs = fromList (Z:.10) [0..] :: Vector Int</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- &gt;&gt;&gt; xs</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- Vector (Z :. 10) [0,1,2,3,4,5,6,7,8,9]</span><span>
</span><a name="line-401"></a><span class="hs-comment">--</span><span>
</span><a name="line-402"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ map (+1) (use xs)</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- Vector (Z :. 10) [1,2,3,4,5,6,7,8,9,10]</span><span>
</span><a name="line-404"></a><span class="hs-comment">--</span><span>
</span><a name="line-405"></a><span class="hs-identifier">map</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142015"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142016"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142017"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142016"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142017"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142015"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142016"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142015"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142017"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-409"></a><a name="map"><a href="Data.Array.Accelerate.Language.html#map"><span class="hs-identifier">map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Map"><span class="hs-identifier hs-var">Map</span></a><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- | Apply the given binary function element-wise to the two arrays. The extent</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- of the resulting array is the intersection of the extents of the two source</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- arrays.</span><span>
</span><a name="line-414"></a><span class="hs-comment">--</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- &gt;&gt;&gt; let xs = fromList (Z:.3:.5) [0..] :: Matrix Int</span><span>
</span><a name="line-416"></a><span class="hs-comment">-- &gt;&gt;&gt; xs</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- Matrix (Z :. 3 :. 5)</span><span>
</span><a name="line-418"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,</span><span>
</span><a name="line-419"></a><span class="hs-comment">--      5,  6,  7,  8,  9,</span><span>
</span><a name="line-420"></a><span class="hs-comment">--     10, 11, 12, 13, 14]</span><span>
</span><a name="line-421"></a><span class="hs-comment">--</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- &gt;&gt;&gt; let ys = fromList (Z:.5:.10) [1..] :: Matrix Int</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- &gt;&gt;&gt; ys</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-425"></a><span class="hs-comment">--   [  1,  2,  3,  4,  5,  6,  7,  8,  9, 10,</span><span>
</span><a name="line-426"></a><span class="hs-comment">--     11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span><span>
</span><a name="line-427"></a><span class="hs-comment">--     21, 22, 23, 24, 25, 26, 27, 28, 29, 30,</span><span>
</span><a name="line-428"></a><span class="hs-comment">--     31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span><span>
</span><a name="line-429"></a><span class="hs-comment">--     41, 42, 43, 44, 45, 46, 47, 48, 49, 50]</span><span>
</span><a name="line-430"></a><span class="hs-comment">--</span><span>
</span><a name="line-431"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ zipWith (+) (use xs) (use ys)</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- Matrix (Z :. 3 :. 5)</span><span>
</span><a name="line-433"></a><span class="hs-comment">--   [  1,  3,  5,  7,  9,</span><span>
</span><a name="line-434"></a><span class="hs-comment">--     16, 18, 20, 22, 24,</span><span>
</span><a name="line-435"></a><span class="hs-comment">--     31, 33, 35, 37, 39]</span><span>
</span><a name="line-436"></a><span class="hs-comment">--</span><span>
</span><a name="line-437"></a><span class="hs-identifier">zipWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142011"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142012"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142013"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142014"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142012"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142013"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142014"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142011"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142012"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142011"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142013"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142011"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142014"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><a name="zipWith"><a href="Data.Array.Accelerate.Language.html#zipWith"><span class="hs-identifier">zipWith</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#ZipWith"><span class="hs-identifier hs-var">ZipWith</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">-- Reductions</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- ----------</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- | Reduction of the innermost dimension of an array of arbitrary rank.  The</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- first argument needs to be an /associative/ function to enable an efficient</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- parallel implementation. The initial element does not need to be an identity</span><span>
</span><a name="line-450"></a><span class="hs-comment">-- element of the combination function.</span><span>
</span><a name="line-451"></a><span class="hs-comment">--</span><span>
</span><a name="line-452"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-453"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-455"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-456"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-457"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-458"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-459"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-460"></a><span class="hs-comment">--</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ fold (+) 42 (use mat)</span><span>
</span><a name="line-462"></a><span class="hs-comment">-- Vector (Z :. 5) [87,187,287,387,487]</span><span>
</span><a name="line-463"></a><span class="hs-comment">--</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- Reductions with non-commutative operators are supported. For example, the</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- following computes the maximum segment sum problem along each innermost</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- dimension of the array.</span><span>
</span><a name="line-467"></a><span class="hs-comment">--</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- &lt;https://en.wikipedia.org/wiki/Maximum_subarray_problem&gt;</span><span>
</span><a name="line-469"></a><span class="hs-comment">--</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-471"></a><span class="hs-comment">--   let maximumSegmentSum</span><span>
</span><a name="line-472"></a><span class="hs-comment">--           :: forall sh e. (Shape sh, Num e, Ord e)</span><span>
</span><a name="line-473"></a><span class="hs-comment">--           =&gt; Acc (Array (sh :. Int) e)</span><span>
</span><a name="line-474"></a><span class="hs-comment">--           -&gt; Acc (Array sh e)</span><span>
</span><a name="line-475"></a><span class="hs-comment">--       maximumSegmentSum</span><span>
</span><a name="line-476"></a><span class="hs-comment">--         = map (\v -&gt; let (x,_,_,_) = unlift v :: (Exp e, Exp e, Exp e, Exp e) in x)</span><span>
</span><a name="line-477"></a><span class="hs-comment">--         . fold1 f</span><span>
</span><a name="line-478"></a><span class="hs-comment">--         . map g</span><span>
</span><a name="line-479"></a><span class="hs-comment">--         where</span><span>
</span><a name="line-480"></a><span class="hs-comment">--           f :: (Num a, Ord a) =&gt; Exp (a,a,a,a) -&gt; Exp (a,a,a,a) -&gt; Exp (a,a,a,a)</span><span>
</span><a name="line-481"></a><span class="hs-comment">--           f x y =</span><span>
</span><a name="line-482"></a><span class="hs-comment">--             let (mssx, misx, mcsx, tsx) = unlift x</span><span>
</span><a name="line-483"></a><span class="hs-comment">--                 (mssy, misy, mcsy, tsy) = unlift y</span><span>
</span><a name="line-484"></a><span class="hs-comment">--             in</span><span>
</span><a name="line-485"></a><span class="hs-comment">--             lift ( mssx `max` (mssy `max` (mcsx+misy))</span><span>
</span><a name="line-486"></a><span class="hs-comment">--                  , misx `max` (tsx+misy)</span><span>
</span><a name="line-487"></a><span class="hs-comment">--                  , mcsy `max` (mcsx+tsy)</span><span>
</span><a name="line-488"></a><span class="hs-comment">--                  , tsx+tsy</span><span>
</span><a name="line-489"></a><span class="hs-comment">--                  )</span><span>
</span><a name="line-490"></a><span class="hs-comment">--           --</span><span>
</span><a name="line-491"></a><span class="hs-comment">--           g :: (Num a, Ord a) =&gt; Exp a -&gt; Exp (a,a,a,a)</span><span>
</span><a name="line-492"></a><span class="hs-comment">--           g x = let y = max x 0</span><span>
</span><a name="line-493"></a><span class="hs-comment">--                 in  lift (y,y,y,x)</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-495"></a><span class="hs-comment">--</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec = fromList (Z:.10) [-2,1,-3,4,-1,2,1,-5,4,0] :: Vector Int</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ maximumSegmentSum (use vec)</span><span>
</span><a name="line-498"></a><span class="hs-comment">-- Scalar Z [6]</span><span>
</span><a name="line-499"></a><span class="hs-comment">--</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- See also 'Data.Array.Accelerate.Data.Fold.Fold', which can be a useful way to</span><span>
</span><a name="line-501"></a><span class="hs-comment">-- compute multiple results from a single reduction.</span><span>
</span><a name="line-502"></a><span class="hs-comment">--</span><span>
</span><a name="line-503"></a><span class="hs-identifier">fold</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142009"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-506"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142009"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142009"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142010"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><a name="fold"><a href="Data.Array.Accelerate.Language.html#fold"><span class="hs-identifier">fold</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Fold"><span class="hs-identifier hs-var">Fold</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span class="hs-comment">-- | Variant of 'fold' that requires the reduced array to be non-empty and</span><span>
</span><a name="line-511"></a><span class="hs-comment">-- doesn't need an default value.  The first argument needs to be an</span><span>
</span><a name="line-512"></a><span class="hs-comment">-- /associative/ function to enable an efficient parallel implementation. The</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- initial element does not need to be an identity element.</span><span>
</span><a name="line-514"></a><span class="hs-comment">--</span><span>
</span><a name="line-515"></a><span class="hs-identifier">fold1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142007"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142008"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142008"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142008"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142008"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142007"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142008"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680142007"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680142008"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-519"></a><a name="fold1"><a href="Data.Array.Accelerate.Language.html#fold1"><span class="hs-identifier">fold1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Fold1"><span class="hs-identifier hs-var">Fold1</span></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- | Segmented reduction along the innermost dimension of an array. The segment</span><span>
</span><a name="line-522"></a><span class="hs-comment">-- descriptor specifies the lengths of the logical sub-arrays, each of which is</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- reduced independently. The innermost dimension must contain at least as many</span><span>
</span><a name="line-524"></a><span class="hs-comment">-- elements as required by the segment descriptor (sum thereof).</span><span>
</span><a name="line-525"></a><span class="hs-comment">--</span><span>
</span><a name="line-526"></a><span class="hs-comment">-- &gt;&gt;&gt; let seg = fromList (Z:.4) [1,4,0,3] :: Segments Int</span><span>
</span><a name="line-527"></a><span class="hs-comment">-- &gt;&gt;&gt; seg</span><span>
</span><a name="line-528"></a><span class="hs-comment">-- Vector (Z :. 4) [1,4,0,3]</span><span>
</span><a name="line-529"></a><span class="hs-comment">--</span><span>
</span><a name="line-530"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-531"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-532"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-533"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-534"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-535"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-536"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-537"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-538"></a><span class="hs-comment">--</span><span>
</span><a name="line-539"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ foldSeg (+) 0 (use mat) (use seg)</span><span>
</span><a name="line-540"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 4)</span><span>
</span><a name="line-541"></a><span class="hs-comment">--   [  0,  10, 0,  18,</span><span>
</span><a name="line-542"></a><span class="hs-comment">--     10,  50, 0,  48,</span><span>
</span><a name="line-543"></a><span class="hs-comment">--     20,  90, 0,  78,</span><span>
</span><a name="line-544"></a><span class="hs-comment">--     30, 130, 0, 108,</span><span>
</span><a name="line-545"></a><span class="hs-comment">--     40, 170, 0, 138]</span><span>
</span><a name="line-546"></a><span class="hs-comment">--</span><span>
</span><a name="line-547"></a><span class="hs-identifier">foldSeg</span><span>
</span><a name="line-548"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142004"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142006"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Type.html#IsIntegral"><span class="hs-identifier hs-type">IsIntegral</span></a><span> </span><a href="#local-6989586621680142006"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-549"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-551"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142004"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Segments"><span class="hs-identifier hs-type">Segments</span></a><span> </span><a href="#local-6989586621680142006"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142004"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142005"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-554"></a><a name="foldSeg"><a href="Data.Array.Accelerate.Language.html#foldSeg"><span class="hs-identifier">foldSeg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24%24"><span class="hs-operator hs-var">$$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#FoldSeg"><span class="hs-identifier hs-var">FoldSeg</span></a><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-comment">-- | Variant of 'foldSeg' that requires /all/ segments of the reduced array to</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- be non-empty and doesn't need a default value. The segment descriptor</span><span>
</span><a name="line-558"></a><span class="hs-comment">-- specifies the length of each of the logical sub-arrays.</span><span>
</span><a name="line-559"></a><span class="hs-comment">--</span><span>
</span><a name="line-560"></a><span class="hs-identifier">fold1Seg</span><span>
</span><a name="line-561"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680142001"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142002"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142003"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Type.html#IsIntegral"><span class="hs-identifier hs-type">IsIntegral</span></a><span> </span><a href="#local-6989586621680142003"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142002"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142002"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142002"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142001"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142002"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-564"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Segments"><span class="hs-identifier hs-type">Segments</span></a><span> </span><a href="#local-6989586621680142003"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-565"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142001"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142002"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-566"></a><a name="fold1Seg"><a href="Data.Array.Accelerate.Language.html#fold1Seg"><span class="hs-identifier">fold1Seg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Fold1Seg"><span class="hs-identifier hs-var">Fold1Seg</span></a><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-comment">-- Scan functions</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- --------------</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-comment">-- | Data.List style left-to-right scan along the innermost dimension of an</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- arbitrary rank array. The first argument needs to be an /associative/</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- function to enable efficient parallel implementation. The initial value</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- (second argument) may be arbitrary.</span><span>
</span><a name="line-575"></a><span class="hs-comment">--</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec = fromList (Z :. 10) [0..] :: Vector Int</span><span>
</span><a name="line-577"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ scanl (+) 10 (use vec)</span><span>
</span><a name="line-578"></a><span class="hs-comment">-- Vector (Z :. 11) [10,10,11,13,16,20,25,31,38,46,55]</span><span>
</span><a name="line-579"></a><span class="hs-comment">--</span><span>
</span><a name="line-580"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z :. 4 :. 10) [0..] :: Matrix Int</span><span>
</span><a name="line-581"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ scanl (+) 0 (use mat)</span><span>
</span><a name="line-582"></a><span class="hs-comment">-- Matrix (Z :. 4 :. 11)</span><span>
</span><a name="line-583"></a><span class="hs-comment">--   [ 0,  0,  1,  3,   6,  10,  15,  21,  28,  36,  45,</span><span>
</span><a name="line-584"></a><span class="hs-comment">--     0, 10, 21, 33,  46,  60,  75,  91, 108, 126, 145,</span><span>
</span><a name="line-585"></a><span class="hs-comment">--     0, 20, 41, 63,  86, 110, 135, 161, 188, 216, 245,</span><span>
</span><a name="line-586"></a><span class="hs-comment">--     0, 30, 61, 93, 126, 160, 195, 231, 268, 306, 345]</span><span>
</span><a name="line-587"></a><span class="hs-comment">--</span><span>
</span><a name="line-588"></a><span class="hs-identifier">scanl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141999"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-591"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141999"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141999"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142000"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><a name="scanl"><a href="Data.Array.Accelerate.Language.html#scanl"><span class="hs-identifier">scanl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Scanl"><span class="hs-identifier hs-var">Scanl</span></a><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-comment">-- | Variant of 'scanl', where the last element (final reduction result) along</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- each dimension is returned separately. Denotationally we have:</span><span>
</span><a name="line-597"></a><span class="hs-comment">--</span><span>
</span><a name="line-598"></a><span class="hs-comment">-- &gt; scanl' f e arr = (init res, unit (res!len))</span><span>
</span><a name="line-599"></a><span class="hs-comment">-- &gt;   where</span><span>
</span><a name="line-600"></a><span class="hs-comment">-- &gt;     len = shape arr</span><span>
</span><a name="line-601"></a><span class="hs-comment">-- &gt;     res = scanl f e arr</span><span>
</span><a name="line-602"></a><span class="hs-comment">--</span><span>
</span><a name="line-603"></a><span class="hs-comment">-- &gt;&gt;&gt; let vec       = fromList (Z:.10) [0..] :: Vector Int</span><span>
</span><a name="line-604"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res,sum) = run $ scanl' (+) 0 (use vec)</span><span>
</span><a name="line-605"></a><span class="hs-comment">-- &gt;&gt;&gt; res</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- Vector (Z :. 10) [0,0,1,3,6,10,15,21,28,36]</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- &gt;&gt;&gt; sum</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- Scalar Z [45]</span><span>
</span><a name="line-609"></a><span class="hs-comment">--</span><span>
</span><a name="line-610"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat        = fromList (Z:.4:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-611"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res,sums) = run $ scanl' (+) 0 (use mat)</span><span>
</span><a name="line-612"></a><span class="hs-comment">-- &gt;&gt;&gt; res</span><span>
</span><a name="line-613"></a><span class="hs-comment">-- Matrix (Z :. 4 :. 10)</span><span>
</span><a name="line-614"></a><span class="hs-comment">--   [ 0,  0,  1,  3,   6,  10,  15,  21,  28,  36,</span><span>
</span><a name="line-615"></a><span class="hs-comment">--     0, 10, 21, 33,  46,  60,  75,  91, 108, 126,</span><span>
</span><a name="line-616"></a><span class="hs-comment">--     0, 20, 41, 63,  86, 110, 135, 161, 188, 216,</span><span>
</span><a name="line-617"></a><span class="hs-comment">--     0, 30, 61, 93, 126, 160, 195, 231, 268, 306]</span><span>
</span><a name="line-618"></a><span class="hs-comment">-- &gt;&gt;&gt; sums</span><span>
</span><a name="line-619"></a><span class="hs-comment">-- Vector (Z :. 4) [45,145,245,345]</span><span>
</span><a name="line-620"></a><span class="hs-comment">--</span><span>
</span><a name="line-621"></a><span class="hs-identifier">scanl'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141997"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-624"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141997"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-625"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141997"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141997"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141998"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-626"></a><a name="scanl%27"><a href="Data.Array.Accelerate.Language.html#scanl%27"><span class="hs-identifier">scanl'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Scanl%27"><span class="hs-identifier hs-var">Scanl'</span></a><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span class="hs-comment">-- | Data.List style left-to-right scan along the innermost dimension without an</span><span>
</span><a name="line-629"></a><span class="hs-comment">-- initial value (aka inclusive scan). The array must not be empty. The first</span><span>
</span><a name="line-630"></a><span class="hs-comment">-- argument needs to be an /associative/ function. Denotationally, we have:</span><span>
</span><a name="line-631"></a><span class="hs-comment">--</span><span>
</span><a name="line-632"></a><span class="hs-comment">-- &gt; scanl1 f e arr = tail (scanl f e arr)</span><span>
</span><a name="line-633"></a><span class="hs-comment">--</span><span>
</span><a name="line-634"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.4:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-635"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ scanl1 (+) (use mat)</span><span>
</span><a name="line-636"></a><span class="hs-comment">-- Matrix (Z :. 4 :. 10)</span><span>
</span><a name="line-637"></a><span class="hs-comment">--   [  0,  1,  3,   6,  10,  15,  21,  28,  36,  45,</span><span>
</span><a name="line-638"></a><span class="hs-comment">--     10, 21, 33,  46,  60,  75,  91, 108, 126, 145,</span><span>
</span><a name="line-639"></a><span class="hs-comment">--     20, 41, 63,  86, 110, 135, 161, 188, 216, 245,</span><span>
</span><a name="line-640"></a><span class="hs-comment">--     30, 61, 93, 126, 160, 195, 231, 268, 306, 345]</span><span>
</span><a name="line-641"></a><span class="hs-comment">--</span><span>
</span><a name="line-642"></a><span class="hs-identifier">scanl1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141995"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141996"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-643"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141996"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141996"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141996"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-644"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141995"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141996"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141995"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141996"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-646"></a><a name="scanl1"><a href="Data.Array.Accelerate.Language.html#scanl1"><span class="hs-identifier">scanl1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Scanl1"><span class="hs-identifier hs-var">Scanl1</span></a><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-comment">-- | Right-to-left variant of 'scanl'.</span><span>
</span><a name="line-649"></a><span class="hs-comment">--</span><span>
</span><a name="line-650"></a><span class="hs-identifier">scanr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141993"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-653"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141993"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141993"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141994"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-655"></a><a name="scanr"><a href="Data.Array.Accelerate.Language.html#scanr"><span class="hs-identifier">scanr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Scanr"><span class="hs-identifier hs-var">Scanr</span></a><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><span class="hs-comment">-- | Right-to-left variant of 'scanl''.</span><span>
</span><a name="line-658"></a><span class="hs-comment">--</span><span>
</span><a name="line-659"></a><span class="hs-identifier">scanr'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141991"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-662"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141991"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141991"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141991"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141992"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-664"></a><a name="scanr%27"><a href="Data.Array.Accelerate.Language.html#scanr%27"><span class="hs-identifier">scanr'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Scanr%27"><span class="hs-identifier hs-var">Scanr'</span></a><span>
</span><a name="line-665"></a><span>
</span><a name="line-666"></a><span class="hs-comment">-- | Right-to-left variant of 'scanl1'.</span><span>
</span><a name="line-667"></a><span class="hs-comment">--</span><span>
</span><a name="line-668"></a><span class="hs-identifier">scanr1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141989"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141990"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-669"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141990"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141990"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141990"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141989"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141990"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141989"><span class="hs-identifier hs-type">sh</span></a><span class="hs-operator">:.</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680141990"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-672"></a><a name="scanr1"><a href="Data.Array.Accelerate.Language.html#scanr1"><span class="hs-identifier">scanr1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Scanr1"><span class="hs-identifier hs-var">Scanr1</span></a><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-comment">-- Permutations</span><span>
</span><a name="line-675"></a><span class="hs-comment">-- ------------</span><span>
</span><a name="line-676"></a><span>
</span><a name="line-677"></a><span class="hs-comment">-- | Generalised forward permutation operation (array scatter).</span><span>
</span><a name="line-678"></a><span class="hs-comment">--</span><span>
</span><a name="line-679"></a><span class="hs-comment">-- Forward permutation specified by a function mapping indices from the source</span><span>
</span><a name="line-680"></a><span class="hs-comment">-- array to indices in the result array. The result array is initialised with</span><span>
</span><a name="line-681"></a><span class="hs-comment">-- the given defaults and any further values that are permuted into the result</span><span>
</span><a name="line-682"></a><span class="hs-comment">-- array are added to the current value using the given combination function.</span><span>
</span><a name="line-683"></a><span class="hs-comment">--</span><span>
</span><a name="line-684"></a><span class="hs-comment">-- The combination function must be /associative/ and /commutative/. Elements</span><span>
</span><a name="line-685"></a><span class="hs-comment">-- that are mapped to the magic value 'ignore' by the permutation function are</span><span>
</span><a name="line-686"></a><span class="hs-comment">-- dropped.</span><span>
</span><a name="line-687"></a><span class="hs-comment">--</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- The combination function is given the new value being permuted as its first</span><span>
</span><a name="line-689"></a><span class="hs-comment">-- argument, and the current value of the array as its second.</span><span>
</span><a name="line-690"></a><span class="hs-comment">--</span><span>
</span><a name="line-691"></a><span class="hs-comment">-- For example, we can use 'permute' to compute the occurrence count (histogram)</span><span>
</span><a name="line-692"></a><span class="hs-comment">-- for an array of values in the range @[0,10)@:</span><span>
</span><a name="line-693"></a><span class="hs-comment">--</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-695"></a><span class="hs-comment">--   let histogram :: Acc (Vector Int) -&gt; Acc (Vector Int)</span><span>
</span><a name="line-696"></a><span class="hs-comment">--       histogram xs =</span><span>
</span><a name="line-697"></a><span class="hs-comment">--         let zeros = fill (constant (Z:.10)) 0</span><span>
</span><a name="line-698"></a><span class="hs-comment">--             ones  = fill (shape xs)         1</span><span>
</span><a name="line-699"></a><span class="hs-comment">--         in</span><span>
</span><a name="line-700"></a><span class="hs-comment">--         permute (+) zeros (\ix -&gt; index1 (xs!ix)) ones</span><span>
</span><a name="line-701"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-702"></a><span class="hs-comment">--</span><span>
</span><a name="line-703"></a><span class="hs-comment">-- &gt;&gt;&gt; let xs = fromList (Z :. 20) [0,0,1,2,1,1,2,4,8,3,4,9,8,3,2,5,5,3,1,2] :: Vector Int</span><span>
</span><a name="line-704"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ histogram (use xs)</span><span>
</span><a name="line-705"></a><span class="hs-comment">-- Vector (Z :. 10) [2,4,4,3,2,2,0,0,2,1]</span><span>
</span><a name="line-706"></a><span class="hs-comment">--</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- As a second example, note that the dimensionality of the source and</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- destination arrays can differ. In this way, we can use 'permute' to create an</span><span>
</span><a name="line-709"></a><span class="hs-comment">-- identity matrix by overwriting elements along the diagonal:</span><span>
</span><a name="line-710"></a><span class="hs-comment">--</span><span>
</span><a name="line-711"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-712"></a><span class="hs-comment">--   let identity :: Num a =&gt; Exp Int -&gt; Acc (Matrix a)</span><span>
</span><a name="line-713"></a><span class="hs-comment">--       identity n =</span><span>
</span><a name="line-714"></a><span class="hs-comment">--         let zeros = fill (index2 n n) 0</span><span>
</span><a name="line-715"></a><span class="hs-comment">--             ones  = fill (index1 n)   1</span><span>
</span><a name="line-716"></a><span class="hs-comment">--         in</span><span>
</span><a name="line-717"></a><span class="hs-comment">--         permute const zeros (\(unindex1 -&gt; i) -&gt; index2 i i) ones</span><span>
</span><a name="line-718"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-719"></a><span class="hs-comment">--</span><span>
</span><a name="line-720"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ identity 5 :: Matrix Int</span><span>
</span><a name="line-721"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 5)</span><span>
</span><a name="line-722"></a><span class="hs-comment">--   [ 1, 0, 0, 0, 0,</span><span>
</span><a name="line-723"></a><span class="hs-comment">--     0, 1, 0, 0, 0,</span><span>
</span><a name="line-724"></a><span class="hs-comment">--     0, 0, 1, 0, 0,</span><span>
</span><a name="line-725"></a><span class="hs-comment">--     0, 0, 0, 1, 0,</span><span>
</span><a name="line-726"></a><span class="hs-comment">--     0, 0, 0, 0, 1]</span><span>
</span><a name="line-727"></a><span class="hs-comment">--</span><span>
</span><a name="line-728"></a><span class="hs-comment">-- [/Note:/]</span><span>
</span><a name="line-729"></a><span class="hs-comment">--</span><span>
</span><a name="line-730"></a><span class="hs-comment">-- Regarding array fusion:</span><span>
</span><a name="line-731"></a><span class="hs-comment">--</span><span>
</span><a name="line-732"></a><span class="hs-comment">--   1. The 'permute' operation will always be evaluated; it can not be fused</span><span>
</span><a name="line-733"></a><span class="hs-comment">--      into a later step.</span><span>
</span><a name="line-734"></a><span class="hs-comment">--</span><span>
</span><a name="line-735"></a><span class="hs-comment">--   2. Since the index permutation function might not cover all positions in</span><span>
</span><a name="line-736"></a><span class="hs-comment">--      the output array (the function is not surjective), the array of default</span><span>
</span><a name="line-737"></a><span class="hs-comment">--      values must be evaluated. However, other operations may fuse into this.</span><span>
</span><a name="line-738"></a><span class="hs-comment">--</span><span>
</span><a name="line-739"></a><span class="hs-comment">--   3. The array of source values can fuse into the permutation operation.</span><span>
</span><a name="line-740"></a><span class="hs-comment">--</span><span>
</span><a name="line-741"></a><span class="hs-comment">--   4. If the array of default values is only used once, it will be updated</span><span>
</span><a name="line-742"></a><span class="hs-comment">--      in-place.</span><span>
</span><a name="line-743"></a><span class="hs-comment">--</span><span>
</span><a name="line-744"></a><span class="hs-identifier">permute</span><span>
</span><a name="line-745"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141986"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141987"><span class="hs-identifier hs-type">sh'</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-746"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ combination function</span><span>
</span><a name="line-747"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141987"><span class="hs-identifier hs-type">sh'</span></a><span> </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- ^ array of default values</span><span>
</span><a name="line-748"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141986"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141987"><span class="hs-identifier hs-type">sh'</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ index permutation function</span><span>
</span><a name="line-749"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141986"><span class="hs-identifier hs-type">sh</span></a><span>  </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- ^ array of source values to be permuted</span><span>
</span><a name="line-750"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141987"><span class="hs-identifier hs-type">sh'</span></a><span> </span><a href="#local-6989586621680141988"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-751"></a><a name="permute"><a href="Data.Array.Accelerate.Language.html#permute"><span class="hs-identifier">permute</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24%24"><span class="hs-operator hs-var">$$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Permute"><span class="hs-identifier hs-var">Permute</span></a><span>
</span><a name="line-752"></a><span>
</span><a name="line-753"></a><span class="hs-comment">-- | Generalised backward permutation operation (array gather).</span><span>
</span><a name="line-754"></a><span class="hs-comment">--</span><span>
</span><a name="line-755"></a><span class="hs-comment">-- Backward permutation specified by a function mapping indices in the</span><span>
</span><a name="line-756"></a><span class="hs-comment">-- destination array to indices in the source array. Elements of the output</span><span>
</span><a name="line-757"></a><span class="hs-comment">-- array are thus generated by reading from the corresponding index in the</span><span>
</span><a name="line-758"></a><span class="hs-comment">-- source array.</span><span>
</span><a name="line-759"></a><span class="hs-comment">--</span><span>
</span><a name="line-760"></a><span class="hs-comment">-- For example, backpermute can be used to</span><span>
</span><a name="line-761"></a><span class="hs-comment">-- 'Data.Array.Accelerate.Prelude.transpose' a matrix; at every index @Z:.y:.x@</span><span>
</span><a name="line-762"></a><span class="hs-comment">-- in the result array, we get the value at that index by reading from the</span><span>
</span><a name="line-763"></a><span class="hs-comment">-- source array at index @Z:.x:.y@:</span><span>
</span><a name="line-764"></a><span class="hs-comment">--</span><span>
</span><a name="line-765"></a><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><a name="line-766"></a><span class="hs-comment">--   let swap :: Exp DIM2 -&gt; Exp DIM2</span><span>
</span><a name="line-767"></a><span class="hs-comment">--       swap = lift1 f</span><span>
</span><a name="line-768"></a><span class="hs-comment">--         where</span><span>
</span><a name="line-769"></a><span class="hs-comment">--           f :: Z :. Exp Int :. Exp Int -&gt; Z :. Exp Int :. Exp Int</span><span>
</span><a name="line-770"></a><span class="hs-comment">--           f (Z:.y:.x) = Z :. x :. y</span><span>
</span><a name="line-771"></a><span class="hs-comment">-- :}</span><span>
</span><a name="line-772"></a><span class="hs-comment">--</span><span>
</span><a name="line-773"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-774"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-775"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-776"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-777"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-778"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-779"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-780"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-781"></a><span class="hs-comment">--</span><span>
</span><a name="line-782"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat' = use mat</span><span>
</span><a name="line-783"></a><span class="hs-comment">-- &gt;&gt;&gt; run $ backpermute (swap (shape mat')) swap mat'</span><span>
</span><a name="line-784"></a><span class="hs-comment">-- Matrix (Z :. 10 :. 5)</span><span>
</span><a name="line-785"></a><span class="hs-comment">--   [ 0, 10, 20, 30, 40,</span><span>
</span><a name="line-786"></a><span class="hs-comment">--     1, 11, 21, 31, 41,</span><span>
</span><a name="line-787"></a><span class="hs-comment">--     2, 12, 22, 32, 42,</span><span>
</span><a name="line-788"></a><span class="hs-comment">--     3, 13, 23, 33, 43,</span><span>
</span><a name="line-789"></a><span class="hs-comment">--     4, 14, 24, 34, 44,</span><span>
</span><a name="line-790"></a><span class="hs-comment">--     5, 15, 25, 35, 45,</span><span>
</span><a name="line-791"></a><span class="hs-comment">--     6, 16, 26, 36, 46,</span><span>
</span><a name="line-792"></a><span class="hs-comment">--     7, 17, 27, 37, 47,</span><span>
</span><a name="line-793"></a><span class="hs-comment">--     8, 18, 28, 38, 48,</span><span>
</span><a name="line-794"></a><span class="hs-comment">--     9, 19, 29, 39, 49]</span><span>
</span><a name="line-795"></a><span class="hs-comment">--</span><span>
</span><a name="line-796"></a><span class="hs-identifier">backpermute</span><span>
</span><a name="line-797"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141983"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141984"><span class="hs-identifier hs-type">sh'</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141985"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-798"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141984"><span class="hs-identifier hs-type">sh'</span></a><span>                          </span><span class="hs-comment">-- ^ shape of the result array</span><span>
</span><a name="line-799"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141984"><span class="hs-identifier hs-type">sh'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141983"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ index permutation function</span><span>
</span><a name="line-800"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141983"><span class="hs-identifier hs-type">sh</span></a><span>  </span><a href="#local-6989586621680141985"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- ^ source array</span><span>
</span><a name="line-801"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141984"><span class="hs-identifier hs-type">sh'</span></a><span> </span><a href="#local-6989586621680141985"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-802"></a><a name="backpermute"><a href="Data.Array.Accelerate.Language.html#backpermute"><span class="hs-identifier">backpermute</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Backpermute"><span class="hs-identifier hs-var">Backpermute</span></a><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span>
</span><a name="line-805"></a><span class="hs-comment">-- Stencil operations</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- ------------------</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-comment">-- Common stencil types</span><span>
</span><a name="line-809"></a><span class="hs-comment">--</span><span>
</span><a name="line-810"></a><span>
</span><a name="line-811"></a><span class="hs-comment">-- DIM1 stencil type</span><span>
</span><a name="line-812"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3"><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier">Stencil3</span></a></a><span> </span><a name="local-6989586621680141922"><a href="#local-6989586621680141922"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141922"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141922"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141922"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-813"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5"><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier">Stencil5</span></a></a><span> </span><a name="local-6989586621680141921"><a href="#local-6989586621680141921"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141921"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil7"><a href="Data.Array.Accelerate.Language.html#Stencil7"><span class="hs-identifier">Stencil7</span></a></a><span> </span><a name="local-6989586621680141920"><a href="#local-6989586621680141920"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141920"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil9"><a href="Data.Array.Accelerate.Language.html#Stencil9"><span class="hs-identifier">Stencil9</span></a></a><span> </span><a name="local-6989586621680141919"><a href="#local-6989586621680141919"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141919"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-816"></a><span>
</span><a name="line-817"></a><span class="hs-comment">-- DIM2 stencil type</span><span>
</span><a name="line-818"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3x3"><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier">Stencil3x3</span></a></a><span> </span><a name="local-6989586621680141918"><a href="#local-6989586621680141918"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-819"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5x3"><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier">Stencil5x3</span></a></a><span> </span><a name="local-6989586621680141917"><a href="#local-6989586621680141917"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141917"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141917"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141917"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3x5"><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier">Stencil3x5</span></a></a><span> </span><a name="local-6989586621680141916"><a href="#local-6989586621680141916"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141916"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141916"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141916"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141916"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3"><span class="hs-identifier hs-type">Stencil3</span></a><span> </span><a href="#local-6989586621680141916"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-821"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5x5"><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier">Stencil5x5</span></a></a><span> </span><a name="local-6989586621680141915"><a href="#local-6989586621680141915"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5"><span class="hs-identifier hs-type">Stencil5</span></a><span> </span><a href="#local-6989586621680141915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>
</span><a name="line-823"></a><span class="hs-comment">-- DIM3 stencil type</span><span>
</span><a name="line-824"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3x3x3"><a href="Data.Array.Accelerate.Language.html#Stencil3x3x3"><span class="hs-identifier">Stencil3x3x3</span></a></a><span> </span><a name="local-6989586621680141914"><a href="#local-6989586621680141914"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141914"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141914"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141914"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-825"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5x3x3"><a href="Data.Array.Accelerate.Language.html#Stencil5x3x3"><span class="hs-identifier">Stencil5x3x3</span></a></a><span> </span><a name="local-6989586621680141913"><a href="#local-6989586621680141913"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-826"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3x5x3"><a href="Data.Array.Accelerate.Language.html#Stencil3x5x3"><span class="hs-identifier">Stencil3x5x3</span></a></a><span> </span><a name="local-6989586621680141912"><a href="#local-6989586621680141912"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141912"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141912"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141912"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-827"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3x3x5"><a href="Data.Array.Accelerate.Language.html#Stencil3x3x5"><span class="hs-identifier">Stencil3x3x5</span></a></a><span> </span><a name="local-6989586621680141911"><a href="#local-6989586621680141911"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141911"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141911"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141911"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141911"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x3"><span class="hs-identifier hs-type">Stencil3x3</span></a><span> </span><a href="#local-6989586621680141911"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5x5x3"><a href="Data.Array.Accelerate.Language.html#Stencil5x5x3"><span class="hs-identifier">Stencil5x5x3</span></a></a><span> </span><a name="local-6989586621680141910"><a href="#local-6989586621680141910"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141910"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141910"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141910"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-829"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5x3x5"><a href="Data.Array.Accelerate.Language.html#Stencil5x3x5"><span class="hs-identifier">Stencil5x3x5</span></a></a><span> </span><a name="local-6989586621680141909"><a href="#local-6989586621680141909"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141909"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141909"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141909"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141909"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x3"><span class="hs-identifier hs-type">Stencil5x3</span></a><span> </span><a href="#local-6989586621680141909"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-830"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil3x5x5"><a href="Data.Array.Accelerate.Language.html#Stencil3x5x5"><span class="hs-identifier">Stencil3x5x5</span></a></a><span> </span><a name="local-6989586621680141908"><a href="#local-6989586621680141908"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil3x5"><span class="hs-identifier hs-type">Stencil3x5</span></a><span> </span><a href="#local-6989586621680141908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-831"></a><span class="hs-keyword">type</span><span> </span><a name="Stencil5x5x5"><a href="Data.Array.Accelerate.Language.html#Stencil5x5x5"><span class="hs-identifier">Stencil5x5x5</span></a></a><span> </span><a name="local-6989586621680141907"><a href="#local-6989586621680141907"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141907"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141907"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141907"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141907"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Language.html#Stencil5x5"><span class="hs-identifier hs-type">Stencil5x5</span></a><span> </span><a href="#local-6989586621680141907"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-832"></a><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-comment">-- | Map a stencil over an array. In contrast to 'map', the domain of a stencil</span><span>
</span><a name="line-835"></a><span class="hs-comment">-- function is an entire /neighbourhood/ of each array element. Neighbourhoods</span><span>
</span><a name="line-836"></a><span class="hs-comment">-- are sub-arrays centred around a focal point. They are not necessarily</span><span>
</span><a name="line-837"></a><span class="hs-comment">-- rectangular, but they are symmetric and have an extent of at least three</span><span>
</span><a name="line-838"></a><span class="hs-comment">-- along each axis. Due to the symmetry requirement the extent is necessarily</span><span>
</span><a name="line-839"></a><span class="hs-comment">-- odd. The focal point is the array position that is determined by the stencil.</span><span>
</span><a name="line-840"></a><span class="hs-comment">--</span><span>
</span><a name="line-841"></a><span class="hs-comment">-- For those array positions where the neighbourhood extends past the boundaries</span><span>
</span><a name="line-842"></a><span class="hs-comment">-- of the source array, a boundary condition determines the contents of the</span><span>
</span><a name="line-843"></a><span class="hs-comment">-- out-of-bounds neighbourhood positions.</span><span>
</span><a name="line-844"></a><span class="hs-comment">--</span><span>
</span><a name="line-845"></a><span class="hs-comment">-- Stencil neighbourhoods are specified via nested tuples, where the nesting</span><span>
</span><a name="line-846"></a><span class="hs-comment">-- depth is equal to the dimensionality of the array. For example, a 3x1 stencil</span><span>
</span><a name="line-847"></a><span class="hs-comment">-- for a one-dimensional array:</span><span>
</span><a name="line-848"></a><span class="hs-comment">--</span><span>
</span><a name="line-849"></a><span class="hs-comment">-- &gt; s31 :: Stencil3 a -&gt; Exp a</span><span>
</span><a name="line-850"></a><span class="hs-comment">-- &gt; s31 (l,c,r) = ...</span><span>
</span><a name="line-851"></a><span class="hs-comment">--</span><span>
</span><a name="line-852"></a><span class="hs-comment">-- ...where @c@ is the focal point of the stencil, and @l@ and @r@ represent the</span><span>
</span><a name="line-853"></a><span class="hs-comment">-- elements to the left and right of the focal point, respectively. Similarly,</span><span>
</span><a name="line-854"></a><span class="hs-comment">-- a 3x3 stencil for a two-dimensional array:</span><span>
</span><a name="line-855"></a><span class="hs-comment">--</span><span>
</span><a name="line-856"></a><span class="hs-comment">-- &gt; s33 :: Stencil3x3 a -&gt; Exp a</span><span>
</span><a name="line-857"></a><span class="hs-comment">-- &gt; s33 ((_,t,_)</span><span>
</span><a name="line-858"></a><span class="hs-comment">-- &gt;     ,(l,c,r)</span><span>
</span><a name="line-859"></a><span class="hs-comment">-- &gt;     ,(_,b,_)) = ...</span><span>
</span><a name="line-860"></a><span class="hs-comment">--</span><span>
</span><a name="line-861"></a><span class="hs-comment">-- ...where @c@ is again the focal point and @t@, @b@, @l@ and @r@ are the</span><span>
</span><a name="line-862"></a><span class="hs-comment">-- elements to the top, bottom, left, and right of the focal point, respectively</span><span>
</span><a name="line-863"></a><span class="hs-comment">-- (the diagonal elements have been elided).</span><span>
</span><a name="line-864"></a><span class="hs-comment">--</span><span>
</span><a name="line-865"></a><span class="hs-comment">-- For example, the following computes a 5x5</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- &lt;https://en.wikipedia.org/wiki/Gaussian_blur Gaussian blur&gt; as a separable</span><span>
</span><a name="line-867"></a><span class="hs-comment">-- 2-pass operation.</span><span>
</span><a name="line-868"></a><span class="hs-comment">--</span><span>
</span><a name="line-869"></a><span class="hs-comment">-- &gt; type Stencil5x1 a = (Stencil3 a, Stencil5 a, Stencil3 a)</span><span>
</span><a name="line-870"></a><span class="hs-comment">-- &gt; type Stencil1x5 a = (Stencil3 a, Stencil3 a, Stencil3 a, Stencil3 a, Stencil3 a)</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-872"></a><span class="hs-comment">-- &gt; convolve5x1 :: Num a =&gt; [Exp a] -&gt; Stencil5x1 a -&gt; Exp a</span><span>
</span><a name="line-873"></a><span class="hs-comment">-- &gt; convolve5x1 kernel (_, (a,b,c,d,e), _)</span><span>
</span><a name="line-874"></a><span class="hs-comment">-- &gt;   = Prelude.sum $ Prelude.zipWith (*) kernel [a,b,c,d,e]</span><span>
</span><a name="line-875"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-876"></a><span class="hs-comment">-- &gt; convolve1x5 :: Num a =&gt; [Exp a] -&gt; Stencil1x5 a -&gt; Exp a</span><span>
</span><a name="line-877"></a><span class="hs-comment">-- &gt; convolve1x5 kernel ((_,a,_), (_,b,_), (_,c,_), (_,d,_), (_,e,_))</span><span>
</span><a name="line-878"></a><span class="hs-comment">-- &gt;   = Prelude.sum $ Prelude.zipWith (*) kernel [a,b,c,d,e]</span><span>
</span><a name="line-879"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-880"></a><span class="hs-comment">-- &gt; gaussian = [0.06136,0.24477,0.38774,0.24477,0.06136]</span><span>
</span><a name="line-881"></a><span class="hs-comment">-- &gt;</span><span>
</span><a name="line-882"></a><span class="hs-comment">-- &gt; blur :: Num a =&gt; Acc (Matrix a) -&gt; Acc (Matrix a)</span><span>
</span><a name="line-883"></a><span class="hs-comment">-- &gt; blur = stencil (convolve5x1 gaussian) clamp</span><span>
</span><a name="line-884"></a><span class="hs-comment">-- &gt;      . stencil (convolve1x5 gaussian) clamp</span><span>
</span><a name="line-885"></a><span class="hs-comment">--</span><span>
</span><a name="line-886"></a><span class="hs-identifier">stencil</span><span>
</span><a name="line-887"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a><span> </span><a href="#local-6989586621680141979"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141980"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621680141981"><span class="hs-identifier hs-type">stencil</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141982"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-888"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141981"><span class="hs-identifier hs-type">stencil</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141982"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- ^ stencil function</span><span>
</span><a name="line-889"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141979"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141980"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- ^ boundary condition</span><span>
</span><a name="line-890"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141979"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141980"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                       </span><span class="hs-comment">-- ^ source array</span><span>
</span><a name="line-891"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141979"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141982"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                       </span><span class="hs-comment">-- ^ destination array</span><span>
</span><a name="line-892"></a><a name="stencil"><a href="Data.Array.Accelerate.Language.html#stencil"><span class="hs-identifier">stencil</span></a></a><span> </span><a name="local-6989586621680142029"><a href="#local-6989586621680142029"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><a name="local-6989586621680142030"><a href="#local-6989586621680142030"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680142031"><a href="#local-6989586621680142031"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Stencil"><span class="hs-identifier hs-var">Stencil</span></a><span> </span><a href="#local-6989586621680142029"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680142030"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621680142031"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-893"></a><span>
</span><a name="line-894"></a><span class="hs-comment">-- | Map a binary stencil of an array. The extent of the resulting array is the</span><span>
</span><a name="line-895"></a><span class="hs-comment">-- intersection of the extents of the two source arrays. This is the stencil</span><span>
</span><a name="line-896"></a><span class="hs-comment">-- equivalent of 'zipWith'.</span><span>
</span><a name="line-897"></a><span class="hs-comment">--</span><span>
</span><a name="line-898"></a><span class="hs-identifier">stencil2</span><span>
</span><a name="line-899"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141974"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621680141975"><span class="hs-identifier hs-type">stencil1</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Stencil"><span class="hs-identifier hs-type">Stencil</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141976"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621680141977"><span class="hs-identifier hs-type">stencil2</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141978"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-900"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141975"><span class="hs-identifier hs-type">stencil1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680141977"><span class="hs-identifier hs-type">stencil2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141978"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ binary stencil function</span><span>
</span><a name="line-901"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141974"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- ^ boundary condition #1</span><span>
</span><a name="line-902"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141974"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                       </span><span class="hs-comment">-- ^ source array #1</span><span>
</span><a name="line-903"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141976"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- ^ boundary condition #2</span><span>
</span><a name="line-904"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141976"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                       </span><span class="hs-comment">-- ^ source array #2</span><span>
</span><a name="line-905"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141973"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141978"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>                       </span><span class="hs-comment">-- ^ destination array</span><span>
</span><a name="line-906"></a><a name="stencil2"><a href="Data.Array.Accelerate.Language.html#stencil2"><span class="hs-identifier">stencil2</span></a></a><span> </span><a name="local-6989586621680142032"><a href="#local-6989586621680142032"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><a name="local-6989586621680142033"><a href="#local-6989586621680142033"><span class="hs-identifier">b1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680142034"><a href="#local-6989586621680142034"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><a name="local-6989586621680142035"><a href="#local-6989586621680142035"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680142036"><a href="#local-6989586621680142036"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Stencil2"><span class="hs-identifier hs-var">Stencil2</span></a><span> </span><a href="#local-6989586621680142032"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680142033"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621680142034"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621680142035"><span class="hs-identifier hs-var">b2</span></a><span> </span><a href="#local-6989586621680142036"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-907"></a><span>
</span><a name="line-908"></a><span class="hs-comment">-- | Boundary condition where elements of the stencil which would be</span><span>
</span><a name="line-909"></a><span class="hs-comment">-- out-of-bounds are instead clamped to the edges of the array.</span><span>
</span><a name="line-910"></a><span class="hs-comment">--</span><span>
</span><a name="line-911"></a><span class="hs-comment">-- In the following 3x3 stencil, the out-of-bounds element @b@ will instead</span><span>
</span><a name="line-912"></a><span class="hs-comment">-- return the value at position @c@:</span><span>
</span><a name="line-913"></a><span class="hs-comment">--</span><span>
</span><a name="line-914"></a><span class="hs-comment">-- &gt;   +------------+</span><span>
</span><a name="line-915"></a><span class="hs-comment">-- &gt;   |a           |</span><span>
</span><a name="line-916"></a><span class="hs-comment">-- &gt;  b|cd          |</span><span>
</span><a name="line-917"></a><span class="hs-comment">-- &gt;   |e           |</span><span>
</span><a name="line-918"></a><span class="hs-comment">-- &gt;   +------------+</span><span>
</span><a name="line-919"></a><span class="hs-comment">--</span><span>
</span><a name="line-920"></a><span class="hs-identifier">clamp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141971"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141972"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-921"></a><a name="clamp"><a href="Data.Array.Accelerate.Language.html#clamp"><span class="hs-identifier">clamp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Clamp"><span class="hs-identifier hs-var">Clamp</span></a><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span class="hs-comment">-- | Stencil boundary condition where coordinates beyond the array extent are</span><span>
</span><a name="line-924"></a><span class="hs-comment">-- instead mirrored</span><span>
</span><a name="line-925"></a><span class="hs-comment">--</span><span>
</span><a name="line-926"></a><span class="hs-comment">-- In the following 5x3 stencil, the out-of-bounds element @c@ will instead</span><span>
</span><a name="line-927"></a><span class="hs-comment">-- return the value at position @d@, and similarly the element at @b@ will</span><span>
</span><a name="line-928"></a><span class="hs-comment">-- return the value at @e@:</span><span>
</span><a name="line-929"></a><span class="hs-comment">--</span><span>
</span><a name="line-930"></a><span class="hs-comment">-- &gt;   +------------+</span><span>
</span><a name="line-931"></a><span class="hs-comment">-- &gt;   |a           |</span><span>
</span><a name="line-932"></a><span class="hs-comment">-- &gt; bc|def         |</span><span>
</span><a name="line-933"></a><span class="hs-comment">-- &gt;   |g           |</span><span>
</span><a name="line-934"></a><span class="hs-comment">-- &gt;   +------------+</span><span>
</span><a name="line-935"></a><span class="hs-comment">--</span><span>
</span><a name="line-936"></a><span class="hs-identifier">mirror</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141969"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141970"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-937"></a><a name="mirror"><a href="Data.Array.Accelerate.Language.html#mirror"><span class="hs-identifier">mirror</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Mirror"><span class="hs-identifier hs-var">Mirror</span></a><span>
</span><a name="line-938"></a><span>
</span><a name="line-939"></a><span class="hs-comment">-- | Stencil boundary condition where coordinates beyond the array extent</span><span>
</span><a name="line-940"></a><span class="hs-comment">-- instead wrap around the array.</span><span>
</span><a name="line-941"></a><span class="hs-comment">--</span><span>
</span><a name="line-942"></a><span class="hs-comment">-- In the following 3x3 stencil, the out of bounds elements will be read as in</span><span>
</span><a name="line-943"></a><span class="hs-comment">-- the pattern on the right.</span><span>
</span><a name="line-944"></a><span class="hs-comment">--</span><span>
</span><a name="line-945"></a><span class="hs-comment">-- &gt;  a bc</span><span>
</span><a name="line-946"></a><span class="hs-comment">-- &gt;   +------------+      +------------+</span><span>
</span><a name="line-947"></a><span class="hs-comment">-- &gt;  d|ef          |      |ef         d|</span><span>
</span><a name="line-948"></a><span class="hs-comment">-- &gt;  g|hi          |  -&gt;  |hi         g|</span><span>
</span><a name="line-949"></a><span class="hs-comment">-- &gt;   |            |      |bc         a|</span><span>
</span><a name="line-950"></a><span class="hs-comment">-- &gt;   +------------+      +------------+</span><span>
</span><a name="line-951"></a><span class="hs-comment">--</span><span>
</span><a name="line-952"></a><span class="hs-identifier">wrap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141967"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141968"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-953"></a><a name="wrap"><a href="Data.Array.Accelerate.Language.html#wrap"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-comment">-- | Stencil boundary condition where the given function is applied to any</span><span>
</span><a name="line-956"></a><span class="hs-comment">-- outlying coordinates.</span><span>
</span><a name="line-957"></a><span class="hs-comment">--</span><span>
</span><a name="line-958"></a><span class="hs-identifier">function</span><span>
</span><a name="line-959"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141965"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141966"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-960"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141965"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141966"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-961"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141965"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141966"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-962"></a><a name="function"><a href="Data.Array.Accelerate.Language.html#function"><span class="hs-identifier">function</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Boundary"><span class="hs-identifier hs-var">Boundary</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Function"><span class="hs-identifier hs-var">Function</span></a><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span class="hs-comment">{--
-- Sequence operations
-- ------------------

-- Common sequence types
--

streamIn :: Arrays a
         =&gt; [a]
         -&gt; Seq [a]
streamIn arrs = Seq (StreamIn arrs)

-- | Convert the given array to a sequence by dividing the array up into subarrays.
-- The first argument captures how to the division should be performed. The
-- presence of `All` in the division descriptor indicates that elements in the
-- corresponding dimension should be retained in the subarrays, whereas `Split`
-- indicates that the input array should divided along this dimension.
--
toSeq :: (Division slsix, Elt a)
      =&gt; slsix
      -&gt; Acc (Array (FullShape (DivisionSlice slsix)) a)
      -&gt; Seq [Array (SliceShape (DivisionSlice slsix)) a]
toSeq spec acc = Seq (ToSeq spec acc)

-- | Apply the given array function element-wise to the given sequence.
--
mapSeq :: (Arrays a, Arrays b)
       =&gt; (Acc a -&gt; Acc b)
       -&gt; Seq [a]
       -&gt; Seq [b]
mapSeq = Seq $$ MapSeq

-- | Apply the given binary function element-wise to the two sequences.  The length of the resulting
-- sequence is the minumum of the lengths of the two source sequences.
--
zipWithSeq :: (Arrays a, Arrays b, Arrays c)
           =&gt; (Acc a -&gt; Acc b -&gt; Acc c)
           -&gt; Seq [a]
           -&gt; Seq [b]
           -&gt; Seq [c]
zipWithSeq = Seq $$$ ZipWithSeq

-- | scanSeq (+) a0 x seq. Scan a sequence x by combining each
-- element using the given binary operation (+). (+) must be
-- associative:
--
--   Forall a b c. (a + b) + c = a + (b + c),
--
-- and a0 must be the identity element for (+):
--
--   Forall a. a0 + a = a = a + a0.
--
scanSeq :: Elt a
        =&gt; (Exp a -&gt; Exp a -&gt; Exp a)
        -&gt; Exp a
        -&gt; Seq [Scalar a]
        -&gt; Seq [Scalar a]
scanSeq = Seq $$$ ScanSeq

-- | foldSeq (+) a0 x seq. Fold a sequence x by combining each
-- element using the given binary operation (+). (+) must be
-- associative:
--
--   Forall a b c. (a + b) + c = a + (b + c),
--
-- and a0 must be the identity element for (+):
--
--   Forall a. a0 + a = a = a + a0.
--
foldSeq :: Elt a
        =&gt; (Exp a -&gt; Exp a -&gt; Exp a)
        -&gt; Exp a
        -&gt; Seq [Scalar a]
        -&gt; Seq (Scalar a)
foldSeq = Seq $$$ FoldSeq

-- | foldSeqFlatten f a0 x seq. A specialized version of
-- FoldSeqAct where reduction with the companion operator
-- corresponds to flattening. f must be semi-associative, with vecotor
-- append (++) as the companion operator:
--
--   Forall b sh1 a1 sh2 a2.
--     f (f b sh1 a1) sh2 a2 = f b (sh1 ++ sh2) (a1 ++ a2).
--
-- It is common to ignore the shape vectors, yielding the usual
-- semi-associativity law:
--
--   f b a _ = b + a,
--
-- for some (+) satisfying:
--
--   Forall b a1 a2. (b + a1) + a2 = b + (a1 ++ a2).
--
foldSeqFlatten :: (Arrays a, Shape jx, Elt b)
               =&gt; (Acc a -&gt; Acc (Vector jx) -&gt; Acc (Vector b) -&gt; Acc a)
               -&gt; Acc a
               -&gt; Seq [Array jx b]
               -&gt; Seq a
foldSeqFlatten = Seq $$$ FoldSeqFlatten

collect :: Arrays arrs =&gt; Seq arrs -&gt; Acc arrs
collect = Acc . Collect
--}</span><span>
</span><a name="line-1068"></a><span>
</span><a name="line-1069"></a><span class="hs-comment">-- Foreign function calling</span><span>
</span><a name="line-1070"></a><span class="hs-comment">-- ------------------------</span><span>
</span><a name="line-1071"></a><span>
</span><a name="line-1072"></a><span class="hs-comment">-- | Call a foreign array function.</span><span>
</span><a name="line-1073"></a><span class="hs-comment">--</span><span>
</span><a name="line-1074"></a><span class="hs-comment">-- The form the first argument takes is dependent on the backend being targeted.</span><span>
</span><a name="line-1075"></a><span class="hs-comment">-- Note that the foreign function only has access to the input array(s) passed</span><span>
</span><a name="line-1076"></a><span class="hs-comment">-- in as its argument.</span><span>
</span><a name="line-1077"></a><span class="hs-comment">--</span><span>
</span><a name="line-1078"></a><span class="hs-comment">-- In case the operation is being executed on a backend which does not support</span><span>
</span><a name="line-1079"></a><span class="hs-comment">-- this foreign implementation, the fallback implementation is used instead,</span><span>
</span><a name="line-1080"></a><span class="hs-comment">-- which itself could be a foreign implementation for a (presumably) different</span><span>
</span><a name="line-1081"></a><span class="hs-comment">-- backend, or an implementation in pure Accelerate. In this way, multiple</span><span>
</span><a name="line-1082"></a><span class="hs-comment">-- foreign implementations can be supplied, and will be tested for suitability</span><span>
</span><a name="line-1083"></a><span class="hs-comment">-- against the target backend in sequence.</span><span>
</span><a name="line-1084"></a><span class="hs-comment">--</span><span>
</span><a name="line-1085"></a><span class="hs-comment">-- For an example see the &lt;https://hackage.haskell.org/package/accelerate-fft accelerate-fft&gt; package.</span><span>
</span><a name="line-1086"></a><span class="hs-comment">--</span><span>
</span><a name="line-1087"></a><span class="hs-identifier">foreignAcc</span><span>
</span><a name="line-1088"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680141963"><span class="hs-identifier hs-type">bs</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a><span> </span><a href="#local-6989586621680141964"><span class="hs-identifier hs-type">asm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1089"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680141964"><span class="hs-identifier hs-type">asm</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680141963"><span class="hs-identifier hs-type">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141963"><span class="hs-identifier hs-type">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1091"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1092"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141963"><span class="hs-identifier hs-type">bs</span></a><span>
</span><a name="line-1093"></a><a name="foreignAcc"><a href="Data.Array.Accelerate.Language.html#foreignAcc"><span class="hs-identifier">foreignAcc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Aforeign"><span class="hs-identifier hs-var">Aforeign</span></a><span>
</span><a name="line-1094"></a><span>
</span><a name="line-1095"></a><span class="hs-comment">-- | Call a foreign scalar expression.</span><span>
</span><a name="line-1096"></a><span class="hs-comment">--</span><span>
</span><a name="line-1097"></a><span class="hs-comment">-- The form of the first argument is dependent on the backend being targeted.</span><span>
</span><a name="line-1098"></a><span class="hs-comment">-- Note that the foreign function only has access to the input element(s) passed</span><span>
</span><a name="line-1099"></a><span class="hs-comment">-- in as its first argument.</span><span>
</span><a name="line-1100"></a><span class="hs-comment">--</span><span>
</span><a name="line-1101"></a><span class="hs-comment">-- As with 'foreignAcc', the fallback implementation itself may be a (sequence</span><span>
</span><a name="line-1102"></a><span class="hs-comment">-- of) foreign implementation(s) for a different backend(s), or implemented</span><span>
</span><a name="line-1103"></a><span class="hs-comment">-- purely in Accelerate.</span><span>
</span><a name="line-1104"></a><span class="hs-comment">--</span><span>
</span><a name="line-1105"></a><span class="hs-identifier">foreignExp</span><span>
</span><a name="line-1106"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141959"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141960"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a><span> </span><a href="#local-6989586621680141961"><span class="hs-identifier hs-type">asm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1107"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680141961"><span class="hs-identifier hs-type">asm</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141959"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680141960"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141959"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141960"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141959"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-1110"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141960"><span class="hs-identifier hs-type">y</span></a><span>
</span><a name="line-1111"></a><a name="foreignExp"><a href="Data.Array.Accelerate.Language.html#foreignExp"><span class="hs-identifier">foreignExp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Foreign"><span class="hs-identifier hs-var">Foreign</span></a><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span>
</span><a name="line-1114"></a><span class="hs-comment">-- Composition of array computations</span><span>
</span><a name="line-1115"></a><span class="hs-comment">-- ---------------------------------</span><span>
</span><a name="line-1116"></a><span>
</span><a name="line-1117"></a><span class="hs-comment">-- | Pipelining of two array computations. The first argument will be fully</span><span>
</span><a name="line-1118"></a><span class="hs-comment">-- evaluated before being passed to the second computation. This can be used to</span><span>
</span><a name="line-1119"></a><span class="hs-comment">-- prevent the argument being fused into the function, for example.</span><span>
</span><a name="line-1120"></a><span class="hs-comment">--</span><span>
</span><a name="line-1121"></a><span class="hs-comment">-- Denotationally, we have</span><span>
</span><a name="line-1122"></a><span class="hs-comment">--</span><span>
</span><a name="line-1123"></a><span class="hs-comment">-- &gt; (acc1 &gt;-&gt; acc2) arrs = let tmp = acc1 arrs</span><span>
</span><a name="line-1124"></a><span class="hs-comment">-- &gt;                        in  tmp `seq` acc2 tmp</span><span>
</span><a name="line-1125"></a><span class="hs-comment">--</span><span>
</span><a name="line-1126"></a><span class="hs-comment">-- For an example use of this operation see the 'Data.Array.Accelerate.compute'</span><span>
</span><a name="line-1127"></a><span class="hs-comment">-- function.</span><span>
</span><a name="line-1128"></a><span class="hs-comment">--</span><span>
</span><a name="line-1129"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">&gt;-&gt;</span><span>
</span><a name="line-1130"></a><span class="hs-special">(</span><span class="hs-operator">&gt;-&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680141956"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680141957"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680141958"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141956"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141957"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141957"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141958"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141956"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141958"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1131"></a><span class="hs-special">(</span><a name="%3E-%3E"><a href="Data.Array.Accelerate.Language.html#%3E-%3E"><span class="hs-operator">&gt;-&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span>
</span><a name="line-1134"></a><span class="hs-comment">-- Flow control constructs</span><span>
</span><a name="line-1135"></a><span class="hs-comment">-- -----------------------</span><span>
</span><a name="line-1136"></a><span>
</span><a name="line-1137"></a><span class="hs-comment">-- | An array-level if-then-else construct.</span><span>
</span><a name="line-1138"></a><span class="hs-comment">--</span><span>
</span><a name="line-1139"></a><span class="hs-comment">-- Enabling the @RebindableSyntax@ extension will allow you to use the standard</span><span>
</span><a name="line-1140"></a><span class="hs-comment">-- if-then-else syntax instead.</span><span>
</span><a name="line-1141"></a><span class="hs-comment">--</span><span>
</span><a name="line-1142"></a><span class="hs-identifier">acond</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680141955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1143"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>               </span><span class="hs-comment">-- ^ if-condition</span><span>
</span><a name="line-1144"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141955"><span class="hs-identifier hs-type">a</span></a><span>                  </span><span class="hs-comment">-- ^ then-array</span><span>
</span><a name="line-1145"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141955"><span class="hs-identifier hs-type">a</span></a><span>                  </span><span class="hs-comment">-- ^ else-array</span><span>
</span><a name="line-1146"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1147"></a><a name="acond"><a href="Data.Array.Accelerate.Language.html#acond"><span class="hs-identifier">acond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Acond"><span class="hs-identifier hs-var">Acond</span></a><span>
</span><a name="line-1148"></a><span>
</span><a name="line-1149"></a><span class="hs-comment">-- | An array-level 'while' construct. Continue to apply the given function,</span><span>
</span><a name="line-1150"></a><span class="hs-comment">-- starting with the initial value, until the test function evaluates to</span><span>
</span><a name="line-1151"></a><span class="hs-comment">-- 'False'.</span><span>
</span><a name="line-1152"></a><span class="hs-comment">--</span><span>
</span><a name="line-1153"></a><span class="hs-identifier">awhile</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Arrays"><span class="hs-identifier hs-type">Arrays</span></a><span> </span><a href="#local-6989586621680141954"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1154"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141954"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ keep evaluating while this returns 'True'</span><span>
</span><a name="line-1155"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141954"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141954"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- ^ function to apply</span><span>
</span><a name="line-1156"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141954"><span class="hs-identifier hs-type">a</span></a><span>                           </span><span class="hs-comment">-- ^ initial value</span><span>
</span><a name="line-1157"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><a href="#local-6989586621680141954"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1158"></a><a name="awhile"><a href="Data.Array.Accelerate.Language.html#awhile"><span class="hs-identifier">awhile</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-var">Acc</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Awhile"><span class="hs-identifier hs-var">Awhile</span></a><span>
</span><a name="line-1159"></a><span>
</span><a name="line-1160"></a><span>
</span><a name="line-1161"></a><span class="hs-comment">-- Shapes and indices</span><span>
</span><a name="line-1162"></a><span class="hs-comment">-- ------------------</span><span>
</span><a name="line-1163"></a><span>
</span><a name="line-1164"></a><span class="hs-comment">-- | Get the innermost dimension of a shape.</span><span>
</span><a name="line-1165"></a><span class="hs-comment">--</span><span>
</span><a name="line-1166"></a><span class="hs-comment">-- The innermost dimension (right-most component of the shape) is the index of</span><span>
</span><a name="line-1167"></a><span class="hs-comment">-- the array which varies most rapidly, and corresponds to elements of the array</span><span>
</span><a name="line-1168"></a><span class="hs-comment">-- which are adjacent in memory.</span><span>
</span><a name="line-1169"></a><span class="hs-comment">--</span><span>
</span><a name="line-1170"></a><span class="hs-comment">-- Another way to think of this is, for example when writing nested loops over</span><span>
</span><a name="line-1171"></a><span class="hs-comment">-- an array in C, this index corresponds to the index iterated over by the</span><span>
</span><a name="line-1172"></a><span class="hs-comment">-- innermost nested loop.</span><span>
</span><a name="line-1173"></a><span class="hs-comment">--</span><span>
</span><a name="line-1174"></a><span class="hs-identifier">indexHead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Slice"><span class="hs-identifier hs-type">Slice</span></a><span> </span><a href="#local-6989586621680141952"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141953"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141952"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-operator">:.</span><span> </span><a href="#local-6989586621680141953"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141953"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1175"></a><a name="indexHead"><a href="Data.Array.Accelerate.Language.html#indexHead"><span class="hs-identifier">indexHead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#IndexHead"><span class="hs-identifier hs-var">IndexHead</span></a><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span class="hs-comment">-- | Get all but the innermost element of a shape</span><span>
</span><a name="line-1178"></a><span class="hs-comment">--</span><span>
</span><a name="line-1179"></a><span class="hs-identifier">indexTail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Slice"><span class="hs-identifier hs-type">Slice</span></a><span> </span><a href="#local-6989586621680141950"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141951"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680141950"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-operator">:.</span><span> </span><a href="#local-6989586621680141951"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141950"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1180"></a><a name="indexTail"><a href="Data.Array.Accelerate.Language.html#indexTail"><span class="hs-identifier">indexTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#IndexTail"><span class="hs-identifier hs-var">IndexTail</span></a><span>
</span><a name="line-1181"></a><span>
</span><a name="line-1182"></a><span class="hs-comment">-- | Map a multi-dimensional index into a linear, row-major representation of an</span><span>
</span><a name="line-1183"></a><span class="hs-comment">-- array.</span><span>
</span><a name="line-1184"></a><span class="hs-comment">--</span><span>
</span><a name="line-1185"></a><span class="hs-identifier">toIndex</span><span>
</span><a name="line-1186"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141949"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1187"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141949"><span class="hs-identifier hs-type">sh</span></a><span>                     </span><span class="hs-comment">-- ^ extent of the array</span><span>
</span><a name="line-1188"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141949"><span class="hs-identifier hs-type">sh</span></a><span>                     </span><span class="hs-comment">-- ^ index to remap</span><span>
</span><a name="line-1189"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1190"></a><a name="toIndex"><a href="Data.Array.Accelerate.Language.html#toIndex"><span class="hs-identifier">toIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#ToIndex"><span class="hs-identifier hs-var">ToIndex</span></a><span>
</span><a name="line-1191"></a><span>
</span><a name="line-1192"></a><span class="hs-comment">-- | Inverse of 'toIndex'</span><span>
</span><a name="line-1193"></a><span class="hs-comment">--</span><span>
</span><a name="line-1194"></a><span class="hs-identifier">fromIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141948"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141948"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141948"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1195"></a><a name="fromIndex"><a href="Data.Array.Accelerate.Language.html#fromIndex"><span class="hs-identifier">fromIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#FromIndex"><span class="hs-identifier hs-var">FromIndex</span></a><span>
</span><a name="line-1196"></a><span>
</span><a name="line-1197"></a><span class="hs-comment">-- | Intersection of two shapes</span><span>
</span><a name="line-1198"></a><span class="hs-comment">--</span><span>
</span><a name="line-1199"></a><span class="hs-identifier">intersect</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141947"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141947"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141947"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141947"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1200"></a><a name="intersect"><a href="Data.Array.Accelerate.Language.html#intersect"><span class="hs-identifier">intersect</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Intersect"><span class="hs-identifier hs-var">Intersect</span></a><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-comment">-- | Union of two shapes</span><span>
</span><a name="line-1203"></a><span class="hs-comment">--</span><span>
</span><a name="line-1204"></a><span class="hs-identifier">union</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141946"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141946"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141946"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141946"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1205"></a><a name="union"><a href="Data.Array.Accelerate.Language.html#union"><span class="hs-identifier">union</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Union"><span class="hs-identifier hs-var">Union</span></a><span>
</span><a name="line-1206"></a><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span class="hs-comment">-- Flow-control</span><span>
</span><a name="line-1209"></a><span class="hs-comment">-- ------------</span><span>
</span><a name="line-1210"></a><span>
</span><a name="line-1211"></a><span class="hs-comment">-- | A scalar-level if-then-else construct.</span><span>
</span><a name="line-1212"></a><span class="hs-comment">--</span><span>
</span><a name="line-1213"></a><span class="hs-comment">-- Enabling the @RebindableSyntax@ extension will allow you to use the standard</span><span>
</span><a name="line-1214"></a><span class="hs-comment">-- if-then-else syntax instead.</span><span>
</span><a name="line-1215"></a><span class="hs-comment">--</span><span>
</span><a name="line-1216"></a><span class="hs-identifier">cond</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141945"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-1217"></a><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                </span><span class="hs-comment">-- ^ condition</span><span>
</span><a name="line-1218"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141945"><span class="hs-identifier hs-type">t</span></a><span>                   </span><span class="hs-comment">-- ^ then-expression</span><span>
</span><a name="line-1219"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141945"><span class="hs-identifier hs-type">t</span></a><span>                   </span><span class="hs-comment">-- ^ else-expression</span><span>
</span><a name="line-1220"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141945"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-1221"></a><a name="cond"><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Cond"><span class="hs-identifier hs-var">Cond</span></a><span>
</span><a name="line-1222"></a><span>
</span><a name="line-1223"></a><span class="hs-comment">-- | While construct. Continue to apply the given function, starting with the</span><span>
</span><a name="line-1224"></a><span class="hs-comment">-- initial value, until the test function evaluates to 'False'.</span><span>
</span><a name="line-1225"></a><span class="hs-comment">--</span><span>
</span><a name="line-1226"></a><span class="hs-identifier">while</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141944"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-1227"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141944"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ keep evaluating while this returns 'True'</span><span>
</span><a name="line-1228"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141944"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141944"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ function to apply</span><span>
</span><a name="line-1229"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141944"><span class="hs-identifier hs-type">e</span></a><span>                  </span><span class="hs-comment">-- ^ initial value</span><span>
</span><a name="line-1230"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141944"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-1231"></a><a name="while"><a href="Data.Array.Accelerate.Language.html#while"><span class="hs-identifier">while</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24%24"><span class="hs-operator hs-var">$$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#While"><span class="hs-identifier hs-var">While</span></a><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span class="hs-comment">-- Array operations with a scalar result</span><span>
</span><a name="line-1235"></a><span class="hs-comment">-- -------------------------------------</span><span>
</span><a name="line-1236"></a><span>
</span><a name="line-1237"></a><span class="hs-comment">-- | Multidimensional array indexing. Extract the value from an array at the</span><span>
</span><a name="line-1238"></a><span class="hs-comment">-- specified zero-based index.</span><span>
</span><a name="line-1239"></a><span class="hs-comment">--</span><span>
</span><a name="line-1240"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-1241"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-1242"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-1243"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-1244"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-1245"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-1246"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-1247"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-1248"></a><span class="hs-comment">--</span><span>
</span><a name="line-1249"></a><span class="hs-comment">-- &gt;&gt;&gt; runExp $ use mat ! constant (Z:.1:.2)</span><span>
</span><a name="line-1250"></a><span class="hs-comment">-- 12</span><span>
</span><a name="line-1251"></a><span class="hs-comment">--</span><span>
</span><a name="line-1252"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-glyph">!</span><span>
</span><a name="line-1253"></a><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141942"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141943"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141942"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141943"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141942"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141943"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-1254"></a><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#Index"><span class="hs-identifier hs-var">Index</span></a><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span class="hs-comment">-- | Extract the value from an array at the specified linear index.</span><span>
</span><a name="line-1257"></a><span class="hs-comment">-- Multidimensional arrays in Accelerate are stored in row-major order with</span><span>
</span><a name="line-1258"></a><span class="hs-comment">-- zero-based indexing.</span><span>
</span><a name="line-1259"></a><span class="hs-comment">--</span><span>
</span><a name="line-1260"></a><span class="hs-comment">-- &gt;&gt;&gt; let mat = fromList (Z:.5:.10) [0..] :: Matrix Int</span><span>
</span><a name="line-1261"></a><span class="hs-comment">-- &gt;&gt;&gt; mat</span><span>
</span><a name="line-1262"></a><span class="hs-comment">-- Matrix (Z :. 5 :. 10)</span><span>
</span><a name="line-1263"></a><span class="hs-comment">--   [  0,  1,  2,  3,  4,  5,  6,  7,  8,  9,</span><span>
</span><a name="line-1264"></a><span class="hs-comment">--     10, 11, 12, 13, 14, 15, 16, 17, 18, 19,</span><span>
</span><a name="line-1265"></a><span class="hs-comment">--     20, 21, 22, 23, 24, 25, 26, 27, 28, 29,</span><span>
</span><a name="line-1266"></a><span class="hs-comment">--     30, 31, 32, 33, 34, 35, 36, 37, 38, 39,</span><span>
</span><a name="line-1267"></a><span class="hs-comment">--     40, 41, 42, 43, 44, 45, 46, 47, 48, 49]</span><span>
</span><a name="line-1268"></a><span class="hs-comment">--</span><span>
</span><a name="line-1269"></a><span class="hs-comment">-- &gt;&gt;&gt; runExp $ use mat !! 12</span><span>
</span><a name="line-1270"></a><span class="hs-comment">-- 12</span><span>
</span><a name="line-1271"></a><span class="hs-comment">--</span><span>
</span><a name="line-1272"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator">!!</span><span>
</span><a name="line-1273"></a><span class="hs-special">(</span><span class="hs-operator">!!</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141940"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141941"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141940"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141941"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141941"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-1274"></a><span class="hs-special">(</span><a name="%21%21"><a href="Data.Array.Accelerate.Language.html#%21%21"><span class="hs-operator">!!</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Data.Array.Accelerate.Smart.html#LinearIndex"><span class="hs-identifier hs-var">LinearIndex</span></a><span>
</span><a name="line-1275"></a><span>
</span><a name="line-1276"></a><span class="hs-comment">-- | Extract the shape (extent) of an array.</span><span>
</span><a name="line-1277"></a><span class="hs-comment">--</span><span>
</span><a name="line-1278"></a><span class="hs-identifier">shape</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141938"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141939"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141938"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141939"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141938"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1279"></a><a name="shape"><a href="Data.Array.Accelerate.Language.html#shape"><span class="hs-identifier">shape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Shape"><span class="hs-identifier hs-var">Shape</span></a><span>
</span><a name="line-1280"></a><span>
</span><a name="line-1281"></a><span class="hs-comment">-- | The number of elements in the array</span><span>
</span><a name="line-1282"></a><span class="hs-comment">--</span><span>
</span><a name="line-1283"></a><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141936"><span class="hs-identifier hs-type">sh</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141937"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Acc"><span class="hs-identifier hs-type">Acc</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Array"><span class="hs-identifier hs-type">Array</span></a><span> </span><a href="#local-6989586621680141936"><span class="hs-identifier hs-type">sh</span></a><span> </span><a href="#local-6989586621680141937"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1284"></a><a name="size"><a href="Data.Array.Accelerate.Language.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Language.html#shapeSize"><span class="hs-identifier hs-var">shapeSize</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Language.html#shape"><span class="hs-identifier hs-var">shape</span></a><span>
</span><a name="line-1285"></a><span>
</span><a name="line-1286"></a><span class="hs-comment">-- | The number of elements that would be held by an array of the given shape.</span><span>
</span><a name="line-1287"></a><span class="hs-comment">--</span><span>
</span><a name="line-1288"></a><span class="hs-identifier">shapeSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141935"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141935"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1289"></a><a name="shapeSize"><a href="Data.Array.Accelerate.Language.html#shapeSize"><span class="hs-identifier">shapeSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Array.Accelerate.Smart.html#ShapeSize"><span class="hs-identifier hs-var">ShapeSize</span></a><span>
</span><a name="line-1290"></a><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-comment">-- Numeric functions</span><span>
</span><a name="line-1293"></a><span class="hs-comment">-- -----------------</span><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><span class="hs-comment">-- | 'subtract' is the same as @'flip' ('-')@.</span><span>
</span><a name="line-1296"></a><span class="hs-comment">--</span><span>
</span><a name="line-1297"></a><span class="hs-identifier">subtract</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Classes.Num.html#Num"><span class="hs-identifier hs-type">Num</span></a><span> </span><a href="#local-6989586621680141934"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141934"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141934"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141934"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1298"></a><a name="subtract"><a href="Data.Array.Accelerate.Language.html#subtract"><span class="hs-identifier">subtract</span></a></a><span> </span><a name="local-6989586621680142037"><a href="#local-6989586621680142037"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680142038"><a href="#local-6989586621680142038"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680142038"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621680142037"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1299"></a><span>
</span><a name="line-1300"></a><span class="hs-comment">-- | Determine if a number is even</span><span>
</span><a name="line-1301"></a><span class="hs-comment">--</span><span>
</span><a name="line-1302"></a><span class="hs-identifier">even</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680141933"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141933"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1303"></a><a name="even"><a href="Data.Array.Accelerate.Language.html#even"><span class="hs-identifier">even</span></a></a><span> </span><a name="local-6989586621680142039"><a href="#local-6989586621680142039"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680142039"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">rem</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1304"></a><span>
</span><a name="line-1305"></a><span class="hs-comment">-- | Determine if a number is odd</span><span>
</span><a name="line-1306"></a><span class="hs-comment">--</span><span>
</span><a name="line-1307"></a><span class="hs-identifier">odd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680141932"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141932"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1308"></a><a name="odd"><a href="Data.Array.Accelerate.Language.html#odd"><span class="hs-identifier">odd</span></a></a><span> </span><a name="local-6989586621680142040"><a href="#local-6989586621680142040"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680142040"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">rem</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1309"></a><span>
</span><a name="line-1310"></a><span class="hs-comment">-- | @'gcd' x y@ is the non-negative factor of both @x@ and @y@ of which every</span><span>
</span><a name="line-1311"></a><span class="hs-comment">-- common factor of both @x@ and @y@ is also a factor; for example:</span><span>
</span><a name="line-1312"></a><span class="hs-comment">--</span><span>
</span><a name="line-1313"></a><span class="hs-comment">-- &gt; gcd 4 2 = 2</span><span>
</span><a name="line-1314"></a><span class="hs-comment">-- &gt; gcd (-4) 6 = 2</span><span>
</span><a name="line-1315"></a><span class="hs-comment">-- &gt; gcd 0 4 = 4</span><span>
</span><a name="line-1316"></a><span class="hs-comment">-- &gt; gcd 0 0 = 0</span><span>
</span><a name="line-1317"></a><span class="hs-comment">--</span><span>
</span><a name="line-1318"></a><span class="hs-comment">-- That is, the common divisor that is \&quot;greatest\&quot; in the divisibility</span><span>
</span><a name="line-1319"></a><span class="hs-comment">-- preordering.</span><span>
</span><a name="line-1320"></a><span class="hs-comment">--</span><span>
</span><a name="line-1321"></a><span class="hs-identifier">gcd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680141931"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141931"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141931"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141931"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1322"></a><a name="gcd"><a href="Data.Array.Accelerate.Language.html#gcd"><span class="hs-identifier">gcd</span></a></a><span> </span><a name="local-6989586621680142041"><a href="#local-6989586621680142041"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680142042"><a href="#local-6989586621680142042"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680142043"><span class="hs-identifier hs-var">gcd'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">abs</span><span> </span><a href="#local-6989586621680142041"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">abs</span><span> </span><a href="#local-6989586621680142042"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1324"></a><span>    </span><span class="hs-identifier">gcd'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680142044"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142044"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142044"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680142044"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1325"></a><span>    </span><a name="local-6989586621680142043"><a href="#local-6989586621680142043"><span class="hs-identifier">gcd'</span></a></a><span> </span><a name="local-6989586621680142045"><a href="#local-6989586621680142045"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621680142046"><a href="#local-6989586621680142046"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1326"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680142047"><a href="#local-6989586621680142047"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#untup2"><span class="hs-identifier hs-var">untup2</span></a><span>
</span><a name="line-1327"></a><span>                </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Array.Accelerate.Language.html#while"><span class="hs-identifier hs-var">while</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#untup2"><span class="hs-identifier hs-var">untup2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680142048"><a href="#local-6989586621680142048"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680142048"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1328"></a><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#untup2"><span class="hs-identifier hs-var">untup2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680142049"><a href="#local-6989586621680142049"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621680142050"><a href="#local-6989586621680142050"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#tup2"><span class="hs-identifier hs-var">tup2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142050"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680142049"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">rem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680142050"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>                        </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#tup2"><span class="hs-identifier hs-var">tup2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142045"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><a href="#local-6989586621680142046"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1330"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680142047"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span>
</span><a name="line-1333"></a><span class="hs-comment">-- | @'lcm' x y@ is the smallest positive integer that both @x@ and @y@ divide.</span><span>
</span><a name="line-1334"></a><span class="hs-comment">--</span><span>
</span><a name="line-1335"></a><span class="hs-identifier">lcm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680141930"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141930"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141930"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141930"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1336"></a><a name="lcm"><a href="Data.Array.Accelerate.Language.html#lcm"><span class="hs-identifier">lcm</span></a></a><span> </span><a name="local-6989586621680142051"><a href="#local-6989586621680142051"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680142052"><a href="#local-6989586621680142052"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1337"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142051"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%7C%7C"><span class="hs-operator hs-var">||</span></a><span> </span><a href="#local-6989586621680142052"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1338"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680142051"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#gcd"><span class="hs-identifier hs-var">gcd</span></a><span> </span><a href="#local-6989586621680142051"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680142052"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680142052"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1339"></a><span>
</span><a name="line-1340"></a><span>
</span><a name="line-1341"></a><span class="hs-comment">-- | Raise a number to a non-negative integral power</span><span>
</span><a name="line-1342"></a><span class="hs-comment">--</span><span>
</span><a name="line-1343"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">^</span><span>
</span><a name="line-1344"></a><span class="hs-special">(</span><span class="hs-operator">^</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621680141928"><a href="#local-6989586621680141928"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680141929"><a href="#local-6989586621680141929"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Classes.Num.html#Num"><span class="hs-identifier hs-type">Num</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680141929"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141929"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1345"></a><a name="local-6989586621680142053"><a href="#local-6989586621680142053"><span class="hs-identifier">x0</span></a></a><span> </span><a name="%5E"><a href="Data.Array.Accelerate.Language.html#%5E"><span class="hs-operator">^</span></a></a><span> </span><a name="local-6989586621680142054"><a href="#local-6989586621680142054"><span class="hs-identifier">y0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142054"><span class="hs-identifier hs-var">y0</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Ord.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142055"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680142053"><span class="hs-identifier hs-var">x0</span></a><span> </span><a href="#local-6989586621680142054"><span class="hs-identifier hs-var">y0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1347"></a><span>    </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141929"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1348"></a><span>    </span><a name="local-6989586621680142055"><a href="#local-6989586621680142055"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680142057"><a href="#local-6989586621680142057"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680142058"><a href="#local-6989586621680142058"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1349"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680142059"><a href="#local-6989586621680142059"><span class="hs-identifier">x'</span></a></a><span class="hs-special">,</span><a name="local-6989586621680142060"><a href="#local-6989586621680142060"><span class="hs-identifier">y'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#untup2"><span class="hs-identifier hs-var">untup2</span></a><span>
</span><a name="line-1350"></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Array.Accelerate.Language.html#while"><span class="hs-identifier hs-var">while</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#untup2"><span class="hs-identifier hs-var">untup2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680142061"><a href="#local-6989586621680142061"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Language.html#even"><span class="hs-identifier hs-var">even</span></a><span> </span><a href="#local-6989586621680142061"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1351"></a><span>                          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#untup2"><span class="hs-identifier hs-var">untup2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680142062"><a href="#local-6989586621680142062"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><a name="local-6989586621680142063"><a href="#local-6989586621680142063"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#tup2"><span class="hs-identifier hs-var">tup2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142062"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680142062"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680142063"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1352"></a><span>                          </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#tup2"><span class="hs-identifier hs-var">tup2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142057"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680142058"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1353"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-1354"></a><span>      </span><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142060"><span class="hs-identifier hs-var">y'</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142059"><span class="hs-identifier hs-var">x'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142056"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142059"><span class="hs-identifier hs-var">x'</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621680142059"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680142060"><span class="hs-identifier hs-var">y'</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680142059"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1355"></a><span>
</span><a name="line-1356"></a><span>    </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141929"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141928"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1357"></a><span>    </span><a name="local-6989586621680142056"><a href="#local-6989586621680142056"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621680142064"><a href="#local-6989586621680142064"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680142065"><a href="#local-6989586621680142065"><span class="hs-identifier">y</span></a></a><span> </span><a name="local-6989586621680142066"><a href="#local-6989586621680142066"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1358"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680142067"><a href="#local-6989586621680142067"><span class="hs-identifier">x'</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680142068"><a href="#local-6989586621680142068"><span class="hs-identifier">z'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#untup3"><span class="hs-identifier hs-var">untup3</span></a><span>
</span><a name="line-1359"></a><span>                    </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Array.Accelerate.Language.html#while"><span class="hs-identifier hs-var">while</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#untup3"><span class="hs-identifier hs-var">untup3</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680142069"><a href="#local-6989586621680142069"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680142069"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Eq.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1360"></a><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#untup3"><span class="hs-identifier hs-var">untup3</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680142070"><a href="#local-6989586621680142070"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><a name="local-6989586621680142071"><a href="#local-6989586621680142071"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><a name="local-6989586621680142072"><a href="#local-6989586621680142072"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1361"></a><span>                              </span><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Language.html#even"><span class="hs-identifier hs-var">even</span></a><span> </span><a href="#local-6989586621680142071"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#tup3"><span class="hs-identifier hs-var">tup3</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142070"><span class="hs-identifier hs-var">u</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621680142070"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680142071"><span class="hs-identifier hs-var">v</span></a><span>     </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680142072"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1362"></a><span>                                            </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#tup3"><span class="hs-identifier hs-var">tup3</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142070"><span class="hs-identifier hs-var">u</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621680142070"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142071"><span class="hs-identifier hs-var">v</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680142072"><span class="hs-identifier hs-var">w</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621680142070"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1363"></a><span>                            </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Smart.html#tup3"><span class="hs-identifier hs-var">tup3</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142064"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621680142065"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621680142066"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1364"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-1365"></a><span>      </span><a href="#local-6989586621680142067"><span class="hs-identifier hs-var">x'</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680142068"><span class="hs-identifier hs-var">z'</span></a><span>
</span><a name="line-1366"></a><span>
</span><a name="line-1367"></a><span class="hs-comment">-- | Raise a number to an integral power</span><span>
</span><a name="line-1368"></a><span class="hs-comment">--</span><span>
</span><a name="line-1369"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">^^</span><span>
</span><a name="line-1370"></a><span class="hs-special">(</span><span class="hs-operator">^^</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Classes.Fractional.html#Fractional"><span class="hs-identifier hs-type">Fractional</span></a><span> </span><a href="#local-6989586621680141926"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Classes.Integral.html#Integral"><span class="hs-identifier hs-type">Integral</span></a><span> </span><a href="#local-6989586621680141927"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141926"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141927"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141926"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1371"></a><a name="local-6989586621680142073"><a href="#local-6989586621680142073"><span class="hs-identifier">x</span></a></a><span> </span><a name="%5E%5E"><a href="Data.Array.Accelerate.Language.html#%5E%5E"><span class="hs-operator">^^</span></a></a><span> </span><a name="local-6989586621680142074"><a href="#local-6989586621680142074"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1372"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Language.html#cond"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142074"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Data.Array.Accelerate.Classes.Ord.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1373"></a><span>  </span><span class="hs-comment">{- then -}</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142073"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Data.Array.Accelerate.Language.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621680142074"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span>  </span><span class="hs-comment">{- else -}</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">recip</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680142073"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Data.Array.Accelerate.Language.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">negate</span><span> </span><a href="#local-6989586621680142074"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1375"></a><span>
</span><a name="line-1376"></a><span>
</span><a name="line-1377"></a><span class="hs-comment">-- Conversions</span><span>
</span><a name="line-1378"></a><span class="hs-comment">-- -----------</span><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-comment">-- |Convert a character to an 'Int'.</span><span>
</span><a name="line-1381"></a><span class="hs-comment">--</span><span>
</span><a name="line-1382"></a><span class="hs-identifier">ord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1383"></a><a name="ord"><a href="Data.Array.Accelerate.Language.html#ord"><span class="hs-identifier">ord</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#mkOrd"><span class="hs-identifier hs-var">mkOrd</span></a><span>
</span><a name="line-1384"></a><span>
</span><a name="line-1385"></a><span class="hs-comment">-- |Convert an 'Int' into a character.</span><span>
</span><a name="line-1386"></a><span class="hs-comment">--</span><span>
</span><a name="line-1387"></a><span class="hs-identifier">chr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-1388"></a><a name="chr"><a href="Data.Array.Accelerate.Language.html#chr"><span class="hs-identifier">chr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#mkChr"><span class="hs-identifier hs-var">mkChr</span></a><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span class="hs-comment">-- |Convert a Boolean value to an 'Int', where 'False' turns into '0' and 'True'</span><span>
</span><a name="line-1391"></a><span class="hs-comment">-- into '1'.</span><span>
</span><a name="line-1392"></a><span class="hs-comment">--</span><span>
</span><a name="line-1393"></a><span class="hs-identifier">boolToInt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1394"></a><a name="boolToInt"><a href="Data.Array.Accelerate.Language.html#boolToInt"><span class="hs-identifier">boolToInt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#mkBoolToInt"><span class="hs-identifier hs-var">mkBoolToInt</span></a><span>
</span><a name="line-1395"></a><span>
</span><a name="line-1396"></a><span class="hs-comment">-- |Reinterpret a value as another type. The two representations must have the</span><span>
</span><a name="line-1397"></a><span class="hs-comment">-- same bit size.</span><span>
</span><a name="line-1398"></a><span class="hs-comment">--</span><span>
</span><a name="line-1399"></a><span class="hs-identifier">bitcast</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141924"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Elt"><span class="hs-identifier hs-type">Elt</span></a><span> </span><a href="#local-6989586621680141925"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Type.html#IsScalar"><span class="hs-identifier hs-type">IsScalar</span></a><span> </span><a href="#local-6989586621680141924"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Type.html#IsScalar"><span class="hs-identifier hs-type">IsScalar</span></a><span> </span><a href="#local-6989586621680141925"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Array.Accelerate.Type.html#BitSizeEq"><span class="hs-identifier hs-type">BitSizeEq</span></a><span> </span><a href="#local-6989586621680141924"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621680141925"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141924"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141925"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1400"></a><a name="bitcast"><a href="Data.Array.Accelerate.Language.html#bitcast"><span class="hs-identifier">bitcast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#mkBitcast"><span class="hs-identifier hs-var">mkBitcast</span></a><span>
</span><a name="line-1401"></a><span>
</span><a name="line-1402"></a><span>
</span><a name="line-1403"></a><span class="hs-comment">-- Constants</span><span>
</span><a name="line-1404"></a><span class="hs-comment">-- ---------</span><span>
</span><a name="line-1405"></a><span>
</span><a name="line-1406"></a><span class="hs-comment">-- |Magic value identifying elements that are ignored in a forward permutation.</span><span>
</span><a name="line-1407"></a><span class="hs-comment">--</span><span>
</span><a name="line-1408"></a><span class="hs-identifier">ignore</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><a href="#local-6989586621680141923"><span class="hs-identifier hs-type">sh</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Array.Accelerate.Smart.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><a href="#local-6989586621680141923"><span class="hs-identifier hs-type">sh</span></a><span>
</span><a name="line-1409"></a><a name="ignore"><a href="Data.Array.Accelerate.Language.html#ignore"><span class="hs-identifier">ignore</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Accelerate.Smart.html#constant"><span class="hs-identifier hs-var">constant</span></a><span> </span><a href="Data.Array.Accelerate.Array.Sugar.html#ignore"><span class="hs-identifier hs-var">Sugar</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ignore</span></a><span>
</span><a name="line-1410"></a><span>
</span><a name="line-1411"></a></pre></body></html>