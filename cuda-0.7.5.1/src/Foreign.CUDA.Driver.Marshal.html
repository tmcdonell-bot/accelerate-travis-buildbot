<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- GENERATED by C-&gt;Haskell Compiler, version 0.28.1 Switcheroo, 1 April 2016 (Haskell)</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- Edit the ORIGNAL .chs file instead!</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LINE 1 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns             #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP                      #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE EmptyDataDecls           #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ForeignFunctionInterface #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell          #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# OPTIONS_HADDOCK prune #-}</span><span>
</span><a name="line-12"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Module    : Foreign.CUDA.Driver.Marshal</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Copyright : [2009..2014] Trevor L. McDonell</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- License   : BSD</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- Memory management for low-level driver interface</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">module</span><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#registerArray"><span class="hs-identifier hs-var">Foreign</span><span class="hs-operator hs-var">.</span></a><span class="hs-identifier">CUDA</span><a href="Foreign.CUDA.Driver.Marshal.html#unregisterArray"><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Driver</span><span class="hs-operator hs-var">.</span></a><span class="hs-identifier">Marshal</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-comment">-- * Host Allocation</span><span>
</span><a name="line-25"></a><span>  </span><a href="Foreign.CUDA.Driver.Marshal.html#mallocArray"><span class="hs-identifier hs-var">AllocFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-identifier">mallocHostArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mallocHostForeignPtr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">freeHost</span><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-identifier">registerArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unregisterArray</span><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-comment">-- * Device Allocation</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-identifier">mallocArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">allocaArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">free</span><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-comment">-- * Unified Memory Allocation</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-identifier">AttachFlag</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>  </span><span class="hs-identifier">mallocManagedArray</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-comment">-- * Marshalling</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-identifier">peekArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekArrayAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekArray2D</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekArray2DAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekListArray</span><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>  </span><a href="Foreign.CUDA.Driver.Marshal.html#newListArray"><span class="hs-identifier hs-var">pokeArray</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeArrayAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeArray2D</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeArray2DAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeListArray</span><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>  </span><a href="Foreign.CUDA.Driver.Marshal.html#withListArray"><span class="hs-identifier hs-var">copyArray</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArrayAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArray2D</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArray2DAsync</span><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-identifier">copyArrayPeer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArrayPeerAsync</span><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-comment">-- * Combined Allocation and Marshalling</span><span>
</span><a name="line-43"></a><span>  </span><a href="Foreign.CUDA.Driver.Marshal.html#getDevicePtr"><span class="hs-identifier hs-var">newListArray</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier">newListArrayLen</span><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>  </span><span class="hs-identifier">withListArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">withListArrayLen</span><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">-- * Utility</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-identifier">memset</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">memsetAsync</span><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-identifier">getDevicePtr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getBasePtr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getMemInfo</span><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-comment">-- Internal</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-identifier">useDeviceHandle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekDeviceHandle</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C2HSImp</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Foreign.CUDA.Driver.Error.html"><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C2HSImp</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-pragma">{-# LINE 51 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- Friends</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Driver</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Driver</span><span class="hs-operator">.</span><span class="hs-identifier">Stream</span><span>                       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Stream</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">defaultStream</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Driver</span><span class="hs-operator">.</span><span class="hs-identifier">Context</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span><span>                 </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Context</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">C2HS</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- System</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Int</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unsafe</span><span class="hs-operator">.</span><span class="hs-identifier">Coerce</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a name="AllocFlag"><a href="Foreign.CUDA.Driver.Marshal.html#AllocFlag"><span class="hs-identifier">Foreign</span></a></a><span class="hs-operator">.</span><span class="hs-identifier">ForeignPtr</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Storable</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a name="WriteCombined"><a href="Foreign.CUDA.Driver.Marshal.html#WriteCombined"><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span></a></a><span class="hs-identifier">Marshal</span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- Host Allocation</span><span>
</span><a name="line-88"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- Options for host allocation</span><span>
</span><a name="line-92"></a><span class="hs-comment">--</span><span>
</span><a name="line-93"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">AllocFlag</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Portable</span><span>
</span><a name="line-94"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-95"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-96"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span class="hs-identifier">Bounded</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">AllocFlag</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">Portable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">DeviceMapped</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">WriteCombined</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;AllocFlag.succ: WriteCombined has no successor&quot;</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>  </span><span class="hs-identifier">pred</span><span> </span><span class="hs-identifier">DeviceMapped</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Portable</span><span>
</span><a name="line-103"></a><span>  </span><a name="local-805306531"><span class="hs-identifier">pred</span></a><span> </span><span class="hs-identifier">WriteCombined</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-identifier">pred</span><span> </span><span class="hs-identifier">Portable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;AllocFlag.pred: Portable has no predecessor&quot;</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span>  </span><span class="hs-identifier">enumFromTo</span><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">from</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-108"></a><span>      </span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">to</span><span>
</span><a name="line-109"></a><span>      </span><a name="local-1912608618"><span class="hs-identifier">go</span></a><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-110"></a><span>                 </span><a href="Foreign.CUDA.Driver.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">LT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">succ</span><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#AllocFlag"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>                 </span><a href="Foreign.CUDA.Driver.Marshal.html#WriteCombined"><span class="hs-identifier hs-var">EQ</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Foreign.CUDA.Driver.Marshal.html#WriteCombined"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>                 </span><span class="hs-identifier">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier">enumFrom</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromTo</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>  </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">Portable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DeviceMapped</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">WriteCombined</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>  </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Portable</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-123"></a><span>  </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">unmatched</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;AllocFlag.toEnum: Cannot match &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier hs-type">show</span><span> </span><span class="hs-identifier">unmatched</span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-pragma">{-# LINE 92 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- Allocate a section of linear memory on the host which is page-locked and</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- directly accessible from the device. The storage is sufficient to hold the</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- given number of elements of a storable type.</span><span>
</span><a name="line-132"></a><span class="hs-comment">--</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- Note that since the amount of pageable memory is thusly reduced, overall</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- system performance may suffer. This is best used sparingly to allocate</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- staging areas for data exchange.</span><span>
</span><a name="line-136"></a><span class="hs-comment">--</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- Host memory allocated in this way is automatically and immediately</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- accessible to all contexts on all devices which support unified</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- addressing.</span><span>
</span><a name="line-140"></a><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1gdd8311286d2c2691605362c689bc64e0&gt;</span><span>
</span><a name="line-142"></a><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span class="hs-pragma">{-# INLINEABLE mallocHostArray #-}</span><span>
</span><a name="line-144"></a><span class="hs-identifier">mallocHostArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span class="hs-identifier">mallocHostArray</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">flags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-147"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a'</span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">resultIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cuMemHostAlloc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">flags</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- As 'mallocHostArray', but return a 'ForeignPtr' instead. The array will be</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- deallocated automatically once the last reference to the 'ForeignPtr' is</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- dropped.</span><span>
</span><a name="line-154"></a><span class="hs-comment">--</span><span>
</span><a name="line-155"></a><span class="hs-pragma">{-# INLINEABLE mallocHostForeignPtr #-}</span><span>
</span><a name="line-156"></a><span class="hs-pragma">{-# SPECIALISE mallocHostForeignPtr :: [AllocFlag] -&gt; Int -&gt; IO (ForeignPtr Word8) #-}</span><span>
</span><a name="line-157"></a><span class="hs-identifier">mallocHostForeignPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForeignPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span class="hs-identifier">mallocHostForeignPtr</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">flags</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mallocHostArray</span><span> </span><span class="hs-identifier">flags</span><span> </span><span class="hs-identifier">size</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">finalizerMemFreeHost</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span class="hs-pragma">{-# INLINE cuMemHostAlloc #-}</span><span>
</span><a name="line-163"></a><span class="hs-identifier">cuMemHostAlloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span class="hs-identifier">cuMemHostAlloc</span><span> </span><span class="hs-identifier">a2</span><span> </span><span class="hs-identifier">a3</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a2'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">a2</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a3'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">combineBitMasks</span><span> </span><span class="hs-identifier">a3</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-identifier">cuMemHostAlloc'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-identifier">a2'</span><span> </span><span class="hs-identifier">a3'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-170"></a><span>  </span><span class="hs-identifier">peekHP</span><span>  </span><span class="hs-identifier">a1'</span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1''</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a1''</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-pragma">{-# LINE 132 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">F</span><span class="hs-operator">.</span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">poke</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">nullPtr</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier">peekHP</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- Pointer to the foreign function to release host arrays, which may be used as</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- a finalizer. Technically this function has a non-void return type, but I am</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- hoping that that doesn't matter...</span><span>
</span><a name="line-182"></a><span class="hs-comment">--</span><span>
</span><a name="line-183"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-string">&quot;&amp;cuMemFreeHost&quot;</span><span> </span><span class="hs-identifier">finalizerMemFreeHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FinalizerPtr</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- Free a section of page-locked host memory.</span><span>
</span><a name="line-187"></a><span class="hs-comment">--</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g62e0fdbe181dab6b1c90fa1a51c7b92c&gt;</span><span>
</span><a name="line-189"></a><span class="hs-comment">--</span><span>
</span><a name="line-190"></a><span class="hs-pragma">{-# INLINEABLE freeHost #-}</span><span>
</span><a name="line-191"></a><span class="hs-identifier">freeHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier hs-var">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span class="hs-identifier">freeHost</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Foreign.CUDA.Internal.C2HS.html#combineBitMasks"><span class="hs-identifier hs-var">nothingIfOk</span></a><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cuMemFreeHost</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-pragma">{-# INLINE cuMemFreeHost #-}</span><span>
</span><a name="line-195"></a><span class="hs-identifier">cuMemFreeHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span class="hs-identifier">cuMemFreeHost</span><span> </span><span class="hs-identifier">a1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">useHP</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-198"></a><span>  </span><span class="hs-identifier">cuMemFreeHost'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-199"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-200"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-pragma">{-# LINE 154 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-identifier">useHP</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">useHostPtr</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- Page-locks the specified array (on the host) and maps it for the device(s) as</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- specified by the given allocation flags. Subsequently, the memory is accessed</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- directly by the device so can be read and written with much higher bandwidth</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- than pageable memory that has not been registered. The memory range is added</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- to the same tracking mechanism as 'mallocHostArray' to automatically</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- accelerate calls to functions such as 'pokeArray'.</span><span>
</span><a name="line-215"></a><span class="hs-comment">--</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- Note that page-locking excessive amounts of memory may degrade system</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- performance, since it reduces the amount of pageable memory available. This</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- is best used sparingly to allocate staging areas for data exchange.</span><span>
</span><a name="line-219"></a><span class="hs-comment">--</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- This function has limited support on Mac OS X. OS 10.7 or later is</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- required.</span><span>
</span><a name="line-222"></a><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- Requires CUDA-4.0.</span><span>
</span><a name="line-224"></a><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1gf0a9fe11544326dabd743b7aa6b54223&gt;</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-pragma">{-# INLINEABLE registerArray #-}</span><span>
</span><a name="line-228"></a><span class="hs-identifier">registerArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span class="hs-identifier">registerArray</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">flags</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-230"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-233"></a><span>      </span><span class="hs-identifier">status</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">cuMemHostRegister</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">flags</span><span>
</span><a name="line-234"></a><span>      </span><span class="hs-identifier">resultIfOk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">status</span><span class="hs-special">,</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-pragma">{-# INLINE cuMemHostRegister #-}</span><span>
</span><a name="line-237"></a><span class="hs-identifier">cuMemHostRegister</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span class="hs-identifier">cuMemHostRegister</span><span> </span><span class="hs-identifier">a1</span><span> </span><span class="hs-identifier">a2</span><span> </span><span class="hs-identifier">a3</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-239"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-240"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a name="cuMemAlloc"><a href="Foreign.CUDA.Driver.Marshal.html#cuMemAlloc"><span class="hs-identifier">a2'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">a2</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-241"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a3'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">combineBitMasks</span><span> </span><span class="hs-identifier">a3</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-242"></a><span>  </span><span class="hs-identifier">cuMemHostRegister'_</span><span> </span><span class="hs-identifier hs-var">a1'</span><span> </span><span class="hs-identifier">a2'</span><span> </span><span class="hs-identifier">a3'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-243"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a href="Foreign.CUDA.Driver.Marshal.html#cuMemAlloc%27_"><span class="hs-identifier hs-var">res'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier hs-var">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-244"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">)</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-pragma">{-# LINE 195 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- Unmaps the memory from the given pointer, and makes it pageable again.</span><span>
</span><a name="line-252"></a><span class="hs-comment">--</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- Requires CUDA-4.0.</span><span>
</span><a name="line-254"></a><span class="hs-comment">--</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g63f450c8125359be87b7623b1c0b2a14&gt;</span><span>
</span><a name="line-256"></a><span class="hs-comment">--</span><span>
</span><a name="line-257"></a><span class="hs-pragma">{-# INLINEABLE unregisterArray #-}</span><span>
</span><a name="line-258"></a><span class="hs-identifier">unregisterArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HostPtr</span><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#mallocArray"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Foreign.CUDA.Driver.Marshal.html#mallocArray"><span class="hs-identifier hs-var">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span class="hs-identifier">unregisterArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-260"></a><span>  </span><span class="hs-identifier">status</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">cuMemHostUnregister</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-261"></a><span>  </span><span class="hs-identifier">resultIfOk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">status</span><span class="hs-special">,</span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-pragma">{-# INLINE cuMemHostUnregister #-}</span><span>
</span><a name="line-264"></a><span class="hs-identifier">cuMemHostUnregister</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span class="hs-identifier">cuMemHostUnregister</span><span> </span><span class="hs-identifier">a1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-266"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-267"></a><span>  </span><span class="hs-identifier">cuMemHostUnregister'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-268"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Foreign.CUDA.Driver.Error.html#nothingIfOk"><span class="hs-identifier hs-var">cToEnum</span></a><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-269"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-pragma">{-# LINE 217 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- Device Allocation</span><span>
</span><a name="line-277"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- Allocate a section of linear memory on the device, and return a reference to</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- it. The memory is sufficient to hold the given number of elements of storable</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- type. It is suitably aligned for any type, and is not cleared.</span><span>
</span><a name="line-283"></a><span class="hs-comment">--</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1gb82d2a09844a58dd9e744dc31e8aa467&gt;</span><span>
</span><a name="line-285"></a><span class="hs-comment">--</span><span>
</span><a name="line-286"></a><span class="hs-pragma">{-# INLINEABLE mallocArray #-}</span><span>
</span><a name="line-287"></a><span class="hs-identifier">mallocArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span class="hs-identifier">mallocArray</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-289"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-290"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a'</span><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">resultIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cuMemAlloc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-pragma">{-# INLINE cuMemAlloc #-}</span><span>
</span><a name="line-294"></a><span class="hs-identifier">cuMemAlloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-295"></a><span class="hs-identifier">cuMemAlloc</span><span> </span><span class="hs-identifier">a2</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-296"></a><span>  </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-297"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a2'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">a2</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-298"></a><span>  </span><span class="hs-identifier">cuMemAlloc'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-identifier">a2'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-299"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-identifier">peekDeviceHandle</span><span>  </span><span class="hs-identifier">a1'</span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1''</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-301"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a1''</span><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-pragma">{-# LINE 241 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-306"></a><span>    </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">F</span><span class="hs-operator">.</span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">poke</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">nullPtr</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- Execute a computation on the device, passing a pointer to a temporarily</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- allocated block of memory sufficient to hold the given number of elements of</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- storable type. The memory is freed when the computation terminates (normally</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- or via an exception), so the pointer must not be used after this.</span><span>
</span><a name="line-314"></a><span class="hs-comment">--</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- Note that kernel launches can be asynchronous, so you may want to add a</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- synchronisation point using 'Foreign.CUDA.Driver.Context.sync' as part</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- of the continuation.</span><span>
</span><a name="line-318"></a><span class="hs-comment">--</span><span>
</span><a name="line-319"></a><span class="hs-pragma">{-# INLINEABLE allocaArray #-}</span><span>
</span><a name="line-320"></a><span class="hs-identifier">allocaArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-321"></a><span class="hs-identifier">allocaArray</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bracket</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mallocArray</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">free</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- Release a section of device memory.</span><span>
</span><a name="line-326"></a><span class="hs-comment">--</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g89b3f154e17cc89b6eea277dbdf5c93a&gt;</span><span>
</span><a name="line-328"></a><span class="hs-comment">--</span><span>
</span><a name="line-329"></a><span class="hs-pragma">{-# INLINEABLE free #-}</span><span>
</span><a name="line-330"></a><span class="hs-identifier">free</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span class="hs-identifier">free</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">dp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nothingIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cuMemFree</span><span> </span><span class="hs-identifier">dp</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-pragma">{-# INLINE cuMemFree #-}</span><span>
</span><a name="line-334"></a><span class="hs-identifier">cuMemFree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span class="hs-identifier">cuMemFree</span><span> </span><span class="hs-identifier">a1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-336"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a name="local-1627996441"><a href="#local-1627996441"><span class="hs-identifier">a1'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">useDeviceHandle</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-337"></a><span>  </span><a href="Foreign.CUDA.Driver.Marshal.html#cuMemcpyDtoH%27_"><span class="hs-identifier hs-var">cuMemFree'_</span></a><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-338"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a name="local-1627996443"><a href="#local-1627996443"><span class="hs-identifier">res'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Foreign.CUDA.Internal.C2HS.html#cToEnum"><span class="hs-identifier hs-var">cToEnum</span></a><span> </span><a href="#local-1627996442"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-339"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627996443"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-pragma">{-# LINE 272 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- Unified memory allocations</span><span>
</span><a name="line-347"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- Options for unified memory allocations</span><span>
</span><a name="line-351"></a><span class="hs-comment">--</span><span>
</span><a name="line-352"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">AttachFlag</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- Allocates memory that will be automatically managed by the Unified Memory</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- system. The returned pointer is valid on the CPU and on all GPUs which</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- supported managed memory. All accesses to this pointer must obey the</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- Unified Memory programming model.</span><span>
</span><a name="line-359"></a><span class="hs-comment">--</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- On a multi-GPU system with peer-to-peer support, where multiple GPUs</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- support managed memory, the physical storage is created on the GPU which</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- is active at the time 'mallocManagedArray' is called. All other GPUs</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- will access the array at reduced bandwidth via peer mapping over the</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- PCIe bus. The Unified Memory system does not migrate memory between</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- GPUs.</span><span>
</span><a name="line-366"></a><span class="hs-comment">--</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- On a multi-GPU system where multiple GPUs support managed memory, but</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- not all pairs of such GPUs have peer-to-peer support between them, the</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- physical storage is allocated in system memory (zero-copy memory) and</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- all GPUs will access the data at reduced bandwidth over the PCIe bus.</span><span>
</span><a name="line-371"></a><span class="hs-comment">--</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- Requires CUDA-6.0</span><span>
</span><a name="line-373"></a><span class="hs-comment">--</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1gb347ded34dc326af404aa02af5388a32&gt;</span><span>
</span><a name="line-375"></a><span class="hs-comment">--</span><span>
</span><a name="line-376"></a><span class="hs-pragma">{-# INLINEABLE mallocManagedArray #-}</span><span>
</span><a name="line-377"></a><span class="hs-identifier">mallocManagedArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">AttachFlag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span class="hs-identifier">mallocManagedArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">requireSDK</span><span> </span><span class="hs-char">'mallocManagedArray 6.0


--------------------------------------------------------------------------------
-- Marshalling
--------------------------------------------------------------------------------

-- Device -&gt; Host
-- --------------

-- |
-- Copy a number of elements from the device to host memory. This is a
-- synchronous operation.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g3480368ee0208a98f75019c9a8450893&gt;
--
{-# INLINEABLE peekArray #-}
peekArray :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; Ptr a -&gt; IO ()
peekArray !n !dptr !hptr = doPeek undefined dptr
  where
    doPeek :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPeek x _ = nothingIfOk =&lt;&lt; cuMemcpyDtoH hptr dptr (n * sizeOf x)

{-# INLINE cuMemcpyDtoH #-}
cuMemcpyDtoH :: (Ptr a) -&gt; (DevicePtr a) -&gt; (Int) -&gt; IO ((Status))
cuMemcpyDtoH a1 a2 a3 =
  let {a1' = castPtr a1} in 
  let {a2' = useDeviceHandle a2} in 
  let {a3' = fromIntegral a3} in 
  cuMemcpyDtoH'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 356 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy memory from the device asynchronously, possibly associated with a
-- particular stream. The destination host memory must be page-locked.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g56f30236c7c5247f8e061b59d3268362&gt;
--
{-# INLINEABLE peekArrayAsync #-}
peekArrayAsync :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; HostPtr a -&gt; Maybe Stream -&gt; IO ()
peekArrayAsync !n !dptr !hptr !mst = doPeek undefined dptr
  where
    doPeek :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPeek x _ = nothingIfOk =&lt;&lt; cuMemcpyDtoHAsync hptr dptr (n * sizeOf x) (fromMaybe defaultStream mst)

{-# INLINE cuMemcpyDtoHAsync #-}
cuMemcpyDtoHAsync :: (HostPtr a) -&gt; (DevicePtr a) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpyDtoHAsync a1 a2 a3 a4 =
  let {a1' = useHP a1} in 
  let {a2' = useDeviceHandle a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = useStream a4} in 
  cuMemcpyDtoHAsync'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 377 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    useHP = castPtr . useHostPtr


-- |
-- Copy a 2D array from the device to the host.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g27f885b30c34cc20a663a671dbf6fc27&gt;
--
{-# INLINEABLE peekArray2D #-}
peekArray2D
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Int                      -- ^ source x-coordinate
    -&gt; Int                      -- ^ source y-coordinate
    -&gt; Ptr a                    -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Int                      -- ^ destination x-coordinate
    -&gt; Int                      -- ^ destination y-coordinate
    -&gt; IO ()
peekArray2D !w !h !dptr !dw !dx !dy !hptr !hw !hx !hy = doPeek undefined dptr
  where
    doPeek :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPeek x _ =
      let bytes = sizeOf x
          w'    = w  * bytes
          hw'   = hw * bytes
          hx'   = hx * bytes
          dw'   = dw * bytes
          dx'   = dx * bytes
      in
      nothingIfOk =&lt;&lt; cuMemcpy2DDtoH hptr hw' hx' hy dptr dw' dx' dy w' h

{-# INLINE cuMemcpy2DDtoH #-}
cuMemcpy2DDtoH :: (Ptr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; IO ((Status))
cuMemcpy2DDtoH a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 =
  let {a1' = castPtr a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = useDeviceHandle a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = fromIntegral a7} in 
  let {a8' = fromIntegral a8} in 
  let {a9' = fromIntegral a9} in 
  let {a10' = fromIntegral a10} in 
  cuMemcpy2DDtoH'_ a1' a2' a3' a4' a5' a6' a7' a8' a9' a10' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 427 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy a 2D array from the device to the host asynchronously, possibly
-- associated with a particular execution stream. The destination host memory
-- must be page-locked.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g4acf155faeb969d9d21f5433d3d0f274&gt;
--
{-# INLINEABLE peekArray2DAsync #-}
peekArray2DAsync
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Int                      -- ^ source x-coordinate
    -&gt; Int                      -- ^ source y-coordinate
    -&gt; HostPtr a                -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Int                      -- ^ destination x-coordinate
    -&gt; Int                      -- ^ destination y-coordinate
    -&gt; Maybe Stream             -- ^ stream to associate to
    -&gt; IO ()
peekArray2DAsync !w !h !dptr !dw !dx !dy !hptr !hw !hx !hy !mst = doPeek undefined dptr
  where
    doPeek :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPeek x _ =
      let bytes = sizeOf x
          w'    = w  * bytes
          hw'   = hw * bytes
          hx'   = hx * bytes
          dw'   = dw * bytes
          dx'   = dx * bytes
          st    = fromMaybe defaultStream mst
      in
      nothingIfOk =&lt;&lt; cuMemcpy2DDtoHAsync hptr hw' hx' hy dptr dw' dx' dy w' h st

{-# INLINE cuMemcpy2DDtoHAsync #-}
cuMemcpy2DDtoHAsync :: (HostPtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpy2DDtoHAsync a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 a11 =
  let {a1' = useHP a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = useDeviceHandle a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = fromIntegral a7} in 
  let {a8' = fromIntegral a8} in 
  let {a9' = fromIntegral a9} in 
  let {a10' = fromIntegral a10} in 
  let {a11' = useStream a11} in 
  cuMemcpy2DDtoHAsync'_ a1' a2' a3' a4' a5' a6' a7' a8' a9' a10' a11' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 480 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    useHP = castPtr . useHostPtr


-- |
-- Copy a number of elements from the device into a new Haskell list. Note that
-- this requires two memory copies: firstly from the device into a heap
-- allocated array, and from there marshalled into a list.
--
{-# INLINEABLE peekListArray #-}
peekListArray :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; IO [a]
peekListArray !n !dptr =
  F.allocaArray n $ \p -&gt; do
    peekArray   n dptr p
    F.peekArray n p


-- Host -&gt; Device
-- --------------

-- |
-- Copy a number of elements onto the device. This is a synchronous operation.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g4d32266788c440b0220b1a9ba5795169&gt;
--
{-# INLINEABLE pokeArray #-}
pokeArray :: Storable a =&gt; Int -&gt; Ptr a -&gt; DevicePtr a -&gt; IO ()
pokeArray !n !hptr !dptr = doPoke undefined dptr
  where
    doPoke :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPoke x _ = nothingIfOk =&lt;&lt; cuMemcpyHtoD dptr hptr (n * sizeOf x)

{-# INLINE cuMemcpyHtoD #-}
cuMemcpyHtoD :: (DevicePtr a) -&gt; (Ptr a) -&gt; (Int) -&gt; IO ((Status))
cuMemcpyHtoD a1 a2 a3 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = castPtr a2} in 
  let {a3' = fromIntegral a3} in 
  cuMemcpyHtoD'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 517 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy memory onto the device asynchronously, possibly associated with a
-- particular stream. The source host memory must be page-locked.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g1572263fe2597d7ba4f6964597a354a3&gt;
--
{-# INLINEABLE pokeArrayAsync #-}
pokeArrayAsync :: Storable a =&gt; Int -&gt; HostPtr a -&gt; DevicePtr a -&gt; Maybe Stream -&gt; IO ()
pokeArrayAsync !n !hptr !dptr !mst = dopoke undefined dptr
  where
    dopoke :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    dopoke x _ = nothingIfOk =&lt;&lt; cuMemcpyHtoDAsync dptr hptr (n * sizeOf x) (fromMaybe defaultStream mst)

{-# INLINE cuMemcpyHtoDAsync #-}
cuMemcpyHtoDAsync :: (DevicePtr a) -&gt; (HostPtr a) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpyHtoDAsync a1 a2 a3 a4 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = useHP a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = useStream a4} in 
  cuMemcpyHtoDAsync'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 538 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    useHP = castPtr . useHostPtr


-- |
-- Copy a 2D array from the host to the device.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g27f885b30c34cc20a663a671dbf6fc27&gt;
--
{-# INLINEABLE pokeArray2D #-}
pokeArray2D
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; Ptr a                    -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Int                      -- ^ source x-coordinate
    -&gt; Int                      -- ^ source y-coordinate
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Int                      -- ^ destination x-coordinate
    -&gt; Int                      -- ^ destination y-coordinate
    -&gt; IO ()
pokeArray2D !w !h !hptr !hw !hx !hy !dptr !dw !dx !dy = doPoke undefined dptr
  where
    doPoke :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPoke x _ =
      let bytes = sizeOf x
          w'    = w  * bytes
          hw'   = hw * bytes
          hx'   = hx * bytes
          dw'   = dw * bytes
          dx'   = dx * bytes
      in
      nothingIfOk =&lt;&lt; cuMemcpy2DHtoD dptr dw' dx' dy hptr hw' hx' hy w' h

{-# INLINE cuMemcpy2DHtoD #-}
cuMemcpy2DHtoD :: (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Ptr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; IO ((Status))
cuMemcpy2DHtoD a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = castPtr a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = fromIntegral a7} in 
  let {a8' = fromIntegral a8} in 
  let {a9' = fromIntegral a9} in 
  let {a10' = fromIntegral a10} in 
  cuMemcpy2DHtoD'_ a1' a2' a3' a4' a5' a6' a7' a8' a9' a10' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 588 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy a 2D array from the host to the device asynchronously, possibly
-- associated with a particular execution stream. The source host memory must be
-- page-locked.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g4acf155faeb969d9d21f5433d3d0f274&gt;
--
{-# INLINEABLE pokeArray2DAsync #-}
pokeArray2DAsync
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; HostPtr a                -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Int                      -- ^ source x-coordinate
    -&gt; Int                      -- ^ source y-coordinate
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Int                      -- ^ destination x-coordinate
    -&gt; Int                      -- ^ destination y-coordinate
    -&gt; Maybe Stream             -- ^ stream to associate to
    -&gt; IO ()
pokeArray2DAsync !w !h !hptr !hw !hx !hy !dptr !dw !dx !dy !mst = doPoke undefined dptr
  where
    doPoke :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doPoke x _ =
      let bytes = sizeOf x
          w'    = w  * bytes
          hw'   = hw * bytes
          hx'   = hx * bytes
          dw'   = dw * bytes
          dx'   = dx * bytes
          st    = fromMaybe defaultStream mst
      in
      nothingIfOk =&lt;&lt; cuMemcpy2DHtoDAsync dptr dw' dx' dy hptr hw' hx' hy w' h st

{-# INLINE cuMemcpy2DHtoDAsync #-}
cuMemcpy2DHtoDAsync :: (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (HostPtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpy2DHtoDAsync a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 a11 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = useHP a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = fromIntegral a7} in 
  let {a8' = fromIntegral a8} in 
  let {a9' = fromIntegral a9} in 
  let {a10' = fromIntegral a10} in 
  let {a11' = useStream a11} in 
  cuMemcpy2DHtoDAsync'_ a1' a2' a3' a4' a5' a6' a7' a8' a9' a10' a11' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 641 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    useHP = castPtr . useHostPtr


-- |
-- Write a list of storable elements into a device array. The device array must
-- be sufficiently large to hold the entire list. This requires two marshalling
-- operations.
--
{-# INLINEABLE pokeListArray #-}
pokeListArray :: Storable a =&gt; [a] -&gt; DevicePtr a -&gt; IO ()
pokeListArray !xs !dptr = F.withArrayLen xs $ \ !len !p -&gt; pokeArray len p dptr


-- Device -&gt; Device
-- ----------------

-- |
-- Copy the given number of elements from the first device array (source) to the
-- second device (destination). The copied areas may not overlap. This operation
-- is asynchronous with respect to the host, but will never overlap with kernel
-- execution.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g1725774abf8b51b91945f3336b778c8b&gt;
--
{-# INLINEABLE copyArray #-}
copyArray :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; DevicePtr a -&gt; IO ()
copyArray !n = docopy undefined
  where
    docopy :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; DevicePtr a' -&gt; IO ()
    docopy x src dst = nothingIfOk =&lt;&lt; cuMemcpyDtoD dst src (n * sizeOf x)

{-# INLINE cuMemcpyDtoD #-}
cuMemcpyDtoD :: (DevicePtr a) -&gt; (DevicePtr a) -&gt; (Int) -&gt; IO ((Status))
cuMemcpyDtoD a1 a2 a3 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = useDeviceHandle a2} in 
  let {a3' = fromIntegral a3} in 
  cuMemcpyDtoD'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 678 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy the given number of elements from the first device array (source) to the
-- second device array (destination). The copied areas may not overlap. The
-- operation is asynchronous with respect to the host, and can be asynchronous
-- to other device operations by associating it with a particular stream.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g39ea09ba682b8eccc9c3e0c04319b5c8&gt;
--
{-# INLINEABLE copyArrayAsync #-}
copyArrayAsync :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; DevicePtr a -&gt; Maybe Stream -&gt; IO ()
copyArrayAsync !n !src !dst !mst = docopy undefined src
  where
    docopy :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    docopy x _ = nothingIfOk =&lt;&lt; cuMemcpyDtoDAsync dst src (n * sizeOf x) (fromMaybe defaultStream mst)

{-# INLINE cuMemcpyDtoDAsync #-}
cuMemcpyDtoDAsync :: (DevicePtr a) -&gt; (DevicePtr a) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpyDtoDAsync a1 a2 a3 a4 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = useDeviceHandle a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = useStream a4} in 
  cuMemcpyDtoDAsync'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 701 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy a 2D array from the first device array (source) to the second device
-- array (destination). The copied areas must not overlap. This operation is
-- asynchronous with respect to the host, but will never overlap with kernel
-- execution.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g27f885b30c34cc20a663a671dbf6fc27&gt;
--
{-# INLINEABLE copyArray2D #-}
copyArray2D
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Int                      -- ^ source x-coordinate
    -&gt; Int                      -- ^ source y-coordinate
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Int                      -- ^ destination x-coordinate
    -&gt; Int                      -- ^ destination y-coordinate
    -&gt; IO ()
copyArray2D !w !h !src !hw !hx !hy !dst !dw !dx !dy = doCopy undefined dst
  where
    doCopy :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doCopy x _ =
      let bytes = sizeOf x
          w'    = w  * bytes
          hw'   = hw * bytes
          hx'   = hx * bytes
          dw'   = dw * bytes
          dx'   = dx * bytes
      in
      nothingIfOk =&lt;&lt; cuMemcpy2DDtoD dst dw' dx' dy src hw' hx' hy w' h

{-# INLINE cuMemcpy2DDtoD #-}
cuMemcpy2DDtoD :: (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; IO ((Status))
cuMemcpy2DDtoD a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = useDeviceHandle a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = fromIntegral a7} in 
  let {a8' = fromIntegral a8} in 
  let {a9' = fromIntegral a9} in 
  let {a10' = fromIntegral a10} in 
  cuMemcpy2DDtoD'_ a1' a2' a3' a4' a5' a6' a7' a8' a9' a10' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 752 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copy a 2D array from the first device array (source) to the second device
-- array (destination). The copied areas may not overlap. The operation is
-- asynchronous with respect to the host, and can be asynchronous to other
-- device operations by associating it with a particular execution stream.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g4acf155faeb969d9d21f5433d3d0f274&gt;
--
{-# INLINEABLE copyArray2DAsync #-}
copyArray2DAsync
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Int                      -- ^ source x-coordinate
    -&gt; Int                      -- ^ source y-coordinate
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Int                      -- ^ destination x-coordinate
    -&gt; Int                      -- ^ destination y-coordinate
    -&gt; Maybe Stream             -- ^ stream to associate to
    -&gt; IO ()
copyArray2DAsync !w !h !src !hw !hx !hy !dst !dw !dx !dy !mst = doCopy undefined dst
  where
    doCopy :: Storable a' =&gt; a' -&gt; DevicePtr a' -&gt; IO ()
    doCopy x _ =
      let bytes = sizeOf x
          w'    = w  * bytes
          hw'   = hw * bytes
          hx'   = hx * bytes
          dw'   = dw * bytes
          dx'   = dx * bytes
          st    = fromMaybe defaultStream mst
      in
      nothingIfOk =&lt;&lt; cuMemcpy2DDtoDAsync dst dw' dx' dy src hw' hx' hy w' h st

{-# INLINE cuMemcpy2DDtoDAsync #-}
cuMemcpy2DDtoDAsync :: (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (DevicePtr a) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpy2DDtoDAsync a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 a11 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = useDeviceHandle a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = fromIntegral a7} in 
  let {a8' = fromIntegral a8} in 
  let {a9' = fromIntegral a9} in 
  let {a10' = fromIntegral a10} in 
  let {a11' = useStream a11} in 
  cuMemcpy2DDtoDAsync'_ a1' a2' a3' a4' a5' a6' a7' a8' a9' a10' a11' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 806 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}




-- Context -&gt; Context
-- ------------------

-- |
-- Copies an array from device memory in one context to device memory in another
-- context. Note that this function is asynchronous with respect to the host,
-- but serialised with respect to all pending and future asynchronous work in
-- the source and destination contexts. To avoid this synchronisation, use
-- 'copyArrayPeerAsync' instead.
--
-- Requires CUDA-4.0.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1ge1f5c7771544fee150ada8853c7cbf4a&gt;
--
{-# INLINEABLE copyArrayPeer #-}
copyArrayPeer :: Storable a
              =&gt; Int                            -- ^ number of array elements
              -&gt; DevicePtr a -&gt; Context         -- ^ source array and context
              -&gt; DevicePtr a -&gt; Context         -- ^ destination array and context
              -&gt; IO ()
copyArrayPeer !n !src !srcCtx !dst !dstCtx = go undefined src dst
  where
    go :: Storable b =&gt; b -&gt; DevicePtr b -&gt; DevicePtr b -&gt; IO ()
    go x _ _ = nothingIfOk =&lt;&lt; cuMemcpyPeer dst dstCtx src srcCtx (n * sizeOf x)

{-# INLINE cuMemcpyPeer #-}
cuMemcpyPeer :: (DevicePtr a) -&gt; (Context) -&gt; (DevicePtr a) -&gt; (Context) -&gt; (Int) -&gt; IO ((Status))
cuMemcpyPeer a1 a2 a3 a4 a5 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = useContext a2} in 
  let {a3' = useDeviceHandle a3} in 
  let {a4' = useContext a4} in 
  let {a5' = fromIntegral a5} in 
  cuMemcpyPeer'_ a1' a2' a3' a4' a5' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 845 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Copies from device memory in one context to device memory in another context.
-- Note that this function is asynchronous with respect to the host and all work
-- in other streams and devices.
--
-- Requires CUDA-4.0.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g82fcecb38018e64b98616a8ac30112f2&gt;
--
{-# INLINEABLE copyArrayPeerAsync #-}
copyArrayPeerAsync :: Storable a
                   =&gt; Int                       -- ^ number of array elements
                   -&gt; DevicePtr a -&gt; Context    -- ^ source array and context
                   -&gt; DevicePtr a -&gt; Context    -- ^ destination array and device context
                   -&gt; Maybe Stream              -- ^ stream to associate with
                   -&gt; IO ()
copyArrayPeerAsync !n !src !srcCtx !dst !dstCtx !st = go undefined src dst
  where
    go :: Storable b =&gt; b -&gt; DevicePtr b -&gt; DevicePtr b -&gt; IO ()
    go x _ _ = nothingIfOk =&lt;&lt; cuMemcpyPeerAsync dst dstCtx src srcCtx (n * sizeOf x) stream
    stream   = fromMaybe defaultStream st

{-# INLINE cuMemcpyPeerAsync #-}
cuMemcpyPeerAsync :: (DevicePtr a) -&gt; (Context) -&gt; (DevicePtr a) -&gt; (Context) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemcpyPeerAsync a1 a2 a3 a4 a5 a6 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = useContext a2} in 
  let {a3' = useDeviceHandle a3} in 
  let {a4' = useContext a4} in 
  let {a5' = fromIntegral a5} in 
  let {a6' = useStream a6} in 
  cuMemcpyPeerAsync'_ a1' a2' a3' a4' a5' a6' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 881 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



--------------------------------------------------------------------------------
-- Combined Allocation and Marshalling
--------------------------------------------------------------------------------

-- |
-- Write a list of storable elements into a newly allocated device array,
-- returning the device pointer together with the number of elements that were
-- written. Note that this requires two memory copies: firstly from a Haskell
-- list to a heap allocated array, and from there onto the graphics device. The
-- memory should be 'free'd when no longer required.
--
{-# INLINEABLE newListArrayLen #-}
newListArrayLen :: Storable a =&gt; [a] -&gt; IO (DevicePtr a, Int)
newListArrayLen xs =
  F.withArrayLen xs                     $ \len p -&gt;
  bracketOnError (mallocArray len) free $ \d_xs  -&gt; do
    pokeArray len p d_xs
    return (d_xs, len)


-- |
-- Write a list of storable elements into a newly allocated device array. This
-- is 'newListArrayLen' composed with 'fst'.
--
{-# INLINEABLE newListArray #-}
newListArray :: Storable a =&gt; [a] -&gt; IO (DevicePtr a)
newListArray xs = fst `fmap` newListArrayLen xs


-- |
-- Temporarily store a list of elements into a newly allocated device array. An
-- IO action is applied to to the array, the result of which is returned.
-- Similar to 'newListArray', this requires copying the data twice.
--
-- As with 'allocaArray', the memory is freed once the action completes, so you
-- should not return the pointer from the action, and be wary of asynchronous
-- kernel execution.
--
{-# INLINEABLE withListArray #-}
withListArray :: Storable a =&gt; [a] -&gt; (DevicePtr a -&gt; IO b) -&gt; IO b
withListArray xs = withListArrayLen xs . const


-- |
-- A variant of 'withListArray' which also supplies the number of elements in
-- the array to the applied function
--
{-# INLINEABLE withListArrayLen #-}
withListArrayLen :: Storable a =&gt; [a] -&gt; (Int -&gt; DevicePtr a -&gt; IO b) -&gt; IO b
withListArrayLen xs f =
  bracket (newListArrayLen xs) (free . fst) (uncurry . flip $ f)
--
-- XXX: Will this attempt to double-free the device array on error (together
-- with newListArrayLen)?
--


--------------------------------------------------------------------------------
-- Utility
--------------------------------------------------------------------------------

-- |
-- Set a number of data elements to the specified value, which may be either 8-,
-- 16-, or 32-bits wide.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g6e582bf866e9e2fb014297bfaf354d7b&gt;
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g7d805e610054392a4d11e8a8bf5eb35c&gt;
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g983e8d8759acd1b64326317481fbf132&gt;
--
{-# INLINEABLE memset #-}
memset :: Storable a =&gt; DevicePtr a -&gt; Int -&gt; a -&gt; IO ()
memset !dptr !n !val = case sizeOf val of
    1 -&gt; nothingIfOk =&lt;&lt; cuMemsetD8  dptr val n
    2 -&gt; nothingIfOk =&lt;&lt; cuMemsetD16 dptr val n
    4 -&gt; nothingIfOk =&lt;&lt; cuMemsetD32 dptr val n
    _ -&gt; cudaError &quot;can only memset 8-, 16-, and 32-bit values&quot;

--
-- We use unsafe coerce below to reinterpret the bits of the value to memset as,
-- into the integer type required by the setting functions.
--
{-# INLINE cuMemsetD8 #-}
cuMemsetD8 :: (DevicePtr a) -&gt; (a) -&gt; (Int) -&gt; IO ((Status))
cuMemsetD8 a1 a2 a3 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = unsafeCoerce a2} in 
  let {a3' = fromIntegral a3} in 
  cuMemsetD8'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 971 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}


{-# INLINE cuMemsetD16 #-}
cuMemsetD16 :: (DevicePtr a) -&gt; (a) -&gt; (Int) -&gt; IO ((Status))
cuMemsetD16 a1 a2 a3 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = unsafeCoerce a2} in 
  let {a3' = fromIntegral a3} in 
  cuMemsetD16'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 977 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}


{-# INLINE cuMemsetD32 #-}
cuMemsetD32 :: (DevicePtr a) -&gt; (a) -&gt; (Int) -&gt; IO ((Status))
cuMemsetD32 a1 a2 a3 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = unsafeCoerce a2} in 
  let {a3' = fromIntegral a3} in 
  cuMemsetD32'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 983 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Set the number of data elements to the specified value, which may be either
-- 8-, 16-, or 32-bits wide. The operation is asynchronous and may optionally be
-- associated with a stream.
--
-- Requires CUDA-3.2.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1gaef08a7ccd61112f94e82f2b30d43627&gt;
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1gf731438877dd8ec875e4c43d848c878c&gt;
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g58229da5d30f1c0cdf667b320ec2c0f5&gt;
--
{-# INLINEABLE memsetAsync #-}
memsetAsync :: Storable a =&gt; DevicePtr a -&gt; Int -&gt; a -&gt; Maybe Stream -&gt; IO ()
memsetAsync !dptr !n !val !mst = case sizeOf val of
    1 -&gt; nothingIfOk =&lt;&lt; cuMemsetD8Async  dptr val n stream
    2 -&gt; nothingIfOk =&lt;&lt; cuMemsetD16Async dptr val n stream
    4 -&gt; nothingIfOk =&lt;&lt; cuMemsetD32Async dptr val n stream
    _ -&gt; cudaError &quot;can only memset 8-, 16-, and 32-bit values&quot;
    where
      stream = fromMaybe defaultStream mst

{-# INLINE cuMemsetD8Async #-}
cuMemsetD8Async :: (DevicePtr a) -&gt; (a) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemsetD8Async a1 a2 a3 a4 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = unsafeCoerce a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = useStream a4} in 
  cuMemsetD8Async'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 1017 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}


{-# INLINE cuMemsetD16Async #-}
cuMemsetD16Async :: (DevicePtr a) -&gt; (a) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemsetD16Async a1 a2 a3 a4 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = unsafeCoerce a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = useStream a4} in 
  cuMemsetD16Async'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 1024 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}


{-# INLINE cuMemsetD32Async #-}
cuMemsetD32Async :: (DevicePtr a) -&gt; (a) -&gt; (Int) -&gt; (Stream) -&gt; IO ((Status))
cuMemsetD32Async a1 a2 a3 a4 =
  let {a1' = useDeviceHandle a1} in 
  let {a2' = unsafeCoerce a2} in 
  let {a3' = fromIntegral a3} in 
  let {a4' = useStream a4} in 
  cuMemsetD32Async'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 1032 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}



-- |
-- Return the device pointer associated with a mapped, pinned host buffer, which
-- was allocated with the 'DeviceMapped' option by 'mallocHostArray'.
--
-- Currently, no options are supported and this must be empty.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g57a39e5cba26af4d06be67fc77cc62f0&gt;
--
{-# INLINEABLE getDevicePtr #-}
getDevicePtr :: [AllocFlag] -&gt; HostPtr a -&gt; IO (DevicePtr a)
getDevicePtr !flags !hp = resultIfOk =&lt;&lt; cuMemHostGetDevicePointer hp flags

{-# INLINE cuMemHostGetDevicePointer #-}
cuMemHostGetDevicePointer :: (HostPtr a) -&gt; ([AllocFlag]) -&gt; IO ((Status), (DevicePtr a))
cuMemHostGetDevicePointer a2 a3 =
  alloca' $ \a1' -&gt; 
  let {a2' = useHP a2} in 
  let {a3' = combineBitMasks a3} in 
  cuMemHostGetDevicePointer'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  peekDeviceHandle  a1'&gt;&gt;= \a1'' -&gt; 
  return (res', a1'')

{-# LINE 1051 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    alloca'  = F.alloca
    useHP    = castPtr . useHostPtr


-- |
-- Return the base address and allocation size of the given device pointer.
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g64fee5711274a2a0573a789c94d8299b&gt;
--
{-# INLINEABLE getBasePtr #-}
getBasePtr :: DevicePtr a -&gt; IO (DevicePtr a, Int64)
getBasePtr !dptr = do
  (status,base,size) &lt;- cuMemGetAddressRange dptr
  resultIfOk (status, (base,size))

{-# INLINE cuMemGetAddressRange #-}
cuMemGetAddressRange :: (DevicePtr a) -&gt; IO ((Status), (DevicePtr a), (Int64))
cuMemGetAddressRange a3 =
  alloca' $ \a1' -&gt; 
  alloca' $ \a2' -&gt; 
  let {a3' = useDeviceHandle a3} in 
  cuMemGetAddressRange'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  peekDeviceHandle  a1'&gt;&gt;= \a1'' -&gt; 
  peekIntConv  a2'&gt;&gt;= \a2'' -&gt; 
  return (res', a1'', a2'')

{-# LINE 1072 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    alloca' :: Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
    alloca' = F.alloca

-- |
-- Return the amount of free and total memory respectively available to the
-- current context (bytes).
--
-- &lt;http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__MEM.html#group__CUDA__MEM_1g808f555540d0143a331cc42aa98835c0&gt;
--
{-# INLINEABLE getMemInfo #-}
getMemInfo :: IO (Int64, Int64)
getMemInfo = do
  (!status,!f,!t) &lt;- cuMemGetInfo
  resultIfOk (status,(f,t))

{-# INLINE cuMemGetInfo #-}
cuMemGetInfo :: IO ((Status), (Int64), (Int64))
cuMemGetInfo =
  alloca' $ \a1' -&gt; 
  alloca' $ \a2' -&gt; 
  cuMemGetInfo'_ a1' a2' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  peekIntConv  a1'&gt;&gt;= \a1'' -&gt; 
  peekIntConv  a2'&gt;&gt;= \a2'' -&gt; 
  return (res', a1'', a2'')

{-# LINE 1092 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}

  where
    alloca' = F.alloca


--------------------------------------------------------------------------------
-- Internal
--------------------------------------------------------------------------------

type DeviceHandle = (C2HSImp.CULLong)
{-# LINE 1101 &quot;src/Foreign/CUDA/Driver/Marshal.chs&quot; #-}


-- Lift an opaque handle to a typed DevicePtr representation. This occasions
-- arcane distinctions for the different driver versions and Tesla (compute 1.x)
-- and Fermi (compute 2.x) class architectures on 32- and 64-bit hosts.
--
{-# INLINE peekDeviceHandle #-}
peekDeviceHandle :: Ptr DeviceHandle -&gt; IO (DevicePtr a)
peekDeviceHandle !p = DevicePtr . intPtrToPtr . fromIntegral &lt;$&gt; peek p

-- Use a device pointer as an opaque handle type
--
{-# INLINE useDeviceHandle #-}
useDeviceHandle :: DevicePtr a -&gt; DeviceHandle
useDeviceHandle = fromIntegral . ptrToIntPtr . useDevicePtr


foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemHostAlloc&quot;
  cuMemHostAlloc'_ :: ((C2HSImp.Ptr (C2HSImp.Ptr ())) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemFreeHost&quot;
  cuMemFreeHost'_ :: ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemHostRegister&quot;
  cuMemHostRegister'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemHostUnregister&quot;
  cuMemHostUnregister'_ :: ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemAlloc&quot;
  cuMemAlloc'_ :: ((C2HSImp.Ptr C2HSImp.CULLong) -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt)))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemFree&quot;
  cuMemFree'_ :: (C2HSImp.CULLong -&gt; (IO C2HSImp.CInt))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyDtoH&quot;
  cuMemcpyDtoH'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyDtoHAsync&quot;
  cuMemcpyDtoHAsync'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpy2DDtoH&quot;
  cuMemcpy2DDtoH'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt)))))))))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpy2DDtoHAsync&quot;
  cuMemcpy2DDtoHAsync'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))))))))))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyHtoD&quot;
  cuMemcpyHtoD'_ :: (C2HSImp.CULLong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyHtoDAsync&quot;
  cuMemcpyHtoDAsync'_ :: (C2HSImp.CULLong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpy2DHtoD&quot;
  cuMemcpy2DHtoD'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt)))))))))))

foreign import ccall safe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpy2DHtoDAsync&quot;
  cuMemcpy2DHtoDAsync'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))))))))))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyDtoD&quot;
  cuMemcpyDtoD'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyDtoDAsync&quot;
  cuMemcpyDtoDAsync'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpy2DDtoD&quot;
  cuMemcpy2DDtoD'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt)))))))))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpy2DDtoDAsync&quot;
  cuMemcpy2DDtoDAsync'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CUInt -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))))))))))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyPeer&quot;
  cuMemcpyPeer'_ :: (C2HSImp.CULLong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULLong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemcpyPeerAsync&quot;
  cuMemcpyPeerAsync'_ :: (C2HSImp.CULLong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULLong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemsetD8&quot;
  cuMemsetD8'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUChar -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemsetD16&quot;
  cuMemsetD16'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUShort -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemsetD32&quot;
  cuMemsetD32'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemsetD8Async&quot;
  cuMemsetD8Async'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUChar -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemsetD16Async&quot;
  cuMemsetD16Async'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUShort -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemsetD32Async&quot;
  cuMemsetD32Async'_ :: (C2HSImp.CULLong -&gt; (C2HSImp.CUInt -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemHostGetDevicePointer&quot;
  cuMemHostGetDevicePointer'_ :: ((C2HSImp.Ptr C2HSImp.CULLong) -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemGetAddressRange&quot;
  cuMemGetAddressRange'_ :: ((C2HSImp.Ptr C2HSImp.CULLong) -&gt; ((C2HSImp.Ptr C2HSImp.CULong) -&gt; (C2HSImp.CULLong -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Driver/Marshal.chs.h cuMemGetInfo&quot;
  cuMemGetInfo'_ :: ((C2HSImp.Ptr C2HSImp.CULong) -&gt; ((C2HSImp.Ptr C2HSImp.CULong) -&gt; (IO C2HSImp.CInt)))
</span></pre></body></html>