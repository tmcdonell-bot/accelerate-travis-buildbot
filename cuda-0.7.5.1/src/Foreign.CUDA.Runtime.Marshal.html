<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- GENERATED by C-&gt;Haskell Compiler, version 0.28.1 Switcheroo, 1 April 2016 (Haskell)</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- Edit the ORIGNAL .chs file instead!</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LINE 1 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns             #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE EmptyDataDecls           #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE ForeignFunctionInterface #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell          #-}</span><span>
</span><a name="line-10"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Module    : Foreign.CUDA.Runtime.Marshal</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Copyright : [2009..2014] Trevor L. McDonell</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- License   : BSD</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- Memory management for CUDA devices</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Runtime</span><span class="hs-operator">.</span><span class="hs-identifier">Marshal</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-comment">-- * Host Allocation</span><span>
</span><a name="line-23"></a><span>  </span><span class="hs-identifier">AllocFlag</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-identifier">mallocHostArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">freeHost</span><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-comment">-- * Device Allocation</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-identifier">mallocArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">allocaArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">free</span><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-comment">-- * Unified Memory Allocation</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-identifier">AttachFlag</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-identifier">mallocManagedArray</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-comment">-- * Marshalling</span><span>
</span><a name="line-34"></a><span>  </span><a href="Foreign.CUDA.Runtime.Marshal.html#newListArray"><span class="hs-identifier hs-var">peekArray</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekArrayAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekArray2D</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekArray2DAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">peekListArray</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>  </span><a href="Foreign.CUDA.Runtime.Marshal.html#withListArray"><span class="hs-identifier hs-var">pokeArray</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeArrayAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeArray2D</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeArray2DAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pokeListArray</span><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-identifier">copyArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArrayAsync</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArray2D</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">copyArray2DAsync</span><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-comment">-- * Combined Allocation and Marshalling</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-identifier">newListArray</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">newListArrayLen</span><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-identifier">withListArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">withListArrayLen</span><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-comment">-- * Utility</span><span>
</span><a name="line-43"></a><span>  </span><span class="hs-identifier">memset</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C2HSImp</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Foreign.CUDA.Runtime.Error.html"><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C2HSImp</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-pragma">{-# LINE 43 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- Friends</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Runtime</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Runtime</span><span class="hs-operator">.</span><span class="hs-identifier">Stream</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">CUDA</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">C2HS</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-comment">-- System</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Int</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Storable</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Marshal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- Host Allocation</span><span>
</span><a name="line-77"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- Options for host allocation</span><span>
</span><a name="line-81"></a><span class="hs-comment">--</span><span>
</span><a name="line-82"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">AllocFlag</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Portable</span><span>
</span><a name="line-83"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-84"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span class="hs-identifier">Bounded</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">AllocFlag</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">Portable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">DeviceMapped</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">WriteCombined</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;AllocFlag.succ: WriteCombined has no successor&quot;</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>  </span><span class="hs-identifier">pred</span><span> </span><span class="hs-identifier">DeviceMapped</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Portable</span><span>
</span><a name="line-92"></a><span>  </span><a name="local-805306531"><span class="hs-identifier">pred</span></a><span> </span><span class="hs-identifier">WriteCombined</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-identifier">pred</span><span> </span><span class="hs-identifier">Portable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;AllocFlag.pred: Portable has no predecessor&quot;</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span>  </span><span class="hs-identifier">enumFromTo</span><span> </span><a href="Foreign.CUDA.Runtime.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="Foreign.CUDA.Runtime.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">from</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>      </span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">to</span><span>
</span><a name="line-98"></a><span>      </span><a name="local-1912608618"><span class="hs-identifier">go</span></a><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-99"></a><span>                 </span><a href="Foreign.CUDA.Runtime.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">LT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Foreign.CUDA.Runtime.Marshal.html#DeviceMapped"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">succ</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>                 </span><a href="Foreign.CUDA.Runtime.Marshal.html#WriteCombined"><span class="hs-identifier hs-var">EQ</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Foreign.CUDA.Runtime.Marshal.html#WriteCombined"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span>
</span><a name="line-101"></a><span>                 </span><span class="hs-identifier">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-identifier">enumFrom</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromTo</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>  </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">Portable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DeviceMapped</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">WriteCombined</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span>  </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Portable</span><span>
</span><a name="line-110"></a><span>  </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DeviceMapped</span><span>
</span><a name="line-111"></a><span>  </span><a name="cudaHostAlloc"><a href="Foreign.CUDA.Runtime.Marshal.html#cudaHostAlloc"><span class="hs-identifier">toEnum</span></a></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WriteCombined</span><span>
</span><a name="line-112"></a><span>  </span><a href="#local-1627906370"><span class="hs-identifier hs-var">toEnum</span></a><span> </span><span class="hs-identifier">unmatched</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;AllocFlag.toEnum: Cannot match &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">unmatched</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-pragma">{-# LINE 88 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- Allocate a section of linear memory on the host which is page-locked and</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- directly accessible from the device. The storage is sufficient to hold the</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- given number of elements of a storable type. The runtime system automatically</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- accelerates calls to functions such as 'peekArrayAsync' and 'pokeArrayAsync'</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- that refer to page-locked memory.</span><span>
</span><a name="line-124"></a><span class="hs-comment">--</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- Note that since the amount of pageable memory is thusly reduced, overall</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- system performance may suffer. This is best used sparingly to allocate</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- staging areas for data exchange</span><span>
</span><a name="line-128"></a><span class="hs-comment">--</span><span>
</span><a name="line-129"></a><span class="hs-pragma">{-# INLINEABLE mallocHostArray #-}</span><span>
</span><a name="line-130"></a><span class="hs-identifier">mallocHostArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><a name="local-1627906385"><a href="#local-1627906385"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span class="hs-identifier">mallocHostArray</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">flags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a'</span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">resultIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cudaHostAlloc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">flags</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-pragma">{-# INLINE cudaHostAlloc #-}</span><span>
</span><a name="line-137"></a><span class="hs-identifier">cudaHostAlloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int64</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">AllocFlag</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span class="hs-identifier">cudaHostAlloc</span><span> </span><span class="hs-identifier">a2</span><span> </span><span class="hs-identifier">a3</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a2'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cIntConv</span><span> </span><span class="hs-identifier">a2</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a3'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">combineBitMasks</span><span> </span><span class="hs-identifier">a3</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-identifier">cudaHostAlloc'_</span><span> </span><span class="hs-identifier hs-type">a1'</span><span> </span><span class="hs-identifier">a2'</span><span> </span><span class="hs-identifier">a3'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a name="mallocArray"><a href="Foreign.CUDA.Runtime.Marshal.html#mallocArray"><span class="hs-identifier">res'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627906387"><span class="hs-identifier hs-var">cToEnum</span></a><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-identifier">hptr</span><span>  </span><span class="hs-identifier">a1'</span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1''</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">a1''</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-pragma">{-# LINE 113 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">F</span><span class="hs-operator">.</span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">poke</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">nullPtr</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>    </span><a href="#local-1627906392"><span class="hs-identifier hs-var">hptr</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-var">p</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">castPtr</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- Free page-locked host memory previously allocated with 'mallecHost'</span><span>
</span><a name="line-156"></a><span class="hs-comment">--</span><span>
</span><a name="line-157"></a><span class="hs-pragma">{-# INLINEABLE freeHost #-}</span><span>
</span><a name="line-158"></a><span class="hs-identifier">freeHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span class="hs-identifier">freeHost</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nothingIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cudaFreeHost</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-pragma">{-# INLINE cudaFreeHost #-}</span><span>
</span><a name="line-162"></a><span class="hs-identifier">cudaFreeHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HostPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span class="hs-identifier">cudaFreeHost</span><span> </span><span class="hs-identifier">a1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hptr</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-identifier">cudaFreeHost'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-pragma">{-# LINE 128 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">hptr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">useHostPtr</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- Device Allocation</span><span>
</span><a name="line-176"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- Allocate a section of linear memory on the device, and return a reference to</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- it. The memory is sufficient to hold the given number of elements of storable</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- type. It is suitable aligned, and not cleared.</span><span>
</span><a name="line-182"></a><span class="hs-comment">--</span><span>
</span><a name="line-183"></a><span class="hs-pragma">{-# INLINEABLE mallocArray #-}</span><span>
</span><a name="line-184"></a><span class="hs-identifier">mallocArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><a href="#local-1627906731"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span class="hs-identifier">mallocArray</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-186"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a'</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-identifier">doMalloc</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">resultIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cudaMalloc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-pragma">{-# INLINE cudaMalloc #-}</span><span>
</span><a name="line-191"></a><span class="hs-identifier">cudaMalloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int64</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span class="hs-identifier">cudaMalloc</span><span> </span><span class="hs-identifier">a2</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-193"></a><span>  </span><span class="hs-identifier">alloca'</span><span> </span><a name="AttachFlag"><a href="Foreign.CUDA.Runtime.Marshal.html#AttachFlag"><span class="hs-operator">$</span></a></a><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a2'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cIntConv</span><span> </span><span class="hs-identifier">a2</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-identifier">cudaMalloc'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-identifier">a2'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-197"></a><span>  </span><span class="hs-identifier">dptr</span><span>  </span><span class="hs-identifier">a1'</span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a1''</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-198"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a1''</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-pragma">{-# LINE 151 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-comment">-- C-&gt; Haskell doesn't like qualified imports in marshaller specifications</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-identifier">alloca'</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">F</span><span class="hs-operator">.</span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">poke</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">nullPtr</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-identifier">dptr</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castDevPtr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">DevicePtr</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- Execute a computation, passing a pointer to a temporarily allocated block of</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- memory sufficient to hold the given number of elements of storable type. The</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- memory is freed when the computation terminates (normally or via an</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- exception), so the pointer must not be used after this.</span><span>
</span><a name="line-213"></a><span class="hs-comment">--</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- Note that kernel launches can be asynchronous, so you may need to add a</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- synchronisation point at the end of the computation.</span><span>
</span><a name="line-216"></a><span class="hs-comment">--</span><span>
</span><a name="line-217"></a><span class="hs-pragma">{-# INLINEABLE allocaArray #-}</span><span>
</span><a name="line-218"></a><span class="hs-identifier">allocaArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-219"></a><span class="hs-identifier">allocaArray</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bracket</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mallocArray</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">free</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- Free previously allocated memory on the device</span><span>
</span><a name="line-224"></a><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span class="hs-pragma">{-# INLINEABLE free #-}</span><span>
</span><a name="line-226"></a><span class="hs-identifier">free</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span class="hs-identifier">free</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nothingIfOk</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">cudaFree</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span class="hs-pragma">{-# INLINE cudaFree #-}</span><span>
</span><a name="line-230"></a><span class="hs-identifier">cudaFree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">Status</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span class="hs-identifier">cudaFree</span><span> </span><span class="hs-identifier">a1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-232"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">a1'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dptr</span><span> </span><span class="hs-identifier">a1</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><a name="line-233"></a><span>  </span><span class="hs-identifier">cudaFree'_</span><span> </span><span class="hs-identifier">a1'</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">res'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cToEnum</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-235"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">res'</span><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-pragma">{-# LINE 181 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-240"></a><span>    </span><span class="hs-identifier">dptr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">useDevicePtr</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">castDevPtr</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-244"></a><span class="hs-comment">-- Unified memory allocation</span><span>
</span><a name="line-245"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- Options for unified memory allocations</span><span>
</span><a name="line-249"></a><span class="hs-comment">--</span><span>
</span><a name="line-250"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">AttachFlag</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- Allocates memory that will be automatically managed by the Unified Memory</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- system</span><span>
</span><a name="line-255"></a><span class="hs-comment">--</span><span>
</span><a name="line-256"></a><span class="hs-pragma">{-# INLINEABLE mallocManagedArray #-}</span><span>
</span><a name="line-257"></a><span class="hs-identifier">mallocManagedArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">AttachFlag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DevicePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span class="hs-identifier">mallocManagedArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">requireSDK</span><span> </span><span class="hs-char">'mallocManagedArray 6.0


--------------------------------------------------------------------------------
-- Marshalling
--------------------------------------------------------------------------------

-- |
-- Copy a number of elements from the device to host memory. This is a
-- synchronous operation.
--
{-# INLINEABLE peekArray #-}
peekArray :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; Ptr a -&gt; IO ()
peekArray !n !dptr !hptr = memcpy hptr (useDevicePtr dptr) n DeviceToHost


-- |
-- Copy memory from the device asynchronously, possibly associated with a
-- particular stream. The destination memory must be page locked.
--
{-# INLINEABLE peekArrayAsync #-}
peekArrayAsync :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; HostPtr a -&gt; Maybe Stream -&gt; IO ()
peekArrayAsync !n !dptr !hptr !mst =
  memcpyAsync (useHostPtr hptr) (useDevicePtr dptr) n DeviceToHost mst


-- |
-- Copy a 2D memory area from the device to the host. This is a synchronous
-- operation.
--
{-# INLINEABLE peekArray2D #-}
peekArray2D
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; Ptr a                    -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; IO ()
peekArray2D !w !h !dptr !dw !hptr !hw =
  memcpy2D hptr hw (useDevicePtr dptr) dw w h DeviceToHost


-- |
-- Copy a 2D memory area from the device to the host asynchronously, possibly
-- associated with a particular stream. The destination array must be page
-- locked.
--
{-# INLINEABLE peekArray2DAsync #-}
peekArray2DAsync
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; HostPtr a                -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Maybe Stream
    -&gt; IO ()
peekArray2DAsync !w !h !dptr !dw !hptr !hw !mst =
  memcpy2DAsync (useHostPtr hptr) hw (useDevicePtr dptr) dw w h DeviceToHost mst


-- |
-- Copy a number of elements from the device into a new Haskell list. Note that
-- this requires two memory copies: firstly from the device into a heap
-- allocated array, and from there marshalled into a list
--
{-# INLINEABLE peekListArray #-}
peekListArray :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; IO [a]
peekListArray !n !dptr =
  F.allocaArray n $ \p -&gt; do
    peekArray   n dptr p
    F.peekArray n p


-- |
-- Copy a number of elements onto the device. This is a synchronous operation.
--
{-# INLINEABLE pokeArray #-}
pokeArray :: Storable a =&gt; Int -&gt; Ptr a -&gt; DevicePtr a -&gt; IO ()
pokeArray !n !hptr !dptr = memcpy (useDevicePtr dptr) hptr n HostToDevice


-- |
-- Copy memory onto the device asynchronously, possibly associated with a
-- particular stream. The source memory must be page-locked.
--
{-# INLINEABLE pokeArrayAsync #-}
pokeArrayAsync :: Storable a =&gt; Int -&gt; HostPtr a -&gt; DevicePtr a -&gt; Maybe Stream -&gt; IO ()
pokeArrayAsync !n !hptr !dptr !mst =
  memcpyAsync (useDevicePtr dptr) (useHostPtr hptr) n HostToDevice mst


-- |
-- Copy a 2D memory area onto the device. This is a synchronous operation.
--
{-# INLINEABLE pokeArray2D #-}
pokeArray2D
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; Ptr a                    -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; IO ()
pokeArray2D !w !h !hptr !dw !dptr !hw =
  memcpy2D (useDevicePtr dptr) dw hptr hw w h HostToDevice


-- |
-- Copy a 2D memory area onto the device asynchronously, possibly associated
-- with a particular stream. The source array must be page locked.
--
{-# INLINEABLE pokeArray2DAsync #-}
pokeArray2DAsync
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; HostPtr a                -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Maybe Stream
    -&gt; IO ()
pokeArray2DAsync !w !h !hptr !hw !dptr !dw !mst =
  memcpy2DAsync (useDevicePtr dptr) dw (useHostPtr hptr) hw w h HostToDevice mst

-- |
-- Write a list of storable elements into a device array. The array must be
-- sufficiently large to hold the entire list. This requires two marshalling
-- operations
--
{-# INLINEABLE pokeListArray #-}
pokeListArray :: Storable a =&gt; [a] -&gt; DevicePtr a -&gt; IO ()
pokeListArray !xs !dptr = F.withArrayLen xs $ \len p -&gt; pokeArray len p dptr


-- |
-- Copy the given number of elements from the first device array (source) to the
-- second (destination). The copied areas may not overlap. This operation is
-- asynchronous with respect to host, but will not overlap other device
-- operations.
--
{-# INLINEABLE copyArray #-}
copyArray :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; DevicePtr a -&gt; IO ()
copyArray !n !src !dst = memcpy (useDevicePtr dst) (useDevicePtr src) n DeviceToDevice


-- |
-- Copy the given number of elements from the first device array (source) to the
-- second (destination). The copied areas may not overlap. This operation is
-- asynchronous with respect to the host, and may be associated with a
-- particular stream.
--
{-# INLINEABLE copyArrayAsync #-}
copyArrayAsync :: Storable a =&gt; Int -&gt; DevicePtr a -&gt; DevicePtr a -&gt; Maybe Stream -&gt; IO ()
copyArrayAsync !n !src !dst !mst =
  memcpyAsync (useDevicePtr dst) (useDevicePtr src) n DeviceToDevice mst


-- |
-- Copy a 2D memory area from the first device array (source) to the second
-- (destination). The copied areas may not overlap. This operation is
-- asynchronous with respect to the host, but will not overlap other device
-- operations.
--
{-# INLINEABLE copyArray2D #-}
copyArray2D
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; IO ()
copyArray2D !w !h !src !sw !dst !dw =
  memcpy2D (useDevicePtr dst) dw (useDevicePtr src) sw w h DeviceToDevice


-- |
-- Copy a 2D memory area from the first device array (source) to the second
-- device array (destination). The copied areas may not overlay. This operation
-- is asynchronous with respect to the host, and may be associated with a
-- particular stream.
--
{-# INLINEABLE copyArray2DAsync #-}
copyArray2DAsync
    :: Storable a
    =&gt; Int                      -- ^ width to copy (elements)
    -&gt; Int                      -- ^ height to copy (elements)
    -&gt; DevicePtr a              -- ^ source array
    -&gt; Int                      -- ^ source array width
    -&gt; DevicePtr a              -- ^ destination array
    -&gt; Int                      -- ^ destination array width
    -&gt; Maybe Stream
    -&gt; IO ()
copyArray2DAsync !w !h !src !sw !dst !dw !mst =
  memcpy2DAsync (useDevicePtr dst) dw (useDevicePtr src) sw w h DeviceToDevice mst


--
-- Memory copy kind
--
data CopyDirection = HostToHost
                   | HostToDevice
                   | DeviceToHost
                   | DeviceToDevice
                   | Default
  deriving (Eq,Show)
instance Enum CopyDirection where
  succ HostToHost = HostToDevice
  succ HostToDevice = DeviceToHost
  succ DeviceToHost = DeviceToDevice
  succ DeviceToDevice = Default
  succ Default = error &quot;CopyDirection.succ: Default has no successor&quot;

  pred HostToDevice = HostToHost
  pred DeviceToHost = HostToDevice
  pred DeviceToDevice = DeviceToHost
  pred Default = DeviceToDevice
  pred HostToHost = error &quot;CopyDirection.pred: HostToHost has no predecessor&quot;

  enumFromTo from to = go from
    where
      end = fromEnum to
      go v = case compare (fromEnum v) end of
                 LT -&gt; v : go (succ v)
                 EQ -&gt; [v]
                 GT -&gt; []

  enumFrom from = enumFromTo from Default

  fromEnum HostToHost = 0
  fromEnum HostToDevice = 1
  fromEnum DeviceToHost = 2
  fromEnum DeviceToDevice = 3
  fromEnum Default = 4

  toEnum 0 = HostToHost
  toEnum 1 = HostToDevice
  toEnum 2 = DeviceToHost
  toEnum 3 = DeviceToDevice
  toEnum 4 = Default
  toEnum unmatched = error (&quot;CopyDirection.toEnum: Cannot match &quot; ++ show unmatched)

{-# LINE 431 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}


-- |
-- Copy data between host and device. This is a synchronous operation.
--
{-# INLINEABLE memcpy #-}
memcpy :: Storable a
       =&gt; Ptr a                 -- ^ destination
       -&gt; Ptr a                 -- ^ source
       -&gt; Int                   -- ^ number of elements
       -&gt; CopyDirection
       -&gt; IO ()
memcpy !dst !src !n !dir = doMemcpy undefined dst
  where
    doMemcpy :: Storable a' =&gt; a' -&gt; Ptr a' -&gt; IO ()
    doMemcpy x _ =
      nothingIfOk =&lt;&lt; cudaMemcpy dst src (fromIntegral n * fromIntegral (sizeOf x)) dir

{-# INLINE cudaMemcpy #-}
cudaMemcpy :: (Ptr a) -&gt; (Ptr a) -&gt; (Int64) -&gt; (CopyDirection) -&gt; IO ((Status))
cudaMemcpy a1 a2 a3 a4 =
  let {a1' = castPtr a1} in 
  let {a2' = castPtr a2} in 
  let {a3' = cIntConv a3} in 
  let {a4' = cFromEnum a4} in 
  cudaMemcpy'_ a1' a2' a3' a4' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 454 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}



-- |
-- Copy data between the host and device asynchronously, possibly associated
-- with a particular stream. The host-side memory must be page-locked (allocated
-- with 'mallocHostArray').
--
{-# INLINEABLE memcpyAsync #-}
memcpyAsync :: Storable a
            =&gt; Ptr a            -- ^ destination
            -&gt; Ptr a            -- ^ source
            -&gt; Int              -- ^ number of elements
            -&gt; CopyDirection
            -&gt; Maybe Stream
            -&gt; IO ()
memcpyAsync !dst !src !n !kind !mst = doMemcpy undefined dst
  where
    doMemcpy :: Storable a' =&gt; a' -&gt; Ptr a' -&gt; IO ()
    doMemcpy x _ =
      let bytes = fromIntegral n * fromIntegral (sizeOf x) in
      nothingIfOk =&lt;&lt; cudaMemcpyAsync dst src bytes kind (fromMaybe defaultStream mst)

{-# INLINE cudaMemcpyAsync #-}
cudaMemcpyAsync :: (Ptr a) -&gt; (Ptr a) -&gt; (Int64) -&gt; (CopyDirection) -&gt; (Stream) -&gt; IO ((Status))
cudaMemcpyAsync a1 a2 a3 a4 a5 =
  let {a1' = castPtr a1} in 
  let {a2' = castPtr a2} in 
  let {a3' = cIntConv a3} in 
  let {a4' = cFromEnum a4} in 
  let {a5' = useStream a5} in 
  cudaMemcpyAsync'_ a1' a2' a3' a4' a5' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 483 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}



-- |
-- Copy a 2D memory area between the host and device. This is a synchronous
-- operation.
--
{-# INLINEABLE memcpy2D #-}
memcpy2D :: Storable a
         =&gt; Ptr a               -- ^ destination
         -&gt; Int                 -- ^ width of destination array
         -&gt; Ptr a               -- ^ source
         -&gt; Int                 -- ^ width of source array
         -&gt; Int                 -- ^ width to copy
         -&gt; Int                 -- ^ height to copy
         -&gt; CopyDirection
         -&gt; IO ()
memcpy2D !dst !dw !src !sw !w !h !kind = doCopy undefined dst
  where
    doCopy :: Storable a' =&gt; a' -&gt; Ptr a' -&gt; IO ()
    doCopy x _ =
      let bytes = fromIntegral (sizeOf x)
          dw'   = fromIntegral dw * bytes
          sw'   = fromIntegral sw * bytes
          w'    = fromIntegral w  * bytes
          h'    = fromIntegral h
      in
      nothingIfOk =&lt;&lt; cudaMemcpy2D dst dw' src sw' w' h' kind

{-# INLINE cudaMemcpy2D #-}
cudaMemcpy2D :: (Ptr a) -&gt; (Int64) -&gt; (Ptr a) -&gt; (Int64) -&gt; (Int64) -&gt; (Int64) -&gt; (CopyDirection) -&gt; IO ((Status))
cudaMemcpy2D a1 a2 a3 a4 a5 a6 a7 =
  let {a1' = castPtr a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = castPtr a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = fromIntegral a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = cFromEnum a7} in 
  cudaMemcpy2D'_ a1' a2' a3' a4' a5' a6' a7' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 522 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}



-- |
-- Copy a 2D memory area between the host and device asynchronously, possibly
-- associated with a particular stream. The host-side memory must be
-- page-locked.
--
{-# INLINEABLE memcpy2DAsync #-}
memcpy2DAsync :: Storable a
              =&gt; Ptr a          -- ^ destination
              -&gt; Int            -- ^ width of destination array
              -&gt; Ptr a          -- ^ source
              -&gt; Int            -- ^ width of source array
              -&gt; Int            -- ^ width to copy
              -&gt; Int            -- ^ height to copy
              -&gt; CopyDirection
              -&gt; Maybe Stream
              -&gt; IO ()
memcpy2DAsync !dst !dw !src !sw !w !h !kind !mst = doCopy undefined dst
  where
    doCopy :: Storable a' =&gt; a' -&gt; Ptr a' -&gt; IO ()
    doCopy x _ =
      let bytes = fromIntegral (sizeOf x)
          dw'   = fromIntegral dw * bytes
          sw'   = fromIntegral sw * bytes
          w'    = fromIntegral w  * bytes
          h'    = fromIntegral h
          st    = fromMaybe defaultStream mst
      in
      nothingIfOk =&lt;&lt; cudaMemcpy2DAsync dst dw' src sw' w' h' kind st

{-# INLINE cudaMemcpy2DAsync #-}
cudaMemcpy2DAsync :: (Ptr a) -&gt; (Int64) -&gt; (Ptr a) -&gt; (Int64) -&gt; (Int64) -&gt; (Int64) -&gt; (CopyDirection) -&gt; (Stream) -&gt; IO ((Status))
cudaMemcpy2DAsync a1 a2 a3 a4 a5 a6 a7 a8 =
  let {a1' = castPtr a1} in 
  let {a2' = fromIntegral a2} in 
  let {a3' = castPtr a3} in 
  let {a4' = fromIntegral a4} in 
  let {a5' = fromIntegral a5} in 
  let {a6' = fromIntegral a6} in 
  let {a7' = cFromEnum a7} in 
  let {a8' = useStream a8} in 
  cudaMemcpy2DAsync'_ a1' a2' a3' a4' a5' a6' a7' a8' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 565 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}



--------------------------------------------------------------------------------
-- Combined Allocation and Marshalling
--------------------------------------------------------------------------------

-- |
-- Write a list of storable elements into a newly allocated device array,
-- returning the device pointer together with the number of elements that were
-- written. Note that this requires two copy operations: firstly from a Haskell
-- list into a heap-allocated array, and from there into device memory. The
-- array should be 'free'd when no longer required.
--
{-# INLINEABLE newListArrayLen #-}
newListArrayLen :: Storable a =&gt; [a] -&gt; IO (DevicePtr a, Int)
newListArrayLen !xs =
  F.withArrayLen xs                     $ \len p -&gt;
  bracketOnError (mallocArray len) free $ \d_xs  -&gt; do
    pokeArray len p d_xs
    return (d_xs, len)


-- |
-- Write a list of storable elements into a newly allocated device array. This
-- is 'newListArrayLen' composed with 'fst'.
--
{-# INLINEABLE newListArray #-}
newListArray :: Storable a =&gt; [a] -&gt; IO (DevicePtr a)
newListArray !xs = fst `fmap` newListArrayLen xs


-- |
-- Temporarily store a list of elements into a newly allocated device array. An
-- IO action is applied to the array, the result of which is returned. Similar
-- to 'newListArray', this requires two marshalling operations of the data.
--
-- As with 'allocaArray', the memory is freed once the action completes, so you
-- should not return the pointer from the action, and be sure that any
-- asynchronous operations (such as kernel execution) have completed.
--
{-# INLINEABLE withListArray #-}
withListArray :: Storable a =&gt; [a] -&gt; (DevicePtr a -&gt; IO b) -&gt; IO b
withListArray !xs = withListArrayLen xs . const


-- |
-- A variant of 'withListArray' which also supplies the number of elements in
-- the array to the applied function
--
{-# INLINEABLE withListArrayLen #-}
withListArrayLen :: Storable a =&gt; [a] -&gt; (Int -&gt; DevicePtr a -&gt; IO b) -&gt; IO b
withListArrayLen !xs !f =
  bracket (newListArrayLen xs) (free . fst) (uncurry . flip $ f)
--
-- XXX: Will this attempt to double-free the device array on error (together
-- with newListArrayLen)?
--


--------------------------------------------------------------------------------
-- Utility
--------------------------------------------------------------------------------

-- |
-- Initialise device memory to a given 8-bit value
--
{-# INLINEABLE memset #-}
memset :: DevicePtr a                   -- ^ The device memory
       -&gt; Int64                         -- ^ Number of bytes
       -&gt; Int8                          -- ^ Value to set for each byte
       -&gt; IO ()
memset !dptr !bytes !symbol = nothingIfOk =&lt;&lt; cudaMemset dptr symbol bytes

{-# INLINE cudaMemset #-}
cudaMemset :: (DevicePtr a) -&gt; (Int8) -&gt; (Int64) -&gt; IO ((Status))
cudaMemset a1 a2 a3 =
  let {a1' = dptr a1} in 
  let {a2' = cIntConv a2} in 
  let {a3' = cIntConv a3} in 
  cudaMemset'_ a1' a2' a3' &gt;&gt;= \res -&gt;
  let {res' = cToEnum res} in
  return (res')

{-# LINE 643 &quot;src/Foreign/CUDA/Runtime/Marshal.chs&quot; #-}

  where
    dptr = useDevicePtr . castDevPtr


foreign import ccall unsafe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaHostAlloc&quot;
  cudaHostAlloc'_ :: ((C2HSImp.Ptr (C2HSImp.Ptr ())) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CUInt -&gt; (IO C2HSImp.CInt))))

foreign import ccall unsafe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaFreeHost&quot;
  cudaFreeHost'_ :: ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))

foreign import ccall unsafe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaMalloc&quot;
  cudaMalloc'_ :: ((C2HSImp.Ptr (C2HSImp.Ptr ())) -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt)))

foreign import ccall unsafe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaFree&quot;
  cudaFree'_ :: ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))

foreign import ccall safe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaMemcpy&quot;
  cudaMemcpy'_ :: ((C2HSImp.Ptr ()) -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CInt -&gt; (IO C2HSImp.CInt)))))

foreign import ccall safe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaMemcpyAsync&quot;
  cudaMemcpyAsync'_ :: ((C2HSImp.Ptr ()) -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CInt -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt))))))

foreign import ccall safe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaMemcpy2D&quot;
  cudaMemcpy2D'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CInt -&gt; (IO C2HSImp.CInt))))))))

foreign import ccall safe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaMemcpy2DAsync&quot;
  cudaMemcpy2DAsync'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CULong -&gt; (C2HSImp.CInt -&gt; ((C2HSImp.Ptr ()) -&gt; (IO C2HSImp.CInt)))))))))

foreign import ccall unsafe &quot;Foreign/CUDA/Runtime/Marshal.chs.h cudaMemset&quot;
  cudaMemset'_ :: ((C2HSImp.Ptr ()) -&gt; (C2HSImp.CInt -&gt; (C2HSImp.CULong -&gt; (IO C2HSImp.CInt))))
</span></pre></body></html>