<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- XXX design uncertainty:  should preResets be inserted into nullView?</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- if not, why not? ADDED</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-comment">-- XXX design uncertainty: what does act -&gt; actNullable -&gt;</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- actNullableTagless not use nullQ and same for inStar, etc?</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- TODO : try rewriting whole qToNFA in terms of &quot;act&quot;</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- (That will require re-organizing the continuation data a bit)</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">-- | &quot;Text.Regex.TDFA.TNFA&quot; converts the CorePattern Q\/P data (and its</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Pattern leafs) to a QNFA tagged non-deterministic finite automata.</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- </span><span>
</span><a name="line-12"></a><span class="hs-comment">-- This holds every possible way to follow one state by another, while</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- in the DFA these will be reduced by picking a single best</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- transition for each (soure,destination) pair.  The transitions are</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- heavily and often redundantly annotated with tasks to perform, and</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- this redundancy is reduced when picking the best transition.  So</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- far, keeping all this information has helped fix bugs in both the</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- design and implementation.</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- The QNFA for a Pattern with a starTraned Q\/P form with N one</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- character accepting leaves has at most N+1 nodes.  These nodes</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- repesent the future choices after accepting a leaf.  The processing</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- of Or nodes often reduces this number by sharing at the end of the</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- different paths.  Turning off capturing while compiling the pattern</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- may (future extension) reduce this further for some patterns by</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- processing Star with optimizations.  This compact design also means</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- that tags are assigned not just to be updated before taking a</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- transition (PreUpdate) but also after the transition (PostUpdate).</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- </span><span>
</span><a name="line-30"></a><span class="hs-comment">-- Uses recursive do notation.</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Regex</span><span class="hs-operator">.</span><span class="hs-identifier">TDFA</span><span class="hs-operator">.</span><span class="hs-identifier">TNFA</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier hs-var">patternToNFA</span></a><span>
</span><a name="line-33"></a><span>                            </span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">{- By Chris Kuklewicz, 2007. BSD License, see the LICENSE file. -}</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-special">(</span><span class="hs-identifier hs-var">when</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">State</span><span class="hs-special">(</span><span class="hs-identifier hs-type">State</span><span class="hs-special">,</span><span class="hs-identifier hs-var">runState</span><span class="hs-special">,</span><span class="hs-identifier hs-var">execState</span><span class="hs-special">,</span><span class="hs-identifier hs-var">get</span><span class="hs-special">,</span><span class="hs-identifier hs-var">put</span><span class="hs-special">,</span><span class="hs-identifier hs-var">modify</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">IArray</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Array</span><span class="hs-special">,</span><span class="hs-identifier hs-var">array</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLower</span><span class="hs-special">,</span><span class="hs-identifier hs-var">toUpper</span><span class="hs-special">,</span><span class="hs-identifier hs-var">isAlpha</span><span class="hs-special">,</span><span class="hs-identifier hs-var">ord</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IMap</span><span class="hs-special">(</span><span class="hs-identifier hs-var">toAscList</span><span class="hs-special">,</span><span class="hs-identifier hs-var">null</span><span class="hs-special">,</span><span class="hs-identifier hs-var">unionWith</span><span class="hs-special">,</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">,</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">,</span><span class="hs-identifier hs-var">fromDistinctAscList</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span class="hs-operator">.</span><span class="hs-identifier">CharMap2</span></a><span class="hs-special">(</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span class="hs-operator">.</span><span class="hs-identifier">CharMap2</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span class="hs-special">(</span><a href="Data.IntMap.CharMap2.html#null"><span class="hs-identifier hs-var">null</span></a><span class="hs-special">,</span><a href="Data.IntMap.CharMap2.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span class="hs-special">,</span><a href="Data.IntMap.CharMap2.html#map"><span class="hs-identifier hs-var">map</span></a><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.IntMap.EnumMap2.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span class="hs-operator">.</span><span class="hs-identifier">EnumMap2</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">EMap</span><span class="hs-special">(</span><a href="Data.IntMap.EnumMap2.html#null"><span class="hs-identifier hs-var">null</span></a><span class="hs-special">,</span><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier hs-var">keysSet</span></a><span class="hs-special">,</span><a href="Data.IntMap.EnumMap2.html#assocs"><span class="hs-identifier hs-var">assocs</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IntSet.EnumSet2.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntSet</span><span class="hs-operator">.</span><span class="hs-identifier">EnumSet2</span></a><span class="hs-special">(</span><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier hs-type">EnumSet</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.IntSet.EnumSet2.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntSet</span><span class="hs-operator">.</span><span class="hs-identifier">EnumSet2</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span class="hs-special">(</span><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span class="hs-special">,</span><a href="Data.IntSet.EnumSet2.html#toList"><span class="hs-identifier hs-var">toList</span></a><span class="hs-special">,</span><a href="Data.IntSet.EnumSet2.html#insert"><span class="hs-identifier hs-var">insert</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">,</span><span class="hs-identifier hs-var">isNothing</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span class="hs-special">,</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">,</span><span class="hs-identifier hs-var">toAscList</span><span class="hs-special">,</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Text.Regex.TDFA.Common.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Regex</span><span class="hs-operator">.</span><span class="hs-identifier">TDFA</span><span class="hs-operator">.</span><span class="hs-identifier">Common</span></a><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-type">TagTask</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>                             </span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span>                             </span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>                             </span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#common_error"><span class="hs-identifier hs-var">common_error</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Regex</span><span class="hs-operator">.</span><span class="hs-identifier">TDFA</span><span class="hs-operator">.</span><span class="hs-identifier">CorePattern</span></a><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#P"><span class="hs-identifier hs-type">P</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a><span>
</span><a name="line-58"></a><span>                                  </span><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#Wanted"><span class="hs-identifier hs-type">Wanted</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a><span>
</span><a name="line-59"></a><span>                                  </span><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-var">mustAccept</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier hs-var">patternToQ</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Text.Regex.TDFA.Pattern.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Regex</span><span class="hs-operator">.</span><span class="hs-identifier">TDFA</span><span class="hs-operator">.</span><span class="hs-identifier">Pattern</span></a><span class="hs-special">(</span><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Pattern.html#PatternSet"><span class="hs-identifier hs-type">PatternSet</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Pattern.html#unSEC"><span class="hs-identifier hs-var">unSEC</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Pattern.html#PatternSetCharacterClass"><span class="hs-identifier hs-type">PatternSetCharacterClass</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-comment">--import Debug.Trace</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-identifier">ecart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080712"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080712"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-64"></a><a name="ecart"><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier">ecart</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-identifier">err</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080711"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-67"></a><a name="err"><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier">err</span></a></a><span> </span><a name="local-6989586621679080713"><a href="#local-6989586621679080713"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.Common.html#common_error"><span class="hs-identifier hs-var">common_error</span></a><span> </span><span class="hs-string">&quot;Text.Regex.TDFA.TNFA&quot;</span><span> </span><a href="#local-6989586621679080713"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-identifier">debug</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679080709"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679080709"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080710"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080710"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-70"></a><a name="debug"><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier">debug</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080714"><a href="#local-6989586621679080714"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080714"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-identifier">qtwin</span><span class="hs-special">,</span><span class="hs-identifier">qtlose</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- qtwin is the continuation after matching the whole pattern.  It has</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- no futher transitions and sets tag #1 to the current position.</span><span>
</span><a name="line-75"></a><a name="qtwin"><a href="Text.Regex.TDFA.TNFA.html#qtwin"><span class="hs-identifier">qtwin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_win</span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier">qt_trans</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span class="hs-identifier">qt_other</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">}</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- qtlose is the continuation to nothing, used when ^ or $ tests fail.</span><span>
</span><a name="line-77"></a><a name="qtlose"><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier">qtlose</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_win</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span class="hs-identifier">qt_trans</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span class="hs-identifier">qt_other</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">}</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-identifier">patternToNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a><span>
</span><a name="line-80"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a><span class="hs-special">,</span><span> </span><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Array</span><span> </span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>                </span><span class="hs-special">,</span><span class="hs-identifier hs-type">Array</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a><span>
</span><a name="line-83"></a><span>                </span><span class="hs-special">,</span><span class="hs-identifier hs-type">Array</span><span> </span><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><a name="patternToNFA"><a href="Text.Regex.TDFA.TNFA.html#patternToNFA"><span class="hs-identifier">patternToNFA</span></a></a><span> </span><a name="local-6989586621679080715"><a href="#local-6989586621679080715"><span class="hs-identifier">compOpt</span></a></a><span> </span><a name="local-6989586621679080716"><a href="#local-6989586621679080716"><span class="hs-identifier">pattern</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080717"><a href="#local-6989586621679080717"><span class="hs-identifier">q</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080718"><a href="#local-6989586621679080718"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080719"><a href="#local-6989586621679080719"><span class="hs-identifier">groups</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#patternToQ"><span class="hs-identifier hs-var">patternToQ</span></a><span> </span><a href="#local-6989586621679080715"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><a href="#local-6989586621679080716"><span class="hs-identifier hs-var">pattern</span></a><span>
</span><a name="line-86"></a><span>      </span><a name="local-6989586621679080720"><a href="#local-6989586621679080720"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-keyword">in</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><a href="#local-6989586621679080720"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#qToNFA"><span class="hs-identifier hs-var">qToNFA</span></a><span> </span><a href="#local-6989586621679080715"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">,</span><a href="#local-6989586621679080718"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">,</span><a href="#local-6989586621679080719"><span class="hs-identifier hs-var">groups</span></a><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == </span><span>
</span><a name="line-90"></a><span class="hs-comment">-- Query function on Q</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-identifier">nullable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-93"></a><a name="nullable"><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier">nullable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">nullQ</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">notNullable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-96"></a><a name="notNullable"><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier">notNullable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">nullQ</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- This asks if the preferred (i.e. first) NullView has no tests.</span><span>
</span><a name="line-99"></a><span class="hs-identifier">maybeOnlyEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span>
</span><a name="line-100"></a><a name="maybeOnlyEmpty"><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier">maybeOnlyEmpty</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">nullQ</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a><span> </span><a name="local-6989586621679080721"><a href="#local-6989586621679080721"><span class="hs-identifier">sti</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080722"><a href="#local-6989586621679080722"><span class="hs-identifier">tags</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.IntMap.EnumMap2.html#null"><span class="hs-identifier hs-var">EMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679080721"><span class="hs-identifier hs-var">sti</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679080722"><span class="hs-identifier hs-var">tags</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-101"></a><span class="hs-identifier">maybeOnlyEmpty</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-identifier">usesQNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-104"></a><a name="usesQNFA"><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier">usesQNFA</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">wants</span><span class="hs-glyph">=</span><a href="Text.Regex.TDFA.CorePattern.html#WantsBoth"><span class="hs-identifier hs-var">WantsBoth</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-105"></a><span class="hs-identifier">usesQNFA</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">wants</span><span class="hs-glyph">=</span><a href="Text.Regex.TDFA.CorePattern.html#WantsQNFA"><span class="hs-identifier hs-var">WantsQNFA</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-106"></a><span class="hs-identifier">usesQNFA</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == </span><span>
</span><a name="line-109"></a><span class="hs-comment">-- Functions related to QT</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- dumb smart constructor used by qToQNFA</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- Possible: Go through the qt and keep only the best tagged transition(s) to each state to make simple NFA?</span><span>
</span><a name="line-113"></a><span class="hs-identifier">mkQNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span>
</span><a name="line-114"></a><a name="mkQNFA"><a href="Text.Regex.TDFA.TNFA.html#mkQNFA"><span class="hs-identifier">mkQNFA</span></a></a><span> </span><a name="local-6989586621679080723"><a href="#local-6989586621679080723"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679080724"><a href="#local-6989586621679080724"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\n&gt;QNFA id=&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-115"></a><span>  </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-var">QNFA</span></a><span> </span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\ngetting QT for &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080724"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">-- This uses the Eq QT instance above</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- ZZZ</span><span>
</span><a name="line-119"></a><span class="hs-identifier">mkTesting</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-120"></a><a name="mkTesting"><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier">mkTesting</span></a></a><span> </span><a name="local-6989586621679080725"><a href="#local-6989586621679080725"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_a</span><span class="hs-glyph">=</span><a name="local-6989586621679080726"><a href="#local-6989586621679080726"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span class="hs-glyph">=</span><a name="local-6989586621679080727"><a href="#local-6989586621679080727"><span class="hs-identifier">b</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679080726"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621679080727"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679080726"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679080725"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-comment">-- Move to nfsToDFA XXX</span><span>
</span><a name="line-121"></a><span class="hs-identifier">mkTesting</span><span> </span><a name="local-6989586621679080728"><a href="#local-6989586621679080728"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080728"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-identifier">nullQT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-124"></a><a name="nullQT"><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier">nullQT</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_win</span><span class="hs-glyph">=</span><a name="local-6989586621679080729"><a href="#local-6989586621679080729"><span class="hs-identifier">w</span></a></a><span class="hs-special">,</span><span class="hs-identifier">qt_trans</span><span class="hs-glyph">=</span><a name="local-6989586621679080730"><a href="#local-6989586621679080730"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span class="hs-identifier">qt_other</span><span class="hs-glyph">=</span><a name="local-6989586621679080731"><a href="#local-6989586621679080731"><span class="hs-identifier">o</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a><span> </span><a href="#local-6989586621679080729"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Data.IntMap.CharMap2.html#null"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679080730"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679080731"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-125"></a><span class="hs-identifier">nullQT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- This reconstructs the set of tests checked in processing QT, adding</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- them to the passed set.</span><span>
</span><a name="line-129"></a><span class="hs-identifier">listTestInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier hs-type">EnumSet</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IntSet.EnumSet2.html#EnumSet"><span class="hs-identifier hs-type">EnumSet</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a><span>
</span><a name="line-130"></a><a name="listTestInfo"><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier">listTestInfo</span></a></a><span> </span><a name="local-6989586621679080732"><a href="#local-6989586621679080732"><span class="hs-identifier">qt</span></a></a><span> </span><a name="local-6989586621679080733"><a href="#local-6989586621679080733"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">execState</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080734"><span class="hs-identifier hs-var">helper</span></a><span> </span><a href="#local-6989586621679080732"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080733"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-131"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679080734"><a href="#local-6989586621679080734"><span class="hs-identifier">helper</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>        </span><span class="hs-identifier">helper</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679080735"><a href="#local-6989586621679080735"><span class="hs-identifier">wt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679080736"><a href="#local-6989586621679080736"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679080737"><a href="#local-6989586621679080737"><span class="hs-identifier">b</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-133"></a><span>          </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><a href="Data.IntSet.EnumSet2.html#insert"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679080735"><span class="hs-identifier hs-var">wt</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>          </span><a href="#local-6989586621679080734"><span class="hs-identifier hs-var">helper</span></a><span> </span><a href="#local-6989586621679080736"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-135"></a><span>          </span><a href="#local-6989586621679080734"><span class="hs-identifier hs-var">helper</span></a><span> </span><a href="#local-6989586621679080737"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- This is used to view &quot;win&quot; only through NullView, and is used in</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- processing Or.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">applyNullViews</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-140"></a><a name="applyNullViews"><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier">applyNullViews</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080738"><a href="#local-6989586621679080738"><span class="hs-identifier">win</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080738"><span class="hs-identifier hs-var">win</span></a><span>
</span><a name="line-141"></a><span class="hs-identifier">applyNullViews</span><span> </span><a name="local-6989586621679080739"><a href="#local-6989586621679080739"><span class="hs-identifier">nvs</span></a></a><span> </span><a name="local-6989586621679080740"><a href="#local-6989586621679080740"><span class="hs-identifier">win</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier hs-var">dominate</span></a><span> </span><a href="#local-6989586621679080740"><span class="hs-identifier hs-var">win</span></a><span class="hs-special">)</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a><span> </span><a href="#local-6989586621679080739"><span class="hs-identifier hs-var">nvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-comment">-- This is used to prefer to view &quot;win&quot; through NullView.  Losing is</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- replaced by the plain win.  This is employed by Star patterns to</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- express that the first iteration is allowed to match null, but</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- skipping the NullView occurs if the match fails.</span><span>
</span><a name="line-147"></a><span class="hs-identifier">preferNullViews</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#NullView"><span class="hs-identifier hs-type">NullView</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-148"></a><a name="preferNullViews"><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier">preferNullViews</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080741"><a href="#local-6989586621679080741"><span class="hs-identifier">win</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080741"><span class="hs-identifier hs-var">win</span></a><span>
</span><a name="line-149"></a><span class="hs-identifier">preferNullViews</span><span> </span><a name="local-6989586621679080742"><a href="#local-6989586621679080742"><span class="hs-identifier">nvs</span></a></a><span> </span><a name="local-6989586621679080743"><a href="#local-6989586621679080743"><span class="hs-identifier">win</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier hs-var">dominate</span></a><span> </span><a href="#local-6989586621679080743"><span class="hs-identifier hs-var">win</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080743"><span class="hs-identifier hs-var">win</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#cleanNullView"><span class="hs-identifier hs-var">cleanNullView</span></a><span> </span><a href="#local-6989586621679080742"><span class="hs-identifier hs-var">nvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">{- 
dominate is common to applyNullViews and preferNullViews above.

Even I no longer understand it without study.

Oversimplified: The last argument has a new set of tests &quot;sti&quot; that
must be satisfied to then apply the new &quot;tags&quot; and reach the &quot;win&quot; QT.
Failing any of this set of tests leads to the &quot;lose&quot; QT.

Closer: The &quot;win&quot; may already have some other set of tests leading to
various branches, this set is cached in winTests.  And the &quot;lose&quot; may
already have some other set of tests leading to various branches.  The
combination of &quot;win&quot; and &quot;lose&quot; and &quot;sti&quot; must check the union of
these tests, which is &quot;allTests&quot;.

Detail: The merging is done by useTest, where the tests in sti divert
losing to a branch of &quot;lose&quot; and winning to a branch of &quot;win&quot;.  Tests
not in sti are unchanged (but the losing DoPa index might be added).
-}</span><span>
</span><a name="line-170"></a><span class="hs-identifier">dominate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-type">SetTestInfo</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-171"></a><a name="dominate"><a href="Text.Regex.TDFA.TNFA.html#dominate"><span class="hs-identifier">dominate</span></a></a><span> </span><a name="local-6989586621679080744"><a href="#local-6989586621679080744"><span class="hs-identifier">win</span></a></a><span> </span><a name="local-6989586621679080745"><a href="#local-6989586621679080745"><span class="hs-identifier">lose</span></a></a><span> </span><a name="local-6989586621679080746"><a href="#local-6989586621679080746"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#SetTestInfo"><span class="hs-identifier hs-var">SetTestInfo</span></a><span> </span><a name="local-6989586621679080747"><a href="#local-6989586621679080747"><span class="hs-identifier">sti</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080748"><a href="#local-6989586621679080748"><span class="hs-identifier">tags</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;dominate &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080746"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-172"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- The winning states are reached through the SetTag</span><span>
</span><a name="line-173"></a><span>      </span><a name="local-6989586621679080749"><a href="#local-6989586621679080749"><span class="hs-identifier">win'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><a href="#local-6989586621679080748"><span class="hs-identifier hs-var">tags</span></a><span> </span><a href="#local-6989586621679080744"><span class="hs-identifier hs-var">win</span></a><span>
</span><a name="line-174"></a><span>      </span><span class="hs-comment">-- get the SetTestInfo </span><span>
</span><a name="line-175"></a><span>      </span><a name="local-6989586621679080750"><a href="#local-6989586621679080750"><span class="hs-identifier">winTests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier hs-var">listTestInfo</span></a><span> </span><a href="#local-6989586621679080744"><span class="hs-identifier hs-var">win</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-176"></a><span>      </span><a name="local-6989586621679080751"><a href="#local-6989586621679080751"><span class="hs-identifier">allTests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#listTestInfo"><span class="hs-identifier hs-var">listTestInfo</span></a><span> </span><a href="#local-6989586621679080745"><span class="hs-identifier hs-var">lose</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080750"><span class="hs-identifier hs-var">winTests</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Data.IntMap.EnumMap2.html#keysSet"><span class="hs-identifier hs-var">EMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keysSet</span></a><span> </span><a href="#local-6989586621679080747"><span class="hs-identifier hs-var">sti</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span>      </span><span class="hs-comment">-- The first and second arguments of useTest are sorted</span><span>
</span><a name="line-178"></a><span>      </span><span class="hs-comment">-- At all times the second argument of useTest is a subset of the first</span><span>
</span><a name="line-179"></a><span>      </span><a name="local-6989586621679080752"><a href="#local-6989586621679080752"><span class="hs-identifier">useTest</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080753"><a href="#local-6989586621679080753"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080753"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-comment">-- no more dominating tests to fail to choose lose, so just choose win</span><span>
</span><a name="line-180"></a><span>      </span><span class="hs-identifier">useTest</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080754"><a href="#local-6989586621679080754"><span class="hs-identifier">aTest</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679080755"><a href="#local-6989586621679080755"><span class="hs-identifier">tests</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080756"><a href="#local-6989586621679080756"><span class="hs-identifier">allD</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679080757"><a href="#local-6989586621679080757"><span class="hs-identifier">dTest</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080758"><a href="#local-6989586621679080758"><span class="hs-identifier">dopas</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679080759"><a href="#local-6989586621679080759"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080760"><a href="#local-6989586621679080760"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679080761"><a href="#local-6989586621679080761"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-181"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080762"><a href="#local-6989586621679080762"><span class="hs-identifier">wA</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080763"><a href="#local-6989586621679080763"><span class="hs-identifier">wB</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080764"><a href="#local-6989586621679080764"><span class="hs-identifier">wD</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080768"><span class="hs-identifier hs-var">branches</span></a><span> </span><a href="#local-6989586621679080760"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-182"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679080765"><a href="#local-6989586621679080765"><span class="hs-identifier">lA</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080766"><a href="#local-6989586621679080766"><span class="hs-identifier">lB</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080767"><a href="#local-6989586621679080767"><span class="hs-identifier">lD</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080768"><span class="hs-identifier hs-var">branches</span></a><span> </span><a href="#local-6989586621679080761"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-183"></a><span>            </span><a name="local-6989586621679080768"><a href="#local-6989586621679080768"><span class="hs-identifier">branches</span></a></a><span> </span><a name="local-6989586621679080769"><a href="#local-6989586621679080769"><span class="hs-identifier">qt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679080754"><span class="hs-identifier hs-var">aTest</span></a><span class="hs-operator hs-var">==</span><span class="hs-identifier">qt_test</span><span> </span><a href="#local-6989586621679080769"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">qt_a</span><span> </span><a href="#local-6989586621679080769"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><a href="#local-6989586621679080769"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">,</span><span class="hs-identifier">qt_dopas</span><span> </span><a href="#local-6989586621679080769"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>            </span><span class="hs-identifier">branches</span><span> </span><a name="local-6989586621679080770"><a href="#local-6989586621679080770"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">,</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679080754"><span class="hs-identifier hs-var">aTest</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679080757"><span class="hs-identifier hs-var">dTest</span></a><span>
</span><a name="line-186"></a><span>             </span><span class="hs-keyword">then</span><span> </span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080754"><span class="hs-identifier hs-var">aTest</span></a><span>
</span><a name="line-187"></a><span>                          </span><span class="hs-special">,</span><span class="hs-identifier">qt_dopas</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080758"><span class="hs-identifier hs-var">dopas</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080764"><span class="hs-identifier hs-var">wD</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080767"><span class="hs-identifier hs-var">lD</span></a><span>
</span><a name="line-188"></a><span>                          </span><span class="hs-special">,</span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">useTest</span></a><span> </span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">tests</span></a><span> </span><a href="#local-6989586621679080759"><span class="hs-identifier hs-var">ds</span></a><span> </span><a href="#local-6989586621679080762"><span class="hs-identifier hs-var">wA</span></a><span> </span><a href="#local-6989586621679080765"><span class="hs-identifier hs-var">lA</span></a><span>
</span><a name="line-189"></a><span>                          </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080766"><span class="hs-identifier hs-var">lB</span></a><span class="hs-special">}</span><span>
</span><a name="line-190"></a><span>             </span><span class="hs-keyword">else</span><span> </span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080754"><span class="hs-identifier hs-var">aTest</span></a><span>
</span><a name="line-191"></a><span>                          </span><span class="hs-special">,</span><span class="hs-identifier">qt_dopas</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080764"><span class="hs-identifier hs-var">wD</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080767"><span class="hs-identifier hs-var">lD</span></a><span>
</span><a name="line-192"></a><span>                          </span><span class="hs-special">,</span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">useTest</span></a><span> </span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">tests</span></a><span> </span><a href="#local-6989586621679080756"><span class="hs-identifier hs-var">allD</span></a><span> </span><a href="#local-6989586621679080762"><span class="hs-identifier hs-var">wA</span></a><span> </span><a href="#local-6989586621679080765"><span class="hs-identifier hs-var">lA</span></a><span>
</span><a name="line-193"></a><span>                          </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">useTest</span></a><span> </span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">tests</span></a><span> </span><a href="#local-6989586621679080756"><span class="hs-identifier hs-var">allD</span></a><span> </span><a href="#local-6989586621679080763"><span class="hs-identifier hs-var">wB</span></a><span> </span><a href="#local-6989586621679080766"><span class="hs-identifier hs-var">lB</span></a><span class="hs-special">}</span><span>
</span><a name="line-194"></a><span>      </span><span class="hs-identifier">useTest</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;This case in dominate.useText cannot happen: second argument would have to have been null and that is checked before this case&quot;</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">useTest</span></a><span> </span><span class="hs-special">(</span><a href="Data.IntSet.EnumSet2.html#toList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-6989586621679080751"><span class="hs-identifier hs-var">allTests</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.IntMap.EnumMap2.html#assocs"><span class="hs-identifier hs-var">EMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">assocs</span></a><span> </span><a href="#local-6989586621679080747"><span class="hs-identifier hs-var">sti</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080749"><span class="hs-identifier hs-var">win'</span></a><span> </span><a href="#local-6989586621679080745"><span class="hs-identifier hs-var">lose</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- 'applyTest' is only used by addTest</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- 2009: maybe need to keep track of whether a change is actually made</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- (beyond DoPa tracking) to the QT.</span><span>
</span><a name="line-200"></a><span class="hs-identifier">applyTest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-201"></a><a name="applyTest"><a href="Text.Regex.TDFA.TNFA.html#applyTest"><span class="hs-identifier">applyTest</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080771"><a href="#local-6989586621679080771"><span class="hs-identifier">wt</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080772"><a href="#local-6989586621679080772"><span class="hs-identifier">dopa</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080773"><a href="#local-6989586621679080773"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a><span> </span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">qt</span></a><span>
</span><a name="line-202"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">applyTest'</span></a><span> </span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-identifier">applyTest'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-204"></a><span>  </span><a name="local-6989586621679080774"><a href="#local-6989586621679080774"><span class="hs-identifier">applyTest'</span></a></a><span> </span><a name="local-6989586621679080775"><a href="#local-6989586621679080775"><span class="hs-identifier">q</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-205"></a><span>    </span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080771"><span class="hs-identifier hs-var">wt</span></a><span>
</span><a name="line-206"></a><span>                        </span><span class="hs-special">,</span><span class="hs-identifier">qt_dopas</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span></a><span> </span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">dopa</span></a><span>
</span><a name="line-207"></a><span>                        </span><span class="hs-special">,</span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080775"><span class="hs-identifier hs-var">q</span></a><span> </span><span>
</span><a name="line-208"></a><span>                        </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a><span class="hs-special">}</span><span>
</span><a name="line-209"></a><span>  </span><span class="hs-identifier">applyTest'</span><span> </span><a name="local-6989586621679080776"><a href="#local-6989586621679080776"><span class="hs-identifier">q</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span class="hs-glyph">=</span><a name="local-6989586621679080777"><a href="#local-6989586621679080777"><span class="hs-identifier">wt'</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679080771"><span class="hs-identifier hs-var">wt</span></a><span> </span><a href="#local-6989586621679080777"><span class="hs-identifier hs-var">wt'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-211"></a><span>      </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080771"><span class="hs-identifier hs-var">wt</span></a><span>
</span><a name="line-212"></a><span>                    </span><span class="hs-special">,</span><span class="hs-identifier">qt_dopas</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntSet.EnumSet2.html#singleton"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span></a><span> </span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">dopa</span></a><span>
</span><a name="line-213"></a><span>                    </span><span class="hs-special">,</span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-214"></a><span>                    </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a><span class="hs-special">}</span><span>
</span><a name="line-215"></a><span>      </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_dopas</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntSet.EnumSet2.html#insert"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">dopa</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">qt_dopas</span><span> </span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>              </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#qtlose"><span class="hs-identifier hs-var">qtlose</span></a><span class="hs-special">}</span><span>
</span><a name="line-217"></a><span>      </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">applyTest'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">qt_a</span><span> </span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>              </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">applyTest'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">qt_b</span><span> </span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-comment">-- Three ways to merge a pair of QT's varying how winning transitions</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- are handled.</span><span>
</span><a name="line-222"></a><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- mergeQT_2nd is used by the NonEmpty case and always discards the</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- first argument's win and uses the second argment's win.</span><span>
</span><a name="line-225"></a><span class="hs-comment">--</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- mergeAltQT is used by the Or cases and is biased to the first</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- argument's winning transition, if present.</span><span>
</span><a name="line-228"></a><span class="hs-comment">--</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- mergeQT is used by Star and mergeE and combines the winning</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- transitions (concatenating the instructions).</span><span>
</span><a name="line-231"></a><span class="hs-identifier">mergeQT_2nd</span><span class="hs-special">,</span><span class="hs-identifier">mergeAltQT</span><span class="hs-special">,</span><span class="hs-identifier">mergeQT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-232"></a><a name="mergeQT_2nd"><a href="Text.Regex.TDFA.TNFA.html#mergeQT_2nd"><span class="hs-identifier">mergeQT_2nd</span></a></a><span> </span><a name="local-6989586621679080778"><a href="#local-6989586621679080778"><span class="hs-identifier">q1</span></a></a><span> </span><a name="local-6989586621679080779"><a href="#local-6989586621679080779"><span class="hs-identifier">q2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a><span> </span><a href="#local-6989586621679080778"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080779"><span class="hs-identifier hs-var">q2</span></a><span>
</span><a name="line-233"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var">mergeQTWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080780"><a href="#local-6989586621679080780"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080780"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080778"><span class="hs-identifier hs-var">q1</span></a><span> </span><a href="#local-6989586621679080779"><span class="hs-identifier hs-var">q2</span></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><a name="mergeAltQT"><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier">mergeAltQT</span></a></a><span> </span><a name="local-6989586621679080781"><a href="#local-6989586621679080781"><span class="hs-identifier">q1</span></a></a><span> </span><a name="local-6989586621679080782"><a href="#local-6989586621679080782"><span class="hs-identifier">q2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a><span> </span><a href="#local-6989586621679080781"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080782"><span class="hs-identifier hs-var">q2</span></a><span>  </span><span class="hs-comment">-- prefer winning with w1 then with w2</span><span>
</span><a name="line-236"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var">mergeQTWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679080783"><a href="#local-6989586621679080783"><span class="hs-identifier">w1</span></a></a><span> </span><a name="local-6989586621679080784"><a href="#local-6989586621679080784"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a><span> </span><a href="#local-6989586621679080783"><span class="hs-identifier hs-var">w1</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679080784"><span class="hs-identifier hs-var">w2</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679080783"><span class="hs-identifier hs-var">w1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080781"><span class="hs-identifier hs-var">q1</span></a><span> </span><a href="#local-6989586621679080782"><span class="hs-identifier hs-var">q2</span></a><span>
</span><a name="line-237"></a><a name="mergeQT"><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier">mergeQT</span></a></a><span> </span><a name="local-6989586621679080785"><a href="#local-6989586621679080785"><span class="hs-identifier">q1</span></a></a><span> </span><a name="local-6989586621679080786"><a href="#local-6989586621679080786"><span class="hs-identifier">q2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a><span> </span><a href="#local-6989586621679080785"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080786"><span class="hs-identifier hs-var">q2</span></a><span>  </span><span class="hs-comment">-- union wins</span><span>
</span><a name="line-238"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullQT"><span class="hs-identifier hs-var">nullQT</span></a><span> </span><a href="#local-6989586621679080786"><span class="hs-identifier hs-var">q2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080785"><span class="hs-identifier hs-var">q1</span></a><span>  </span><span class="hs-comment">-- union wins</span><span>
</span><a name="line-239"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier hs-var">mergeQTWith</span></a><span> </span><span class="hs-identifier hs-var">mappend</span><span> </span><a href="#local-6989586621679080785"><span class="hs-identifier hs-var">q1</span></a><span> </span><a href="#local-6989586621679080786"><span class="hs-identifier hs-var">q2</span></a><span> </span><span class="hs-comment">-- no preference, win with combined SetTag XXX is the wrong thing! &quot;(.?)*&quot;</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- This takes a function which implements a policy on mergining</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- winning transitions and then merges all the transitions.  It opens</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- the CharMap newtype for more efficient operation, then rewraps it.</span><span>
</span><a name="line-244"></a><span class="hs-identifier">mergeQTWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-245"></a><a name="mergeQTWith"><a href="Text.Regex.TDFA.TNFA.html#mergeQTWith"><span class="hs-identifier">mergeQTWith</span></a></a><span> </span><a name="local-6989586621679080787"><a href="#local-6989586621679080787"><span class="hs-identifier">mergeWins</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-246"></a><span>  </span><span class="hs-identifier">merge</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-247"></a><span>  </span><a name="local-6989586621679080788"><a href="#local-6989586621679080788"><span class="hs-identifier">merge</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><a name="local-6989586621679080791"><a href="#local-6989586621679080791"><span class="hs-identifier">w1</span></a></a><span> </span><a name="local-6989586621679080792"><a href="#local-6989586621679080792"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679080793"><a href="#local-6989586621679080793"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><a name="local-6989586621679080794"><a href="#local-6989586621679080794"><span class="hs-identifier">w2</span></a></a><span> </span><a name="local-6989586621679080795"><a href="#local-6989586621679080795"><span class="hs-identifier">t2</span></a></a><span> </span><a name="local-6989586621679080796"><a href="#local-6989586621679080796"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080797"><a href="#local-6989586621679080797"><span class="hs-identifier">w'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080787"><span class="hs-identifier hs-var">mergeWins</span></a><span> </span><a href="#local-6989586621679080791"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679080794"><span class="hs-identifier hs-var">w2</span></a><span>
</span><a name="line-249"></a><span>        </span><a name="local-6989586621679080798"><a href="#local-6989586621679080798"><span class="hs-identifier">t'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080789"><span class="hs-identifier hs-var">fuseQTrans</span></a><span> </span><a href="#local-6989586621679080792"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679080793"><span class="hs-identifier hs-var">o1</span></a><span> </span><a href="#local-6989586621679080795"><span class="hs-identifier hs-var">t2</span></a><span> </span><a href="#local-6989586621679080796"><span class="hs-identifier hs-var">o2</span></a><span>
</span><a name="line-250"></a><span>        </span><a name="local-6989586621679080799"><a href="#local-6989586621679080799"><span class="hs-identifier">o'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080790"><span class="hs-identifier hs-var">mergeQTrans</span></a><span> </span><a href="#local-6989586621679080793"><span class="hs-identifier hs-var">o1</span></a><span> </span><a href="#local-6989586621679080796"><span class="hs-identifier hs-var">o2</span></a><span>
</span><a name="line-251"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><a href="#local-6989586621679080797"><span class="hs-identifier hs-var">w'</span></a><span> </span><a href="#local-6989586621679080798"><span class="hs-identifier hs-var">t'</span></a><span> </span><a href="#local-6989586621679080799"><span class="hs-identifier hs-var">o'</span></a><span>
</span><a name="line-252"></a><span>  </span><span class="hs-identifier">merge</span><span> </span><a name="local-6989586621679080800"><a href="#local-6989586621679080800"><span class="hs-identifier">t1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080801"><a href="#local-6989586621679080801"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-6989586621679080802"><a href="#local-6989586621679080802"><span class="hs-identifier">b1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080803"><a href="#local-6989586621679080803"><span class="hs-identifier">s2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-253"></a><span>    </span><a href="#local-6989586621679080800"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_a</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080801"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621679080803"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_b</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080802"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679080803"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-identifier">merge</span><span> </span><a name="local-6989586621679080804"><a href="#local-6989586621679080804"><span class="hs-identifier">s1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679080805"><a href="#local-6989586621679080805"><span class="hs-identifier">t2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080806"><a href="#local-6989586621679080806"><span class="hs-identifier">a2</span></a></a><span> </span><a name="local-6989586621679080807"><a href="#local-6989586621679080807"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-255"></a><span>    </span><a href="#local-6989586621679080805"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_a</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080804"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679080806"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_b</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080804"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679080807"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-256"></a><span>  </span><span class="hs-identifier">merge</span><span> </span><a name="local-6989586621679080808"><a href="#local-6989586621679080808"><span class="hs-identifier">t1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><a name="local-6989586621679080809"><a href="#local-6989586621679080809"><span class="hs-identifier">wt1</span></a></a><span> </span><a name="local-6989586621679080810"><a href="#local-6989586621679080810"><span class="hs-identifier">ds1</span></a></a><span> </span><a name="local-6989586621679080811"><a href="#local-6989586621679080811"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-6989586621679080812"><a href="#local-6989586621679080812"><span class="hs-identifier">b1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080813"><a href="#local-6989586621679080813"><span class="hs-identifier">t2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><a name="local-6989586621679080814"><a href="#local-6989586621679080814"><span class="hs-identifier">wt2</span></a></a><span> </span><a name="local-6989586621679080815"><a href="#local-6989586621679080815"><span class="hs-identifier">ds2</span></a></a><span> </span><a name="local-6989586621679080816"><a href="#local-6989586621679080816"><span class="hs-identifier">a2</span></a></a><span> </span><a name="local-6989586621679080817"><a href="#local-6989586621679080817"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mkTesting"><span class="hs-identifier hs-var">mkTesting</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679080809"><span class="hs-identifier hs-var">wt1</span></a><span> </span><a href="#local-6989586621679080814"><span class="hs-identifier hs-var">wt2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-258"></a><span>      </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080808"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_a</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080811"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621679080813"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_b</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080812"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679080813"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-259"></a><span>      </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_test</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080809"><span class="hs-identifier hs-var">wt1</span></a><span> </span><span class="hs-comment">-- same as wt2</span><span>
</span><a name="line-260"></a><span>                    </span><span class="hs-special">,</span><span class="hs-identifier">qt_dopas</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mappend</span><span> </span><a href="#local-6989586621679080810"><span class="hs-identifier hs-var">ds1</span></a><span> </span><a href="#local-6989586621679080815"><span class="hs-identifier hs-var">ds2</span></a><span>
</span><a name="line-261"></a><span>                    </span><span class="hs-special">,</span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080811"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-262"></a><span>                    </span><span class="hs-special">,</span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080812"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679080817"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">}</span><span>
</span><a name="line-263"></a><span>      </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080813"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_a</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080808"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_b</span><span class="hs-glyph">=</span><span class="hs-special">(</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">merge</span></a><span> </span><a href="#local-6989586621679080808"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679080817"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span>  </span><span class="hs-identifier">fuseQTrans</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span>
</span><a name="line-266"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span>
</span><a name="line-267"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span>
</span><a name="line-268"></a><span>  </span><a name="local-6989586621679080789"><a href="#local-6989586621679080789"><span class="hs-identifier">fuseQTrans</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a><span> </span><a name="local-6989586621679080818"><a href="#local-6989586621679080818"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080819"><a href="#local-6989586621679080819"><span class="hs-identifier">o1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a><span> </span><a name="local-6989586621679080820"><a href="#local-6989586621679080820"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080821"><a href="#local-6989586621679080821"><span class="hs-identifier">o2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromDistinctAscList</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080824"><span class="hs-identifier hs-var">fuse</span></a><span> </span><a href="#local-6989586621679080822"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621679080823"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-269"></a><span>    </span><a name="local-6989586621679080822"><a href="#local-6989586621679080822"><span class="hs-identifier">l1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toAscList</span><span> </span><a href="#local-6989586621679080818"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-270"></a><span>    </span><a name="local-6989586621679080823"><a href="#local-6989586621679080823"><span class="hs-identifier">l2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toAscList</span><span> </span><a href="#local-6989586621679080820"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-271"></a><span>    </span><a name="local-6989586621679080824"><a href="#local-6989586621679080824"><span class="hs-identifier">fuse</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080825"><a href="#local-6989586621679080825"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080790"><span class="hs-identifier hs-var">mergeQTrans</span></a><span> </span><a href="#local-6989586621679080819"><span class="hs-identifier hs-var">o1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080825"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-272"></a><span>    </span><span class="hs-identifier">fuse</span><span> </span><a name="local-6989586621679080826"><a href="#local-6989586621679080826"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.Common.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080790"><span class="hs-identifier hs-var">mergeQTrans</span></a><span> </span><a href="#local-6989586621679080821"><span class="hs-identifier hs-var">o2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080826"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-identifier">fuse</span><span> </span><a name="local-6989586621679080827"><a href="#local-6989586621679080827"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679080828"><a href="#local-6989586621679080828"><span class="hs-identifier">xc</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080829"><a href="#local-6989586621679080829"><span class="hs-identifier">xa</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679080830"><a href="#local-6989586621679080830"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080831"><a href="#local-6989586621679080831"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679080832"><a href="#local-6989586621679080832"><span class="hs-identifier">yc</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080833"><a href="#local-6989586621679080833"><span class="hs-identifier">ya</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679080834"><a href="#local-6989586621679080834"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-274"></a><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679080828"><span class="hs-identifier hs-var">xc</span></a><span> </span><a href="#local-6989586621679080832"><span class="hs-identifier hs-var">yc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-275"></a><span>        </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080828"><span class="hs-identifier hs-var">xc</span></a><span class="hs-special">,</span><a href="#local-6989586621679080790"><span class="hs-identifier hs-var">mergeQTrans</span></a><span> </span><a href="#local-6989586621679080829"><span class="hs-identifier hs-var">xa</span></a><span> </span><a href="#local-6989586621679080821"><span class="hs-identifier hs-var">o2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679080824"><span class="hs-identifier hs-var">fuse</span></a><span> </span><a href="#local-6989586621679080830"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679080831"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-276"></a><span>        </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080828"><span class="hs-identifier hs-var">xc</span></a><span class="hs-special">,</span><a href="#local-6989586621679080790"><span class="hs-identifier hs-var">mergeQTrans</span></a><span> </span><a href="#local-6989586621679080829"><span class="hs-identifier hs-var">xa</span></a><span> </span><a href="#local-6989586621679080833"><span class="hs-identifier hs-var">ya</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679080824"><span class="hs-identifier hs-var">fuse</span></a><span> </span><a href="#local-6989586621679080830"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679080834"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-277"></a><span>        </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080832"><span class="hs-identifier hs-var">yc</span></a><span class="hs-special">,</span><a href="#local-6989586621679080790"><span class="hs-identifier hs-var">mergeQTrans</span></a><span> </span><a href="#local-6989586621679080819"><span class="hs-identifier hs-var">o1</span></a><span> </span><a href="#local-6989586621679080833"><span class="hs-identifier hs-var">ya</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679080824"><span class="hs-identifier hs-var">fuse</span></a><span> </span><a href="#local-6989586621679080827"><span class="hs-identifier hs-var">x</span></a><span>  </span><a href="#local-6989586621679080834"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span>  </span><span class="hs-identifier">mergeQTrans</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QTrans"><span class="hs-identifier hs-type">QTrans</span></a><span>
</span><a name="line-280"></a><span>  </span><a name="local-6989586621679080790"><a href="#local-6989586621679080790"><span class="hs-identifier">mergeQTrans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unionWith</span><span> </span><span class="hs-identifier hs-var">mappend</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- Note: There are no append* operations. There are only these</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- prepend* operations because things are only prepended to the future</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- continuation.  And the ordering is significant.</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- This is only used in inStar/nullable</span><span>
</span><a name="line-287"></a><span class="hs-identifier">prependPreTag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-288"></a><a name="prependPreTag"><a href="Text.Regex.TDFA.TNFA.html#prependPreTag"><span class="hs-identifier">prependPreTag</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679080835"><a href="#local-6989586621679080835"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080835"><span class="hs-identifier hs-var">qt</span></a><span>
</span><a name="line-289"></a><span class="hs-identifier">prependPreTag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080836"><a href="#local-6989586621679080836"><span class="hs-identifier">tag</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080837"><a href="#local-6989586621679080837"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679080836"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679080837"><span class="hs-identifier hs-var">qt</span></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-identifier">prependGroupResets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-292"></a><a name="prependGroupResets"><a href="Text.Regex.TDFA.TNFA.html#prependGroupResets"><span class="hs-identifier">prependGroupResets</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080838"><a href="#local-6989586621679080838"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080838"><span class="hs-identifier hs-var">qt</span></a><span>
</span><a name="line-293"></a><span class="hs-identifier">prependGroupResets</span><span> </span><a name="local-6989586621679080839"><a href="#local-6989586621679080839"><span class="hs-identifier">tags</span></a></a><span> </span><a name="local-6989586621679080840"><a href="#local-6989586621679080840"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679080841"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a><span class="hs-special">)</span><span class="hs-glyph">|</span><a name="local-6989586621679080841"><a href="#local-6989586621679080841"><span class="hs-identifier">tag</span></a></a><span class="hs-glyph">&lt;-</span><a href="#local-6989586621679080839"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679080840"><span class="hs-identifier hs-var">qt</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-identifier">prependTags'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-296"></a><a name="prependTags%27"><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier">prependTags'</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><a name="local-6989586621679080842"><a href="#local-6989586621679080842"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080842"><span class="hs-identifier hs-var">qt</span></a><span>
</span><a name="line-297"></a><span class="hs-identifier">prependTags'</span><span> </span><a name="local-6989586621679080843"><a href="#local-6989586621679080843"><span class="hs-identifier">tcs'</span></a></a><span> </span><a name="local-6989586621679080844"><a href="#local-6989586621679080844"><span class="hs-identifier">qt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Testing"><span class="hs-identifier hs-var">Testing</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080844"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_a</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><a href="#local-6989586621679080843"><span class="hs-identifier hs-var">tcs'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">qt_a</span><span> </span><a href="#local-6989586621679080844"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_b</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><a href="#local-6989586621679080843"><span class="hs-identifier hs-var">tcs'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">qt_b</span><span> </span><a href="#local-6989586621679080844"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-299"></a><span class="hs-identifier">prependTags'</span><span> </span><a name="local-6989586621679080845"><a href="#local-6989586621679080845"><span class="hs-identifier">tcs'</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">qt_win</span><span class="hs-glyph">=</span><a name="local-6989586621679080846"><a href="#local-6989586621679080846"><span class="hs-identifier">w</span></a></a><span class="hs-special">,</span><span class="hs-identifier">qt_trans</span><span class="hs-glyph">=</span><a name="local-6989586621679080847"><a href="#local-6989586621679080847"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span class="hs-identifier">qt_other</span><span class="hs-glyph">=</span><a name="local-6989586621679080848"><a href="#local-6989586621679080848"><span class="hs-identifier">o</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-300"></a><span>  </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_win</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.Common.html#noWin"><span class="hs-identifier hs-var">noWin</span></a><span> </span><a href="#local-6989586621679080846"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679080846"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679080845"><span class="hs-identifier hs-var">tcs'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080846"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-301"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_trans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntMap.CharMap2.html#map"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679080849"><span class="hs-identifier hs-var">prependQTrans</span></a><span> </span><a href="#local-6989586621679080847"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-302"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_other</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080849"><span class="hs-identifier hs-var">prependQTrans</span></a><span> </span><a href="#local-6989586621679080848"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-303"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679080849"><a href="#local-6989586621679080849"><span class="hs-identifier">prependQTrans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679080850"><a href="#local-6989586621679080850"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080851"><a href="#local-6989586621679080851"><span class="hs-identifier">tcs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080850"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><a href="#local-6989586621679080845"><span class="hs-identifier hs-var">tcs'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080851"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == </span><span>
</span><a name="line-306"></a><span class="hs-comment">-- define type S which is a State monad, this allows the creation of the uniq QNFA ids and storing the QNFA</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- in an ascending order difference list for later placement in an array.</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- Type of State monad used inside qToNFA</span><span>
</span><a name="line-310"></a><span class="hs-keyword">type</span><span> </span><a name="S"><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier">S</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">State</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span>                             </span><span class="hs-comment">-- Next available QNFA index</span><span>
</span><a name="line-311"></a><span>               </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- DList of previous QNFAs</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-comment">-- Type of continuation of the NFA, not much more complicated</span><span>
</span><a name="line-314"></a><span class="hs-keyword">type</span><span> </span><a name="E"><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier">E</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span>            </span><span class="hs-comment">-- Things to do before the Either QNFA QT</span><span>
</span><a name="line-315"></a><span>                              </span><span class="hs-comment">-- with OneChar these become PostUpdate otherwise they become PreUpdate</span><span>
</span><a name="line-316"></a><span>         </span><span class="hs-special">,</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- The future, packaged in the best way</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">-- See documentation below before the 'act' function.  This is for use inside a Star pattern.</span><span>
</span><a name="line-319"></a><span class="hs-keyword">type</span><span> </span><a name="ActCont"><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier">ActCont</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>                      </span><span class="hs-comment">-- The eLoop is the dangerous recursive reference to continuation</span><span>
</span><a name="line-320"></a><span>                                        </span><span class="hs-comment">-- future that loops while accepting zero more characters</span><span>
</span><a name="line-321"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>                </span><span class="hs-comment">-- This holds the safe non-zero-character accepting continuation</span><span>
</span><a name="line-322"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- optimized merger of the above, used only inside act, to avoid orphan QNFA id values</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- newQNFA is the only operation that actually uses the monad get and put operations</span><span>
</span><a name="line-325"></a><span class="hs-identifier">newQNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span>
</span><a name="line-326"></a><a name="newQNFA"><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier">newQNFA</span></a></a><span> </span><a name="local-6989586621679080852"><a href="#local-6989586621679080852"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679080853"><a href="#local-6989586621679080853"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-327"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679080854"><a href="#local-6989586621679080854"><span class="hs-identifier">thisI</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080855"><a href="#local-6989586621679080855"><span class="hs-identifier">oldQs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-328"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080856"><a href="#local-6989586621679080856"><span class="hs-identifier">futureI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">succ</span><span> </span><a href="#local-6989586621679080854"><span class="hs-identifier hs-var">thisI</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621679080856"><span class="hs-identifier hs-var">futureI</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;newQNFA&lt; &quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679080852"><span class="hs-identifier hs-var">s</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; : &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080854"><span class="hs-identifier hs-var">thisI</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-329"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080857"><a href="#local-6989586621679080857"><span class="hs-identifier">qnfa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mkQNFA"><span class="hs-identifier hs-var">mkQNFA</span></a><span> </span><a href="#local-6989586621679080854"><span class="hs-identifier hs-var">thisI</span></a><span> </span><a href="#local-6989586621679080853"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-comment">-- (strictQT qt) -- making strictQNFA kills test (1,11) ZZZ</span><span>
</span><a name="line-330"></a><span>  </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080856"><span class="hs-identifier hs-var">futureI</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679080855"><span class="hs-identifier hs-var">oldQs</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679080854"><span class="hs-identifier hs-var">thisI</span></a><span class="hs-special">,</span><a href="#local-6989586621679080857"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080857"><span class="hs-identifier hs-var">qnfa</span></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == </span><span>
</span><a name="line-334"></a><span class="hs-comment">-- E related functions</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-identifier">fromQNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-337"></a><a name="fromQNFA"><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier">fromQNFA</span></a></a><span> </span><a name="local-6989586621679080858"><a href="#local-6989586621679080858"><span class="hs-identifier">qnfa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679080858"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-identifier">fromQT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-340"></a><a name="fromQT"><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier">fromQT</span></a></a><span> </span><a name="local-6989586621679080859"><a href="#local-6989586621679080859"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679080859"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- Promises the output will match (_,Left _), used by Or cases when any branch wants a QNFA continuation</span><span>
</span><a name="line-343"></a><span class="hs-identifier">asQNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-344"></a><a name="asQNFA"><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier">asQNFA</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080860"><a href="#local-6989586621679080860"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080860"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-345"></a><span class="hs-identifier">asQNFA</span><span> </span><a name="local-6989586621679080861"><a href="#local-6989586621679080861"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080862"><a href="#local-6989586621679080862"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679080863"><a href="#local-6989586621679080863"><span class="hs-identifier">qt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679080864"><a href="#local-6989586621679080864"><span class="hs-identifier">qnfa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a><span> </span><a href="#local-6989586621679080861"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679080863"><span class="hs-identifier hs-var">qt</span></a><span>      </span><span class="hs-comment">-- YYY Policy choice: leave the tags</span><span>
</span><a name="line-346"></a><span>                              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080862"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679080864"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- Convert continuation E into a QNFA, only done at &quot;top level&quot; by qToNFA to get unique start state</span><span>
</span><a name="line-349"></a><span class="hs-identifier">getQNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span>
</span><a name="line-350"></a><a name="getQNFA"><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier">getQNFA</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679080865"><a href="#local-6989586621679080865"><span class="hs-identifier">qnfa</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080865"><span class="hs-identifier hs-var">qnfa</span></a><span>
</span><a name="line-351"></a><span class="hs-identifier">getQNFA</span><span> </span><a name="local-6989586621679080866"><a href="#local-6989586621679080866"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080867"><a href="#local-6989586621679080867"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679080868"><a href="#local-6989586621679080868"><span class="hs-identifier">qnfa</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a><span> </span><a href="#local-6989586621679080866"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="#local-6989586621679080867"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">q_qt</span><span> </span><a href="#local-6989586621679080868"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span class="hs-identifier">getQNFA</span><span> </span><a name="local-6989586621679080869"><a href="#local-6989586621679080869"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080870"><a href="#local-6989586621679080870"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679080871"><a href="#local-6989586621679080871"><span class="hs-identifier">qt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a><span> </span><a href="#local-6989586621679080869"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="#local-6989586621679080870"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080871"><span class="hs-identifier hs-var">qt</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- Extract the QT from the E</span><span>
</span><a name="line-355"></a><span class="hs-identifier">getQT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-356"></a><a name="getQT"><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier">getQT</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080872"><a href="#local-6989586621679080872"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080873"><a href="#local-6989586621679080873"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="#local-6989586621679080872"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier">q_qt</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-6989586621679080873"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-comment">-- 2009: This looks realllly dodgy, since it can convert a QNFA/Testing to a QT/Testing</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- without actually achieving anything except adding a DoPa to the Testing.  A diagnostic</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- series of runs might be needed to decide if this ever creates orphan id numbers.</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- Then applyTest might need to keep track of whether it actually changes anything.</span><span>
</span><a name="line-362"></a><span class="hs-identifier">addTest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-363"></a><a name="addTest"><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier">addTest</span></a></a><span> </span><a name="local-6989586621679080874"><a href="#local-6989586621679080874"><span class="hs-identifier">ti</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080875"><a href="#local-6989586621679080875"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080876"><a href="#local-6989586621679080876"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080875"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#applyTest"><span class="hs-identifier hs-var">applyTest</span></a><span> </span><a href="#local-6989586621679080874"><span class="hs-identifier hs-var">ti</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier">q_qt</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080876"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">-- This is used only with PreUpdate and PostUpdate as the first argument.</span><span>
</span><a name="line-366"></a><span class="hs-identifier">promoteTasks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-type">TagTask</span></a><span class="hs-glyph">-&gt;</span><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a><span>
</span><a name="line-367"></a><a name="promoteTasks"><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier">promoteTasks</span></a></a><span> </span><a name="local-6989586621679080877"><a href="#local-6989586621679080877"><span class="hs-identifier">promote</span></a></a><span> </span><a name="local-6989586621679080878"><a href="#local-6989586621679080878"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679080879"><a href="#local-6989586621679080879"><span class="hs-identifier">tag</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080880"><a href="#local-6989586621679080880"><span class="hs-identifier">task</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080879"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="#local-6989586621679080877"><span class="hs-identifier hs-var">promote</span></a><span> </span><a href="#local-6989586621679080880"><span class="hs-identifier hs-var">task</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080878"><span class="hs-identifier hs-var">tags</span></a><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">-- only used in addWinTags</span><span>
</span><a name="line-370"></a><span class="hs-identifier">demoteTags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span>
</span><a name="line-371"></a><a name="demoteTags"><a href="Text.Regex.TDFA.TNFA.html#demoteTags"><span class="hs-identifier">demoteTags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679080881"><span class="hs-identifier hs-var">helper</span></a><span>
</span><a name="line-372"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679080881"><a href="#local-6989586621679080881"><span class="hs-identifier">helper</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080882"><a href="#local-6989586621679080882"><span class="hs-identifier">tag</span></a></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a name="local-6989586621679080883"><a href="#local-6989586621679080883"><span class="hs-identifier">tt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080882"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="#local-6989586621679080883"><span class="hs-identifier hs-var">tt</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>        </span><span class="hs-identifier">helper</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080884"><a href="#local-6989586621679080884"><span class="hs-identifier">tag</span></a></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-var">PostUpdate</span></a><span> </span><a name="local-6989586621679080885"><a href="#local-6989586621679080885"><span class="hs-identifier">tt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080884"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="#local-6989586621679080885"><span class="hs-identifier hs-var">tt</span></a><span class="hs-special">)</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-comment">-- This is polymorphic so addWinTags can be cute below</span><span>
</span><a name="line-376"></a><span class="hs-pragma">{-# INLINE addWinTags #-}</span><span>
</span><a name="line-377"></a><span class="hs-identifier">addWinTags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080708"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080708"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-378"></a><a name="addWinTags"><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier">addWinTags</span></a></a><span> </span><a name="local-6989586621679080886"><a href="#local-6989586621679080886"><span class="hs-identifier">wtags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080887"><a href="#local-6989586621679080887"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080888"><a href="#local-6989586621679080888"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#demoteTags"><span class="hs-identifier hs-var">demoteTags</span></a><span> </span><a href="#local-6989586621679080886"><span class="hs-identifier hs-var">wtags</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080887"><span class="hs-identifier hs-var">tags</span></a><span>
</span><a name="line-379"></a><span>                               </span><span class="hs-special">,</span><a href="#local-6989586621679080888"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-pragma">{-# INLINE addTag' #-}</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- This is polymorphic so addTagAC can be cute below</span><span>
</span><a name="line-383"></a><span class="hs-identifier">addTag'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080707"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080707"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><a name="addTag%27"><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier">addTag'</span></a></a><span> </span><a name="local-6989586621679080889"><a href="#local-6989586621679080889"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080890"><a href="#local-6989586621679080890"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080891"><a href="#local-6989586621679080891"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679080889"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679080890"><span class="hs-identifier hs-var">tags</span></a><span>
</span><a name="line-385"></a><span>                          </span><span class="hs-special">,</span><a href="#local-6989586621679080891"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">-- a Maybe version of addTag' above, specializing 'a' to Either QNFA QT</span><span>
</span><a name="line-388"></a><span class="hs-identifier">addTag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-389"></a><a name="addTag"><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier">addTag</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679080892"><a href="#local-6989586621679080892"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080892"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-390"></a><span class="hs-identifier">addTag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080893"><a href="#local-6989586621679080893"><span class="hs-identifier">tag</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080894"><a href="#local-6989586621679080894"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a><span> </span><a href="#local-6989586621679080893"><span class="hs-identifier hs-var">tag</span></a><span> </span><a href="#local-6989586621679080894"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-pragma">{-# INLINE addGroupResets #-}</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- This is polymorphic so addGroupResetsAC can be cute below</span><span>
</span><a name="line-394"></a><span class="hs-identifier">addGroupResets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679080706"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080706"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080706"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><a name="addGroupResets"><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier">addGroupResets</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080895"><a href="#local-6989586621679080895"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080895"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-396"></a><span class="hs-identifier">addGroupResets</span><span> </span><a name="local-6989586621679080896"><a href="#local-6989586621679080896"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080897"><a href="#local-6989586621679080897"><span class="hs-identifier">tags'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080898"><a href="#local-6989586621679080898"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080897"><span class="hs-identifier hs-var">tags'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679080899"><a href="#local-6989586621679080899"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080899"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080896"><span class="hs-identifier hs-var">tags</span></a><span>
</span><a name="line-397"></a><span>                                   </span><span class="hs-special">,</span><a href="#local-6989586621679080898"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">addGroupSets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679080705"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080705"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#TagTasks"><span class="hs-identifier hs-type">TagTasks</span></a><span class="hs-special">,</span><a href="#local-6989586621679080705"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><a name="addGroupSets"><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier">addGroupSets</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080900"><a href="#local-6989586621679080900"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080900"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-401"></a><span class="hs-identifier">addGroupSets</span><span> </span><a name="local-6989586621679080901"><a href="#local-6989586621679080901"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080902"><a href="#local-6989586621679080902"><span class="hs-identifier">tags'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080903"><a href="#local-6989586621679080903"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080902"><span class="hs-identifier hs-var">tags'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679080904"><a href="#local-6989586621679080904"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080904"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#SetGroupStopTask"><span class="hs-identifier hs-var">SetGroupStopTask</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080901"><span class="hs-identifier hs-var">tags</span></a><span>
</span><a name="line-402"></a><span>                                 </span><span class="hs-special">,</span><a href="#local-6989586621679080903"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">-- Consume an ActCont.  Uses the mergeQT form to combine non-accepting</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- and accepting view of the continuation.</span><span>
</span><a name="line-406"></a><span class="hs-identifier">getE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-407"></a><a name="getE"><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier">getE</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080905"><a href="#local-6989586621679080905"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080906"><a href="#local-6989586621679080906"><span class="hs-identifier">qnfa</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080905"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679080906"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- consume optimized mQNFA value returned by Star</span><span>
</span><a name="line-408"></a><span class="hs-identifier">getE</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080907"><a href="#local-6989586621679080907"><span class="hs-identifier">eLoop</span></a></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080908"><a href="#local-6989586621679080908"><span class="hs-identifier">accepting</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679080907"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679080908"><span class="hs-identifier hs-var">accepting</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span class="hs-identifier">getE</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080909"><a href="#local-6989586621679080909"><span class="hs-identifier">eLoop</span></a></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080909"><span class="hs-identifier hs-var">eLoop</span></a><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- 2009: See coment for addTest.  Here is a case where the third component might be a (Just qnfa) and it</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- is being lost even though the added test might be redundant.</span><span>
</span><a name="line-413"></a><span class="hs-identifier">addTestAC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#TestInfo"><span class="hs-identifier hs-type">TestInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span>
</span><a name="line-414"></a><a name="addTestAC"><a href="Text.Regex.TDFA.TNFA.html#addTestAC"><span class="hs-identifier">addTestAC</span></a></a><span> </span><a name="local-6989586621679080910"><a href="#local-6989586621679080910"><span class="hs-identifier">ti</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080911"><a href="#local-6989586621679080911"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080912"><a href="#local-6989586621679080912"><span class="hs-identifier">mE</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var">addTest</span></a><span> </span><a href="#local-6989586621679080910"><span class="hs-identifier hs-var">ti</span></a><span> </span><a href="#local-6989586621679080911"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-415"></a><span>                        </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var">addTest</span></a><span> </span><a href="#local-6989586621679080910"><span class="hs-identifier hs-var">ti</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080912"><span class="hs-identifier hs-var">mE</span></a><span>
</span><a name="line-416"></a><span>                        </span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-comment">-- These are AC versions of the add functions on E</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-identifier">addTagAC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span>
</span><a name="line-421"></a><a name="addTagAC"><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier">addTagAC</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679080913"><a href="#local-6989586621679080913"><span class="hs-identifier">ac</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080913"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-422"></a><span class="hs-identifier">addTagAC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080914"><a href="#local-6989586621679080914"><span class="hs-identifier">tag</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080915"><a href="#local-6989586621679080915"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080916"><a href="#local-6989586621679080916"><span class="hs-identifier">mE</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080917"><a href="#local-6989586621679080917"><span class="hs-identifier">mQNFA</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a><span> </span><a href="#local-6989586621679080914"><span class="hs-identifier hs-var">tag</span></a><span> </span><a href="#local-6989586621679080915"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-423"></a><span>                                   </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a><span> </span><a href="#local-6989586621679080914"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080916"><span class="hs-identifier hs-var">mE</span></a><span>
</span><a name="line-424"></a><span>                                   </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTag%27"><span class="hs-identifier hs-var">addTag'</span></a><span> </span><a href="#local-6989586621679080914"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080917"><span class="hs-identifier hs-var">mQNFA</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-identifier">addGroupResetsAC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span>
</span><a name="line-427"></a><a name="addGroupResetsAC"><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier">addGroupResetsAC</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080918"><a href="#local-6989586621679080918"><span class="hs-identifier">ac</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080918"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-428"></a><span class="hs-identifier">addGroupResetsAC</span><span> </span><a name="local-6989586621679080919"><a href="#local-6989586621679080919"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080920"><a href="#local-6989586621679080920"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080921"><a href="#local-6989586621679080921"><span class="hs-identifier">mE</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080922"><a href="#local-6989586621679080922"><span class="hs-identifier">mQNFA</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a><span> </span><a href="#local-6989586621679080919"><span class="hs-identifier hs-var">tags</span></a><span> </span><a href="#local-6989586621679080920"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-429"></a><span>                                     </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a><span> </span><a href="#local-6989586621679080919"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080921"><span class="hs-identifier hs-var">mE</span></a><span>
</span><a name="line-430"></a><span>                                     </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a><span> </span><a href="#local-6989586621679080919"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080922"><span class="hs-identifier hs-var">mQNFA</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-identifier">addGroupSetsAC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span>
</span><a name="line-433"></a><a name="addGroupSetsAC"><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier">addGroupSetsAC</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679080923"><a href="#local-6989586621679080923"><span class="hs-identifier">ac</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080923"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-434"></a><span class="hs-identifier">addGroupSetsAC</span><span> </span><a name="local-6989586621679080924"><a href="#local-6989586621679080924"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080925"><a href="#local-6989586621679080925"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080926"><a href="#local-6989586621679080926"><span class="hs-identifier">mE</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080927"><a href="#local-6989586621679080927"><span class="hs-identifier">mQNFA</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080924"><span class="hs-identifier hs-var">tags</span></a><span> </span><a href="#local-6989586621679080925"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-435"></a><span>                                   </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080924"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080926"><span class="hs-identifier hs-var">mE</span></a><span>
</span><a name="line-436"></a><span>                                   </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080924"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080927"><span class="hs-identifier hs-var">mQNFA</span></a><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span class="hs-identifier">addWinTagsAC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#WinTags"><span class="hs-identifier hs-type">WinTags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span>
</span><a name="line-439"></a><a name="addWinTagsAC"><a href="Text.Regex.TDFA.TNFA.html#addWinTagsAC"><span class="hs-identifier">addWinTagsAC</span></a></a><span> </span><a name="local-6989586621679080928"><a href="#local-6989586621679080928"><span class="hs-identifier">wtags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679080929"><a href="#local-6989586621679080929"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080930"><a href="#local-6989586621679080930"><span class="hs-identifier">mE</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080931"><a href="#local-6989586621679080931"><span class="hs-identifier">mQNFA</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a><span> </span><a href="#local-6989586621679080928"><span class="hs-identifier hs-var">wtags</span></a><span> </span><a href="#local-6989586621679080929"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-440"></a><span>                                  </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a><span> </span><a href="#local-6989586621679080928"><span class="hs-identifier hs-var">wtags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080930"><span class="hs-identifier hs-var">mE</span></a><span>
</span><a name="line-441"></a><span>                                  </span><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a><span> </span><a href="#local-6989586621679080928"><span class="hs-identifier hs-var">wtags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080931"><span class="hs-identifier hs-var">mQNFA</span></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span class="hs-comment">-- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == -- == </span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">-- Initial preTag of 0th tag is implied. No other general pre-tags would be expected.</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- The qtwin contains the preTag of the 1st tag and is only set when a match is completed.</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- The fst Index is the index of the unique starting QNFA state.</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- The snd (Array Index QNFA) is all the QNFA states.</span><span>
</span><a name="line-448"></a><span class="hs-comment">--</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- In the cases below, Empty is handled much like a Test with no TestInfo.</span><span>
</span><a name="line-450"></a><span class="hs-identifier">qToNFA</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Array</span><span> </span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#QNFA"><span class="hs-identifier hs-type">QNFA</span></a><span class="hs-special">)</span><span>
</span><a name="line-451"></a><a name="qToNFA"><a href="Text.Regex.TDFA.TNFA.html#qToNFA"><span class="hs-identifier">qToNFA</span></a></a><span> </span><a name="local-6989586621679080932"><a href="#local-6989586621679080932"><span class="hs-identifier">compOpt</span></a></a><span> </span><a name="local-6989586621679080933"><a href="#local-6989586621679080933"><span class="hs-identifier">qTop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">q_id</span><span> </span><a href="#local-6989586621679080934"><span class="hs-identifier hs-var">startingQNFA</span></a><span>
</span><a name="line-452"></a><span>                      </span><span class="hs-special">,</span><span class="hs-identifier hs-var">array</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-identifier hs-var">pred</span><span> </span><a href="#local-6989586621679080935"><span class="hs-identifier hs-var">lastIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080936"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-453"></a><span>  </span><span class="hs-comment">-- Result startingQNFA is the top level's index</span><span>
</span><a name="line-454"></a><span>  </span><span class="hs-comment">-- State pair: fst 0 is the next state number (not yet used) going in, and lastIndex coming out (succ of last used)</span><span>
</span><a name="line-455"></a><span>  </span><span class="hs-comment">--             snd id is the difference list of states going in, and the finished list coming out</span><span>
</span><a name="line-456"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679080934"><a href="#local-6989586621679080934"><span class="hs-identifier">startingQNFA</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><a name="local-6989586621679080935"><a href="#local-6989586621679080935"><span class="hs-identifier">lastIndex</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080936"><a href="#local-6989586621679080936"><span class="hs-identifier">table</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-457"></a><span>    </span><span class="hs-identifier hs-var">runState</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#qtwin"><span class="hs-identifier hs-var">qtwin</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQNFA"><span class="hs-identifier hs-var">getQNFA</span></a><span> </span><span class="hs-string">&quot;top level&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080937"><span class="hs-identifier hs-var">startState</span></a><span>
</span><a name="line-458"></a><span>  </span><a name="local-6989586621679080937"><a href="#local-6989586621679080937"><span class="hs-identifier">startState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span>  </span><span class="hs-identifier">getTrans</span><span class="hs-special">,</span><span class="hs-identifier">getTransTagless</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-461"></a><span>  </span><a name="local-6989586621679080938"><a href="#local-6989586621679080938"><span class="hs-identifier">getTrans</span></a></a><span> </span><a name="local-6989586621679080950"><a href="#local-6989586621679080950"><span class="hs-identifier">qIn</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">preReset</span><span class="hs-glyph">=</span><a name="local-6989586621679080951"><a href="#local-6989586621679080951"><span class="hs-identifier">resets</span></a></a><span class="hs-special">,</span><span class="hs-identifier">postSet</span><span class="hs-glyph">=</span><a name="local-6989586621679080952"><a href="#local-6989586621679080952"><span class="hs-identifier">sets</span></a></a><span class="hs-special">,</span><span class="hs-identifier">preTag</span><span class="hs-glyph">=</span><a name="local-6989586621679080953"><a href="#local-6989586621679080953"><span class="hs-identifier">pre</span></a></a><span class="hs-special">,</span><span class="hs-identifier">postTag</span><span class="hs-glyph">=</span><a name="local-6989586621679080954"><a href="#local-6989586621679080954"><span class="hs-identifier">post</span></a></a><span class="hs-special">,</span><span class="hs-identifier">unQ</span><span class="hs-glyph">=</span><a name="local-6989586621679080955"><a href="#local-6989586621679080955"><span class="hs-identifier">pIn</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679080956"><a href="#local-6989586621679080956"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; getTrans &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080950"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-462"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679080955"><span class="hs-identifier hs-var">pIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-463"></a><span>      </span><span class="hs-comment">-- The case below is the ultimate consumer of every single OneChar in the input and the only caller of</span><span>
</span><a name="line-464"></a><span>      </span><span class="hs-comment">-- newTrans/acceptTrans which is the sole source of QT/Simple nodes.</span><span>
</span><a name="line-465"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-var">OneChar</span></a><span> </span><a name="local-6989586621679080957"><a href="#local-6989586621679080957"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080948"><span class="hs-identifier hs-var">newTrans</span></a><span> </span><span class="hs-string">&quot;getTrans/OneChar&quot;</span><span> </span><a href="#local-6989586621679080951"><span class="hs-identifier hs-var">resets</span></a><span> </span><a href="#local-6989586621679080953"><span class="hs-identifier hs-var">pre</span></a><span> </span><a href="#local-6989586621679080957"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080954"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080952"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080956"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-466"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a><span> </span><a href="#local-6989586621679080951"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080953"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080954"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080952"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080956"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-467"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-var">Test</span></a><span> </span><a name="local-6989586621679080958"><a href="#local-6989586621679080958"><span class="hs-identifier">ti</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a><span> </span><a href="#local-6989586621679080951"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080953"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTest"><span class="hs-identifier hs-var">addTest</span></a><span> </span><a href="#local-6989586621679080958"><span class="hs-identifier hs-var">ti</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080954"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080952"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080956"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-468"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupResets"><span class="hs-identifier hs-var">addGroupResets</span></a><span> </span><a href="#local-6989586621679080951"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080953"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080939"><span class="hs-identifier hs-var">getTransTagless</span></a><span> </span><a href="#local-6989586621679080950"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080954"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080952"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080956"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span>  </span><a name="local-6989586621679080939"><a href="#local-6989586621679080939"><span class="hs-identifier">getTransTagless</span></a></a><span> </span><a name="local-6989586621679080959"><a href="#local-6989586621679080959"><span class="hs-identifier">qIn</span></a></a><span> </span><a name="local-6989586621679080960"><a href="#local-6989586621679080960"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; getTransTagless &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-471"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unQ</span><span> </span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-472"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-var">Seq</span></a><span> </span><a name="local-6989586621679080961"><a href="#local-6989586621679080961"><span class="hs-identifier">q1</span></a></a><span> </span><a name="local-6989586621679080962"><a href="#local-6989586621679080962"><span class="hs-identifier">q2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080961"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080962"><span class="hs-identifier hs-var">q2</span></a><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-473"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-474"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679080963"><a href="#local-6989586621679080963"><span class="hs-identifier">q</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080963"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-475"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><a name="local-6989586621679080964"><a href="#local-6989586621679080964"><span class="hs-identifier">qs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-476"></a><span>        </span><a name="local-6989586621679080968"><a href="#local-6989586621679080968"><span class="hs-identifier">eqts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a><span> </span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span>
</span><a name="line-477"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-478"></a><span>                    </span><a name="local-6989586621679080965"><a href="#local-6989586621679080965"><span class="hs-identifier">eQNFA</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a><span> </span><span class="hs-string">&quot;getTransTagless/Or/usesQNFA&quot;</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-479"></a><span>                    </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080966"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080965"><span class="hs-identifier hs-var">eQNFA</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679080966"><a href="#local-6989586621679080966"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080964"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-480"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080967"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679080967"><a href="#local-6989586621679080967"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080964"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080969"><a href="#local-6989586621679080969"><span class="hs-identifier">qts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679080968"><span class="hs-identifier hs-var">eqts</span></a><span>
</span><a name="line-482"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr1</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var">mergeAltQT</span></a><span> </span><a href="#local-6989586621679080969"><span class="hs-identifier hs-var">qts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-var">Star</span></a><span> </span><a name="local-6989586621679080970"><a href="#local-6989586621679080970"><span class="hs-identifier">mOrbit</span></a></a><span> </span><a name="local-6989586621679080971"><a href="#local-6989586621679080971"><span class="hs-identifier">resetTheseOrbits</span></a></a><span> </span><a name="local-6989586621679080972"><a href="#local-6989586621679080972"><span class="hs-identifier">mayFirstBeNull</span></a></a><span> </span><a name="local-6989586621679080973"><a href="#local-6989586621679080973"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-485"></a><span>        </span><span class="hs-comment">-- mOrbit of Just implies varies q and childGroups q</span><span>
</span><a name="line-486"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080974"><a href="#local-6989586621679080974"><span class="hs-identifier">e'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080975"><a href="#local-6989586621679080975"><span class="hs-identifier">clear</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- debug (&quot;\n&gt;&quot;++show e++&quot;\n&quot;++show q++&quot;\n&lt;&quot;) $</span><span>
</span><a name="line-487"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var">notNullable</span></a><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- subpattern cannot be null</span><span>
</span><a name="line-488"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679080971"><span class="hs-identifier hs-var">resetTheseOrbits</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679080970"><span class="hs-identifier hs-var">mOrbit</span></a><span>
</span><a name="line-489"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-490"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- True because null of subpattern is same as skipping subpattern</span><span>
</span><a name="line-491"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080976"><a href="#local-6989586621679080976"><span class="hs-identifier">tagList</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a><span> </span><a href="#local-6989586621679080976"><span class="hs-identifier hs-var">tagList</span></a><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- null of subpattern NOT same as skipping</span><span>
</span><a name="line-492"></a><span>                              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nullQ</span><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- is NOT same as skipping</span><span>
</span><a name="line-493"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080945"><span class="hs-identifier hs-var">resetOrbitsQT</span></a><span> </span><a href="#local-6989586621679080971"><span class="hs-identifier hs-var">resetTheseOrbits</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080946"><span class="hs-identifier hs-var">enterOrbitQT</span></a><span> </span><a href="#local-6989586621679080970"><span class="hs-identifier hs-var">mOrbit</span></a><span> </span><span class="hs-comment">-- resetOrbitsQT and enterOrbitQT commute</span><span>
</span><a name="line-494"></a><span>                             </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nullQ</span><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080947"><span class="hs-identifier hs-var">leaveOrbit</span></a><span> </span><a href="#local-6989586621679080970"><span class="hs-identifier hs-var">mOrbit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- perform resets when accepting 0 characters</span><span>
</span><a name="line-495"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080974"><span class="hs-identifier hs-var">e'</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><a name="line-496"></a><span>        </span><a name="local-6989586621679080977"><a href="#local-6989586621679080977"><span class="hs-identifier">mqt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080940"><span class="hs-identifier hs-var">inStar</span></a><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080978"><span class="hs-identifier hs-var">this</span></a><span>
</span><a name="line-497"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679080978"><a href="#local-6989586621679080978"><span class="hs-identifier">this</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080979"><a href="#local-6989586621679080979"><span class="hs-identifier">ans</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679080977"><span class="hs-identifier hs-var">mqt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-498"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Weird pattern in getTransTagless/Star: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-499"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080980"><a href="#local-6989586621679080980"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-500"></a><span>                          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080981"><a href="#local-6989586621679080981"><span class="hs-identifier">qt'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080945"><span class="hs-identifier hs-var">resetOrbitsQT</span></a><span> </span><a href="#local-6989586621679080971"><span class="hs-identifier hs-var">resetTheseOrbits</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080946"><span class="hs-identifier hs-var">enterOrbitQT</span></a><span> </span><a href="#local-6989586621679080970"><span class="hs-identifier hs-var">mOrbit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080980"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-comment">-- resetOrbitsQT and enterOrbitQT commute</span><span>
</span><a name="line-501"></a><span>                              </span><a name="local-6989586621679080982"><a href="#local-6989586621679080982"><span class="hs-identifier">thisQT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679080981"><span class="hs-identifier hs-var">qt'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080947"><span class="hs-identifier hs-var">leaveOrbit</span></a><span> </span><a href="#local-6989586621679080970"><span class="hs-identifier hs-var">mOrbit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-comment">-- capture of subpattern or leave via next pattern (avoid null of subpattern on way out)</span><span>
</span><a name="line-502"></a><span>                              </span><a name="local-6989586621679080983"><a href="#local-6989586621679080983"><span class="hs-identifier">ansE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679080981"><span class="hs-identifier hs-var">qt'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080974"><span class="hs-identifier hs-var">e'</span></a><span> </span><span class="hs-comment">-- capture of subpattern or leave via null of subpattern</span><span>
</span><a name="line-503"></a><span>                          </span><a name="local-6989586621679080984"><a href="#local-6989586621679080984"><span class="hs-identifier">thisE</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a><span> </span><a href="#local-6989586621679080973"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-504"></a><span>                                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier hs-var">fromQNFA</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a><span> </span><span class="hs-string">&quot;getTransTagless/Star&quot;</span><span> </span><a href="#local-6989586621679080982"><span class="hs-identifier hs-var">thisQT</span></a><span>
</span><a name="line-505"></a><span>                                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080982"><span class="hs-identifier hs-var">thisQT</span></a><span>
</span><a name="line-506"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080984"><span class="hs-identifier hs-var">thisE</span></a><span class="hs-special">,</span><a href="#local-6989586621679080983"><span class="hs-identifier hs-var">ansE</span></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679080972"><span class="hs-identifier hs-var">mayFirstBeNull</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679080975"><span class="hs-identifier hs-var">clear</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679080978"><span class="hs-identifier hs-var">this</span></a><span>  </span><span class="hs-comment">-- optimization to possibly preserve QNFA</span><span>
</span><a name="line-508"></a><span>                                                 </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679080979"><span class="hs-identifier hs-var">ans</span></a><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679080978"><span class="hs-identifier hs-var">this</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span>      </span><span class="hs-comment">{- NonEmpty is like actNullable (Or [Empty,q]) without the extra tag to prefer the first Empty branch -}</span><span>
</span><a name="line-512"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-var">NonEmpty</span></a><span> </span><a name="local-6989586621679080985"><a href="#local-6989586621679080985"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var">ecart</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\n&gt; getTransTagless/NonEmpty&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-513"></a><span>        </span><span class="hs-comment">-- Assertion to check than Pattern.starTrans did its job right:</span><span>
</span><a name="line-514"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a><span> </span><a href="#local-6989586621679080985"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;getTransTagless/NonEmpty : provided with a *cannotAccept* pattern: &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-var">mustAccept</span></a><span> </span><a href="#local-6989586621679080985"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;getTransTagless/NonEmpty : provided with a *mustAccept* pattern: &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080986"><a href="#local-6989586621679080986"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a><span> </span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-517"></a><span>                   </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-518"></a><span>                   </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080987"><a href="#local-6989586621679080987"><span class="hs-identifier">_wtags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-comment">-- addWinTags wtags e  XXX was duplicating tags</span><span>
</span><a name="line-519"></a><span>                   </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;getTransTagless/NonEmpty is supposed to have an emptyNull nullView : &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span>
</span><a name="line-520"></a><span>        </span><a name="local-6989586621679080988"><a href="#local-6989586621679080988"><span class="hs-identifier">mqt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080940"><span class="hs-identifier hs-var">inStar</span></a><span> </span><a href="#local-6989586621679080985"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080960"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-521"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679080988"><span class="hs-identifier hs-var">mqt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-522"></a><span>                   </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Weird pattern in getTransTagless/NonEmpty: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>                   </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679080989"><a href="#local-6989586621679080989"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT_2nd"><span class="hs-identifier hs-var">mergeQT_2nd</span></a><span> </span><a href="#local-6989586621679080989"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080986"><span class="hs-identifier hs-var">e'</span></a><span> </span><span class="hs-comment">-- ...and then this sets qt_win to exactly that of e'</span><span>
</span><a name="line-524"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;This case in Text.Regex.TNFA.TNFA.getTransTagless cannot happen&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679080959"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span>  </span><span class="hs-identifier">inStar</span><span class="hs-special">,</span><span class="hs-identifier">inStarNullableTagless</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span class="hs-special">)</span><span>
</span><a name="line-527"></a><span>  </span><a name="local-6989586621679080940"><a href="#local-6989586621679080940"><span class="hs-identifier">inStar</span></a></a><span> </span><a name="local-6989586621679080990"><a href="#local-6989586621679080990"><span class="hs-identifier">qIn</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">preReset</span><span class="hs-glyph">=</span><a name="local-6989586621679080991"><a href="#local-6989586621679080991"><span class="hs-identifier">resets</span></a></a><span class="hs-special">,</span><span class="hs-identifier">postSet</span><span class="hs-glyph">=</span><a name="local-6989586621679080992"><a href="#local-6989586621679080992"><span class="hs-identifier">sets</span></a></a><span class="hs-special">,</span><span class="hs-identifier">preTag</span><span class="hs-glyph">=</span><a name="local-6989586621679080993"><a href="#local-6989586621679080993"><span class="hs-identifier">pre</span></a></a><span class="hs-special">,</span><span class="hs-identifier">postTag</span><span class="hs-glyph">=</span><a name="local-6989586621679080994"><a href="#local-6989586621679080994"><span class="hs-identifier">post</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679080995"><a href="#local-6989586621679080995"><span class="hs-identifier">eLoop</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var">notNullable</span></a><span> </span><a href="#local-6989586621679080990"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-528"></a><span>    </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; inStar/1 &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080990"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679080990"><span class="hs-identifier hs-var">qIn</span></a><span> </span><a href="#local-6989586621679080995"><span class="hs-identifier hs-var">eLoop</span></a><span>
</span><a name="line-530"></a><span>                                                                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-531"></a><span>    </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; inStar/2 &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080990"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-532"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#prependGroupResets"><span class="hs-identifier hs-var">prependGroupResets</span></a><span> </span><a href="#local-6989586621679080991"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependPreTag"><span class="hs-identifier hs-var">prependPreTag</span></a><span> </span><a href="#local-6989586621679080993"><span class="hs-identifier hs-var">pre</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080941"><span class="hs-identifier hs-var">inStarNullableTagless</span></a><span> </span><a href="#local-6989586621679080990"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addTag"><span class="hs-identifier hs-var">addTag</span></a><span> </span><a href="#local-6989586621679080994"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSets"><span class="hs-identifier hs-var">addGroupSets</span></a><span> </span><a href="#local-6989586621679080992"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080995"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>    </span><span>
</span><a name="line-534"></a><span>  </span><a name="local-6989586621679080941"><a href="#local-6989586621679080941"><span class="hs-identifier">inStarNullableTagless</span></a></a><span> </span><a name="local-6989586621679080996"><a href="#local-6989586621679080996"><span class="hs-identifier">qIn</span></a></a><span> </span><a name="local-6989586621679080997"><a href="#local-6989586621679080997"><span class="hs-identifier">eLoop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; inStarNullableTagless &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080996"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-535"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unQ</span><span> </span><a href="#local-6989586621679080996"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-536"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- with Or this discards () branch in &quot;(^|foo|())*&quot;</span><span>
</span><a name="line-537"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-538"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679080998"><a href="#local-6989586621679080998"><span class="hs-identifier">q</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080940"><span class="hs-identifier hs-var">inStar</span></a><span> </span><a href="#local-6989586621679080998"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080997"><span class="hs-identifier hs-var">eLoop</span></a><span>
</span><a name="line-539"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><a name="local-6989586621679080999"><a href="#local-6989586621679080999"><span class="hs-identifier">qs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-540"></a><span>        </span><a name="local-6989586621679081003"><a href="#local-6989586621679081003"><span class="hs-identifier">mqts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a><span> </span><a href="#local-6989586621679080996"><span class="hs-identifier hs-var">qIn</span></a><span>
</span><a name="line-541"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679081000"><a href="#local-6989586621679081000"><span class="hs-identifier">eQNFA</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a><span> </span><span class="hs-string">&quot;inStarNullableTagless/Or/usesQNFA&quot;</span><span> </span><a href="#local-6989586621679080997"><span class="hs-identifier hs-var">eLoop</span></a><span>
</span><a name="line-542"></a><span>                          </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679080940"><span class="hs-identifier hs-var">inStar</span></a><span> </span><a href="#local-6989586621679081001"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679081000"><span class="hs-identifier hs-var">eQNFA</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679081001"><a href="#local-6989586621679081001"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080999"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-543"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679080940"><span class="hs-identifier hs-var">inStar</span></a><span> </span><a href="#local-6989586621679081002"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679080997"><span class="hs-identifier hs-var">eLoop</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679081002"><a href="#local-6989586621679081002"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080999"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-544"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081004"><a href="#local-6989586621679081004"><span class="hs-identifier">qts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><a href="#local-6989586621679081003"><span class="hs-identifier hs-var">mqts</span></a><span>
</span><a name="line-545"></a><span>            </span><a name="local-6989586621679081005"><a href="#local-6989586621679081005"><span class="hs-identifier">mqt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679081004"><span class="hs-identifier hs-var">qts</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr1</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var">mergeAltQT</span></a><span> </span><a href="#local-6989586621679081004"><span class="hs-identifier hs-var">qts</span></a><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679081005"><span class="hs-identifier hs-var">mqt</span></a><span>
</span><a name="line-547"></a><span>      </span><span class="hs-comment">-- Calls to act are inlined by hand to actNullable.  This returns only cases where q1 or q2 or both</span><span>
</span><a name="line-548"></a><span>      </span><span class="hs-comment">-- accepted characters.  The zero-character case is handled by the tag wrapping by inStar.</span><span>
</span><a name="line-549"></a><span>      </span><span class="hs-comment">-- 2009: Does this look dodgy and repetitios of tags?  Seq by policy has no preTag or postTag.</span><span>
</span><a name="line-550"></a><span>      </span><span class="hs-comment">-- though it can have prependGroupResets, but those are not repeated in children so it is okay.</span><span>
</span><a name="line-551"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-var">Seq</span></a><span> </span><a name="local-6989586621679081006"><a href="#local-6989586621679081006"><span class="hs-identifier">q1</span></a></a><span> </span><a name="local-6989586621679081007"><a href="#local-6989586621679081007"><span class="hs-identifier">q2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679081008"><a href="#local-6989586621679081008"><span class="hs-identifier">meAcceptingOut</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081006"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081007"><span class="hs-identifier hs-var">q2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080997"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679081008"><span class="hs-identifier hs-var">meAcceptingOut</span></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>      </span><span class="hs-comment">-- Calls to act are inlined by hand and are we losing the tags?</span><span>
</span><a name="line-554"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-var">Star</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679081009"><a href="#local-6989586621679081009"><span class="hs-identifier">meAcceptingOut</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080944"><span class="hs-identifier hs-var">actNullableTagless</span></a><span> </span><a href="#local-6989586621679080996"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080997"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-555"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679081009"><span class="hs-identifier hs-var">meAcceptingOut</span></a><span class="hs-special">)</span><span>
</span><a name="line-556"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-var">NonEmpty</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var">ecart</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\n&gt; inStarNullableTagless/NonEmpty&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080996"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-557"></a><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679081010"><a href="#local-6989586621679081010"><span class="hs-identifier">meAcceptingOut</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080944"><span class="hs-identifier hs-var">actNullableTagless</span></a><span> </span><a href="#local-6989586621679080996"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080997"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-558"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679081010"><span class="hs-identifier hs-var">meAcceptingOut</span></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-var">Test</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- with Or this discards ^ branch in &quot;(^|foo|())*&quot;</span><span>
</span><a name="line-560"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-var">OneChar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;OneChar cannot have nullable True&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-561"></a><span>
</span><a name="line-562"></a><span>  </span><span class="hs-comment">{- act* functions

  These have a very complicated state that they receive and return as
  &quot;the continuation&quot;.

   (E, Maybe E,Maybe (SetTag,QNFA))

  The first E is the source of the danger that must be avoided.  It
  starts out a reference to the QNFA/QT state that will be created by
  the most recent parent Star node.  Thus it is a recursive reference
  from the MonadFix machinery.  In particular, this value cannot be
  returned to the parent Star to be included in itself or we get a &quot;let
  x = y; y=x&quot; style infinite loop.

  As act* progresses the first E is actually modified to be the parent
  QNFA/QT as &quot;seen&quot; when all the elements to the right have accepted 0
  characters.  Thus it acquires tags and tests+tags (the NullView data
  is used for this purpose).

  The second item in the 3-tuple is a Maybe E.  This will be used as the
  source of the QT for this contents of the Star QNFA/QT.  It will be
  merged with the Star's own continuation data.  It starts out Nothing
  and stays that way as long as there are no accepting transitions in
  the Star's pattern.  This is value (via getQT) returned by inStar.

  The third item is a special optimization I added to remove a source
  of orphaned QNFAs.  A Star within Act will often have to create a
  QNFA node.  This cannot go into the second Maybe E item as Just
  (SetTag,Left QNFA) because this QNFA can have pulled values from the
  recursive parent Star's QNFA/QT in the first E value.  Thus pulling
  with getQT from the QNFA and using that as the Maybe E would likely
  cause an infinite loop.  This extra QNFA is stored in the thd3
  location for use by getE. To improve it further it can accumulate
  Tag information after being formed.

  When a non nullable Q is handled by act it checks to see if the
  third value is there, in which case it uses that QNFA as the total
  continuation (subsumed in getE).  Otherwise it merges the first E
  with any (Just E) in the second value to form the continuation.

  -}</span><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span>  </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>  </span><a name="local-6989586621679080942"><a href="#local-6989586621679080942"><span class="hs-identifier">act</span></a></a><span> </span><a name="local-6989586621679081011"><a href="#local-6989586621679081011"><span class="hs-identifier">qIn</span></a></a><span> </span><a name="local-6989586621679081012"><a href="#local-6989586621679081012"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var">nullable</span></a><span> </span><a href="#local-6989586621679081011"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081011"><span class="hs-identifier hs-var">qIn</span></a><span> </span><a href="#local-6989586621679081012"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-606"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; act &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679081011"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-607"></a><span>    </span><a name="local-6989586621679081013"><a href="#local-6989586621679081013"><span class="hs-identifier">mqt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679081011"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081012"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679081013"><span class="hs-identifier hs-var">mqt</span></a><span>  </span><span class="hs-comment">-- or &quot;return (fromQT qtlose,mqt,Nothing)&quot;</span><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span>  </span><span class="hs-identifier">actNullable</span><span class="hs-special">,</span><span class="hs-identifier">actNullableTagless</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><a href="Text.Regex.TDFA.TNFA.html#ActCont"><span class="hs-identifier hs-type">ActCont</span></a><span>
</span><a name="line-611"></a><span>  </span><a name="local-6989586621679080943"><a href="#local-6989586621679080943"><span class="hs-identifier">actNullable</span></a></a><span> </span><a name="local-6989586621679081014"><a href="#local-6989586621679081014"><span class="hs-identifier">qIn</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-var">Q</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">preReset</span><span class="hs-glyph">=</span><a name="local-6989586621679081015"><a href="#local-6989586621679081015"><span class="hs-identifier">resets</span></a></a><span class="hs-special">,</span><span class="hs-identifier">postSet</span><span class="hs-glyph">=</span><a name="local-6989586621679081016"><a href="#local-6989586621679081016"><span class="hs-identifier">sets</span></a></a><span class="hs-special">,</span><span class="hs-identifier">preTag</span><span class="hs-glyph">=</span><a name="local-6989586621679081017"><a href="#local-6989586621679081017"><span class="hs-identifier">pre</span></a></a><span class="hs-special">,</span><span class="hs-identifier">postTag</span><span class="hs-glyph">=</span><a name="local-6989586621679081018"><a href="#local-6989586621679081018"><span class="hs-identifier">post</span></a></a><span class="hs-special">,</span><span class="hs-identifier">unQ</span><span class="hs-glyph">=</span><a name="local-6989586621679081019"><a href="#local-6989586621679081019"><span class="hs-identifier">pIn</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679081020"><a href="#local-6989586621679081020"><span class="hs-identifier">ac</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-612"></a><span>    </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; actNullable &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679081014"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-613"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081019"><span class="hs-identifier hs-var">pIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-614"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a><span> </span><a href="#local-6989586621679081015"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a><span> </span><a href="#local-6989586621679081017"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a><span> </span><a href="#local-6989586621679081018"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a><span> </span><a href="#local-6989586621679081016"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081020"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-615"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Test"><span class="hs-identifier hs-var">Test</span></a><span> </span><a name="local-6989586621679081021"><a href="#local-6989586621679081021"><span class="hs-identifier">ti</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a><span> </span><a href="#local-6989586621679081015"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a><span> </span><a href="#local-6989586621679081017"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTestAC"><span class="hs-identifier hs-var">addTestAC</span></a><span> </span><a href="#local-6989586621679081021"><span class="hs-identifier hs-var">ti</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a><span> </span><a href="#local-6989586621679081018"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a><span> </span><a href="#local-6989586621679081016"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081020"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-616"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#OneChar"><span class="hs-identifier hs-var">OneChar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;OneChar cannot have nullable True &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupResetsAC"><span class="hs-identifier hs-var">addGroupResetsAC</span></a><span> </span><a href="#local-6989586621679081015"><span class="hs-identifier hs-var">resets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a><span> </span><a href="#local-6989586621679081017"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080944"><span class="hs-identifier hs-var">actNullableTagless</span></a><span> </span><a href="#local-6989586621679081014"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addTagAC"><span class="hs-identifier hs-var">addTagAC</span></a><span> </span><a href="#local-6989586621679081018"><span class="hs-identifier hs-var">post</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addGroupSetsAC"><span class="hs-identifier hs-var">addGroupSetsAC</span></a><span> </span><a href="#local-6989586621679081016"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081020"><span class="hs-identifier hs-var">ac</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>
</span><a name="line-619"></a><span>  </span><a name="local-6989586621679080944"><a href="#local-6989586621679080944"><span class="hs-identifier">actNullableTagless</span></a></a><span> </span><a name="local-6989586621679081022"><a href="#local-6989586621679081022"><span class="hs-identifier">qIn</span></a></a><span> </span><a name="local-6989586621679081023"><a href="#local-6989586621679081023"><span class="hs-identifier">ac</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679081024"><a href="#local-6989586621679081024"><span class="hs-identifier">eLoop</span></a></a><span class="hs-special">,</span><a name="local-6989586621679081025"><a href="#local-6989586621679081025"><span class="hs-identifier">mAccepting</span></a></a><span class="hs-special">,</span><a name="local-6989586621679081026"><a href="#local-6989586621679081026"><span class="hs-identifier">mQNFA</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&gt;&lt; actNullableTagless &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot; &lt;&gt;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-620"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unQ</span><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-621"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Seq"><span class="hs-identifier hs-var">Seq</span></a><span> </span><a name="local-6989586621679081027"><a href="#local-6989586621679081027"><span class="hs-identifier">q1</span></a></a><span> </span><a name="local-6989586621679081028"><a href="#local-6989586621679081028"><span class="hs-identifier">q2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081027"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081028"><span class="hs-identifier hs-var">q2</span></a><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>   </span><span class="hs-comment">-- We know q1 and q2 are nullable</span><span>
</span><a name="line-622"></a><span>                      </span><span>
</span><a name="line-623"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-624"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679081029"><a href="#local-6989586621679081029"><span class="hs-identifier">q</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080944"><span class="hs-identifier hs-var">actNullableTagless</span></a><span> </span><a href="#local-6989586621679081029"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-625"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><a name="local-6989586621679081030"><a href="#local-6989586621679081030"><span class="hs-identifier">qs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-626"></a><span>        </span><a name="local-6989586621679081036"><a href="#local-6989586621679081036"><span class="hs-identifier">cqts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-627"></a><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var">nullable</span></a><span> </span><a href="#local-6989586621679081030"><span class="hs-identifier hs-var">qs</span></a><span>
</span><a name="line-628"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081031"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679081031"><a href="#local-6989586621679081031"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679081030"><span class="hs-identifier hs-var">qs</span></a><span class="hs-special">]</span><span>
</span><a name="line-629"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-630"></a><span>              </span><a name="local-6989586621679081032"><a href="#local-6989586621679081032"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#asQNFA"><span class="hs-identifier hs-var">asQNFA</span></a><span> </span><span class="hs-string">&quot;qToNFA/actNullableTagless/Or&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-631"></a><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">act'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#Q"><span class="hs-identifier hs-type">Q</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>                  </span><a name="local-6989586621679081033"><a href="#local-6989586621679081033"><span class="hs-identifier">act'</span></a></a><span> </span><a name="local-6989586621679081034"><a href="#local-6989586621679081034"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679080938"><span class="hs-identifier hs-var">getTrans</span></a><span> </span><a href="#local-6989586621679081034"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679081032"><span class="hs-identifier hs-var">e'</span></a><span>
</span><a name="line-633"></a><span>              </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#nullable"><span class="hs-identifier hs-var">nullable</span></a><span> </span><a href="#local-6989586621679081035"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Text.Regex.TDFA.Common.html#snd3"><span class="hs-identifier hs-var">snd3</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081035"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679081033"><span class="hs-identifier hs-var">act'</span></a><span> </span><a href="#local-6989586621679081035"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679081035"><a href="#local-6989586621679081035"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679081030"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-634"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081037"><a href="#local-6989586621679081037"><span class="hs-identifier">qts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span> </span><a href="#local-6989586621679081036"><span class="hs-identifier hs-var">cqts</span></a><span class="hs-special">)</span><span>
</span><a name="line-635"></a><span>            </span><a name="local-6989586621679081038"><a href="#local-6989586621679081038"><span class="hs-identifier">eLoop'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-636"></a><span>                       </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081041"><a href="#local-6989586621679081041"><span class="hs-identifier">wtags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a><span> </span><a href="#local-6989586621679081041"><span class="hs-identifier hs-var">wtags</span></a><span> </span><a href="#local-6989586621679081024"><span class="hs-identifier hs-var">eLoop</span></a><span> </span><span class="hs-comment">-- nullable without tests; avoid getQT</span><span>
</span><a name="line-637"></a><span>                       </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-var">applyNullViews</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nullQ</span><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679081024"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- suspect this of duplicating some tags with nullQ qIn</span><span>
</span><a name="line-638"></a><span>            </span><a name="local-6989586621679081039"><a href="#local-6989586621679081039"><span class="hs-identifier">mAccepting'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679081037"><span class="hs-identifier hs-var">qts</span></a><span>
</span><a name="line-639"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#applyNullViews"><span class="hs-identifier hs-var">applyNullViews</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nullQ</span><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081025"><span class="hs-identifier hs-var">mAccepting</span></a><span> </span><span class="hs-comment">-- suspect this of duplicating some tags with nullQ qIn</span><span>
</span><a name="line-640"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldr1</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeAltQT"><span class="hs-identifier hs-var">mergeAltQT</span></a><span> </span><a href="#local-6989586621679081037"><span class="hs-identifier hs-var">qts</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>            </span><a name="local-6989586621679081040"><a href="#local-6989586621679081040"><span class="hs-identifier">mQNFA'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679081037"><span class="hs-identifier hs-var">qts</span></a><span>
</span><a name="line-642"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-643"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081042"><a href="#local-6989586621679081042"><span class="hs-identifier">wtags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addWinTags"><span class="hs-identifier hs-var">addWinTags</span></a><span> </span><a href="#local-6989586621679081042"><span class="hs-identifier hs-var">wtags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081026"><span class="hs-identifier hs-var">mQNFA</span></a><span>
</span><a name="line-644"></a><span>                              </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-645"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-646"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081038"><span class="hs-identifier hs-var">eLoop'</span></a><span class="hs-special">,</span><a href="#local-6989586621679081039"><span class="hs-identifier hs-var">mAccepting'</span></a><span class="hs-special">,</span><a href="#local-6989586621679081040"><span class="hs-identifier hs-var">mQNFA'</span></a><span class="hs-special">)</span><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#Star"><span class="hs-identifier hs-var">Star</span></a><span> </span><a name="local-6989586621679081043"><a href="#local-6989586621679081043"><span class="hs-identifier">mOrbit</span></a></a><span> </span><a name="local-6989586621679081044"><a href="#local-6989586621679081044"><span class="hs-identifier">resetTheseOrbits</span></a></a><span> </span><a name="local-6989586621679081045"><a href="#local-6989586621679081045"><span class="hs-identifier">mayFirstBeNull</span></a></a><span> </span><a name="local-6989586621679081046"><a href="#local-6989586621679081046"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-649"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679081047"><a href="#local-6989586621679081047"><span class="hs-identifier">ac0</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679081048"><a href="#local-6989586621679081048"><span class="hs-identifier">mAccepting0</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679081049"><a href="#local-6989586621679081049"><span class="hs-identifier">clear</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-650"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#notNullable"><span class="hs-identifier hs-var">notNullable</span></a><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-651"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679081044"><span class="hs-identifier hs-var">resetTheseOrbits</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679081043"><span class="hs-identifier hs-var">mOrbit</span></a><span>
</span><a name="line-653"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-654"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081050"><a href="#local-6989586621679081050"><span class="hs-identifier">wtags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#addWinTagsAC"><span class="hs-identifier hs-var">addWinTagsAC</span></a><span> </span><a href="#local-6989586621679081050"><span class="hs-identifier hs-var">wtags</span></a><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>                              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081051"><a href="#local-6989586621679081051"><span class="hs-identifier">nQ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nullQ</span><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span>
</span><a name="line-657"></a><span>                                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679081051"><span class="hs-identifier hs-var">nQ</span></a><span> </span><a href="#local-6989586621679081024"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679081051"><span class="hs-identifier hs-var">nQ</span></a><span> </span><a href="#local-6989586621679081025"><span class="hs-identifier hs-var">mAccepting</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081052"><a href="#local-6989586621679081052"><span class="hs-identifier">nQ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080945"><span class="hs-identifier hs-var">resetOrbitsQT</span></a><span> </span><a href="#local-6989586621679081044"><span class="hs-identifier hs-var">resetTheseOrbits</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080946"><span class="hs-identifier hs-var">enterOrbitQT</span></a><span> </span><a href="#local-6989586621679081043"><span class="hs-identifier hs-var">mOrbit</span></a><span>
</span><a name="line-659"></a><span>                                     </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#preferNullViews"><span class="hs-identifier hs-var">preferNullViews</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nullQ</span><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080947"><span class="hs-identifier hs-var">leaveOrbit</span></a><span> </span><a href="#local-6989586621679081043"><span class="hs-identifier hs-var">mOrbit</span></a><span>
</span><a name="line-660"></a><span>                            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679081052"><span class="hs-identifier hs-var">nQ</span></a><span> </span><a href="#local-6989586621679081024"><span class="hs-identifier hs-var">eLoop</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679081052"><span class="hs-identifier hs-var">nQ</span></a><span> </span><a href="#local-6989586621679081025"><span class="hs-identifier hs-var">mAccepting</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679081047"><span class="hs-identifier hs-var">ac0</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><a name="line-662"></a><span>          </span><a name="local-6989586621679081053"><a href="#local-6989586621679081053"><span class="hs-identifier">mChildAccepting</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080942"><span class="hs-identifier hs-var">act</span></a><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081055"><span class="hs-identifier hs-var">this</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621679081054"><a href="#local-6989586621679081054"><span class="hs-identifier">thisAC</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679081055"><a href="#local-6989586621679081055"><span class="hs-identifier">this</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679081056"><a href="#local-6989586621679081056"><span class="hs-identifier">ansAC</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span>
</span><a name="line-664"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081053"><span class="hs-identifier hs-var">mChildAccepting</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-665"></a><span>              </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Weird pattern in getTransTagless/Star: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081057"><a href="#local-6989586621679081057"><span class="hs-identifier">childAccepting</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-667"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081058"><a href="#local-6989586621679081058"><span class="hs-identifier">childQT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080945"><span class="hs-identifier hs-var">resetOrbitsQT</span></a><span> </span><a href="#local-6989586621679081044"><span class="hs-identifier hs-var">resetTheseOrbits</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080946"><span class="hs-identifier hs-var">enterOrbitQT</span></a><span> </span><a href="#local-6989586621679081043"><span class="hs-identifier hs-var">mOrbit</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081057"><span class="hs-identifier hs-var">childAccepting</span></a><span>
</span><a name="line-668"></a><span>                    </span><a name="local-6989586621679081059"><a href="#local-6989586621679081059"><span class="hs-identifier">thisQT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679081058"><span class="hs-identifier hs-var">childQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679080947"><span class="hs-identifier hs-var">leaveOrbit</span></a><span> </span><a href="#local-6989586621679081043"><span class="hs-identifier hs-var">mOrbit</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-669"></a><span>                    </span><a name="local-6989586621679081060"><a href="#local-6989586621679081060"><span class="hs-identifier">thisAccepting</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-670"></a><span>                      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081025"><span class="hs-identifier hs-var">mAccepting</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-671"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081061"><a href="#local-6989586621679081061"><span class="hs-identifier">futureAccepting</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679081058"><span class="hs-identifier hs-var">childQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081061"><span class="hs-identifier hs-var">futureAccepting</span></a><span>
</span><a name="line-672"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081058"><span class="hs-identifier hs-var">childQT</span></a><span>
</span><a name="line-673"></a><span>                </span><a name="local-6989586621679081063"><a href="#local-6989586621679081063"><span class="hs-identifier">thisAll</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#usesQNFA"><span class="hs-identifier hs-var">usesQNFA</span></a><span> </span><a href="#local-6989586621679081046"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-674"></a><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679081062"><a href="#local-6989586621679081062"><span class="hs-identifier">thisQNFA</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a><span> </span><span class="hs-string">&quot;actNullableTagless/Star&quot;</span><span> </span><a href="#local-6989586621679081059"><span class="hs-identifier hs-var">thisQT</span></a><span>
</span><a name="line-675"></a><span>                                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQNFA"><span class="hs-identifier hs-var">fromQNFA</span></a><span> </span><a href="#local-6989586621679081062"><span class="hs-identifier hs-var">thisQNFA</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679081060"><span class="hs-identifier hs-var">thisAccepting</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><a href="#local-6989586621679081062"><span class="hs-identifier hs-var">thisQNFA</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><a href="#local-6989586621679081059"><span class="hs-identifier hs-var">thisQT</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679081060"><span class="hs-identifier hs-var">thisAccepting</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081064"><a href="#local-6989586621679081064"><span class="hs-identifier">skipQT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679081058"><span class="hs-identifier hs-var">childQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getE"><span class="hs-identifier hs-var">getE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081047"><span class="hs-identifier hs-var">ac0</span></a><span>  </span><span class="hs-comment">-- for first iteration the continuation uses NullView</span><span>
</span><a name="line-678"></a><span>                    </span><a name="local-6989586621679081065"><a href="#local-6989586621679081065"><span class="hs-identifier">skipAccepting</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-679"></a><span>                      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081048"><span class="hs-identifier hs-var">mAccepting0</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-680"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081067"><a href="#local-6989586621679081067"><span class="hs-identifier">futureAccepting0</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679081058"><span class="hs-identifier hs-var">childQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081067"><span class="hs-identifier hs-var">futureAccepting0</span></a><span>
</span><a name="line-681"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081058"><span class="hs-identifier hs-var">childQT</span></a><span>
</span><a name="line-682"></a><span>                    </span><a name="local-6989586621679081066"><a href="#local-6989586621679081066"><span class="hs-identifier">ansAll</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><a href="#local-6989586621679081064"><span class="hs-identifier hs-var">skipQT</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679081065"><span class="hs-identifier hs-var">skipAccepting</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-683"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081063"><span class="hs-identifier hs-var">thisAll</span></a><span class="hs-special">,</span><a href="#local-6989586621679081066"><span class="hs-identifier hs-var">ansAll</span></a><span class="hs-special">)</span><span>
</span><a name="line-684"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679081045"><span class="hs-identifier hs-var">mayFirstBeNull</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679081049"><span class="hs-identifier hs-var">clear</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679081054"><span class="hs-identifier hs-var">thisAC</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679081056"><span class="hs-identifier hs-var">ansAC</span></a><span class="hs-special">)</span><span>
</span><a name="line-685"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679081054"><span class="hs-identifier hs-var">thisAC</span></a><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>      </span><a href="Text.Regex.TDFA.CorePattern.html#NonEmpty"><span class="hs-identifier hs-var">NonEmpty</span></a><span> </span><a name="local-6989586621679081068"><a href="#local-6989586621679081068"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#ecart"><span class="hs-identifier hs-var">ecart</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\n&gt; actNullableTagless/NonEmpty&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-687"></a><span>        </span><span class="hs-comment">-- We *know* that q is nullable from Pattern and CorePattern checks, but assert here anyway</span><span>
</span><a name="line-688"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#mustAccept"><span class="hs-identifier hs-var">mustAccept</span></a><span> </span><a href="#local-6989586621679081068"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;actNullableTagless/NonEmpty : provided with a *mustAccept* pattern: &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-689"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.CorePattern.html#cannotAccept"><span class="hs-identifier hs-var">cannotAccept</span></a><span> </span><a href="#local-6989586621679081068"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;actNullableTagless/NonEmpty : provided with a *cannotAccept* pattern: &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span>        </span><span class="hs-comment">{- This is like actNullable (Or [Empty,q]) without the extra tag to prefer the first Empty branch -}</span><span>
</span><a name="line-692"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679081069"><a href="#local-6989586621679081069"><span class="hs-identifier">clearE</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#maybeOnlyEmpty"><span class="hs-identifier hs-var">maybeOnlyEmpty</span></a><span> </span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-693"></a><span>                             </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-694"></a><span>                             </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081070"><a href="#local-6989586621679081070"><span class="hs-identifier">_wtags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span> </span><span class="hs-comment">-- addWinTagsAC wtags ac XXX was duplicating tags</span><span>
</span><a name="line-695"></a><span>                             </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;actNullableTagless/NonEmpty is supposed to have an emptyNull nullView : &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span>
</span><a name="line-696"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679081071"><a href="#local-6989586621679081071"><span class="hs-identifier">mChildAccepting</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080943"><span class="hs-identifier hs-var">actNullable</span></a><span> </span><a href="#local-6989586621679081068"><span class="hs-identifier hs-var">q</span></a><span> </span><a href="#local-6989586621679081023"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-697"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081071"><span class="hs-identifier hs-var">mChildAccepting</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-698"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Weird pattern in actNullableTagless/NonEmpty: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span>
</span><a name="line-699"></a><span>            </span><span class="hs-comment">-- cannotAccept q checked for and excluded the above condition (and starTrans!)</span><span>
</span><a name="line-700"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081072"><a href="#local-6989586621679081072"><span class="hs-identifier">childAccepting</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-701"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081073"><a href="#local-6989586621679081073"><span class="hs-identifier">childQT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><a href="#local-6989586621679081072"><span class="hs-identifier hs-var">childAccepting</span></a><span>
</span><a name="line-702"></a><span>                </span><a name="local-6989586621679081074"><a href="#local-6989586621679081074"><span class="hs-identifier">thisAccepting</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081025"><span class="hs-identifier hs-var">mAccepting</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-703"></a><span>                                  </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081073"><span class="hs-identifier hs-var">childQT</span></a><span>
</span><a name="line-704"></a><span>                                  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679081075"><a href="#local-6989586621679081075"><span class="hs-identifier">futureAcceptingE</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#mergeQT"><span class="hs-identifier hs-var">mergeQT</span></a><span> </span><a href="#local-6989586621679081073"><span class="hs-identifier hs-var">childQT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#getQT"><span class="hs-identifier hs-var">getQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081075"><span class="hs-identifier hs-var">futureAcceptingE</span></a><span>
</span><a name="line-705"></a><span>                                  </span><span class="hs-comment">-- I _think_ there is no need for mergeQT_2nd in the above.</span><span>
</span><a name="line-706"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081069"><span class="hs-identifier hs-var">clearE</span></a><span class="hs-special">,</span><a href="#local-6989586621679081074"><span class="hs-identifier hs-var">thisAccepting</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-707"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;This case in Text.Regex.TNFA.TNFA.actNullableTagless cannot happen: &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081022"><span class="hs-identifier hs-var">qIn</span></a><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span>  </span><span class="hs-comment">-- This is applied directly to any qt immediately before passing to mergeQT</span><span>
</span><a name="line-710"></a><span>  </span><span class="hs-identifier">resetOrbitsQT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-711"></a><span>  </span><a name="local-6989586621679080945"><a href="#local-6989586621679080945"><span class="hs-identifier">resetOrbitsQT</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">lastStarGreedy</span><span> </span><a href="#local-6989586621679080932"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-712"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679081076"><a href="#local-6989586621679081076"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679081077"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#ResetOrbitTask"><span class="hs-identifier hs-var">ResetOrbitTask</span></a><span class="hs-special">)</span><span class="hs-glyph">|</span><a name="local-6989586621679081077"><a href="#local-6989586621679081077"><span class="hs-identifier">tag</span></a></a><span class="hs-glyph">&lt;-</span><a href="#local-6989586621679081076"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span>  </span><span class="hs-identifier">enterOrbitQT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-715"></a><span>  </span><a name="local-6989586621679080946"><a href="#local-6989586621679080946"><span class="hs-identifier">enterOrbitQT</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">lastStarGreedy</span><span> </span><a href="#local-6989586621679080932"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-716"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679081078"><a href="#local-6989586621679081078"><span class="hs-identifier">tag</span></a></a><span class="hs-glyph">-&gt;</span><a href="Text.Regex.TDFA.TNFA.html#prependTags%27"><span class="hs-identifier hs-var">prependTags'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679081078"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#EnterOrbitTask"><span class="hs-identifier hs-var">EnterOrbitTask</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span>  </span><span class="hs-identifier">leaveOrbit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>
</span><a name="line-719"></a><span>  </span><a name="local-6989586621679080947"><a href="#local-6989586621679080947"><span class="hs-identifier">leaveOrbit</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">lastStarGreedy</span><span> </span><a href="#local-6989586621679080932"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-720"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679081079"><a href="#local-6989586621679081079"><span class="hs-identifier">tag</span></a></a><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679081080"><a href="#local-6989586621679081080"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679081081"><a href="#local-6989586621679081081"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679081079"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#LeaveOrbitTask"><span class="hs-identifier hs-var">LeaveOrbitTask</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679081080"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">,</span><a href="#local-6989586621679081081"><span class="hs-identifier hs-var">cont</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span>  </span><span class="hs-comment">-- 'newTrans' is the only place where PostUpdate is used and is only called from getTrans/OneChar</span><span>
</span><a name="line-723"></a><span>  </span><span class="hs-comment">--  and is the only caller of 'acceptTrans' to make QT/Simple nodes.</span><span>
</span><a name="line-724"></a><span>  </span><span class="hs-identifier">newTrans</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>    </span><span class="hs-comment">-- debugging string for when a newQNFA is allocated</span><span>
</span><a name="line-725"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- which tags get ResetGroupStopTask in this transition (PreUpdate)</span><span>
</span><a name="line-726"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span> </span><span class="hs-comment">-- maybe one TagTask to update before incrementing the offset (PreUpdate)</span><span>
</span><a name="line-727"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>   </span><span class="hs-comment">-- the one character accepting Pattern of this transition</span><span>
</span><a name="line-728"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>         </span><span class="hs-comment">-- the continuation state, reified to a QNFA, of after this Pattern</span><span>
</span><a name="line-729"></a><span>                       </span><span class="hs-comment">-- The fst part of the E is consumed here as a TagTask (PostUpdate)</span><span>
</span><a name="line-730"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#S"><span class="hs-identifier hs-type">S</span></a><span> </span><a href="Text.Regex.TDFA.TNFA.html#E"><span class="hs-identifier hs-type">E</span></a><span>       </span><span class="hs-comment">-- the continuation state, as a QT, of before this Pattern</span><span>
</span><a name="line-731"></a><span>  </span><a name="local-6989586621679080948"><a href="#local-6989586621679080948"><span class="hs-identifier">newTrans</span></a></a><span> </span><a name="local-6989586621679081082"><a href="#local-6989586621679081082"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679081083"><a href="#local-6989586621679081083"><span class="hs-identifier">resets</span></a></a><span> </span><a name="local-6989586621679081084"><a href="#local-6989586621679081084"><span class="hs-identifier">mPre</span></a></a><span> </span><a name="local-6989586621679081085"><a href="#local-6989586621679081085"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679081086"><a href="#local-6989586621679081086"><span class="hs-identifier">tags</span></a></a><span class="hs-special">,</span><a name="local-6989586621679081087"><a href="#local-6989586621679081087"><span class="hs-identifier">cont</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-732"></a><span>    </span><a name="local-6989586621679081091"><a href="#local-6989586621679081091"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081087"><span class="hs-identifier hs-var">cont</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-733"></a><span>           </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679081088"><a href="#local-6989586621679081088"><span class="hs-identifier">qnfa</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">q_id</span><span> </span><a href="#local-6989586621679081088"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- strictQNFA ZZZ no help</span><span>
</span><a name="line-734"></a><span>           </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679081089"><a href="#local-6989586621679081089"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679081090"><a href="#local-6989586621679081090"><span class="hs-identifier">qnfa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#newQNFA"><span class="hs-identifier hs-var">newQNFA</span></a><span> </span><a href="#local-6989586621679081082"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679081089"><span class="hs-identifier hs-var">qt</span></a><span> </span><span class="hs-comment">-- strictQT ZZZ no help</span><span>
</span><a name="line-735"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">q_id</span><span> </span><a href="#local-6989586621679081090"><span class="hs-identifier hs-var">qnfa</span></a><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081092"><a href="#local-6989586621679081092"><span class="hs-identifier">post</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#PostUpdate"><span class="hs-identifier hs-var">PostUpdate</span></a><span> </span><a href="#local-6989586621679081086"><span class="hs-identifier hs-var">tags</span></a><span>
</span><a name="line-737"></a><span>        </span><a name="local-6989586621679081093"><a href="#local-6989586621679081093"><span class="hs-identifier">pre</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#promoteTasks"><span class="hs-identifier hs-var">promoteTasks</span></a><span> </span><a href="Text.Regex.TDFA.Common.html#PreUpdate"><span class="hs-identifier hs-var">PreUpdate</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679081094"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#ResetGroupStopTask"><span class="hs-identifier hs-var">ResetGroupStopTask</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679081094"><a href="#local-6989586621679081094"><span class="hs-identifier">tag</span></a></a><span class="hs-glyph">&lt;-</span><a href="#local-6989586621679081083"><span class="hs-identifier hs-var">resets</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679081095"><a href="#local-6989586621679081095"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679081095"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><a href="Text.Regex.TDFA.Common.html#TagTask"><span class="hs-identifier hs-var">TagTask</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081084"><span class="hs-identifier hs-var">mPre</span></a><span class="hs-special">)</span><span>
</span><a name="line-738"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#fromQT"><span class="hs-identifier hs-var">fromQT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080949"><span class="hs-identifier hs-var">acceptTrans</span></a><span> </span><a href="#local-6989586621679081093"><span class="hs-identifier hs-var">pre</span></a><span> </span><a href="#local-6989586621679081085"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679081092"><span class="hs-identifier hs-var">post</span></a><span> </span><a href="#local-6989586621679081091"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-comment">-- fromQT $ strictQT no help</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span>  </span><span class="hs-comment">-- 'acceptTrans' is the sole creator of QT/Simple and is only called by getTrans/OneChar/newTrans</span><span>
</span><a name="line-741"></a><span>  </span><span class="hs-identifier">acceptTrans</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Pattern.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagList"><span class="hs-identifier hs-type">TagList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#QT"><span class="hs-identifier hs-type">QT</span></a><span>
</span><a name="line-742"></a><span>  </span><a name="local-6989586621679080949"><a href="#local-6989586621679080949"><span class="hs-identifier">acceptTrans</span></a></a><span> </span><a name="local-6989586621679081096"><a href="#local-6989586621679081096"><span class="hs-identifier">pre</span></a></a><span> </span><a name="local-6989586621679081097"><a href="#local-6989586621679081097"><span class="hs-identifier">pIn</span></a></a><span> </span><a name="local-6989586621679081098"><a href="#local-6989586621679081098"><span class="hs-identifier">post</span></a></a><span> </span><a name="local-6989586621679081099"><a href="#local-6989586621679081099"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-743"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081107"><a href="#local-6989586621679081107"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><a href="#local-6989586621679081099"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">getDoPa</span><span> </span><a href="#local-6989586621679081097"><span class="hs-identifier hs-var">pIn</span></a><span class="hs-special">,</span><a href="#local-6989586621679081096"><span class="hs-identifier hs-var">pre</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679081098"><span class="hs-identifier hs-var">post</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-744"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081097"><span class="hs-identifier hs-var">pIn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-745"></a><span>         </span><a href="Text.Regex.TDFA.Pattern.html#PChar"><span class="hs-identifier hs-var">PChar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679081108"><a href="#local-6989586621679081108"><span class="hs-identifier">char</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-746"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081109"><a href="#local-6989586621679081109"><span class="hs-identifier">trans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081100"><span class="hs-identifier hs-var">toMap</span></a><span> </span><a href="#local-6989586621679081107"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679081108"><span class="hs-identifier hs-var">char</span></a><span class="hs-special">]</span><span>
</span><a name="line-747"></a><span>           </span><span class="hs-keyword">in</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_win</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_trans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081109"><span class="hs-identifier hs-var">trans</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_other</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-748"></a><span>         </span><a href="Text.Regex.TDFA.Pattern.html#PEscape"><span class="hs-identifier hs-var">PEscape</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679081110"><a href="#local-6989586621679081110"><span class="hs-identifier">char</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-749"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081111"><a href="#local-6989586621679081111"><span class="hs-identifier">trans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081100"><span class="hs-identifier hs-var">toMap</span></a><span> </span><a href="#local-6989586621679081107"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679081110"><span class="hs-identifier hs-var">char</span></a><span class="hs-special">]</span><span>
</span><a name="line-750"></a><span>           </span><span class="hs-keyword">in</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_win</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_trans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081111"><span class="hs-identifier hs-var">trans</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_other</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-751"></a><span>         </span><a href="Text.Regex.TDFA.Pattern.html#PDot"><span class="hs-identifier hs-var">PDot</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_win</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_trans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081102"><span class="hs-identifier hs-var">dotTrans</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_other</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081107"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-752"></a><span>         </span><a href="Text.Regex.TDFA.Pattern.html#PAny"><span class="hs-identifier hs-var">PAny</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679081112"><a href="#local-6989586621679081112"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-753"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081113"><a href="#local-6989586621679081113"><span class="hs-identifier">trans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081100"><span class="hs-identifier hs-var">toMap</span></a><span> </span><a href="#local-6989586621679081107"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toAscList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#decodePatternSet"><span class="hs-identifier hs-var">decodePatternSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081112"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-754"></a><span>           </span><span class="hs-keyword">in</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_win</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_trans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081113"><span class="hs-identifier hs-var">trans</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_other</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-755"></a><span>         </span><a href="Text.Regex.TDFA.Pattern.html#PAnyNot"><span class="hs-identifier hs-var">PAnyNot</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679081114"><a href="#local-6989586621679081114"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-756"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081115"><a href="#local-6989586621679081115"><span class="hs-identifier">trans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081100"><span class="hs-identifier hs-var">toMap</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toAscList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679081101"><span class="hs-identifier hs-var">addNewline</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#decodePatternSet"><span class="hs-identifier hs-var">decodePatternSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679081114"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-757"></a><span>           </span><span class="hs-keyword">in</span><span> </span><a href="Text.Regex.TDFA.Common.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qt_win</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_trans</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081115"><span class="hs-identifier hs-var">trans</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">qt_other</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679081107"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-758"></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#err"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Cannot acceptTrans pattern &quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080933"><span class="hs-identifier hs-var">qTop</span></a><span class="hs-special">,</span><a href="#local-6989586621679081097"><span class="hs-identifier hs-var">pIn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-759"></a><span>    </span><span class="hs-keyword">where</span><span>  </span><span class="hs-comment">-- Take a common destination and a sorted list of unique chraceters</span><span>
</span><a name="line-760"></a><span>           </span><span class="hs-comment">-- and create a map from those characters to the common destination</span><span>
</span><a name="line-761"></a><span>      </span><span class="hs-identifier">toMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">,</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span>
</span><a name="line-762"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-type">CharMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#DoPa"><span class="hs-identifier hs-type">DoPa</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">,</span><span> </span><a href="Text.Regex.TDFA.Common.html#TagUpdate"><span class="hs-identifier hs-type">TagUpdate</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span>      </span><a name="local-6989586621679081100"><a href="#local-6989586621679081100"><span class="hs-identifier">toMap</span></a></a><span> </span><a name="local-6989586621679081103"><a href="#local-6989586621679081103"><span class="hs-identifier">dest</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">caseSensitive</span><span> </span><a href="#local-6989586621679080932"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromDistinctAscList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679081104"><a href="#local-6989586621679081104"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621679081104"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><a href="#local-6989586621679081103"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-764"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntMap.CharMap2.html#CharMap"><span class="hs-identifier hs-var">CharMap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IMap</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-765"></a><span>                               </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679081105"><a href="#local-6989586621679081105"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679081106"><a href="#local-6989586621679081106"><span class="hs-identifier">dl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isAlpha</span><span> </span><a href="#local-6989586621679081105"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-766"></a><span>                                                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081106"><span class="hs-identifier hs-var">dl</span></a><span class="hs-operator hs-var">.</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toUpper</span><span> </span><a href="#local-6989586621679081105"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679081103"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-767"></a><span>                                                           </span><span class="hs-operator hs-var">.</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679081105"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679081103"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-768"></a><span>                                                        </span><span class="hs-special">)</span><span>
</span><a name="line-769"></a><span>                                                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679081106"><span class="hs-identifier hs-var">dl</span></a><span class="hs-operator hs-var">.</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621679081105"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><a href="#local-6989586621679081103"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>                                       </span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span>
</span><a name="line-771"></a><span>      </span><a name="local-6989586621679081101"><a href="#local-6989586621679081101"><span class="hs-identifier">addNewline</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">multiline</span><span> </span><a href="#local-6989586621679080932"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span> </span><span class="hs-char">'\n'</span><span>
</span><a name="line-772"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-773"></a><span>      </span><a name="local-6989586621679081102"><a href="#local-6989586621679081102"><span class="hs-identifier">dotTrans</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">multiline</span><span> </span><a href="#local-6989586621679080932"><span class="hs-identifier hs-var">compOpt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IntMap.CharMap2.html#singleton"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span></a><span> </span><span class="hs-char">'\n'</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-774"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-775"></a><span>
</span><a name="line-776"></a><span class="hs-comment">{-

prepend architecture becomes
prependTags :: TagTask -&gt; [Tag] -&gt; QT -&gt; QT
which always uses PreUpdate and the same task for all the tags

qt_win seems to only allow PreUpdate so why keep the same type?


ADD ORPHAN ID check and make this a fatal error while testing

-}</span><span>
</span><a name="line-788"></a><span>
</span><a name="line-789"></a><span class="hs-comment">-- | decodePatternSet cannot handle collating element and treats</span><span>
</span><a name="line-790"></a><span class="hs-comment">-- equivalence classes as just their definition and nothing more.</span><span>
</span><a name="line-791"></a><span class="hs-identifier">decodePatternSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Pattern.html#PatternSet"><span class="hs-identifier hs-type">PatternSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-792"></a><a name="decodePatternSet"><a href="Text.Regex.TDFA.TNFA.html#decodePatternSet"><span class="hs-identifier">decodePatternSet</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Pattern.html#PatternSet"><span class="hs-identifier hs-var">PatternSet</span></a><span> </span><a name="local-6989586621679081116"><a href="#local-6989586621679081116"><span class="hs-identifier">msc</span></a></a><span> </span><a name="local-6989586621679081117"><a href="#local-6989586621679081117"><span class="hs-identifier">mscc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679081118"><a href="#local-6989586621679081118"><span class="hs-identifier">msec</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-793"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679081119"><a href="#local-6989586621679081119"><span class="hs-identifier">baseMSC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-6989586621679081116"><span class="hs-identifier hs-var">msc</span></a><span>
</span><a name="line-794"></a><span>      </span><a name="local-6989586621679081120"><a href="#local-6989586621679081120"><span class="hs-identifier">withMSCC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081119"><span class="hs-identifier hs-var">baseMSC</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Text.Regex.TDFA.TNFA.html#decodeCharacterClass"><span class="hs-identifier hs-var">decodeCharacterClass</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toAscList</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081117"><span class="hs-identifier hs-var">mscc</span></a><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span>      </span><a name="local-6989586621679081121"><a href="#local-6989586621679081121"><span class="hs-identifier">withMSEC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081120"><span class="hs-identifier hs-var">withMSCC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-identifier">unSEC</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">S</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toAscList</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679081118"><span class="hs-identifier hs-var">msec</span></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>  </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679081121"><span class="hs-identifier hs-var">withMSEC</span></a><span>
</span><a name="line-797"></a><span>
</span><a name="line-798"></a><span class="hs-comment">-- | This returns the disctince ascending list of characters</span><span>
</span><a name="line-799"></a><span class="hs-comment">-- represented by [: :] values in legalCharacterClasses; unrecognized</span><span>
</span><a name="line-800"></a><span class="hs-comment">-- class names return an empty string</span><span>
</span><a name="line-801"></a><span class="hs-identifier">decodeCharacterClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Text.Regex.TDFA.Pattern.html#PatternSetCharacterClass"><span class="hs-identifier hs-type">PatternSetCharacterClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-802"></a><a name="decodeCharacterClass"><a href="Text.Regex.TDFA.TNFA.html#decodeCharacterClass"><span class="hs-identifier">decodeCharacterClass</span></a></a><span> </span><span class="hs-special">(</span><a href="Text.Regex.TDFA.Pattern.html#PatternSetCharacterClass"><span class="hs-identifier hs-var">PatternSetCharacterClass</span></a><span> </span><a name="local-6989586621679081122"><a href="#local-6989586621679081122"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-803"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679081122"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-804"></a><span>    </span><span class="hs-string">&quot;alnum&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'0'</span><span class="hs-glyph">..</span><span class="hs-char">'9'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-glyph">..</span><span class="hs-char">'Z'</span><span class="hs-special">]</span><span>
</span><a name="line-805"></a><span>    </span><span class="hs-string">&quot;digit&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'0'</span><span class="hs-glyph">..</span><span class="hs-char">'9'</span><span class="hs-special">]</span><span>
</span><a name="line-806"></a><span>    </span><span class="hs-string">&quot;punct&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">33</span><span class="hs-special">'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">47</span><span class="hs-special">'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">58</span><span class="hs-special">'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">64</span><span class="hs-special">'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">91</span><span class="hs-special">'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">95</span><span class="hs-special">'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;\96&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">123</span><span class="hs-special">'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">126</span><span class="hs-special">'</span><span class="hs-special">]</span><span>
</span><a name="line-807"></a><span>    </span><span class="hs-string">&quot;alpha&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-glyph">..</span><span class="hs-char">'Z'</span><span class="hs-special">]</span><span>
</span><a name="line-808"></a><span>    </span><span class="hs-string">&quot;graph&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">41</span><span class="hs-special">'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">126</span><span class="hs-special">'</span><span class="hs-special">]</span><span>
</span><a name="line-809"></a><span>    </span><span class="hs-string">&quot;space&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\t\n\v\f\r &quot;</span><span>
</span><a name="line-810"></a><span>    </span><span class="hs-string">&quot;blank&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\t &quot;</span><span>
</span><a name="line-811"></a><span>    </span><span class="hs-string">&quot;lower&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span>
</span><a name="line-812"></a><span>    </span><span class="hs-string">&quot;upper&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-glyph">..</span><span class="hs-char">'Z'</span><span class="hs-special">]</span><span>
</span><a name="line-813"></a><span>    </span><span class="hs-string">&quot;cntrl&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'\0'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">31</span><span class="hs-special">'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;\127&quot;</span><span> </span><span class="hs-comment">-- with NUL</span><span>
</span><a name="line-814"></a><span>    </span><span class="hs-string">&quot;print&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">32</span><span class="hs-special">'</span><span class="hs-glyph">..</span><span class="hs-special">'</span><span class="hs-glyph">\</span><span class="hs-number">126</span><span class="hs-special">'</span><span class="hs-special">]</span><span>
</span><a name="line-815"></a><span>    </span><span class="hs-string">&quot;xdigit&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'0'</span><span class="hs-glyph">..</span><span class="hs-char">'9'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'f'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-glyph">..</span><span class="hs-char">'F'</span><span class="hs-special">]</span><span>
</span><a name="line-816"></a><span>    </span><span class="hs-string">&quot;word&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'0'</span><span class="hs-glyph">..</span><span class="hs-char">'9'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-glyph">..</span><span class="hs-char">'Z'</span><span class="hs-special">]</span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;_&quot;</span><span>
</span><a name="line-817"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-818"></a><span>
</span><a name="line-819"></a><span class="hs-comment">{-
-- | This is the list of recognized [: :] character classes, others
-- are decoded as empty.
legalCharacterClasses :: [String]
legalCharacterClasses = [&quot;alnum&quot;,&quot;digit&quot;,&quot;punct&quot;,&quot;alpha&quot;,&quot;graph&quot;
  ,&quot;space&quot;,&quot;blank&quot;,&quot;lower&quot;,&quot;upper&quot;,&quot;cntrl&quot;,&quot;print&quot;,&quot;xdigit&quot;,&quot;word&quot;]

-}</span><span>
</span><a name="line-827"></a></pre></body></html>