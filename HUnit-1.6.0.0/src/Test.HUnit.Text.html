<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Text-based test controller for running HUnit tests and reporting</span><span>
</span><a name="line-2"></a><span class="hs-comment">--   results as text, usually to a terminal.</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test</span><span class="hs-operator">.</span><span class="hs-identifier">HUnit</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span>
</span><a name="line-5"></a><span class="hs-special">(</span><span>
</span><a name="line-6"></a><span>  </span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-7"></a><span>  </span><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier hs-var">putTextToHandle</span></a><span class="hs-special">,</span><span> </span><a href="Test.HUnit.Text.html#putTextToShowS"><span class="hs-identifier hs-var">putTextToShowS</span></a><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>  </span><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier hs-var">runTestText</span></a><span class="hs-special">,</span><span>
</span><a name="line-9"></a><span>  </span><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier hs-var">showPath</span></a><span class="hs-special">,</span><span> </span><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-var">showCounts</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>  </span><a href="Test.HUnit.Text.html#runTestTT"><span class="hs-identifier hs-var">runTestTT</span></a><span>
</span><a name="line-11"></a><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">where</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Test.HUnit.Base.html"><span class="hs-identifier">Test</span><span class="hs-operator">.</span><span class="hs-identifier">HUnit</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">CallStack</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">when</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">stderr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hPutStrLn</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">-- | As the general text-based test controller ('runTestText') executes a</span><span>
</span><a name="line-22"></a><span class="hs-comment">--   test, it reports each test case start, error, and failure by</span><span>
</span><a name="line-23"></a><span class="hs-comment">--   constructing a string and passing it to the function embodied in a</span><span>
</span><a name="line-24"></a><span class="hs-comment">--   'PutText'.  A report string is known as a \&quot;line\&quot;, although it includes</span><span>
</span><a name="line-25"></a><span class="hs-comment">--   no line terminator; the function in a 'PutText' is responsible for</span><span>
</span><a name="line-26"></a><span class="hs-comment">--   terminating lines appropriately.  Besides the line, the function</span><span>
</span><a name="line-27"></a><span class="hs-comment">--   receives a flag indicating the intended \&quot;persistence\&quot; of the line:</span><span>
</span><a name="line-28"></a><span class="hs-comment">--   'True' indicates that the line should be part of the final overall</span><span>
</span><a name="line-29"></a><span class="hs-comment">--   report; 'False' indicates that the line merely indicates progress of</span><span>
</span><a name="line-30"></a><span class="hs-comment">--   the test execution.  Each progress line shows the current values of</span><span>
</span><a name="line-31"></a><span class="hs-comment">--   the cumulative test execution counts; a final, persistent line shows</span><span>
</span><a name="line-32"></a><span class="hs-comment">--   the final count values.</span><span>
</span><a name="line-33"></a><span class="hs-comment">--</span><span>
</span><a name="line-34"></a><span class="hs-comment">--   The 'PutText' function is also passed, and returns, an arbitrary state</span><span>
</span><a name="line-35"></a><span class="hs-comment">--   value (called 'st' here).  The initial state value is given in the</span><span>
</span><a name="line-36"></a><span class="hs-comment">--   'PutText'; the final value is returned by 'runTestText'.</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">data</span><span> </span><a name="PutText"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier">PutText</span></a></a><span> </span><a name="local-6989586621679035409"><a href="#local-6989586621679035409"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PutText"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier">PutText</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679035409"><span class="hs-identifier hs-type">st</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679035409"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679035409"><span class="hs-identifier hs-type">st</span></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-comment">-- | Two reporting schemes are defined here.  @putTextToHandle@ writes</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- report lines to a given handle.  'putTextToShowS' accumulates</span><span>
</span><a name="line-43"></a><span class="hs-comment">-- persistent lines for return as a whole by 'runTestText'.</span><span>
</span><a name="line-44"></a><span class="hs-comment">--</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- @putTextToHandle@ writes persistent lines to the given handle,</span><span>
</span><a name="line-46"></a><span class="hs-comment">-- following each by a newline character.  In addition, if the given flag</span><span>
</span><a name="line-47"></a><span class="hs-comment">-- is @True@, it writes progress lines to the handle as well.  A progress</span><span>
</span><a name="line-48"></a><span class="hs-comment">-- line is written with no line termination, so that it can be</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- overwritten by the next report line.  As overwriting involves writing</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- carriage return and blank characters, its proper effect is usually</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- only obtained on terminal devices.</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-identifier">putTextToHandle</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ Write progress lines to handle?</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-57"></a><a name="putTextToHandle"><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier">putTextToHandle</span></a></a><span> </span><a name="local-6989586621679035918"><a href="#local-6989586621679035918"><span class="hs-identifier">handle</span></a></a><span> </span><a name="local-6989586621679035919"><a href="#local-6989586621679035919"><span class="hs-identifier">showProgress</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a><span> </span><a href="#local-6989586621679035921"><span class="hs-identifier hs-var">put</span></a><span> </span><a href="#local-6989586621679035920"><span class="hs-identifier hs-var">initCnt</span></a><span>
</span><a name="line-58"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-59"></a><span>  </span><a name="local-6989586621679035920"><a href="#local-6989586621679035920"><span class="hs-identifier">initCnt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679035919"><span class="hs-identifier hs-var">showProgress</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-60"></a><span>  </span><a name="local-6989586621679035921"><a href="#local-6989586621679035921"><span class="hs-identifier">put</span></a></a><span> </span><a name="local-6989586621679035923"><a href="#local-6989586621679035923"><span class="hs-identifier">line</span></a></a><span> </span><a name="local-6989586621679035924"><a href="#local-6989586621679035924"><span class="hs-identifier">pers</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679035924"><span class="hs-identifier hs-var">pers</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hPutStrLn</span><span> </span><a href="#local-6989586621679035918"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="#local-6989586621679035923"><span class="hs-identifier hs-var">line</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-identifier">put</span><span> </span><a name="local-6989586621679036071"><a href="#local-6989586621679036071"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a name="local-6989586621679036072"><a href="#local-6989586621679036072"><span class="hs-identifier">cnt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">hPutStrLn</span><span> </span><a href="#local-6989586621679035918"><span class="hs-identifier hs-var">handle</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679035922"><span class="hs-identifier hs-var">erase</span></a><span> </span><a href="#local-6989586621679036072"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679036071"><span class="hs-identifier hs-var">line</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-identifier">put</span><span> </span><a name="local-6989586621679036073"><a href="#local-6989586621679036073"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679035918"><span class="hs-identifier hs-var">handle</span></a><span> </span><span class="hs-special">(</span><span class="hs-char">'\r'</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679036073"><span class="hs-identifier hs-var">line</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679036073"><span class="hs-identifier hs-var">line</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-comment">-- The &quot;erasing&quot; strategy with a single '\r' relies on the fact that the</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-comment">-- lengths of successive summary lines are monotonically nondecreasing.</span><span>
</span><a name="line-65"></a><span>  </span><a name="local-6989586621679035922"><a href="#local-6989586621679035922"><span class="hs-identifier">erase</span></a></a><span> </span><a name="local-6989586621679036074"><a href="#local-6989586621679036074"><span class="hs-identifier">cnt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679036074"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;\r&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679036074"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\r&quot;</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | Accumulates persistent lines (dropping progess lines) for return by</span><span>
</span><a name="line-69"></a><span class="hs-comment">--   'runTestText'.  The accumulated lines are represented by a</span><span>
</span><a name="line-70"></a><span class="hs-comment">--   @'ShowS' ('String' -&gt; 'String')@ function whose first argument is the</span><span>
</span><a name="line-71"></a><span class="hs-comment">--   string to be appended to the accumulated report lines.</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-identifier">putTextToShowS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a><span> </span><span class="hs-identifier hs-type">ShowS</span><span>
</span><a name="line-74"></a><a name="putTextToShowS"><a href="Test.HUnit.Text.html#putTextToShowS"><span class="hs-identifier">putTextToShowS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a><span> </span><a href="#local-6989586621679036075"><span class="hs-identifier hs-var">put</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-75"></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679036075"><a href="#local-6989586621679036075"><span class="hs-identifier">put</span></a></a><span> </span><a name="local-6989586621679036077"><a href="#local-6989586621679036077"><span class="hs-identifier">line</span></a></a><span> </span><a name="local-6989586621679036078"><a href="#local-6989586621679036078"><span class="hs-identifier">pers</span></a></a><span> </span><a name="local-6989586621679036079"><a href="#local-6989586621679036079"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679036078"><span class="hs-identifier hs-var">pers</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679036076"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621679036079"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679036077"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679036079"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>       </span><a name="local-6989586621679036076"><a href="#local-6989586621679036076"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679036080"><a href="#local-6989586621679036080"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679036081"><a href="#local-6989586621679036081"><span class="hs-identifier">line</span></a></a><span> </span><a name="local-6989586621679036082"><a href="#local-6989586621679036082"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036080"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679036081"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-char">'\n'</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679036082"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | Executes a test, processing each report line according to the given</span><span>
</span><a name="line-80"></a><span class="hs-comment">--   reporting scheme.  The reporting scheme's state is threaded through calls</span><span>
</span><a name="line-81"></a><span class="hs-comment">--   to the reporting scheme's function and finally returned, along with final</span><span>
</span><a name="line-82"></a><span class="hs-comment">--   count values.</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-identifier">runTestText</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a><span> </span><a href="#local-6989586621679035410"><span class="hs-identifier hs-type">st</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.HUnit.Base.html#Test"><span class="hs-identifier hs-type">Test</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679035410"><span class="hs-identifier hs-type">st</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><a name="runTestText"><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier">runTestText</span></a></a><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a><span> </span><a name="local-6989586621679036083"><a href="#local-6989586621679036083"><span class="hs-identifier">put</span></a></a><span> </span><a name="local-6989586621679036084"><a href="#local-6989586621679036084"><span class="hs-identifier">us0</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679036085"><a href="#local-6989586621679036085"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679036101"><a href="#local-6989586621679036101"><span class="hs-identifier">counts'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679036102"><a href="#local-6989586621679036102"><span class="hs-identifier">us1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Test.HUnit.Base.html#performTest"><span class="hs-identifier hs-var">performTest</span></a><span> </span><a href="#local-6989586621679036086"><span class="hs-identifier hs-var">reportStart</span></a><span> </span><a href="#local-6989586621679036087"><span class="hs-identifier hs-var">reportError</span></a><span> </span><a href="#local-6989586621679036088"><span class="hs-identifier hs-var">reportFailure</span></a><span> </span><a href="#local-6989586621679036084"><span class="hs-identifier hs-var">us0</span></a><span> </span><a href="#local-6989586621679036085"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-87"></a><span>  </span><a name="local-6989586621679036103"><a href="#local-6989586621679036103"><span class="hs-identifier">us2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679036083"><span class="hs-identifier hs-var">put</span></a><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-var">showCounts</span></a><span> </span><a href="#local-6989586621679036101"><span class="hs-identifier hs-var">counts'</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679036102"><span class="hs-identifier hs-var">us1</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679036101"><span class="hs-identifier hs-var">counts'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679036103"><span class="hs-identifier hs-var">us2</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-90"></a><span>  </span><a name="local-6989586621679036086"><a href="#local-6989586621679036086"><span class="hs-identifier">reportStart</span></a></a><span> </span><a name="local-6989586621679036090"><a href="#local-6989586621679036090"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621679036091"><a href="#local-6989586621679036091"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036083"><span class="hs-identifier hs-var">put</span></a><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-var">showCounts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">counts</span><span> </span><a href="#local-6989586621679036090"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679036091"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-91"></a><span>  </span><a name="local-6989586621679036087"><a href="#local-6989586621679036087"><span class="hs-identifier">reportError</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036089"><span class="hs-identifier hs-var">reportProblem</span></a><span> </span><span class="hs-string">&quot;Error:&quot;</span><span>   </span><span class="hs-string">&quot;Error in:   &quot;</span><span>
</span><a name="line-92"></a><span>  </span><a name="local-6989586621679036088"><a href="#local-6989586621679036088"><span class="hs-identifier">reportFailure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036089"><span class="hs-identifier hs-var">reportProblem</span></a><span> </span><span class="hs-string">&quot;Failure:&quot;</span><span> </span><span class="hs-string">&quot;Failure in: &quot;</span><span>
</span><a name="line-93"></a><span>  </span><a name="local-6989586621679036089"><a href="#local-6989586621679036089"><span class="hs-identifier">reportProblem</span></a></a><span> </span><a name="local-6989586621679036092"><a href="#local-6989586621679036092"><span class="hs-identifier">p0</span></a></a><span> </span><a name="local-6989586621679036093"><a href="#local-6989586621679036093"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679036094"><a href="#local-6989586621679036094"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679036095"><a href="#local-6989586621679036095"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679036096"><a href="#local-6989586621679036096"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621679036097"><a href="#local-6989586621679036097"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036083"><span class="hs-identifier hs-var">put</span></a><span> </span><a href="#local-6989586621679036098"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679036097"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-94"></a><span>   </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679036098"><a href="#local-6989586621679036098"><span class="hs-identifier">line</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;### &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679036099"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679036100"><span class="hs-identifier hs-var">path'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Test.HUnit.Text.html#formatLocation"><span class="hs-identifier hs-var">formatLocation</span></a><span> </span><a href="#local-6989586621679036094"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679036095"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-95"></a><span>         </span><a name="local-6989586621679036099"><a href="#local-6989586621679036099"><span class="hs-identifier">kind</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679036100"><span class="hs-identifier hs-var">path'</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679036092"><span class="hs-identifier hs-var">p0</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679036093"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-96"></a><span>         </span><a name="local-6989586621679036100"><a href="#local-6989586621679036100"><span class="hs-identifier">path'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier hs-var">showPath</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">path</span><span> </span><a href="#local-6989586621679036096"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-identifier">formatLocation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-99"></a><a name="formatLocation"><a href="Test.HUnit.Text.html#formatLocation"><span class="hs-identifier">formatLocation</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-100"></a><span class="hs-identifier">formatLocation</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679036104"><a href="#local-6989586621679036104"><span class="hs-identifier">loc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">srcLocFile</span><span> </span><a href="#local-6989586621679036104"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcLocStartLine</span><span> </span><a href="#local-6989586621679036104"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- | Converts test execution counts to a string.</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-identifier">showCounts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-105"></a><a name="showCounts"><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier">showCounts</span></a></a><span> </span><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-var">Counts</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">cases</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679036105"><a href="#local-6989586621679036105"><span class="hs-identifier">cases'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tried</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679036106"><a href="#local-6989586621679036106"><span class="hs-identifier">tried'</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>                   </span><span class="hs-identifier">errors</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679036107"><a href="#local-6989586621679036107"><span class="hs-identifier">errors'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">failures</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679036108"><a href="#local-6989586621679036108"><span class="hs-identifier">failures'</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-string">&quot;Cases: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679036105"><span class="hs-identifier hs-var">cases'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;  Tried: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679036106"><span class="hs-identifier hs-var">tried'</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-108"></a><span>  </span><span class="hs-string">&quot;  Errors: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679036107"><span class="hs-identifier hs-var">errors'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;  Failures: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679036108"><span class="hs-identifier hs-var">failures'</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | Converts a test case path to a string, separating adjacent elements by</span><span>
</span><a name="line-112"></a><span class="hs-comment">--   the colon (\':\'). An element of the path is quoted (as with 'show') when</span><span>
</span><a name="line-113"></a><span class="hs-comment">--   there is potential ambiguity.</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">showPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.HUnit.Base.html#Path"><span class="hs-identifier hs-type">Path</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-116"></a><a name="showPath"><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier">showPath</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-117"></a><span class="hs-identifier">showPath</span><span> </span><a name="local-6989586621679036109"><a href="#local-6989586621679036109"><span class="hs-identifier">nodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl1</span><span> </span><a href="#local-6989586621679036110"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679036111"><span class="hs-identifier hs-var">showNode</span></a><span> </span><a href="#local-6989586621679036109"><span class="hs-identifier hs-var">nodes</span></a><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679036110"><a href="#local-6989586621679036110"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679036113"><a href="#local-6989586621679036113"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679036114"><a href="#local-6989586621679036114"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036114"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679036113"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-119"></a><span>       </span><a name="local-6989586621679036111"><a href="#local-6989586621679036111"><span class="hs-identifier">showNode</span></a></a><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Base.html#ListItem"><span class="hs-identifier hs-var">ListItem</span></a><span> </span><a name="local-6989586621679036115"><a href="#local-6989586621679036115"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679036115"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-120"></a><span>       </span><span class="hs-identifier">showNode</span><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Base.html#Label"><span class="hs-identifier hs-var">Label</span></a><span> </span><a name="local-6989586621679036116"><a href="#local-6989586621679036116"><span class="hs-identifier">label</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679036112"><span class="hs-identifier hs-var">safe</span></a><span> </span><a href="#local-6989586621679036116"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679036116"><span class="hs-identifier hs-var">label</span></a><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>       </span><a name="local-6989586621679036112"><a href="#local-6989586621679036112"><span class="hs-identifier">safe</span></a></a><span> </span><a name="local-6989586621679036117"><a href="#local-6989586621679036117"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679036118"><a href="#local-6989586621679036118"><span class="hs-identifier">ss</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-char">':'</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679036117"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679036117"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679036118"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679036118"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679036117"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- | Provides the \&quot;standard\&quot; text-based test controller. Reporting is made to</span><span>
</span><a name="line-125"></a><span class="hs-comment">--   standard error, and progress reports are included. For possible</span><span>
</span><a name="line-126"></a><span class="hs-comment">--   programmatic use, the final counts are returned.</span><span>
</span><a name="line-127"></a><span class="hs-comment">--</span><span>
</span><a name="line-128"></a><span class="hs-comment">--   The \&quot;TT\&quot; in the name suggests \&quot;Text-based reporting to the Terminal\&quot;.</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-identifier">runTestTT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.HUnit.Base.html#Test"><span class="hs-identifier hs-type">Test</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a><span>
</span><a name="line-131"></a><a name="runTestTT"><a href="Test.HUnit.Text.html#runTestTT"><span class="hs-identifier">runTestTT</span></a></a><span> </span><a name="local-6989586621679036119"><a href="#local-6989586621679036119"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679036218"><a href="#local-6989586621679036218"><span class="hs-identifier">counts'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier hs-var">runTestText</span></a><span> </span><span class="hs-special">(</span><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier hs-var">putTextToHandle</span></a><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679036119"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-132"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679036218"><span class="hs-identifier hs-var">counts'</span></a><span>
</span><a name="line-133"></a></pre></body></html>