<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Core types and definitions</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving, FlexibleContexts,
             ExistentialQuantification, RankNTypes, DeriveDataTypeable,
             DeriveGeneric #-}</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test</span><span class="hs-operator">.</span><span class="hs-identifier">Tasty</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Tasty.Options.html"><span class="hs-identifier">Test</span><span class="hs-operator">.</span><span class="hs-identifier">Tasty</span><span class="hs-operator">.</span><span class="hs-identifier">Options</span></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Tasty.Patterns.html"><span class="hs-identifier">Test</span><span class="hs-operator">.</span><span class="hs-identifier">Tasty</span><span class="hs-operator">.</span><span class="hs-identifier">Patterns</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Tagged</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Generics</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>  </span><span class="hs-comment">-- Silence AMP and FTP import warnings</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Printf</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-comment">-- | If a test failed, 'FailureReason' describes why</span><span>
</span><a name="line-20"></a><span class="hs-keyword">data</span><span> </span><a name="FailureReason"><a href="Test.Tasty.Core.html#FailureReason"><span class="hs-identifier">FailureReason</span></a></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TestFailed"><a href="Test.Tasty.Core.html#TestFailed"><span class="hs-identifier">TestFailed</span></a></a><span>
</span><a name="line-22"></a><span>    </span><span class="hs-comment">-- ^ test provider indicated failure of the code to test, either because</span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-comment">-- the tested code returned wrong results, or raised an exception</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TestThrewException"><a href="Test.Tasty.Core.html#TestThrewException"><span class="hs-identifier">TestThrewException</span></a></a><span> </span><span class="hs-identifier hs-type">SomeException</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- ^ the test code itself raised an exception. Typical cases include missing</span><span>
</span><a name="line-26"></a><span>    </span><span class="hs-comment">-- example input or output files.</span><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-comment">-- Usually, providers do not have to implement this, as their 'run' method</span><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- may simply raise an exception.</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TestTimedOut"><a href="Test.Tasty.Core.html#TestTimedOut"><span class="hs-identifier">TestTimedOut</span></a></a><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-31"></a><span>    </span><span class="hs-comment">-- ^ test didn't complete in allotted time</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">-- | Outcome of a test run</span><span>
</span><a name="line-35"></a><span class="hs-comment">--</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- Note: this is isomorphic to @'Maybe' 'FailureReason'@. You can use the</span><span>
</span><a name="line-37"></a><span class="hs-comment">-- @generic-maybe@ package to exploit that.</span><span>
</span><a name="line-38"></a><span class="hs-keyword">data</span><span> </span><a name="Outcome"><a href="Test.Tasty.Core.html#Outcome"><span class="hs-identifier">Outcome</span></a></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Success"><a href="Test.Tasty.Core.html#Success"><span class="hs-identifier">Success</span></a></a><span> </span><span class="hs-comment">-- ^ test succeeded</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Failure"><a href="Test.Tasty.Core.html#Failure"><span class="hs-identifier">Failure</span></a></a><span> </span><a href="Test.Tasty.Core.html#FailureReason"><span class="hs-identifier hs-type">FailureReason</span></a><span> </span><span class="hs-comment">-- ^ test failed because of the 'FailureReason'</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Time in seconds. Used to measure how long the tests took to run.</span><span>
</span><a name="line-44"></a><span class="hs-keyword">type</span><span> </span><a name="Time"><a href="Test.Tasty.Core.html#Time"><span class="hs-identifier">Time</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-comment">-- | A test result</span><span>
</span><a name="line-47"></a><span class="hs-keyword">data</span><span> </span><a name="Result"><a href="Test.Tasty.Core.html#Result"><span class="hs-identifier">Result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Result"><a href="Test.Tasty.Core.html#Result"><span class="hs-identifier">Result</span></a></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="resultOutcome"><a href="Test.Tasty.Core.html#resultOutcome"><span class="hs-identifier">resultOutcome</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Core.html#Outcome"><span class="hs-identifier hs-type">Outcome</span></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">-- ^ Did the test fail? If so, why?</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="resultDescription"><a href="Test.Tasty.Core.html#resultDescription"><span class="hs-identifier">resultDescription</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- ^</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-comment">-- 'resultDescription' may contain some details about the test. For</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-comment">-- a passed test it's ok to leave it empty. Providers like SmallCheck and</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-comment">-- QuickCheck use it to provide information about how many tests were</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-comment">-- generated.</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-comment">-- For a failed test, 'resultDescription' should typically provide more</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-comment">-- information about the failure.</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="resultShortDescription"><a href="Test.Tasty.Core.html#resultShortDescription"><span class="hs-identifier">resultShortDescription</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-comment">-- ^ The short description printed in the test run summary, usually @OK@ or</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-comment">-- @FAIL@.</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="resultTime"><a href="Test.Tasty.Core.html#resultTime"><span class="hs-identifier">resultTime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Core.html#Time"><span class="hs-identifier hs-type">Time</span></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-comment">-- ^ How long it took to run the test, in seconds.</span><span>
</span><a name="line-64"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- | 'True' for a passed test, 'False' for a failed one.</span><span>
</span><a name="line-67"></a><span class="hs-identifier">resultSuccessful</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Core.html#Result"><span class="hs-identifier hs-type">Result</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-68"></a><a name="resultSuccessful"><a href="Test.Tasty.Core.html#resultSuccessful"><span class="hs-identifier">resultSuccessful</span></a></a><span> </span><a name="local-6989586621679059324"><a href="#local-6989586621679059324"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">resultOutcome</span><span> </span><a href="#local-6989586621679059324"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-70"></a><span>    </span><a href="Test.Tasty.Core.html#Success"><span class="hs-identifier hs-var">Success</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-71"></a><span>    </span><a href="Test.Tasty.Core.html#Failure"><span class="hs-identifier hs-var">Failure</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Shortcut for creating a 'Result' that indicates exception</span><span>
</span><a name="line-74"></a><span class="hs-identifier">exceptionResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SomeException</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#Result"><span class="hs-identifier hs-type">Result</span></a><span>
</span><a name="line-75"></a><a name="exceptionResult"><a href="Test.Tasty.Core.html#exceptionResult"><span class="hs-identifier">exceptionResult</span></a></a><span> </span><a name="local-6989586621679059325"><a href="#local-6989586621679059325"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Core.html#Result"><span class="hs-identifier hs-var">Result</span></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">resultOutcome</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Core.html#Failure"><span class="hs-identifier hs-var">Failure</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Tasty.Core.html#TestThrewException"><span class="hs-identifier hs-var">TestThrewException</span></a><span> </span><a href="#local-6989586621679059325"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-77"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resultDescription</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Exception: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679059325"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-78"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resultShortDescription</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;FAIL&quot;</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resultTime</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- | Test progress information.</span><span>
</span><a name="line-83"></a><span class="hs-comment">--</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- This may be used by a runner to provide some feedback to the user while</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- a long-running test is executing.</span><span>
</span><a name="line-86"></a><span class="hs-keyword">data</span><span> </span><a name="Progress"><a href="Test.Tasty.Core.html#Progress"><span class="hs-identifier">Progress</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Progress"><a href="Test.Tasty.Core.html#Progress"><span class="hs-identifier">Progress</span></a></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="progressText"><a href="Test.Tasty.Core.html#progressText"><span class="hs-identifier">progressText</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-comment">-- ^ textual information about the test's progress</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="progressPercent"><a href="Test.Tasty.Core.html#progressPercent"><span class="hs-identifier">progressPercent</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-comment">-- ^</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-comment">-- 'progressPercent' should be a value between 0 and 1. If it's impossible</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-comment">-- to compute the estimate, use 0.</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | The interface to be implemented by a test provider.</span><span>
</span><a name="line-96"></a><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- The type @t@ is the concrete representation of the test which is used by</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- the provider.</span><span>
</span><a name="line-99"></a><span class="hs-keyword">class</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679059319"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="IsTest"><a href="Test.Tasty.Core.html#IsTest"><span class="hs-identifier">IsTest</span></a></a><span> </span><a name="local-6989586621679059319"><a href="#local-6989586621679059319"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-comment">-- | Run the test</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-comment">-- This method should cleanly catch any exceptions in the code to test, and</span><span>
</span><a name="line-103"></a><span>  </span><span class="hs-comment">-- return them as part of the 'Result', see 'FailureReason' for an</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-comment">-- explanation. It is ok for 'run' to raise an exception if there is a</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-comment">-- problem with the test suite code itself (for example, if a file that</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-comment">-- should contain example data or expected output is not found).</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-identifier">run</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span> </span><span class="hs-comment">-- ^ options</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059319"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-comment">-- ^ the test to run</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Core.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ a callback to report progress</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Test.Tasty.Core.html#Result"><span class="hs-identifier hs-type">Result</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>  </span><span class="hs-comment">-- | The list of options that affect execution of tests of this type</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier">testOptions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679059319"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Options.html#OptionDescription"><span class="hs-identifier hs-type">OptionDescription</span></a><span class="hs-special">]</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | The name of a test or a group of tests</span><span>
</span><a name="line-117"></a><span class="hs-keyword">type</span><span> </span><a name="TestName"><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier">TestName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">-- | 'ResourceSpec' describes how to acquire a resource (the first field)</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- and how to release it (the second field).</span><span>
</span><a name="line-121"></a><span class="hs-keyword">data</span><span> </span><a name="ResourceSpec"><a href="Test.Tasty.Core.html#ResourceSpec"><span class="hs-identifier">ResourceSpec</span></a></a><span> </span><a name="local-6989586621679059318"><a href="#local-6989586621679059318"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ResourceSpec"><a href="Test.Tasty.Core.html#ResourceSpec"><span class="hs-identifier">ResourceSpec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679059318"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059318"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | A resources-related exception</span><span>
</span><a name="line-124"></a><span class="hs-keyword">data</span><span> </span><a name="ResourceError"><a href="Test.Tasty.Core.html#ResourceError"><span class="hs-identifier">ResourceError</span></a></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NotRunningTests"><a href="Test.Tasty.Core.html#NotRunningTests"><span class="hs-identifier">NotRunningTests</span></a></a><span>
</span><a name="line-126"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnexpectedState"><a href="Test.Tasty.Core.html#UnexpectedState"><span class="hs-identifier">UnexpectedState</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UseOutsideOfTest"><a href="Test.Tasty.Core.html#UseOutsideOfTest"><span class="hs-identifier">UseOutsideOfTest</span></a></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Test.Tasty.Core.html#ResourceError"><span class="hs-identifier hs-type">ResourceError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-131"></a><span>  </span><a name="local-8214565720323784865"><span class="hs-identifier">show</span></a><span> </span><a href="Test.Tasty.Core.html#NotRunningTests"><span class="hs-identifier hs-var">NotRunningTests</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-string">&quot;Unhandled resource. Probably a bug in the runner you're using.&quot;</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Core.html#UnexpectedState"><span class="hs-identifier hs-var">UnexpectedState</span></a><span> </span><a name="local-6989586621679059320"><a href="#local-6989586621679059320"><span class="hs-identifier">where_</span></a></a><span> </span><a name="local-6989586621679059321"><a href="#local-6989586621679059321"><span class="hs-identifier">what</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-identifier hs-var">printf</span><span> </span><span class="hs-string">&quot;Unexpected state of the resource (%s) in %s. Report as a tasty bug.&quot;</span><span>
</span><a name="line-135"></a><span>      </span><a href="#local-6989586621679059321"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="#local-6989586621679059320"><span class="hs-identifier hs-var">where_</span></a><span>
</span><a name="line-136"></a><span>  </span><span class="hs-identifier">show</span><span> </span><a href="Test.Tasty.Core.html#UseOutsideOfTest"><span class="hs-identifier hs-var">UseOutsideOfTest</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-string">&quot;It looks like you're attempting to use a resource outside of its test. Don't do that!&quot;</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="Test.Tasty.Core.html#ResourceError"><span class="hs-identifier hs-type">ResourceError</span></a><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- | The main data structure defining a test suite.</span><span>
</span><a name="line-142"></a><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- It consists of individual test cases and properties, organized in named</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- groups which form a tree-like hierarchy.</span><span>
</span><a name="line-145"></a><span class="hs-comment">--</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- There is no generic way to create a test case. Instead, every test</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- provider (tasty-hunit, tasty-smallcheck etc.) provides a function to</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- turn a test case into a 'TestTree'.</span><span>
</span><a name="line-149"></a><span class="hs-comment">--</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- Groups can be created using 'testGroup'.</span><span>
</span><a name="line-151"></a><span class="hs-keyword">data</span><span> </span><a name="TestTree"><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier">TestTree</span></a></a><span>
</span><a name="line-152"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679059316"><a href="#local-6989586621679059316"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="Test.Tasty.Core.html#IsTest"><span class="hs-identifier hs-type">IsTest</span></a><span> </span><a href="#local-6989586621679059316"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="SingleTest"><a href="Test.Tasty.Core.html#SingleTest"><span class="hs-identifier">SingleTest</span></a></a><span> </span><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier hs-type">TestName</span></a><span> </span><a href="#local-6989586621679059316"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-comment">-- ^ A single test of some particular type</span><span>
</span><a name="line-154"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TestGroup"><a href="Test.Tasty.Core.html#TestGroup"><span class="hs-identifier">TestGroup</span></a></a><span> </span><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier hs-type">TestName</span></a><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span class="hs-special">]</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-comment">-- ^ Assemble a number of tests into a cohesive group</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PlusTestOptions"><a href="Test.Tasty.Core.html#PlusTestOptions"><span class="hs-identifier">PlusTestOptions</span></a></a><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span class="hs-special">)</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span>
</span><a name="line-157"></a><span>    </span><span class="hs-comment">-- ^ Add some options to child tests</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679059317"><a href="#local-6989586621679059317"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a name="WithResource"><a href="Test.Tasty.Core.html#WithResource"><span class="hs-identifier">WithResource</span></a></a><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Core.html#ResourceSpec"><span class="hs-identifier hs-type">ResourceSpec</span></a><span> </span><a href="#local-6989586621679059317"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679059317"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-comment">-- ^ Acquire the resource before the tests in the inner tree start and</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-comment">-- release it after they finish. The tree gets an `IO` action which</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-comment">-- yields the resource, although the resource is shared across all the</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-comment">-- tests.</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AskOptions"><a href="Test.Tasty.Core.html#AskOptions"><span class="hs-identifier">AskOptions</span></a></a><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-comment">-- ^ Ask for the options and customize the tests based on them</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- | Create a named group of test cases or other groups</span><span>
</span><a name="line-167"></a><span class="hs-identifier">testGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier hs-type">TestName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span>
</span><a name="line-168"></a><a name="testGroup"><a href="Test.Tasty.Core.html#testGroup"><span class="hs-identifier">testGroup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Core.html#TestGroup"><span class="hs-identifier hs-var">TestGroup</span></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- | An algebra for folding a `TestTree`.</span><span>
</span><a name="line-171"></a><span class="hs-comment">--</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- Instead of constructing fresh records, build upon `trivialFold`</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- instead. This way your code won't break when new nodes/fields are</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- indroduced.</span><span>
</span><a name="line-175"></a><span class="hs-keyword">data</span><span> </span><a name="TreeFold"><a href="Test.Tasty.Core.html#TreeFold"><span class="hs-identifier">TreeFold</span></a></a><span> </span><a name="local-6989586621679059313"><a href="#local-6989586621679059313"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TreeFold"><a href="Test.Tasty.Core.html#TreeFold"><span class="hs-identifier">TreeFold</span></a></a><span>
</span><a name="line-176"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="foldSingle"><a href="Test.Tasty.Core.html#foldSingle"><span class="hs-identifier">foldSingle</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679059314"><a href="#local-6989586621679059314"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="Test.Tasty.Core.html#IsTest"><span class="hs-identifier hs-type">IsTest</span></a><span> </span><a href="#local-6989586621679059314"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier hs-type">TestName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059314"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059313"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-177"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="foldGroup"><a href="Test.Tasty.Core.html#foldGroup"><span class="hs-identifier">foldGroup</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Core.html#TestName"><span class="hs-identifier hs-type">TestName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059313"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059313"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="foldResource"><a href="Test.Tasty.Core.html#foldResource"><span class="hs-identifier">foldResource</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679059315"><a href="#local-6989586621679059315"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="Test.Tasty.Core.html#ResourceSpec"><span class="hs-identifier hs-type">ResourceSpec</span></a><span> </span><a href="#local-6989586621679059315"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679059315"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059313"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059313"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | 'trivialFold' can serve as the basis for custom folds. Just override</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- the fields you need.</span><span>
</span><a name="line-183"></a><span class="hs-comment">--</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- Here's what it does:</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- * single tests are mapped to `mempty` (you probably do want to override that)</span><span>
</span><a name="line-187"></a><span class="hs-comment">--</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- * test groups are returned unmodified</span><span>
</span><a name="line-189"></a><span class="hs-comment">--</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- * for a resource, an IO action that throws an exception is passed (you</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- want to override this for runners/ingredients that execute tests)</span><span>
</span><a name="line-192"></a><span class="hs-identifier">trivialFold</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679059323"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Test.Tasty.Core.html#TreeFold"><span class="hs-identifier hs-type">TreeFold</span></a><span> </span><a href="#local-6989586621679059323"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-193"></a><a name="trivialFold"><a href="Test.Tasty.Core.html#trivialFold"><span class="hs-identifier">trivialFold</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Core.html#TreeFold"><span class="hs-identifier hs-var">TreeFold</span></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">foldSingle</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">foldGroup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">foldResource</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059326"><a href="#local-6989586621679059326"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059326"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><a href="Test.Tasty.Core.html#NotRunningTests"><span class="hs-identifier hs-var">NotRunningTests</span></a><span>
</span><a name="line-197"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- | Fold a test tree into a single value.</span><span>
</span><a name="line-200"></a><span class="hs-comment">--</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- The fold result type should be a monoid. This is used to fold multiple</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- results in a test group. In particular, empty groups get folded into 'mempty'.</span><span>
</span><a name="line-203"></a><span class="hs-comment">--</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- Apart from pure convenience, this function also does the following</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- useful things:</span><span>
</span><a name="line-206"></a><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- 1. Keeping track of the current options (which may change due to</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- `PlusTestOptions` nodes)</span><span>
</span><a name="line-209"></a><span class="hs-comment">--</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- 2. Filtering out the tests which do not match the patterns</span><span>
</span><a name="line-211"></a><span class="hs-comment">--</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- Thus, it is preferred to an explicit recursive traversal of the tree.</span><span>
</span><a name="line-213"></a><span class="hs-comment">--</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- Note: right now, the patterns are looked up only once, and won't be</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- affected by the subsequent option changes. This shouldn't be a problem</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- in practice; OTOH, this behaviour may be changed later.</span><span>
</span><a name="line-217"></a><span class="hs-identifier">foldTestTree</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679059322"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Test.Tasty.Core.html#TreeFold"><span class="hs-identifier hs-type">TreeFold</span></a><span> </span><a href="#local-6989586621679059322"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-220"></a><span>     </span><span class="hs-comment">-- ^ the algebra (i.e. how to fold a tree)</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Options.html#OptionSet"><span class="hs-identifier hs-type">OptionSet</span></a><span>
</span><a name="line-222"></a><span>     </span><span class="hs-comment">-- ^ initial options</span><span>
</span><a name="line-223"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span>
</span><a name="line-224"></a><span>     </span><span class="hs-comment">-- ^ the tree to fold</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059322"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-226"></a><a name="foldTestTree"><a href="Test.Tasty.Core.html#foldTestTree"><span class="hs-identifier">foldTestTree</span></a></a><span> </span><span class="hs-special">(</span><a href="Test.Tasty.Core.html#TreeFold"><span class="hs-identifier hs-var">TreeFold</span></a><span> </span><a name="local-6989586621679059327"><a href="#local-6989586621679059327"><span class="hs-identifier">fTest</span></a></a><span> </span><a name="local-6989586621679059328"><a href="#local-6989586621679059328"><span class="hs-identifier">fGroup</span></a></a><span> </span><a name="local-6989586621679059329"><a href="#local-6989586621679059329"><span class="hs-identifier">fResource</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059330"><a href="#local-6989586621679059330"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679059331"><a href="#local-6989586621679059331"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-227"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679059347"><a href="#local-6989586621679059347"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Tasty.Options.html#lookupOption"><span class="hs-identifier hs-var">lookupOption</span></a><span> </span><a href="#local-6989586621679059330"><span class="hs-identifier hs-var">opts</span></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679059332"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679059347"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679059330"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679059331"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-229"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-230"></a><span>    </span><a name="local-6989586621679059332"><a href="#local-6989586621679059332"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679059333"><a href="#local-6989586621679059333"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679059334"><a href="#local-6989586621679059334"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679059335"><a href="#local-6989586621679059335"><span class="hs-identifier">opts</span></a></a><span> </span><a name="local-6989586621679059336"><a href="#local-6989586621679059336"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-231"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679059336"><span class="hs-identifier hs-var">tree</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-232"></a><span>        </span><a href="Test.Tasty.Core.html#SingleTest"><span class="hs-identifier hs-var">SingleTest</span></a><span> </span><a name="local-6989586621679059337"><a href="#local-6989586621679059337"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679059338"><a href="#local-6989586621679059338"><span class="hs-identifier">test</span></a></a><span>
</span><a name="line-233"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Test.Tasty.Patterns.html#testPatternMatches"><span class="hs-identifier hs-var">testPatternMatches</span></a><span> </span><a href="#local-6989586621679059333"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059334"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679059337"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059327"><span class="hs-identifier hs-var">fTest</span></a><span> </span><a href="#local-6989586621679059335"><span class="hs-identifier hs-var">opts</span></a><span> </span><a href="#local-6989586621679059337"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679059338"><span class="hs-identifier hs-var">test</span></a><span>
</span><a name="line-235"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-236"></a><span>        </span><a href="Test.Tasty.Core.html#TestGroup"><span class="hs-identifier hs-var">TestGroup</span></a><span> </span><a name="local-6989586621679059339"><a href="#local-6989586621679059339"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679059340"><a href="#local-6989586621679059340"><span class="hs-identifier">trees</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-237"></a><span>          </span><a href="#local-6989586621679059328"><span class="hs-identifier hs-var">fGroup</span></a><span> </span><a href="#local-6989586621679059339"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059332"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679059333"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059334"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679059339"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059335"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059340"><span class="hs-identifier hs-var">trees</span></a><span>
</span><a name="line-238"></a><span>        </span><a href="Test.Tasty.Core.html#PlusTestOptions"><span class="hs-identifier hs-var">PlusTestOptions</span></a><span> </span><a name="local-6989586621679059341"><a href="#local-6989586621679059341"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679059342"><a href="#local-6989586621679059342"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059332"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679059333"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679059334"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059341"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679059335"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059342"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-239"></a><span>        </span><a href="Test.Tasty.Core.html#WithResource"><span class="hs-identifier hs-var">WithResource</span></a><span> </span><a name="local-6989586621679059343"><a href="#local-6989586621679059343"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-6989586621679059344"><a href="#local-6989586621679059344"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059329"><span class="hs-identifier hs-var">fResource</span></a><span> </span><a href="#local-6989586621679059343"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679059345"><a href="#local-6989586621679059345"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059332"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679059333"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679059334"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679059335"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059344"><span class="hs-identifier hs-var">tree</span></a><span> </span><a href="#local-6989586621679059345"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>        </span><a href="Test.Tasty.Core.html#AskOptions"><span class="hs-identifier hs-var">AskOptions</span></a><span> </span><a name="local-6989586621679059346"><a href="#local-6989586621679059346"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059332"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679059333"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679059334"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679059335"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059346"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679059335"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">-- | Get the list of options that are relevant for a given test tree</span><span>
</span><a name="line-243"></a><span class="hs-identifier">treeOptions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Tasty.Core.html#TestTree"><span class="hs-identifier hs-type">TestTree</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Options.html#OptionDescription"><span class="hs-identifier hs-type">OptionDescription</span></a><span class="hs-special">]</span><span>
</span><a name="line-244"></a><a name="treeOptions"><a href="Test.Tasty.Core.html#treeOptions"><span class="hs-identifier">treeOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>  </span><span class="hs-identifier hs-var">Prelude</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-247"></a><span>  </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>  </span><a href="Test.Tasty.Core.html#foldTestTree"><span class="hs-identifier hs-var">foldTestTree</span></a><span>
</span><a name="line-250"></a><span>    </span><a href="Test.Tasty.Core.html#trivialFold"><span class="hs-identifier hs-var">trivialFold</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">foldSingle</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679059348"><span class="hs-identifier hs-var">getTestOptions</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-254"></a><span>    </span><span class="hs-identifier">getTestOptions</span><span>
</span><a name="line-255"></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679059349"><a href="#local-6989586621679059349"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="Test.Tasty.Core.html#IsTest"><span class="hs-identifier hs-type">IsTest</span></a><span> </span><a href="#local-6989586621679059349"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-256"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679059349"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><span class="hs-special">[</span><a href="Test.Tasty.Options.html#OptionDescription"><span class="hs-identifier hs-type">OptionDescription</span></a><span class="hs-special">]</span><span>
</span><a name="line-257"></a><span>    </span><a name="local-6989586621679059348"><a href="#local-6989586621679059348"><span class="hs-identifier">getTestOptions</span></a></a><span> </span><a name="local-6989586621679059350"><a href="#local-6989586621679059350"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-258"></a><span>      </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeOf</span><span> </span><a href="#local-6989586621679059350"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-259"></a><span>          </span><span class="hs-identifier hs-var">witness</span><span> </span><a href="Test.Tasty.Core.html#testOptions"><span class="hs-identifier hs-var">testOptions</span></a><span> </span><a href="#local-6989586621679059350"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-260"></a></pre></body></html>