<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Criterion</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Criterion.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">criterion-1.5.5.0: Robust, reliable performance measurement and analysis</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2009-2014 Bryan O'Sullivan</td></tr><tr><th>License</th><td>BSD-style</td></tr><tr><th>Maintainer</th><td>bos@serpentine.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>GHC</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Criterion</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Benchmarkable code</a></li><li><a href="#g:2">Creating a benchmark suite</a><ul><li><a href="#g:3">Running a benchmark</a></li></ul></li><li><a href="#g:4">For interactive use</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Core benchmarking code.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Benchmarkable">Benchmarkable</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Benchmark">Benchmark</a></li><li class="src short"><a href="#v:env">env</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env =&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env -&gt; (env -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>) -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></li><li class="src short"><a href="#v:envWithCleanup">envWithCleanup</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env =&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env -&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; (env -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>) -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></li><li class="src short"><a href="#v:perBatchEnv">perBatchEnv</a> :: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b) =&gt; (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env) -&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:perBatchEnvWithCleanup">perBatchEnvWithCleanup</a> :: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b) =&gt; (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env) -&gt; (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:perRunEnv">perRunEnv</a> :: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b) =&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env -&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:perRunEnvWithCleanup">perRunEnvWithCleanup</a> :: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b) =&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env -&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:toBenchmarkable">toBenchmarkable</a> :: (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:bench">bench</a> :: <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></li><li class="src short"><a href="#v:bgroup">bgroup</a> :: <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; [<a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>] -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></li><li class="src short"><a href="#v:nf">nf</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b =&gt; (a -&gt; b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:whnf">whnf</a> :: (a -&gt; b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:nfIO">nfIO</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> a =&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:whnfIO">whnfIO</a> :: <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:nfAppIO">nfAppIO</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b =&gt; (a -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:whnfAppIO">whnfAppIO</a> :: (a -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></li><li class="src short"><a href="#v:benchmark">benchmark</a> :: <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:benchmarkWith">benchmarkWith</a> :: <a href="Criterion-Types.html#t:Config" title="Criterion.Types">Config</a> -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:benchmark-39-">benchmark'</a> :: <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Criterion-Types.html#t:Report" title="Criterion.Types">Report</a></li><li class="src short"><a href="#v:benchmarkWith-39-">benchmarkWith'</a> :: <a href="Criterion-Types.html#t:Config" title="Criterion.Types">Config</a> -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Criterion-Types.html#t:Report" title="Criterion.Types">Report</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Benchmarkable code</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Benchmarkable" class="def">Benchmarkable</a> <a href="#t:Benchmarkable" class="selflink">#</a></p><div class="doc"><p>A pure function or impure action that can be benchmarked. The
 <code><a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a></code> parameter indicates the number of times to run the given
 function or action.</p></div></div><a href="#g:2" id="g:2"><h1>Creating a benchmark suite</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Benchmark" class="def">Benchmark</a> <a href="#t:Benchmark" class="selflink">#</a></p><div class="doc"><p>Specification of a collection of benchmarks and environments. A
 benchmark may consist of:</p><ul><li>An environment that creates input data for benchmarks, created
   with <code><a href="Criterion.html#v:env" title="Criterion">env</a></code>.</li><li>A single <code><a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></code> item with a name, created with <code><a href="Criterion.html#v:bench" title="Criterion">bench</a></code>.</li><li>A (possibly nested) group of <code><a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></code>s, created with <code><a href="Criterion.html#v:bgroup" title="Criterion">bgroup</a></code>.</li></ul></div><div class="subs instances"><details id="i:Benchmark" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Benchmark:Show:1"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Benchmark:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="../criterion-measurement-0.1.1.0/Criterion-Measurement-Types.html">Criterion.Measurement.Types</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:env" class="def">env</a> <a href="#v:env" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env</td><td class="doc"><p>Create the environment.  The environment will be evaluated to
 normal form before being passed to the benchmark.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>)</td><td class="doc"><p>Take the newly created environment and make it available to
 the given benchmarks.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Run a benchmark (or collection of benchmarks) in the given
 environment.  The purpose of an environment is to lazily create
 input data to pass to the functions that will be benchmarked.</p><p>A common example of environment data is input that is read from a
 file.  Another is a large data structure constructed in-place.</p><p><strong>Motivation.</strong> In earlier versions of criterion, all benchmark
 inputs were always created when a program started running.  By
 deferring the creation of an environment when its associated
 benchmarks need the its, we avoid two problems that this strategy
 caused:</p><ul><li>Memory pressure distorted the results of unrelated benchmarks.
   If one benchmark needed e.g. a gigabyte-sized input, it would
   force the garbage collector to do extra work when running some
   other benchmark that had no use for that input.  Since the data
   created by an environment is only available when it is in scope,
   it should be garbage collected before other benchmarks are run.</li><li>The time cost of generating all needed inputs could be
   significant in cases where no inputs (or just a few) were really
   needed.  This occurred often, for instance when just one out of a
   large suite of benchmarks was run, or when a user would list the
   collection of benchmarks without running any.</li></ul><p><strong>Creation.</strong> An environment is created right before its related
 benchmarks are run.  The <code><a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a></code> action that creates the environment
 is run, then the newly created environment is evaluated to normal
 form (hence the <code><a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a></code> constraint) before being passed to the
 function that receives the environment.</p><p><strong>Complex environments.</strong> If you need to create an environment that
 contains multiple values, simply pack the values into a tuple.</p><p><strong>Lazy pattern matching.</strong> In situations where a &quot;real&quot;
 environment is not needed, e.g. if a list of benchmark names is
 being generated, a value which throws an exception will be passed
 to the function that receives the environment.  This avoids the
 overhead of generating an environment that will not actually be
 used.</p><p>The function that receives the environment must use lazy pattern
 matching to deconstruct the tuple (e.g., <code>~(x, y)</code>, not <code>(x, y)</code>),
 as use of strict pattern matching will cause a crash if an
 exception-throwing value is passed in.</p><p><strong>Example.</strong> This program runs benchmarks in an environment that
 contains two values.  The first value is the contents of a text
 file; the second is a string.  Pay attention to the use of a lazy
 pattern to deconstruct the tuple in the function that returns the
 benchmarks to be run.</p><pre>setupEnv = do
  let small = replicate 1000 (1 :: Int)
  big &lt;- map length . words &lt;$&gt; readFile &quot;/usr/dict/words&quot;
  return (small, big)

main = defaultMain [
   -- notice the lazy pattern match here!
   env setupEnv $ \ ~(small,big) -&gt; bgroup &quot;main&quot; [
   bgroup &quot;small&quot; [
     bench &quot;length&quot; $ whnf length small
   , bench &quot;length . filter&quot; $ whnf (length . filter (==1)) small
   ]
 ,  bgroup &quot;big&quot; [
     bench &quot;length&quot; $ whnf length big
   , bench &quot;length . filter&quot; $ whnf (length . filter (==1)) big
   ]
 ] ]</pre><p><strong>Discussion.</strong> The environment created in the example above is
 intentionally <em>not</em> ideal.  As Haskell's scoping rules suggest, the
 variable <code>big</code> is in scope for the benchmarks that use only
 <code>small</code>.  It would be better to create a separate environment for
 <code>big</code>, so that it will not be kept alive while the unrelated
 benchmarks are being run.</p></div></div><div class="top"><p class="src"><a id="v:envWithCleanup" class="def">envWithCleanup</a> <a href="#v:envWithCleanup" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env</td><td class="doc"><p>Create the environment.  The environment will be evaluated to
 normal form before being passed to the benchmark.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</td><td class="doc"><p>Clean up the created environment.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>)</td><td class="doc"><p>Take the newly created environment and make it available to
 the given benchmarks.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Same as <code><a href="Criterion.html#v:env" title="Criterion">env</a></code>, but but allows for an additional callback
 to clean up the environment. Resource clean up is exception safe, that is,
 it runs even if the <code><a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></code> throws an exception.</p></div></div><div class="top"><p class="src"><a id="v:perBatchEnv" class="def">perBatchEnv</a> <a href="#v:perBatchEnv" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env)</td><td class="doc"><p>Create an environment for a batch of N runs. The environment will be
 evaluated to normal form before running.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b)</td><td class="doc"><p>Function returning the IO action that should be benchmarked with the
 newly generated environment.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a Benchmarkable where a fresh environment is allocated for every
 batch of runs of the benchmarkable.</p><p>The environment is evaluated to normal form before the benchmark is run.</p><p>When using <code><a href="Criterion.html#v:whnf" title="Criterion">whnf</a></code>, <code><a href="Criterion.html#v:whnfIO" title="Criterion">whnfIO</a></code>, etc. Criterion creates a <code><a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></code>
 whichs runs a batch of <code>N</code> repeat runs of that expressions. Criterion may
 run any number of these batches to get accurate measurements. Environments
 created by <code><a href="Criterion.html#v:env" title="Criterion">env</a></code> and <code><a href="Criterion.html#v:envWithCleanup" title="Criterion">envWithCleanup</a></code>, are shared across all these batches
 of runs.</p><p>This is fine for simple benchmarks on static input, but when benchmarking
 IO operations where these operations can modify (and especially grow) the
 environment this means that later batches might have their accuracy effected
 due to longer, for example, longer garbage collection pauses.</p><p>An example: Suppose we want to benchmark writing to a Chan, if we allocate
 the Chan using environment and our benchmark consists of <code>writeChan env ()</code>,
 the contents and thus size of the Chan will grow with every repeat. If
 Criterion runs a 1,000 batches of 1,000 repeats, the result is that the
 channel will have 999,000 items in it by the time the last batch is run.
 Since GHC GC has to copy the live set for every major GC this means our last
 set of writes will suffer a lot of noise of the previous repeats.</p><p>By allocating a fresh environment for every batch of runs this function
 should eliminate this effect.</p></div></div><div class="top"><p class="src"><a id="v:perBatchEnvWithCleanup" class="def">perBatchEnvWithCleanup</a> <a href="#v:perBatchEnvWithCleanup" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env)</td><td class="doc"><p>Create an environment for a batch of N runs. The environment will be
 evaluated to normal form before running.</p></td></tr><tr><td class="src">-&gt; (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</td><td class="doc"><p>Clean up the created environment.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b)</td><td class="doc"><p>Function returning the IO action that should be benchmarked with the
 newly generated environment.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Same as <code><a href="Criterion.html#v:perBatchEnv" title="Criterion">perBatchEnv</a></code>, but but allows for an additional callback
 to clean up the environment. Resource clean up is exception safe, that is,
 it runs even if the <code><a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></code> throws an exception.</p></div></div><div class="top"><p class="src"><a id="v:perRunEnv" class="def">perRunEnv</a> <a href="#v:perRunEnv" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env</td><td class="doc"><p>Action that creates the environment for a single run.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b)</td><td class="doc"><p>Function returning the IO action that should be benchmarked with the
 newly genereted environment.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a Benchmarkable where a fresh environment is allocated for every
 run of the operation to benchmark. This is useful for benchmarking mutable
 operations that need a fresh environment, such as sorting a mutable Vector.</p><p>As with <code><a href="Criterion.html#v:env" title="Criterion">env</a></code> and <code><a href="Criterion.html#v:perBatchEnv" title="Criterion">perBatchEnv</a></code> the environment is evaluated to normal form
 before the benchmark is run.</p><p>This introduces extra noise and result in reduce accuracy compared to other
 Criterion benchmarks. But allows easier benchmarking for mutable operations
 than was previously possible.</p></div></div><div class="top"><p class="src"><a id="v:perRunEnvWithCleanup" class="def">perRunEnvWithCleanup</a> <a href="#v:perRunEnvWithCleanup" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> env, <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> env</td><td class="doc"><p>Action that creates the environment for a single run.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</td><td class="doc"><p>Clean up the created environment.</p></td></tr><tr><td class="src">-&gt; (env -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b)</td><td class="doc"><p>Function returning the IO action that should be benchmarked with the
 newly genereted environment.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Same as <code><a href="Criterion.html#v:perRunEnv" title="Criterion">perRunEnv</a></code>, but but allows for an additional callback
 to clean up the environment. Resource clean up is exception safe, that is,
 it runs even if the <code><a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></code> throws an exception.</p></div></div><div class="top"><p class="src"><a id="v:toBenchmarkable" class="def">toBenchmarkable</a> :: (<a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:toBenchmarkable" class="selflink">#</a></p><div class="doc"><p>Construct a <code><a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></code> value from an impure action, where the <code><a href="../base-4.12.0.0/Data-Int.html#t:Int64" title="Data.Int">Int64</a></code>
 parameter indicates the number of times to run the action.</p></div></div><div class="top"><p class="src"><a id="v:bench" class="def">bench</a> <a href="#v:bench" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>A name to identify the benchmark.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a></td><td class="doc"><p>An activity to be benchmarked.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a single benchmark.</p></div></div><div class="top"><p class="src"><a id="v:bgroup" class="def">bgroup</a> <a href="#v:bgroup" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>A name to identify the group of benchmarks.</p></td></tr><tr><td class="src">-&gt; [<a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a>]</td><td class="doc"><p>Benchmarks to group under this name.</p></td></tr><tr><td class="src">-&gt; <a href="Criterion.html#t:Benchmark" title="Criterion">Benchmark</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Group several benchmarks together under a common name.</p></div></div><a href="#g:3" id="g:3"><h2>Running a benchmark</h2></a><div class="top"><p class="src"><a id="v:nf" class="def">nf</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b =&gt; (a -&gt; b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:nf" class="selflink">#</a></p><div class="doc"><p>Apply an argument to a function, and evaluate the result to
 normal form (NF).</p></div></div><div class="top"><p class="src"><a id="v:whnf" class="def">whnf</a> :: (a -&gt; b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:whnf" class="selflink">#</a></p><div class="doc"><p>Apply an argument to a function, and evaluate the result to weak
 head normal form (WHNF).</p></div></div><div class="top"><p class="src"><a id="v:nfIO" class="def">nfIO</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> a =&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:nfIO" class="selflink">#</a></p><div class="doc"><p>Perform an action, then evaluate its result to normal form (NF).
 This is particularly useful for forcing a lazy <code><a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a></code> action to be
 completely performed.</p><p>If the construction of the 'IO a' value is an important factor
 in the benchmark, it is best to use <code><a href="Criterion.html#v:nfAppIO" title="Criterion">nfAppIO</a></code> instead.</p></div></div><div class="top"><p class="src"><a id="v:whnfIO" class="def">whnfIO</a> :: <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:whnfIO" class="selflink">#</a></p><div class="doc"><p>Perform an action, then evaluate its result to weak head normal
 form (WHNF).  This is useful for forcing an <code><a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a></code> action whose result
 is an expression to be evaluated down to a more useful value.</p><p>If the construction of the 'IO a' value is an important factor
 in the benchmark, it is best to use <code><a href="Criterion.html#v:whnfAppIO" title="Criterion">whnfAppIO</a></code> instead.</p></div></div><div class="top"><p class="src"><a id="v:nfAppIO" class="def">nfAppIO</a> :: <a href="../abstract-par-0.3.3/Control-Monad-Par-Class.html#t:NFData" title="Control.Monad.Par.Class">NFData</a> b =&gt; (a -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:nfAppIO" class="selflink">#</a></p><div class="doc"><p>Apply an argument to a function which performs an action, then
 evaluate its result to normal form (NF).
 This function constructs the 'IO b' value on each iteration,
 similar to <code><a href="Criterion.html#v:nf" title="Criterion">nf</a></code>.
 This is particularly useful for <code><a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a></code> actions where the bulk of the
 work is not bound by IO, but by pure computations that may
 optimize away if the argument is known statically, as in <code><a href="Criterion.html#v:nfIO" title="Criterion">nfIO</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:whnfAppIO" class="def">whnfAppIO</a> :: (a -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> b) -&gt; a -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> <a href="#v:whnfAppIO" class="selflink">#</a></p><div class="doc"><p>Perform an action, then evaluate its result to weak head normal
 form (WHNF).
 This function constructs the 'IO b' value on each iteration,
 similar to <code><a href="Criterion.html#v:whnf" title="Criterion">whnf</a></code>.
 This is particularly useful for <code><a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a></code> actions where the bulk of the
 work is not bound by IO, but by pure computations that may
 optimize away if the argument is known statically, as in <code><a href="Criterion.html#v:nfIO" title="Criterion">nfIO</a></code>.</p></div></div><a href="#g:4" id="g:4"><h1>For interactive use</h1></a><div class="top"><p class="src"><a id="v:benchmark" class="def">benchmark</a> :: <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Criterion.html#benchmark" class="link">Source</a> <a href="#v:benchmark" class="selflink">#</a></p><div class="doc"><p>Run a benchmark interactively, and analyse its performance.</p></div></div><div class="top"><p class="src"><a id="v:benchmarkWith" class="def">benchmarkWith</a> :: <a href="Criterion-Types.html#t:Config" title="Criterion.Types">Config</a> -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Criterion.html#benchmarkWith" class="link">Source</a> <a href="#v:benchmarkWith" class="selflink">#</a></p><div class="doc"><p>Run a benchmark interactively, and analyse its performance.</p></div></div><div class="top"><p class="src"><a id="v:benchmark-39-" class="def">benchmark'</a> :: <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Criterion-Types.html#t:Report" title="Criterion.Types">Report</a> <a href="src/Criterion.html#benchmark%27" class="link">Source</a> <a href="#v:benchmark-39-" class="selflink">#</a></p><div class="doc"><p>Run a benchmark interactively, analyse its performance, and
 return the analysis.</p></div></div><div class="top"><p class="src"><a id="v:benchmarkWith-39-" class="def">benchmarkWith'</a> :: <a href="Criterion-Types.html#t:Config" title="Criterion.Types">Config</a> -&gt; <a href="Criterion.html#t:Benchmarkable" title="Criterion">Benchmarkable</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Criterion-Types.html#t:Report" title="Criterion.Types">Report</a> <a href="src/Criterion.html#benchmarkWith%27" class="link">Source</a> <a href="#v:benchmarkWith-39-" class="selflink">#</a></p><div class="doc"><p>Run a benchmark interactively, analyse its performance, and
 return the analysis.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>