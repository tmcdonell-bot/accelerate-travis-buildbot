<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.Array.Accelerate.LLVM.Array.Table</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Data-Array-Accelerate-LLVM-Array-Table.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Data-Array-Accelerate-LLVM-Array-Table.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">accelerate-llvm-2.0.0.0: Accelerate backend generating LLVM</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Copyright</th><td>[2014..2015] Trevor L. McDonell
               [2014..2014] Vinod Grover (NVIDIA Corporation)</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>Trevor L. McDonell &lt;tmcdonell@cse.unsw.edu.au&gt;</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>non-portable (GHC extensions)</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Array.Accelerate.LLVM.Array.Table</p></div><div id="description"><p class="caption">Description</p><div class="doc empty">&nbsp;</div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:MemoryTable">MemoryTable</a> c</li><li class="src short"><span class="keyword">type</span> <a href="#t:MallocRemote">MallocRemote</a> c a = <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (c a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FreeRemote">FreeRemote</a> c = <span class="keyword">forall</span> a. c a -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:new">new</a> :: <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:FreeRemote">FreeRemote</a> c -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c)</li><li class="src short"><a href="#v:member">member</a> :: (ArrayElt e, ArrayPtrs e ~ <a href="../base-4.8.2.0/Foreign-Ptr.html#t:Ptr">Ptr</a> a) =&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; ArrayData e -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:lookup">lookup</a> :: (ArrayElt e, ArrayPtrs e ~ <a href="../base-4.8.2.0/Foreign-Ptr.html#t:Ptr">Ptr</a> a, <a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b) =&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; ArrayData e -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> (c b))</li><li class="src short"><a href="#v:malloc">malloc</a> :: <span class="keyword">forall</span> c e a. (ArrayElt e, ArrayPtrs e ~ <a href="../base-4.8.2.0/Foreign-Ptr.html#t:Ptr">Ptr</a> a, <a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="../base-4.8.2.0/Foreign-Storable.html#t:Storable">Storable</a> a) =&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:FreeRemote">FreeRemote</a> c -&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MallocRemote">MallocRemote</a> c a -&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; ArrayData e -&gt; <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (c a)</li><li class="src short"><a href="#v:cleanup">cleanup</a> :: <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:FreeRemote">FreeRemote</a> c -&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:MemoryTable" class="def">MemoryTable</a> c <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#MemoryTable" class="link">Source</a></p><div class="doc"><p>The memory table is used to associate a host-side Accelerate array with a
 corresponding array in on a remote target.</p><p>Old entries in the table are garbage collected from the table once the host
 array is no longer reachable on the heap. The table stores weak references to
 its entries. Once the key becomes unreachable, a finaliser will fire and
 remove this entry from the table, and further attempts to dereference the
 weak pointer will fail.</p><p>PRECONDITION: The underlying Accelerate array is pinned.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:MallocRemote" class="def">MallocRemote</a> c a = <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (c a) <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#MallocRemote" class="link">Source</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:FreeRemote" class="def">FreeRemote</a> c = <span class="keyword">forall</span> a. c a -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#FreeRemote" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:new" class="def">new</a> :: <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:FreeRemote">FreeRemote</a> c -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c) <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#new" class="link">Source</a></p><div class="doc"><p>Create a new memory table from host to remote arrays. When the structure is
 collected it will finalise all entries in the table.</p></div></div><div class="top"><p class="src"><a name="v:member" class="def">member</a> :: (ArrayElt e, ArrayPtrs e ~ <a href="../base-4.8.2.0/Foreign-Ptr.html#t:Ptr">Ptr</a> a) =&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; ArrayData e -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Bool">Bool</a> <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#member" class="link">Source</a></p><div class="doc"><p>Is the key a _valid_ member of the memory table?</p><p>Because of the possibility of collisions in the host key, this also ensures
 that the entries still refers to valid data. If not, we run the finaliser,
 which also deallocates the remote data and removes its entry from the table.
 Note that it is important for the main thread to <code><a href="../base-4.8.2.0/Control-Concurrent.html#v:yield">yield</a></code> at that point so
 that the finaliser can run immediately.</p><p>See: [Host arrays as memory table keys]</p></div></div><div class="top"><p class="src"><a name="v:lookup" class="def">lookup</a> :: (ArrayElt e, ArrayPtrs e ~ <a href="../base-4.8.2.0/Foreign-Ptr.html#t:Ptr">Ptr</a> a, <a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b) =&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; ArrayData e -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> (c b)) <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#lookup" class="link">Source</a></p><div class="doc"><p>Lookup the remote array corresponding to the given host-side array. This
 assumes that all key-value pairs in the memory table refer to valid data. If
 you are not sure, or want to check whether there is a remote array for the
 given key, use <code><a href="Data-Array-Accelerate-LLVM-Array-Table.html#v:member">member</a></code> instead.</p><p>See note: [Host arrays as memory table keys].</p></div></div><div class="top"><p class="src"><a name="v:malloc" class="def">malloc</a> :: <span class="keyword">forall</span> c e a. (ArrayElt e, ArrayPtrs e ~ <a href="../base-4.8.2.0/Foreign-Ptr.html#t:Ptr">Ptr</a> a, <a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="../base-4.8.2.0/Foreign-Storable.html#t:Storable">Storable</a> a) =&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:FreeRemote">FreeRemote</a> c -&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MallocRemote">MallocRemote</a> c a -&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; ArrayData e -&gt; <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (c a) <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#malloc" class="link">Source</a></p><div class="doc"><p>Allocate a new remote array and associate it with the given host side
 array. This will attempt to reuse an old array from the nursery if possible.</p><p>In order to increase the hit rate to the nursery, allocations are not made
 for the exact number of bytes requested, but instead rounded up to a
 chunk/page size.</p></div></div><div class="top"><p class="src"><a name="v:cleanup" class="def">cleanup</a> :: <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:FreeRemote">FreeRemote</a> c -&gt; <a href="Data-Array-Accelerate-LLVM-Array-Table.html#t:MemoryTable">MemoryTable</a> c -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/Data-Array-Accelerate-LLVM-Array-Table.html#cleanup" class="link">Source</a></p><div class="doc"><p>Cleanup the memory table in an attempt to create more free space on the
 remote device. This removes all entries from the nursery, and finalises any
 unreachable arrays.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>