<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Control.Parallel.Meta</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Control-Parallel-Meta.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Control-Parallel-Meta.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">accelerate-llvm-2.0.0.0: Accelerate backend generating LLVM</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Copyright</th><td>[2014..2015] Trevor L. McDonell
               [2014..2014] Vinod Grover (NVIDIA Corporation)</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>Trevor L. McDonell &lt;tmcdonell@cse.unsw.edu.au&gt;</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>non-portable (GHC extensions)</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Control.Parallel.Meta</p></div><div id="description"><p class="caption">Description</p><div class="doc empty">&nbsp;</div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Startup">Startup</a> = <a href="#v:Startup">Startup</a> {<ul class="subs"><li><a href="#v:runStartup">runStartup</a> :: <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:WorkSearch">WorkSearch</a> = <a href="#v:WorkSearch">WorkSearch</a> {<ul class="subs"><li><a href="#v:runWorkSearch">runWorkSearch</a> :: <a href="Control-Parallel-Meta-Worker.html#t:Worker">Worker</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> (<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Data-Range-Range.html#t:Range">Range</a>)</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Resource">Resource</a> = <a href="#v:Resource">Resource</a> {<ul class="subs"><li><a href="#v:startup">startup</a> :: <a href="Control-Parallel-Meta.html#t:Startup">Startup</a></li><li><a href="#v:workSearch">workSearch</a> :: <a href="Control-Parallel-Meta.html#t:WorkSearch">WorkSearch</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Action">Action</a> = <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:Executable">Executable</a> = <a href="#v:Executable">Executable</a> {<ul class="subs"><li><a href="#v:runExecutable">runExecutable</a> :: <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Finalise">Finalise</a> = <a href="#v:Finalise">Finalise</a> {<ul class="subs"><li><a href="#v:runFinalise">runFinalise</a> :: <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../containers-0.5.5.1/Data-Sequence.html#t:Seq">Seq</a> <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li></ul>}</li><li class="src short"><a href="#v:runParIO">runParIO</a> :: <a href="Control-Parallel-Meta.html#t:Resource">Resource</a> -&gt; <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:seqIO">seqIO</a> :: <a href="Control-Parallel-Meta.html#t:Resource">Resource</a> -&gt; <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:parIO">parIO</a> :: <a href="Control-Parallel-Meta.html#t:Resource">Resource</a> -&gt; <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Startup" class="def">Startup</a> <a href="src/Control-Parallel-Meta.html#Startup" class="link">Source</a></p><div class="doc"><p>The <code><a href="Control-Parallel-Meta.html#t:Startup">Startup</a></code> component of a <code><a href="Control-Parallel-Meta.html#t:Resource">Resource</a></code> is a callback that implements
 initialisation behaviour. For example, it might contact remote hosts, spawn
 threads, or initialise hardware such as GPUs.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Startup" class="def">Startup</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runStartup" class="def">runStartup</a> :: <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Startup" class="caption collapser" onclick="toggleSection('i:Startup')">Instances</p><div id="section.i:Startup" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Data-Monoid.html#t:Monoid">Monoid</a> <a href="Control-Parallel-Meta.html#t:Startup">Startup</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:WorkSearch" class="def">WorkSearch</a> <a href="src/Control-Parallel-Meta.html#WorkSearch" class="link">Source</a></p><div class="doc"><p>The <code><a href="Control-Parallel-Meta.html#t:WorkSearch">WorkSearch</a></code> component of a <code><a href="Control-Parallel-Meta.html#t:Resource">Resource</a></code> is a callback that responds to
 requests for work from meta-workers. The arguments to <code><a href="Control-Parallel-Meta.html#t:WorkSearch">WorkSearch</a></code> are the
 scheduler state for the current thread and a reference to all workers in the
 program.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:WorkSearch" class="def">WorkSearch</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runWorkSearch" class="def">runWorkSearch</a> :: <a href="Control-Parallel-Meta-Worker.html#t:Worker">Worker</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> (<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Data-Range-Range.html#t:Range">Range</a>)</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:WorkSearch" class="caption collapser" onclick="toggleSection('i:WorkSearch')">Instances</p><div id="section.i:WorkSearch" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Data-Monoid.html#t:Monoid">Monoid</a> <a href="Control-Parallel-Meta.html#t:WorkSearch">WorkSearch</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Resource" class="def">Resource</a> <a href="src/Control-Parallel-Meta.html#Resource" class="link">Source</a></p><div class="doc"><p>A <code><a href="Control-Parallel-Meta.html#t:Resource">Resource</a></code> provides an abstraction of heterogeneous execution resources
 that may be combined. Composition of resources is left-biased. That is, if if
 <code>resource1</code> always returns work from its <code><a href="Control-Parallel-Meta.html#t:WorkSearch">WorkSearch</a></code>, then the composed
 resource <code>resource1 &lt;&gt; resource2</code> will never request work from <code>resource2</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Resource" class="def">Resource</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:startup" class="def">startup</a> :: <a href="Control-Parallel-Meta.html#t:Startup">Startup</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:workSearch" class="def">workSearch</a> :: <a href="Control-Parallel-Meta.html#t:WorkSearch">WorkSearch</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Resource" class="caption collapser" onclick="toggleSection('i:Resource')">Instances</p><div id="section.i:Resource" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Data-Monoid.html#t:Monoid">Monoid</a> <a href="Control-Parallel-Meta.html#t:Resource">Resource</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Action" class="def">Action</a> = <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> () <a href="src/Control-Parallel-Meta.html#Action" class="link">Source</a></p><div class="doc"><p>An action to execute. The first parameters are the start and end indices of
 the range this action should process, and the final is the ID of the thread
 doing the work.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Executable" class="def">Executable</a> <a href="src/Control-Parallel-Meta.html#Executable" class="link">Source</a></p><div class="doc"><p>An <code><a href="Control-Parallel-Meta.html#t:Executable">Executable</a></code> provides a callback that can be used to run a provided
 function using an encapsulated work-stealing gang of threads.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Executable" class="def">Executable</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runExecutable" class="def">runExecutable</a> :: <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Finalise" class="def">Finalise</a> <a href="src/Control-Parallel-Meta.html#Finalise" class="link">Source</a></p><div class="doc"><p>The <code><a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a></code> component of an executable is an action the thread applies
 after processing the work function, given its thread id the ranges that this
 thread actually handled.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Finalise" class="def">Finalise</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runFinalise" class="def">runFinalise</a> :: <a href="../accelerate-2.0.0.0/Data-Array-Accelerate.html#t:Int">Int</a> -&gt; <a href="../containers-0.5.5.1/Data-Sequence.html#t:Seq">Seq</a> <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Finalise" class="caption collapser" onclick="toggleSection('i:Finalise')">Instances</p><div id="section.i:Finalise" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Data-Monoid.html#t:Monoid">Monoid</a> <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:runParIO" class="def">runParIO</a> :: <a href="Control-Parallel-Meta.html#t:Resource">Resource</a> -&gt; <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> () <a href="src/Control-Parallel-Meta.html#runParIO" class="link">Source</a></p><div class="doc"><p>Run a parallel work-stealing operation.</p><p>Each thread initialises its work queue with an equally sized chunk of the
 work. Threads keep working until their work search returns Nothing, at which
 point the thread exits. In our LBS implementation, a worker thread takes a
 small chunk of its work range to process, and places the remainder back onto
 its deque. Thus the work queues are only empty:</p><p>(a) Briefly during the scheduling process; or</p><p>(b) After the deque has been robbed. If the stolen chunk is large enough,
       the stealee will split the remainder onto its deque to be stolen; or</p><p>(c) There is no more work.</p><p>As long as the thread makes a small number of retries, this should correctly
 balance the work without too much scheduler overhead.</p><p>An alternative to every thread initialising with an even chunk size is to put
 the entire range onto the first worker and then have the scheduler handle the
 decomposition. However, since we are playing fast-and-loose with the exit
 condition, this is a little racy.</p><p>TLM NOTE:</p><p>Should threads check whether the work queues of all threads are empty before
 deciding to exit? If the PPT is too large then threads might not react
 quickly enough to splitting once their deque is emptied. Maybe the first
 thread to return Nothing can probe the queues to see if they are all empty.
 If True, write into a shared MVar to signal to the others that it is time to
 exit. But, that still assumes that the PPT is not so large that the queues
 are always empty.</p><p>TLM TODO:</p><p>Splitting work should probably be biased to cache-size chunks, rather
 than trying to split exactly evenly.</p></div></div><div class="top"><p class="src"><a name="v:seqIO" class="def">seqIO</a> :: <a href="Control-Parallel-Meta.html#t:Resource">Resource</a> -&gt; <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> () <a href="src/Control-Parallel-Meta.html#seqIO" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:parIO" class="def">parIO</a> :: <a href="Control-Parallel-Meta.html#t:Resource">Resource</a> -&gt; <a href="Control-Parallel-Meta-Worker.html#t:Gang">Gang</a> -&gt; <a href="Data-Range-Range.html#t:Range">Range</a> -&gt; <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Action">Action</a> -&gt; <a href="Control-Parallel-Meta.html#t:Finalise">Finalise</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> () <a href="src/Control-Parallel-Meta.html#parIO" class="link">Source</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.14.3</p></div></body></html>