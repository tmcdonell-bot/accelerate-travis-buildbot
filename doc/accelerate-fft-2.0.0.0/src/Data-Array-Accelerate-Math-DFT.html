<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Data/Array/Accelerate/Math/DFT.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds     #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts    #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE TypeOperators       #-}</span>
<a name="line-5"></a><span class='hs-comment'>-- |</span>
<a name="line-6"></a><span class='hs-comment'>-- Module      : Data.Array.Accelerate.Math.DFT</span>
<a name="line-7"></a><span class='hs-comment'>-- Copyright   : [2012..2014] Manuel M T Chakravarty, Gabriele Keller, Trevor L. McDonell</span>
<a name="line-8"></a><span class='hs-comment'>--               [2013..2014] Robert Clifton-Everest</span>
<a name="line-9"></a><span class='hs-comment'>-- License     : BSD3</span>
<a name="line-10"></a><span class='hs-comment'>--</span>
<a name="line-11"></a><span class='hs-comment'>-- Maintainer  : Manuel M T Chakravarty &lt;chak@cse.unsw.edu.au&gt;</span>
<a name="line-12"></a><span class='hs-comment'>-- Stability   : experimental</span>
<a name="line-13"></a><span class='hs-comment'>-- Portability : non-portable (GHC extensions)</span>
<a name="line-14"></a><span class='hs-comment'>--</span>
<a name="line-15"></a><span class='hs-comment'>-- Compute the Discrete Fourier Transform (DFT) along the lower order dimension</span>
<a name="line-16"></a><span class='hs-comment'>-- of an array.</span>
<a name="line-17"></a><span class='hs-comment'>--</span>
<a name="line-18"></a><span class='hs-comment'>-- This uses a na√Øve algorithm which takes O(n^2) time. However, you can</span>
<a name="line-19"></a><span class='hs-comment'>-- transform an array with an arbitrary extent, unlike with FFT which requires</span>
<a name="line-20"></a><span class='hs-comment'>-- each dimension to be a power of two.</span>
<a name="line-21"></a><span class='hs-comment'>--</span>
<a name="line-22"></a><span class='hs-comment'>-- The `dft` and `idft` functions compute the roots of unity as needed. If you</span>
<a name="line-23"></a><span class='hs-comment'>-- need to transform several arrays with the same extent than it is faster to</span>
<a name="line-24"></a><span class='hs-comment'>-- compute the roots once using `rootsOfUnity` or `inverseRootsOfUnity`</span>
<a name="line-25"></a><span class='hs-comment'>-- respectively, then call `dftG` directly.</span>
<a name="line-26"></a><span class='hs-comment'>--</span>
<a name="line-27"></a><span class='hs-comment'>-- You can also compute single values of the transform using `dftGS`</span>
<a name="line-28"></a><span class='hs-comment'>--</span>
<a name="line-29"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span><span class='hs-varop'>.</span><span class='hs-conid'>Accelerate</span><span class='hs-varop'>.</span><span class='hs-conid'>Math</span><span class='hs-varop'>.</span><span class='hs-conid'>DFT</span> <span class='hs-layout'>(</span>
<a name="line-30"></a>
<a name="line-31"></a>  <span class='hs-varid'>dft</span><span class='hs-layout'>,</span> <span class='hs-varid'>idft</span><span class='hs-layout'>,</span> <span class='hs-varid'>dftG</span><span class='hs-layout'>,</span> <span class='hs-varid'>dftGS</span><span class='hs-layout'>,</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-34"></a>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span>                                  <span class='hs-keyword'>as</span> <span class='hs-conid'>P</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>!!</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span><span class='hs-varop'>.</span><span class='hs-conid'>Accelerate</span>                    <span class='hs-keyword'>as</span> <span class='hs-conid'>A</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span><span class='hs-varop'>.</span><span class='hs-conid'>Accelerate</span><span class='hs-varop'>.</span><span class='hs-conid'>Math</span><span class='hs-varop'>.</span><span class='hs-conid'>DFT</span><span class='hs-varop'>.</span><span class='hs-conid'>Roots</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span><span class='hs-varop'>.</span><span class='hs-conid'>Accelerate</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Complex</span>
<a name="line-39"></a>
<a name="line-40"></a>
<a name="line-41"></a><a name="dft"></a><span class='hs-comment'>-- | Compute the DFT along the low order dimension of an array</span>
<a name="line-42"></a><span class='hs-comment'>--</span>
<a name="line-43"></a><span class='hs-definition'>dft</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Shape</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>Slice</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>RealFloat</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>FromIntegral</span> <span class='hs-conid'>Int</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-44"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-45"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-definition'>dft</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dftG</span> <span class='hs-layout'>(</span><span class='hs-varid'>rootsOfUnity</span> <span class='hs-layout'>(</span><span class='hs-varid'>shape</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span>
<a name="line-47"></a>
<a name="line-48"></a>
<a name="line-49"></a><a name="idft"></a><span class='hs-comment'>-- | Compute the inverse DFT along the low order dimension of an array</span>
<a name="line-50"></a><span class='hs-comment'>--</span>
<a name="line-51"></a><span class='hs-definition'>idft</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Shape</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>Slice</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>RealFloat</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>FromIntegral</span> <span class='hs-conid'>Int</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-52"></a>     <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-53"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-54"></a><span class='hs-definition'>idft</span> <span class='hs-varid'>v</span>
<a name="line-55"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>sh</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>shape</span> <span class='hs-varid'>v</span>
<a name="line-56"></a>        <span class='hs-varid'>n</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexHead</span> <span class='hs-varid'>sh</span>
<a name="line-57"></a>        <span class='hs-varid'>roots</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inverseRootsOfUnity</span> <span class='hs-varid'>sh</span>
<a name="line-58"></a>        <span class='hs-varid'>scale</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>n</span> <span class='hs-conop'>:+</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-59"></a>    <span class='hs-keyword'>in</span>
<a name="line-60"></a>    <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-varid'>scale</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>dftG</span> <span class='hs-varid'>roots</span> <span class='hs-varid'>v</span>
<a name="line-61"></a>
<a name="line-62"></a>
<a name="line-63"></a><a name="dftG"></a><span class='hs-comment'>-- | Generic function for computation of forward and inverse DFT. This function</span>
<a name="line-64"></a><span class='hs-comment'>--   is also useful if you transform many arrays of the same extent, and don't</span>
<a name="line-65"></a><span class='hs-comment'>--   want to recompute the roots for each one.</span>
<a name="line-66"></a><span class='hs-comment'>--</span>
<a name="line-67"></a><span class='hs-comment'>--   The extent of the input and roots must match.</span>
<a name="line-68"></a><span class='hs-comment'>--</span>
<a name="line-69"></a><span class='hs-definition'>dftG</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>sh</span> <span class='hs-varid'>e</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Shape</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>Slice</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>RealFloat</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-70"></a>     <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ roots of unity</span>
<a name="line-71"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ input array</span>
<a name="line-72"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-73"></a><span class='hs-definition'>dftG</span> <span class='hs-varid'>roots</span> <span class='hs-varid'>arr</span>
<a name="line-74"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>fold</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<a name="line-75"></a>  <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>zipWith</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-varid'>arr'</span> <span class='hs-varid'>roots'</span>
<a name="line-76"></a>  <span class='hs-keyword'>where</span>
<a name="line-77"></a>    <span class='hs-varid'>base</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>shape</span> <span class='hs-varid'>arr</span>
<a name="line-78"></a>    <span class='hs-varid'>l</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexHead</span> <span class='hs-varid'>base</span>
<a name="line-79"></a>    <span class='hs-varid'>extend</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>base</span> <span class='hs-conop'>:.</span> <span class='hs-varid'>shapeSize</span> <span class='hs-varid'>base</span><span class='hs-layout'>)</span>
<a name="line-80"></a>
<a name="line-81"></a>    <span class='hs-comment'>-- Extend the entirety of the input arrays into a higher dimension, reading</span>
<a name="line-82"></a>    <span class='hs-comment'>-- roots from the appropriate places and then reduce along this axis.</span>
<a name="line-83"></a>    <span class='hs-comment'>--</span>
<a name="line-84"></a>    <span class='hs-comment'>-- In the calculation for 'roots'', 'i' is the index into the extended</span>
<a name="line-85"></a>    <span class='hs-comment'>-- dimension, with corresponding base index 'ix' which we are attempting to</span>
<a name="line-86"></a>    <span class='hs-comment'>-- calculate the single DFT value of. The rest proceeds as per 'dftGS'.</span>
<a name="line-87"></a>    <span class='hs-comment'>--</span>
<a name="line-88"></a>    <span class='hs-varid'>arr'</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>generate</span> <span class='hs-varid'>extend</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ix'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexHead</span> <span class='hs-varid'>ix'</span> <span class='hs-keyword'>in</span> <span class='hs-varid'>arr</span> <span class='hs-varop'>!!</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-89"></a>    <span class='hs-varid'>roots'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>generate</span> <span class='hs-varid'>extend</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ix'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>ix</span> <span class='hs-conop'>:.</span> <span class='hs-varid'>i</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlift</span> <span class='hs-varid'>ix'</span>
<a name="line-90"></a>                                                 <span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-varid'>n</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlift</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIndex</span> <span class='hs-varid'>base</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Int</span>
<a name="line-91"></a>                                                 <span class='hs-varid'>k</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexHead</span> <span class='hs-varid'>ix</span>
<a name="line-92"></a>                                             <span class='hs-keyword'>in</span>
<a name="line-93"></a>                                             <span class='hs-varid'>roots</span> <span class='hs-varop'>!</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-varop'>*</span><span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mod`</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-94"></a>
<a name="line-95"></a>
<a name="line-96"></a><a name="dftGS"></a><span class='hs-comment'>-- | Compute a single value of the DFT.</span>
<a name="line-97"></a><span class='hs-comment'>--</span>
<a name="line-98"></a><span class='hs-definition'>dftGS</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>sh</span> <span class='hs-varid'>e</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Shape</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>Slice</span> <span class='hs-varid'>sh</span><span class='hs-layout'>,</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>RealFloat</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-99"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>                        <span class='hs-comment'>-- ^ index of the value we want</span>
<a name="line-100"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ roots of unity</span>
<a name="line-101"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span><span class='hs-conop'>:.</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ input array</span>
<a name="line-102"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Acc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-layout'>(</span><span class='hs-conid'>Complex</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-103"></a><span class='hs-definition'>dftGS</span> <span class='hs-varid'>ix</span> <span class='hs-varid'>roots</span> <span class='hs-varid'>arr</span>
<a name="line-104"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexHead</span> <span class='hs-varid'>ix</span>
<a name="line-105"></a>        <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indexHead</span> <span class='hs-layout'>(</span><span class='hs-varid'>shape</span> <span class='hs-varid'>arr</span><span class='hs-layout'>)</span>
<a name="line-106"></a>
<a name="line-107"></a>        <span class='hs-comment'>-- all the roots we need to multiply with</span>
<a name="line-108"></a>        <span class='hs-varid'>roots'</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>generate</span> <span class='hs-layout'>(</span><span class='hs-varid'>shape</span> <span class='hs-varid'>arr</span><span class='hs-layout'>)</span>
<a name="line-109"></a>                             <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ix'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlift</span> <span class='hs-varid'>ix'</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Int</span>
<a name="line-110"></a>                                      <span class='hs-keyword'>in</span>  <span class='hs-varid'>roots</span> <span class='hs-varop'>!</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>sh</span> <span class='hs-conop'>:.</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-varop'>*</span><span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mod`</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-111"></a>    <span class='hs-keyword'>in</span>
<a name="line-112"></a>    <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>foldAll</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>zipWith</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-varid'>arr</span> <span class='hs-varid'>roots'</span>
<a name="line-113"></a>
</pre></body>
</html>
