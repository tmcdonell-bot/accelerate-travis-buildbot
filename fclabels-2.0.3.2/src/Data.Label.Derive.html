<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Template Haskell functions for automatically generating labels for algebraic
datatypes, newtypes and GADTs. There are two basic modes of label generation,
the `mkLabels` family of functions create labels (and optionally type
signatures) in scope as top level funtions, the `getLabel` family of funtions
create labels as expressions that can be named and typed manually.

In the case of multi-constructor datatypes some fields might not always be
available and the derived labels will be partial. Partial labels are provided
with an additional type context that forces them to be only usable in the
`Partial' or `Failing` context.
-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE
    DeriveFunctor
  , DeriveFoldable
  , TemplateHaskell
  , TypeOperators
  , CPP #-}</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Label</span><span class="hs-operator">.</span><span class="hs-identifier">Derive</span><span>
</span><a name="line-22"></a><span class="hs-special">(</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-comment">-- * Generate labels in scope.</span><span>
</span><a name="line-25"></a><span>  </span><a href="Data.Label.Derive.html#mkLabel"><span class="hs-identifier hs-var">mkLabel</span></a><span>
</span><a name="line-26"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#mkLabels"><span class="hs-identifier hs-var">mkLabels</span></a><span>
</span><a name="line-27"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#mkLabelsNamed"><span class="hs-identifier hs-var">mkLabelsNamed</span></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-comment">-- * Produce labels as expressions.</span><span>
</span><a name="line-30"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#getLabel"><span class="hs-identifier hs-var">getLabel</span></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-comment">-- * First class record labels.</span><span>
</span><a name="line-33"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#fclabels"><span class="hs-identifier hs-var">fclabels</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">-- * Low level derivation functions.</span><span>
</span><a name="line-36"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#mkLabelsWith"><span class="hs-identifier hs-var">mkLabelsWith</span></a><span>
</span><a name="line-37"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#getLabelWith"><span class="hs-identifier hs-var">getLabelWith</span></a><span>
</span><a name="line-38"></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#defaultNaming"><span class="hs-identifier hs-var">defaultNaming</span></a><span>
</span><a name="line-39"></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">where</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Category</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLower</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-cpp">#if MIN_VERSION_base(4,8,0)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toList</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Label.Point.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Label</span><span class="hs-operator">.</span><span class="hs-identifier">Point</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">groupBy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">delete</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nub</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span><span>
</span><a name="line-56"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,10,0)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classP</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span>
</span><a name="line-60"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Label.Mono.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Label</span><span class="hs-operator">.</span><span class="hs-identifier">Mono</span></a><span>     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Mono</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Label.Poly.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Label</span><span class="hs-operator">.</span><span class="hs-identifier">Poly</span></a><span>     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Poly</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- Publicly exposed functions.</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | Derive labels including type signatures for all the record selectors for a</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- collection of datatypes. The types will be polymorphic and can be used in an</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- arbitrary context.</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-identifier">mkLabels</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-74"></a><a name="mkLabels"><a href="Data.Label.Derive.html#mkLabels"><span class="hs-identifier">mkLabels</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#mkLabelsWith"><span class="hs-identifier hs-var">mkLabelsWith</span></a><span> </span><a href="Data.Label.Derive.html#defaultNaming"><span class="hs-identifier hs-var">defaultNaming</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- | Derive labels including type signatures for all the record selectors in a</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- single datatype. The types will be polymorphic and can be used in an</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- arbitrary context.</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">mkLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-81"></a><a name="mkLabel"><a href="Data.Label.Derive.html#mkLabel"><span class="hs-identifier">mkLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#mkLabels"><span class="hs-identifier hs-var">mkLabels</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">-- | Like `mkLabels`, but uses the specified function to produce custom names</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- for the labels.</span><span>
</span><a name="line-85"></a><span class="hs-comment">--</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- For instance, @(drop 1 . dropWhile (/='_'))@ creates a label</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- @val@ from a record @Rec { rec_val :: X }@.</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-identifier">mkLabelsNamed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-90"></a><a name="mkLabelsNamed"><a href="Data.Label.Derive.html#mkLabelsNamed"><span class="hs-identifier">mkLabelsNamed</span></a></a><span> </span><a name="local-6989586621679054339"><a href="#local-6989586621679054339"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#mkLabelsWith"><span class="hs-identifier hs-var">mkLabelsWith</span></a><span> </span><a href="#local-6989586621679054339"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | Derive unnamed labels as n-tuples that can be named manually. The types</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- will be polymorphic and can be used in an arbitrary context.</span><span>
</span><a name="line-94"></a><span class="hs-comment">--</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- Example:</span><span>
</span><a name="line-96"></a><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- &gt; (left, right) = $(getLabel ''Either)</span><span>
</span><a name="line-98"></a><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- The lenses can now also be typed manually:</span><span>
</span><a name="line-100"></a><span class="hs-comment">--</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- &gt; left  :: (Either a b -&gt; Either c b) :~&gt; (a -&gt; c)</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- &gt; right :: (Either a b -&gt; Either a c) :~&gt; (b -&gt; c)</span><span>
</span><a name="line-103"></a><span class="hs-comment">--</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- Note: Because of the abstract nature of the generated lenses and the top</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- level pattern match, it might be required to use 'NoMonomorphismRestriction'</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- in some cases.</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-identifier">getLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a name="line-109"></a><a name="getLabel"><a href="Data.Label.Derive.html#getLabel"><span class="hs-identifier">getLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#getLabelWith"><span class="hs-identifier hs-var">getLabelWith</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | Low level label as expression derivation function.</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-identifier">getLabelWith</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- ^ Generate type signatures or not.</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- ^ Generate concrete type or abstract type. When true the</span><span>
</span><a name="line-116"></a><span>           </span><span class="hs-comment">--   signatures will be concrete and can only be used in the</span><span>
</span><a name="line-117"></a><span>           </span><span class="hs-comment">--   appropriate context. Total labels will use (`:-&gt;`) and partial</span><span>
</span><a name="line-118"></a><span>           </span><span class="hs-comment">--   labels will use either `Lens Partial` or `Lens Failing`</span><span>
</span><a name="line-119"></a><span>           </span><span class="hs-comment">--   dependent on the following flag:</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- ^ Use `ArrowFail` for failure instead of `ArrowZero`.</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>  </span><span class="hs-comment">-- ^ The type to derive labels for.</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><a name="getLabelWith"><a href="Data.Label.Derive.html#getLabelWith"><span class="hs-identifier">getLabelWith</span></a></a><span> </span><a name="local-6989586621679054340"><a href="#local-6989586621679054340"><span class="hs-identifier">sigs</span></a></a><span> </span><a name="local-6989586621679054341"><a href="#local-6989586621679054341"><span class="hs-identifier">concrete</span></a></a><span> </span><a name="local-6989586621679054342"><a href="#local-6989586621679054342"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679054343"><a href="#local-6989586621679054343"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-125"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679054344"><a href="#local-6989586621679054344"><span class="hs-identifier">dec</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Label.Derive.html#reifyDec"><span class="hs-identifier hs-var">reifyDec</span></a><span> </span><a href="#local-6989586621679054343"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-126"></a><span>     </span><a name="local-6989586621679054345"><a href="#local-6989586621679054345"><span class="hs-identifier">labels</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Label.Derive.html#generateLabels"><span class="hs-identifier hs-var">generateLabels</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-6989586621679054341"><span class="hs-identifier hs-var">concrete</span></a><span> </span><a href="#local-6989586621679054342"><span class="hs-identifier hs-var">failing</span></a><span> </span><a href="#local-6989586621679054344"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-127"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679054346"><a href="#local-6989586621679054346"><span class="hs-identifier">bodies</span></a></a><span>  </span><span class="hs-glyph">=</span><span>        </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier hs-var">LabelExpr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054350"><a href="#local-6989586621679054350"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679054350"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054345"><span class="hs-identifier hs-var">labels</span></a><span>
</span><a name="line-128"></a><span>         </span><a name="local-6989586621679054347"><a href="#local-6989586621679054347"><span class="hs-identifier">types</span></a></a><span>   </span><span class="hs-glyph">=</span><span>        </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier hs-var">LabelExpr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054351"><a href="#local-6989586621679054351"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679054351"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054345"><span class="hs-identifier hs-var">labels</span></a><span>
</span><a name="line-129"></a><span>         </span><a name="local-6989586621679054348"><a href="#local-6989586621679054348"><span class="hs-identifier">context</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier hs-var">LabelExpr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054529"><a href="#local-6989586621679054529"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679054529"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054345"><span class="hs-identifier hs-var">labels</span></a><span>
</span><a name="line-130"></a><span>         </span><a name="local-6989586621679054349"><a href="#local-6989586621679054349"><span class="hs-identifier">vars</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier hs-var">LabelExpr</span></a><span> </span><a name="local-6989586621679054530"><a href="#local-6989586621679054530"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679054530"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054345"><span class="hs-identifier hs-var">labels</span></a><span>
</span><a name="line-131"></a><span>     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679054340"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-132"></a><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">tupE</span><span> </span><a href="#local-6989586621679054346"><span class="hs-identifier hs-var">bodies</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">sigE</span><span class="hs-special">`</span><span>
</span><a name="line-133"></a><span>              </span><span class="hs-identifier hs-var">forallT</span><span> </span><a href="#local-6989586621679054349"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679054348"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-identifier hs-var">appT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679054346"><span class="hs-identifier hs-var">bodies</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054347"><span class="hs-identifier hs-var">types</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">tupE</span><span> </span><a href="#local-6989586621679054346"><span class="hs-identifier hs-var">bodies</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Low level standalone label derivation function.</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-identifier">mkLabelsWith</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Supply a function to perform custom label naming.</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>               </span><span class="hs-comment">-- ^ Generate type signatures or not.</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>               </span><span class="hs-comment">-- ^ Generate concrete type or abstract type. When</span><span>
</span><a name="line-142"></a><span>                        </span><span class="hs-comment">--   true the signatures will be concrete and can only</span><span>
</span><a name="line-143"></a><span>                        </span><span class="hs-comment">--   be used in the appropriate context. Total labels</span><span>
</span><a name="line-144"></a><span>                        </span><span class="hs-comment">--   will use (`:-&gt;`) and partial labels will use</span><span>
</span><a name="line-145"></a><span>                        </span><span class="hs-comment">--   either `Lens Partial` or `Lens Failing` dependent</span><span>
</span><a name="line-146"></a><span>                        </span><span class="hs-comment">--   on the following flag:</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>               </span><span class="hs-comment">-- ^ Use `ArrowFail` for failure instead of `ArrowZero`.</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>               </span><span class="hs-comment">-- ^ Generate inline pragma or not.</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>               </span><span class="hs-comment">-- ^ The type to derive labels for.</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><a name="mkLabelsWith"><a href="Data.Label.Derive.html#mkLabelsWith"><span class="hs-identifier">mkLabelsWith</span></a></a><span> </span><a name="local-6989586621679054531"><a href="#local-6989586621679054531"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679054532"><a href="#local-6989586621679054532"><span class="hs-identifier">sigs</span></a></a><span> </span><a name="local-6989586621679054533"><a href="#local-6989586621679054533"><span class="hs-identifier">concrete</span></a></a><span> </span><a name="local-6989586621679054534"><a href="#local-6989586621679054534"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679054535"><a href="#local-6989586621679054535"><span class="hs-identifier">inl</span></a></a><span> </span><a name="local-6989586621679054536"><a href="#local-6989586621679054536"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679054537"><a href="#local-6989586621679054537"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Label.Derive.html#reifyDec"><span class="hs-identifier hs-var">reifyDec</span></a><span> </span><a href="#local-6989586621679054536"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-154"></a><span>     </span><a href="Data.Label.Derive.html#mkLabelsWithForDec"><span class="hs-identifier hs-var">mkLabelsWithForDec</span></a><span> </span><a href="#local-6989586621679054531"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621679054532"><span class="hs-identifier hs-var">sigs</span></a><span> </span><a href="#local-6989586621679054533"><span class="hs-identifier hs-var">concrete</span></a><span> </span><a href="#local-6989586621679054534"><span class="hs-identifier hs-var">failing</span></a><span> </span><a href="#local-6989586621679054535"><span class="hs-identifier hs-var">inl</span></a><span> </span><a href="#local-6989586621679054537"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-comment">-- | Default way of generating a label name from the Haskell record selector</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- name. If the original selector starts with an underscore, remove it and make</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- the next character lowercase. Otherwise, add 'l', and make the next</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- character uppercase.</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-identifier">defaultNaming</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-162"></a><a name="defaultNaming"><a href="Data.Label.Derive.html#defaultNaming"><span class="hs-identifier">defaultNaming</span></a></a><span> </span><a name="local-6989586621679054538"><a href="#local-6989586621679054538"><span class="hs-identifier">field</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679054538"><span class="hs-identifier hs-var">field</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-char">'_'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679054539"><a href="#local-6989586621679054539"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679054540"><a href="#local-6989586621679054540"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679054539"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679054540"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-165"></a><span>    </span><a name="local-6989586621679054885"><a href="#local-6989586621679054885"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679054886"><a href="#local-6989586621679054886"><span class="hs-identifier">rest</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'l'</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span> </span><a href="#local-6989586621679054885"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679054886"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-166"></a><span>    </span><a name="local-6989586621679054887"><a href="#local-6989586621679054887"><span class="hs-identifier">n</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#fclError"><span class="hs-identifier hs-var">fclError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Cannot derive label for record selector with name: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679054887"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- | Derive labels for all the record types in the supplied declaration. The</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- record fields don't need an underscore prefix. Multiple data types /</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- newtypes are allowed at once.</span><span>
</span><a name="line-171"></a><span class="hs-comment">--</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- The advantage of this approach is that you don't need to explicitly hide the</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- original record accessors from being exported and they won't show up in the</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- derived `Show` instance.</span><span>
</span><a name="line-175"></a><span class="hs-comment">--</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- Example:</span><span>
</span><a name="line-177"></a><span class="hs-comment">--</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- &gt; fclabels [d|</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- &gt;   data Record = Record</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- &gt;     { int  :: Int</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- &gt;     , bool :: Bool</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- &gt;     } deriving Show</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- &gt;   |]</span><span>
</span><a name="line-184"></a><span class="hs-comment">--</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- &gt; ghci&gt; modify int (+2) (Record 1 False)</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- &gt; Record 3 False</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-identifier">fclabels</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><a name="fclabels"><a href="Data.Label.Derive.html#fclabels"><span class="hs-identifier">fclabels</span></a></a><span> </span><a name="local-6989586621679054888"><a href="#local-6989586621679054888"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-190"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679054917"><a href="#local-6989586621679054917"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679054888"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-191"></a><span>     </span><a name="local-6989586621679054918"><a href="#local-6989586621679054918"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054917"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679054889"><span class="hs-identifier hs-var">labels</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#mkLabelsWithForDec"><span class="hs-identifier hs-var">mkLabelsWithForDec</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679054890"><span class="hs-identifier hs-var">delabelize</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054917"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679054918"><span class="hs-identifier hs-var">ls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>  </span><span class="hs-identifier">labels</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-196"></a><span>  </span><a name="local-6989586621679054889"><a href="#local-6989586621679054889"><span class="hs-identifier">labels</span></a></a><span> </span><a name="local-6989586621679054891"><a href="#local-6989586621679054891"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679054891"><span class="hs-identifier hs-var">dec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-198"></a><span>      </span><span class="hs-identifier hs-var">DataD</span><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679054891"><span class="hs-identifier hs-var">dec</span></a><span class="hs-special">]</span><span>
</span><a name="line-199"></a><span>      </span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679054891"><span class="hs-identifier hs-var">dec</span></a><span class="hs-special">]</span><span>
</span><a name="line-200"></a><span>      </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-identifier">delabelize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Dec</span><span>
</span><a name="line-203"></a><span>  </span><a name="local-6989586621679054890"><a href="#local-6989586621679054890"><span class="hs-identifier">delabelize</span></a></a><span> </span><a name="local-6989586621679054892"><a href="#local-6989586621679054892"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679054892"><span class="hs-identifier hs-var">dec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-205"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-206"></a><span>      </span><span class="hs-identifier hs-var">DataD</span><span>    </span><a name="local-6989586621679054904"><a href="#local-6989586621679054904"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679054905"><a href="#local-6989586621679054905"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621679054906"><a href="#local-6989586621679054906"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679054907"><a href="#local-6989586621679054907"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679054908"><a href="#local-6989586621679054908"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679054909"><a href="#local-6989586621679054909"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">DataD</span><span>    </span><a href="#local-6989586621679054904"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679054905"><span class="hs-identifier hs-var">nm</span></a><span> </span><a href="#local-6989586621679054906"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679054907"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054893"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054908"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054909"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-207"></a><span>      </span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><a name="local-6989586621679054910"><a href="#local-6989586621679054910"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679054911"><a href="#local-6989586621679054911"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621679054912"><a href="#local-6989586621679054912"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679054913"><a href="#local-6989586621679054913"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679054914"><a href="#local-6989586621679054914"><span class="hs-identifier">c</span></a></a><span>  </span><a name="local-6989586621679054915"><a href="#local-6989586621679054915"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><a href="#local-6989586621679054910"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679054911"><span class="hs-identifier hs-var">nm</span></a><span> </span><a href="#local-6989586621679054912"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679054913"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054893"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679054914"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>      </span><a href="#local-6989586621679054915"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-208"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-209"></a><span>      </span><span class="hs-identifier">DataD</span><span>    </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-identifier">nm</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-identifier">cs</span><span> </span><span class="hs-identifier">ns</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">DataD</span><span>    </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-identifier">nm</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">con</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">cs</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ns</span><span>
</span><a name="line-210"></a><span>      </span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-identifier">nm</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-identifier">c</span><span>  </span><span class="hs-identifier">ns</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-identifier">nm</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">c</span><span class="hs-special">)</span><span>      </span><span class="hs-identifier">ns</span><span>
</span><a name="line-211"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-212"></a><span>      </span><a name="local-6989586621679054916"><a href="#local-6989586621679054916"><span class="hs-identifier">rest</span></a></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679054916"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-213"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679054893"><a href="#local-6989586621679054893"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679054894"><a href="#local-6989586621679054894"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679054895"><a href="#local-6989586621679054895"><span class="hs-identifier">vst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NormalC</span><span> </span><a href="#local-6989586621679054894"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679054896"><a href="#local-6989586621679054896"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679054897"><a href="#local-6989586621679054897"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054896"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054897"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054895"><span class="hs-identifier hs-var">vst</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-215"></a><span>          </span><span class="hs-identifier">con</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679054898"><a href="#local-6989586621679054898"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621679054899"><a href="#local-6989586621679054899"><span class="hs-identifier">vst</span></a></a><span> </span><a name="local-6989586621679054900"><a href="#local-6989586621679054900"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GadtC</span><span> </span><a href="#local-6989586621679054898"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679054901"><a href="#local-6989586621679054901"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679054902"><a href="#local-6989586621679054902"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054901"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054902"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054899"><span class="hs-identifier hs-var">vst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054900"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-216"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-217"></a><span>          </span><span class="hs-identifier">con</span><span> </span><a name="local-6989586621679054903"><a href="#local-6989586621679054903"><span class="hs-identifier">c</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679054903"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- Intermediate data types.</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-keyword">data</span><span> </span><a name="Label"><a href="Data.Label.Derive.html#Label"><span class="hs-identifier">Label</span></a></a><span>
</span><a name="line-223"></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="LabelDecl"><a href="Data.Label.Derive.html#LabelDecl"><span class="hs-identifier">LabelDecl</span></a></a><span>
</span><a name="line-224"></a><span>     </span><span class="hs-identifier hs-type">Name</span><span>              </span><span class="hs-comment">-- The label name.</span><span>
</span><a name="line-225"></a><span>     </span><span class="hs-identifier hs-type">DecQ</span><span>              </span><span class="hs-comment">-- An INLINE pragma for the label.</span><span>
</span><a name="line-226"></a><span>     </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- The type variables requiring forall.</span><span>
</span><a name="line-227"></a><span>     </span><span class="hs-identifier hs-type">CxtQ</span><span>              </span><span class="hs-comment">-- The context.</span><span>
</span><a name="line-228"></a><span>     </span><span class="hs-identifier hs-type">TypeQ</span><span>             </span><span class="hs-comment">-- The type.</span><span>
</span><a name="line-229"></a><span>     </span><span class="hs-identifier hs-type">ExpQ</span><span>              </span><span class="hs-comment">-- The label body.</span><span>
</span><a name="line-230"></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="LabelExpr"><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier">LabelExpr</span></a></a><span>
</span><a name="line-231"></a><span>     </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- The type variables requiring forall.</span><span>
</span><a name="line-232"></a><span>     </span><span class="hs-identifier hs-type">CxtQ</span><span>              </span><span class="hs-comment">-- The context.</span><span>
</span><a name="line-233"></a><span>     </span><span class="hs-identifier hs-type">TypeQ</span><span>             </span><span class="hs-comment">-- The type.</span><span>
</span><a name="line-234"></a><span>     </span><span class="hs-identifier hs-type">ExpQ</span><span>              </span><span class="hs-comment">-- The label body.</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-keyword">data</span><span> </span><a name="Field"><a href="Data.Label.Derive.html#Field"><span class="hs-identifier">Field</span></a></a><span> </span><a name="local-6989586621679053959"><a href="#local-6989586621679053959"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Field"><a href="Data.Label.Derive.html#Field"><span class="hs-identifier">Field</span></a></a><span>
</span><a name="line-237"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Name of the field, when there is one.</span><span>
</span><a name="line-238"></a><span>  </span><span class="hs-identifier hs-type">Bool</span><span>                 </span><span class="hs-comment">-- Forced to be mono because of type shared with other fields.</span><span>
</span><a name="line-239"></a><span>  </span><span class="hs-identifier hs-type">Type</span><span>                 </span><span class="hs-comment">-- Type of the field.</span><span>
</span><a name="line-240"></a><span>  </span><a href="#local-6989586621679053959"><span class="hs-identifier hs-type">c</span></a><span>                    </span><span class="hs-comment">-- Occurs in this/these constructors.</span><span>
</span><a name="line-241"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-keyword">type</span><span> </span><a name="Subst"><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier">Subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-keyword">data</span><span> </span><a name="Context"><a href="Data.Label.Derive.html#Context"><span class="hs-identifier">Context</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Context"><a href="Data.Label.Derive.html#Context"><span class="hs-identifier">Context</span></a></a><span>
</span><a name="line-246"></a><span>  </span><span class="hs-identifier hs-type">Int</span><span>                  </span><span class="hs-comment">-- Field index.</span><span>
</span><a name="line-247"></a><span>  </span><span class="hs-identifier hs-type">Name</span><span>                 </span><span class="hs-comment">-- Constructor name.</span><span>
</span><a name="line-248"></a><span>  </span><span class="hs-identifier hs-type">Con</span><span>                  </span><span class="hs-comment">-- Constructor.</span><span>
</span><a name="line-249"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-keyword">data</span><span> </span><a name="Typing"><a href="Data.Label.Derive.html#Typing"><span class="hs-identifier">Typing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Typing"><a href="Data.Label.Derive.html#Typing"><span class="hs-identifier">Typing</span></a></a><span>
</span><a name="line-252"></a><span>  </span><span class="hs-identifier hs-type">Bool</span><span>                 </span><span class="hs-comment">-- Monomorphic type or polymorphic.</span><span>
</span><a name="line-253"></a><span>  </span><span class="hs-identifier hs-type">TypeQ</span><span>                </span><span class="hs-comment">-- The lens input type.</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-identifier hs-type">TypeQ</span><span>                </span><span class="hs-comment">-- The lens output type.</span><span>
</span><a name="line-255"></a><span>  </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- All used type variables.</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-identifier">mkLabelsWithForDec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-260"></a><a name="mkLabelsWithForDec"><a href="Data.Label.Derive.html#mkLabelsWithForDec"><span class="hs-identifier">mkLabelsWithForDec</span></a></a><span> </span><a name="local-6989586621679054919"><a href="#local-6989586621679054919"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679054920"><a href="#local-6989586621679054920"><span class="hs-identifier">sigs</span></a></a><span> </span><a name="local-6989586621679054921"><a href="#local-6989586621679054921"><span class="hs-identifier">concrete</span></a></a><span> </span><a name="local-6989586621679054922"><a href="#local-6989586621679054922"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679054923"><a href="#local-6989586621679054923"><span class="hs-identifier">inl</span></a></a><span> </span><a name="local-6989586621679054924"><a href="#local-6989586621679054924"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-261"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679054925"><a href="#local-6989586621679054925"><span class="hs-identifier">labels</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Label.Derive.html#generateLabels"><span class="hs-identifier hs-var">generateLabels</span></a><span> </span><a href="#local-6989586621679054919"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621679054921"><span class="hs-identifier hs-var">concrete</span></a><span> </span><a href="#local-6989586621679054922"><span class="hs-identifier hs-var">failing</span></a><span> </span><a href="#local-6989586621679054924"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-262"></a><span>     </span><a name="local-6989586621679054936"><a href="#local-6989586621679054936"><span class="hs-identifier">decls</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><a href="#local-6989586621679054925"><span class="hs-identifier hs-var">labels</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679054926"><a href="#local-6989586621679054926"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-263"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679054926"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-264"></a><span>         </span><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier hs-var">LabelExpr</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-265"></a><span>         </span><a href="Data.Label.Derive.html#LabelDecl"><span class="hs-identifier hs-var">LabelDecl</span></a><span> </span><a name="local-6989586621679054927"><a href="#local-6989586621679054927"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679054928"><a href="#local-6989586621679054928"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679054929"><a href="#local-6989586621679054929"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679054930"><a href="#local-6989586621679054930"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679054931"><a href="#local-6989586621679054931"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679054932"><a href="#local-6989586621679054932"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-266"></a><span>           </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679054933"><a href="#local-6989586621679054933"><span class="hs-identifier">bdy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">funD</span><span> </span><a href="#local-6989586621679054927"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">clause</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">normalB</span><span> </span><a href="#local-6989586621679054932"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-267"></a><span>              </span><a name="local-6989586621679054934"><a href="#local-6989586621679054934"><span class="hs-identifier">prg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679054923"><span class="hs-identifier hs-var">inl</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054928"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-268"></a><span>              </span><a name="local-6989586621679054935"><a href="#local-6989586621679054935"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679054920"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-269"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">sigD</span><span> </span><a href="#local-6989586621679054927"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forallT</span><span> </span><a href="#local-6989586621679054929"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679054930"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679054931"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-271"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679054934"><span class="hs-identifier hs-var">prg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054935"><span class="hs-identifier hs-var">typ</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054933"><span class="hs-identifier hs-var">bdy</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679054936"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">-- Generate the labels for all the record fields in the data type.</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-identifier">generateLabels</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Label"><span class="hs-identifier hs-type">Label</span></a><span class="hs-special">]</span><span>
</span><a name="line-277"></a><a name="generateLabels"><a href="Data.Label.Derive.html#generateLabels"><span class="hs-identifier">generateLabels</span></a></a><span> </span><a name="local-6989586621679054937"><a href="#local-6989586621679054937"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679054938"><a href="#local-6989586621679054938"><span class="hs-identifier">concrete</span></a></a><span> </span><a name="local-6989586621679054939"><a href="#local-6989586621679054939"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679054940"><a href="#local-6989586621679054940"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Only process data and newtype declarations, filter out all</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-comment">-- constructors and the type variables.</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679054941"><a href="#local-6989586621679054941"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679054942"><a href="#local-6989586621679054942"><span class="hs-identifier">cons</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679054943"><a href="#local-6989586621679054943"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-282"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679054940"><span class="hs-identifier hs-var">dec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-283"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-284"></a><span>            </span><span class="hs-identifier hs-var">DataD</span><span>    </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054945"><a href="#local-6989586621679054945"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679054946"><a href="#local-6989586621679054946"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054947"><a href="#local-6989586621679054947"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054945"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054947"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span>  </span><a href="#local-6989586621679054946"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>            </span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054948"><a href="#local-6989586621679054948"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679054949"><a href="#local-6989586621679054949"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679054950"><a href="#local-6989586621679054950"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054948"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679054950"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054949"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-287"></a><span>            </span><span class="hs-identifier">DataD</span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">cs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cs</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">vs</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>            </span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">c</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">c</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vs</span><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-290"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#fclError"><span class="hs-identifier hs-var">fclError</span></a><span> </span><span class="hs-string">&quot;Can only derive labels for datatypes and newtypes.&quot;</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span>        </span><span class="hs-comment">-- We are only interested in lenses of record constructors.</span><span>
</span><a name="line-293"></a><span>        </span><a name="local-6989586621679054944"><a href="#local-6989586621679054944"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#groupFields"><span class="hs-identifier hs-var">groupFields</span></a><span> </span><a href="#local-6989586621679054937"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621679054943"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679054942"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>    </span><span class="hs-identifier hs-var">forM</span><span> </span><a href="#local-6989586621679054944"><span class="hs-identifier hs-var">fields</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Label.Derive.html#generateLabel"><span class="hs-identifier hs-var">generateLabel</span></a><span> </span><a href="#local-6989586621679054939"><span class="hs-identifier hs-var">failing</span></a><span> </span><a href="#local-6989586621679054938"><span class="hs-identifier hs-var">concrete</span></a><span> </span><a href="#local-6989586621679054941"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679054943"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679054942"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-identifier">groupFields</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Con</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-type">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-type">Context</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-298"></a><a name="groupFields"><a href="Data.Label.Derive.html#groupFields"><span class="hs-identifier">groupFields</span></a></a><span> </span><a name="local-6989586621679054951"><a href="#local-6989586621679054951"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621679054952"><a href="#local-6989586621679054952"><span class="hs-identifier">vs</span></a></a><span>
</span><a name="line-299"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054955"><span class="hs-identifier hs-var">rename</span></a><span> </span><a href="#local-6989586621679054951"><span class="hs-identifier hs-var">mk</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679054964"><a href="#local-6989586621679054964"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679054965"><a href="#local-6989586621679054965"><span class="hs-identifier">vals</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054964"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>                          </span><a name="local-6989586621679054966"><a href="#local-6989586621679054966"><span class="hs-identifier">cons</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054965"><span class="hs-identifier hs-var">vals</span></a><span>
</span><a name="line-302"></a><span>                          </span><a name="local-6989586621679054967"><a href="#local-6989586621679054967"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054965"><span class="hs-identifier hs-var">vals</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679054966"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679054967"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054964"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><a href="#local-6989586621679054954"><span class="hs-identifier hs-var">eq</span></a><span>
</span><a name="line-306"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><a href="#local-6989586621679054953"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#constructorFields"><span class="hs-identifier hs-var">constructorFields</span></a><span> </span><a href="#local-6989586621679054952"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679054953"><a href="#local-6989586621679054953"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a name="local-6989586621679054956"><a href="#local-6989586621679054956"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679054956"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-309"></a><span>        </span><a name="local-6989586621679054954"><a href="#local-6989586621679054954"><span class="hs-identifier">eq</span></a></a><span> </span><a name="local-6989586621679054957"><a href="#local-6989586621679054957"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679054958"><a href="#local-6989586621679054958"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054953"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679054957"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679054953"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679054958"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span>        </span><a name="local-6989586621679054955"><a href="#local-6989586621679054955"><span class="hs-identifier">rename</span></a></a><span> </span><a name="local-6989586621679054959"><a href="#local-6989586621679054959"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a name="local-6989586621679054960"><a href="#local-6989586621679054960"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679054961"><a href="#local-6989586621679054961"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679054962"><a href="#local-6989586621679054962"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679054963"><a href="#local-6989586621679054963"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-311"></a><span>          </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679054959"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679054960"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679054961"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679054962"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679054963"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-identifier">constructorFields</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-type">Field</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-type">Context</span></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-314"></a><a name="constructorFields"><a href="Data.Label.Derive.html#constructorFields"><span class="hs-identifier">constructorFields</span></a></a><span> </span><a name="local-6989586621679055114"><a href="#local-6989586621679055114"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621679055115"><a href="#local-6989586621679055115"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055115"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span>    </span><span class="hs-identifier hs-var">NormalC</span><span> </span><a name="local-6989586621679055116"><a href="#local-6989586621679055116"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679055117"><a href="#local-6989586621679055117"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055118"><span class="hs-identifier hs-var">one</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679055117"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-319"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055118"><a href="#local-6989586621679055118"><span class="hs-identifier">one</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679055119"><a href="#local-6989586621679055119"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055120"><a href="#local-6989586621679055120"><span class="hs-identifier">f</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055121"><a href="#local-6989586621679055121"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679055123"><span class="hs-identifier hs-var">mono</span></a><span> </span><a href="#local-6989586621679055121"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a href="#local-6989586621679055119"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055116"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679055115"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-320"></a><span>              </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055122"><a href="#local-6989586621679055122"><span class="hs-identifier">fsTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">delete</span><span> </span><a href="#local-6989586621679055120"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055117"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>                    </span><a name="local-6989586621679055123"><a href="#local-6989586621679055123"><span class="hs-identifier">mono</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055124"><a href="#local-6989586621679055124"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="#local-6989586621679055124"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055122"><span class="hs-identifier hs-var">fsTys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055121"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span>    </span><span class="hs-identifier hs-var">RecC</span><span> </span><a name="local-6989586621679055125"><a href="#local-6989586621679055125"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679055126"><a href="#local-6989586621679055126"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055127"><span class="hs-identifier hs-var">one</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679055126"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-324"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055127"><a href="#local-6989586621679055127"><span class="hs-identifier">one</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679055128"><a href="#local-6989586621679055128"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055129"><a href="#local-6989586621679055129"><span class="hs-identifier">f</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679055130"><a href="#local-6989586621679055130"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055131"><a href="#local-6989586621679055131"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679055130"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055133"><span class="hs-identifier hs-var">mono</span></a><span> </span><a href="#local-6989586621679055131"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a href="#local-6989586621679055128"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055125"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679055115"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>              </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055132"><a href="#local-6989586621679055132"><span class="hs-identifier">fsTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Label.Derive.html#trd"><span class="hs-identifier hs-var">trd</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">delete</span><span> </span><a href="#local-6989586621679055129"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055126"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>                    </span><a name="local-6989586621679055133"><a href="#local-6989586621679055133"><span class="hs-identifier">mono</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055134"><a href="#local-6989586621679055134"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="#local-6989586621679055134"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055132"><span class="hs-identifier hs-var">fsTys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055131"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier hs-var">InfixC</span><span> </span><a name="local-6989586621679055135"><a href="#local-6989586621679055135"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055136"><a href="#local-6989586621679055136"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679055137"><a href="#local-6989586621679055137"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055138"><span class="hs-identifier hs-var">one</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055135"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055137"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-329"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055138"><a href="#local-6989586621679055138"><span class="hs-identifier">one</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679055139"><a href="#local-6989586621679055139"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055140"><a href="#local-6989586621679055140"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679055142"><span class="hs-identifier hs-var">mono</span></a><span> </span><a href="#local-6989586621679055140"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a href="#local-6989586621679055139"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055136"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679055115"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>              </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055141"><a href="#local-6989586621679055141"><span class="hs-identifier">fsTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055135"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055137"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-331"></a><span>                    </span><a name="local-6989586621679055142"><a href="#local-6989586621679055142"><span class="hs-identifier">mono</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055143"><a href="#local-6989586621679055143"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="#local-6989586621679055143"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055141"><span class="hs-identifier hs-var">fsTys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055140"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span>    </span><span class="hs-identifier hs-var">ForallC</span><span> </span><a name="local-6989586621679055144"><a href="#local-6989586621679055144"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679055145"><a href="#local-6989586621679055145"><span class="hs-identifier">y</span></a></a><span> </span><a name="local-6989586621679055146"><a href="#local-6989586621679055146"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055148"><span class="hs-identifier hs-var">setEqs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.Label.Derive.html#constructorFields"><span class="hs-identifier hs-var">constructorFields</span></a><span> </span><a href="#local-6989586621679055114"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679055146"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-334"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,10,0)</span><span>
</span><a name="line-335"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055147"><a href="#local-6989586621679055147"><span class="hs-identifier">eqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055150"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055151"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-identifier hs-var">EqualityT</span><span> </span><a name="local-6989586621679055150"><a href="#local-6989586621679055150"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679055151"><a href="#local-6989586621679055151"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679055145"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-336"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-337"></a><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">EqualP</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-338"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-339"></a><span>            </span><a name="local-6989586621679055148"><a href="#local-6989586621679055148"><span class="hs-identifier">setEqs</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a name="local-6989586621679055152"><a href="#local-6989586621679055152"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055153"><a href="#local-6989586621679055153"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679055154"><a href="#local-6989586621679055154"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679055155"><a href="#local-6989586621679055155"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a href="#local-6989586621679055152"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679055153"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679055154"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-6989586621679055149"><span class="hs-identifier hs-var">upd</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055147"><span class="hs-identifier hs-var">eqs</span></a><span> </span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679055155"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>            </span><a name="local-6989586621679055149"><a href="#local-6989586621679055149"><span class="hs-identifier">upd</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a name="local-6989586621679055156"><a href="#local-6989586621679055156"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055157"><a href="#local-6989586621679055157"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679055158"><a href="#local-6989586621679055158"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a href="#local-6989586621679055156"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679055157"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><a href="#local-6989586621679055144"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679055145"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679055158"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-342"></a><span>    </span><span class="hs-identifier hs-var">GadtC</span><span> </span><a name="local-6989586621679055159"><a href="#local-6989586621679055159"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679055160"><a href="#local-6989586621679055160"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679055161"><a href="#local-6989586621679055161"><span class="hs-identifier">resTy</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055170"><a href="#local-6989586621679055170"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055162"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055170"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679055160"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055159"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-343"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055162"><a href="#local-6989586621679055162"><span class="hs-identifier">one</span></a></a><span> </span><a name="local-6989586621679055163"><a href="#local-6989586621679055163"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679055164"><a href="#local-6989586621679055164"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055165"><a href="#local-6989586621679055165"><span class="hs-identifier">f</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055166"><a href="#local-6989586621679055166"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679055168"><span class="hs-identifier hs-var">mono</span></a><span> </span><a href="#local-6989586621679055166"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a href="#local-6989586621679055164"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055163"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679055115"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#mkSubst"><span class="hs-identifier hs-var">mkSubst</span></a><span> </span><a href="#local-6989586621679055114"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679055161"><span class="hs-identifier hs-var">resTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>              </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055167"><a href="#local-6989586621679055167"><span class="hs-identifier">fsTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">delete</span><span> </span><a href="#local-6989586621679055165"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055160"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>                    </span><a name="local-6989586621679055168"><a href="#local-6989586621679055168"><span class="hs-identifier">mono</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055169"><a href="#local-6989586621679055169"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="#local-6989586621679055169"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055167"><span class="hs-identifier hs-var">fsTys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055166"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679055171"><a href="#local-6989586621679055171"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679055172"><a href="#local-6989586621679055172"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679055173"><a href="#local-6989586621679055173"><span class="hs-identifier">resTy</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055183"><a href="#local-6989586621679055183"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055174"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055183"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679055172"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055171"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-347"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055174"><a href="#local-6989586621679055174"><span class="hs-identifier">one</span></a></a><span> </span><a name="local-6989586621679055175"><a href="#local-6989586621679055175"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679055176"><a href="#local-6989586621679055176"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055177"><a href="#local-6989586621679055177"><span class="hs-identifier">f</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679055178"><a href="#local-6989586621679055178"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055179"><a href="#local-6989586621679055179"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679055178"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055181"><span class="hs-identifier hs-var">mono</span></a><span> </span><a href="#local-6989586621679055179"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a href="#local-6989586621679055176"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055175"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679055115"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#mkSubst"><span class="hs-identifier hs-var">mkSubst</span></a><span> </span><a href="#local-6989586621679055114"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679055173"><span class="hs-identifier hs-var">resTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>              </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055180"><a href="#local-6989586621679055180"><span class="hs-identifier">fsTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Label.Derive.html#trd"><span class="hs-identifier hs-var">trd</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">delete</span><span> </span><a href="#local-6989586621679055177"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055172"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>                    </span><a name="local-6989586621679055181"><a href="#local-6989586621679055181"><span class="hs-identifier">mono</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055182"><a href="#local-6989586621679055182"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="#local-6989586621679055182"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055180"><span class="hs-identifier hs-var">fsTys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055179"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-identifier">mkSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span>
</span><a name="line-352"></a><a name="mkSubst"><a href="Data.Label.Derive.html#mkSubst"><span class="hs-identifier">mkSubst</span></a></a><span> </span><a name="local-6989586621679055184"><a href="#local-6989586621679055184"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679055185"><a href="#local-6989586621679055185"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055186"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679055184"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055185"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-353"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-354"></a><span>    </span><a name="local-6989586621679055186"><a href="#local-6989586621679055186"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-355"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679055187"><a href="#local-6989586621679055187"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679055188"><a href="#local-6989586621679055188"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055189"><a href="#local-6989586621679055189"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679055190"><a href="#local-6989586621679055190"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#typeFromBinder"><span class="hs-identifier hs-var">typeFromBinder</span></a><span> </span><a href="#local-6989586621679055187"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055190"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679055186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055188"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679055189"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-356"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#fclError"><span class="hs-identifier hs-var">fclError</span></a><span> </span><span class="hs-string">&quot;Non-AppT with type variables in mkSubst. Please report this as a bug for fclabels.&quot;</span><span>
</span><a name="line-357"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-identifier">prune</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-type">Context</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Con</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Con</span><span class="hs-special">]</span><span>
</span><a name="line-360"></a><a name="prune"><a href="Data.Label.Derive.html#prune"><span class="hs-identifier">prune</span></a></a><span> </span><a name="local-6989586621679055191"><a href="#local-6989586621679055191"><span class="hs-identifier">contexts</span></a></a><span> </span><a name="local-6989586621679055192"><a href="#local-6989586621679055192"><span class="hs-identifier">allCons</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-361"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055191"><span class="hs-identifier hs-var">contexts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-362"></a><span>    </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055193"><a href="#local-6989586621679055193"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-363"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#unifiableCon"><span class="hs-identifier hs-var">unifiableCon</span></a><span> </span><a href="#local-6989586621679055193"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055192"><span class="hs-identifier hs-var">allCons</span></a><span>
</span><a name="line-364"></a><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-identifier">unifiableCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-367"></a><a name="unifiableCon"><a href="Data.Label.Derive.html#unifiableCon"><span class="hs-identifier">unifiableCon</span></a></a><span> </span><a name="local-6989586621679055194"><a href="#local-6989586621679055194"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055195"><a href="#local-6989586621679055195"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">and</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="Data.Label.Derive.html#unifiable"><span class="hs-identifier hs-var">unifiable</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055196"><span class="hs-identifier hs-var">indices</span></a><span> </span><a href="#local-6989586621679055194"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055196"><span class="hs-identifier hs-var">indices</span></a><span> </span><a href="#local-6989586621679055195"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055196"><a href="#local-6989586621679055196"><span class="hs-identifier">indices</span></a></a><span> </span><a name="local-6989586621679055197"><a href="#local-6989586621679055197"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-369"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055197"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-370"></a><span>            </span><span class="hs-identifier hs-var">NormalC</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-371"></a><span>            </span><span class="hs-identifier hs-var">RecC</span><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-372"></a><span>            </span><span class="hs-identifier hs-var">InfixC</span><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-373"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-374"></a><span>            </span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055202"><a href="#local-6989586621679055202"><span class="hs-identifier">ty</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055196"><span class="hs-identifier hs-var">indices</span></a><span> </span><a href="#local-6989586621679055202"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-375"></a><span class="hs-cpp">#elif MIN_VERSION_template_haskell(2,10,0)</span><span>
</span><a name="line-376"></a><span>            </span><span class="hs-identifier">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">AppT</span><span> </span><span class="hs-identifier">EqualityT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-377"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-378"></a><span>            </span><span class="hs-identifier">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">EqualP</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-379"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-380"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-381"></a><span>            </span><span class="hs-identifier hs-var">GadtC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055203"><a href="#local-6989586621679055203"><span class="hs-identifier">ty</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055198"><span class="hs-identifier hs-var">conIndices</span></a><span> </span><a href="#local-6989586621679055203"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-382"></a><span>            </span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055204"><a href="#local-6989586621679055204"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055198"><span class="hs-identifier hs-var">conIndices</span></a><span> </span><a href="#local-6989586621679055204"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-383"></a><span>         </span><span class="hs-keyword">where</span><span>
</span><a name="line-384"></a><span>           </span><a name="local-6989586621679055198"><a href="#local-6989586621679055198"><span class="hs-identifier">conIndices</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679055199"><a href="#local-6989586621679055199"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055199"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-385"></a><span>           </span><span class="hs-identifier">conIndices</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055200"><a href="#local-6989586621679055200"><span class="hs-identifier">rest</span></a></a><span>     </span><a name="local-6989586621679055201"><a href="#local-6989586621679055201"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055198"><span class="hs-identifier hs-var">conIndices</span></a><span> </span><a href="#local-6989586621679055200"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055201"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-386"></a><span>           </span><span class="hs-identifier">conIndices</span><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#fclError"><span class="hs-identifier hs-var">fclError</span></a><span> </span><span class="hs-string">&quot;Non-AppT in conIndices. Please report this as a bug for fclabels.&quot;</span><span>
</span><a name="line-387"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-identifier">unifiable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-390"></a><a name="unifiable"><a href="Data.Label.Derive.html#unifiable"><span class="hs-identifier">unifiable</span></a></a><span> </span><a name="local-6989586621679055205"><a href="#local-6989586621679055205"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679055206"><a href="#local-6989586621679055206"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-391"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055205"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055206"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-392"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">VarT</span><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-special">,</span><span>      </span><span class="hs-identifier">_</span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-393"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">VarT</span><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-394"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055207"><a href="#local-6989586621679055207"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055208"><a href="#local-6989586621679055208"><span class="hs-identifier">b</span></a></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055209"><a href="#local-6989586621679055209"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679055210"><a href="#local-6989586621679055210"><span class="hs-identifier">d</span></a></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#unifiable"><span class="hs-identifier hs-var">unifiable</span></a><span> </span><a href="#local-6989586621679055207"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679055209"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Data.Label.Derive.html#unifiable"><span class="hs-identifier hs-var">unifiable</span></a><span> </span><a href="#local-6989586621679055208"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679055210"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-395"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679055211"><a href="#local-6989586621679055211"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679055212"><a href="#local-6989586621679055212"><span class="hs-identifier">k</span></a></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679055213"><a href="#local-6989586621679055213"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679055214"><a href="#local-6989586621679055214"><span class="hs-identifier">j</span></a></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#unifiable"><span class="hs-identifier hs-var">unifiable</span></a><span> </span><a href="#local-6989586621679055211"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679055213"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679055212"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679055214"><span class="hs-identifier hs-var">j</span></a><span>
</span><a name="line-396"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055215"><a href="#local-6989586621679055215"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055216"><a href="#local-6989586621679055216"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#unifiable"><span class="hs-identifier hs-var">unifiable</span></a><span> </span><a href="#local-6989586621679055215"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679055216"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-397"></a><span>    </span><span class="hs-special">(</span><span> </span><a name="local-6989586621679055217"><a href="#local-6989586621679055217"><span class="hs-identifier">a</span></a></a><span>             </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055218"><a href="#local-6989586621679055218"><span class="hs-identifier">b</span></a></a><span>             </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055217"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679055218"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">generateLabel</span><span>
</span><a name="line-400"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-401"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-402"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-403"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span>
</span><a name="line-404"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Con</span><span class="hs-special">]</span><span>
</span><a name="line-405"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-type">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-type">Context</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><a href="Data.Label.Derive.html#Label"><span class="hs-identifier hs-type">Label</span></a><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><a name="generateLabel"><a href="Data.Label.Derive.html#generateLabel"><span class="hs-identifier">generateLabel</span></a></a><span> </span><a name="local-6989586621679055219"><a href="#local-6989586621679055219"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679055220"><a href="#local-6989586621679055220"><span class="hs-identifier">concrete</span></a></a><span> </span><a name="local-6989586621679055221"><a href="#local-6989586621679055221"><span class="hs-identifier">datatype</span></a></a><span> </span><a name="local-6989586621679055222"><a href="#local-6989586621679055222"><span class="hs-identifier">dtVars</span></a></a><span> </span><a name="local-6989586621679055223"><a href="#local-6989586621679055223"><span class="hs-identifier">allCons</span></a></a><span>
</span><a name="line-409"></a><span>              </span><a name="local-6989586621679055224"><a href="#local-6989586621679055224"><span class="hs-identifier">field</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a name="local-6989586621679055225"><a href="#local-6989586621679055225"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679055226"><a href="#local-6989586621679055226"><span class="hs-identifier">forcedMono</span></a></a><span> </span><a name="local-6989586621679055227"><a href="#local-6989586621679055227"><span class="hs-identifier">fieldtype</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679055228"><a href="#local-6989586621679055228"><span class="hs-identifier">contexts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055229"><a href="#local-6989586621679055229"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055230"><a href="#local-6989586621679055230"><span class="hs-identifier">total</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679055228"><span class="hs-identifier hs-var">contexts</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#prune"><span class="hs-identifier hs-var">prune</span></a><span> </span><a href="#local-6989586621679055228"><span class="hs-identifier hs-var">contexts</span></a><span> </span><a href="#local-6989586621679055223"><span class="hs-identifier hs-var">allCons</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span>     </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Typing"><span class="hs-identifier hs-var">Typing</span></a><span> </span><a name="local-6989586621679055231"><a href="#local-6989586621679055231"><span class="hs-identifier">mono</span></a></a><span> </span><a name="local-6989586621679055232"><a href="#local-6989586621679055232"><span class="hs-identifier">tyI</span></a></a><span> </span><a name="local-6989586621679055233"><a href="#local-6989586621679055233"><span class="hs-identifier">tyO</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Label.Derive.html#computeTypes"><span class="hs-identifier hs-var">computeTypes</span></a><span> </span><a href="#local-6989586621679055226"><span class="hs-identifier hs-var">forcedMono</span></a><span> </span><a href="#local-6989586621679055227"><span class="hs-identifier hs-var">fieldtype</span></a><span> </span><a href="#local-6989586621679055221"><span class="hs-identifier hs-var">datatype</span></a><span> </span><a href="#local-6989586621679055222"><span class="hs-identifier hs-var">dtVars</span></a><span> </span><a href="#local-6989586621679055229"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055234"><a href="#local-6989586621679055234"><span class="hs-identifier">cat</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;cat&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>         </span><a name="local-6989586621679055235"><a href="#local-6989586621679055235"><span class="hs-identifier">failE</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055219"><span class="hs-identifier hs-var">failing</span></a><span>
</span><a name="line-418"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Point.html#failArrow"><span class="hs-identifier hs-var">failArrow</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-419"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">zeroArrow</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-420"></a><span>         </span><a name="local-6989586621679055236"><a href="#local-6989586621679055236"><span class="hs-identifier">getT</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">arr</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#getter"><span class="hs-identifier hs-var">getter</span></a><span> </span><a href="#local-6989586621679055219"><span class="hs-identifier hs-var">failing</span></a><span> </span><a href="#local-6989586621679055230"><span class="hs-identifier hs-var">total</span></a><span> </span><a href="#local-6989586621679055224"><span class="hs-identifier hs-var">field</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-421"></a><span>         </span><a name="local-6989586621679055237"><a href="#local-6989586621679055237"><span class="hs-identifier">putT</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">arr</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="Data.Label.Derive.html#setter"><span class="hs-identifier hs-var">setter</span></a><span> </span><a href="#local-6989586621679055219"><span class="hs-identifier hs-var">failing</span></a><span> </span><a href="#local-6989586621679055230"><span class="hs-identifier hs-var">total</span></a><span> </span><a href="#local-6989586621679055224"><span class="hs-identifier hs-var">field</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-422"></a><span>         </span><a name="local-6989586621679055238"><a href="#local-6989586621679055238"><span class="hs-identifier">getP</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679055235"><span class="hs-identifier hs-var">failE</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">|||</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">&lt;&lt;&lt;</span><span> </span><a href="#local-6989586621679055236"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">getT</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-423"></a><span>         </span><a name="local-6989586621679055239"><a href="#local-6989586621679055239"><span class="hs-identifier">putP</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679055235"><span class="hs-identifier hs-var">failE</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">|||</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">&lt;&lt;&lt;</span><span> </span><a href="#local-6989586621679055237"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">putT</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-424"></a><span>         </span><a name="local-6989586621679055240"><a href="#local-6989586621679055240"><span class="hs-identifier">failP</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055219"><span class="hs-identifier hs-var">failing</span></a><span>
</span><a name="line-425"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><a href="Data.Label.Derive.html#classP"><span class="hs-identifier hs-var">classP</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">ArrowFail</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055234"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">]</span><span>
</span><a name="line-426"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><a href="Data.Label.Derive.html#classP"><span class="hs-identifier hs-var">classP</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">ArrowZero</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055234"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">]</span><span>
</span><a name="line-427"></a><span>         </span><a name="local-6989586621679055241"><a href="#local-6989586621679055241"><span class="hs-identifier">ctx</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055230"><span class="hs-identifier hs-var">total</span></a><span>
</span><a name="line-428"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">cxt</span><span> </span><span class="hs-special">[</span><span> </span><a href="Data.Label.Derive.html#classP"><span class="hs-identifier hs-var">classP</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">ArrowApply</span><span>  </span><span class="hs-special">[</span><a href="#local-6989586621679055234"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-429"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">cxt</span><span> </span><span class="hs-special">[</span><span> </span><a href="Data.Label.Derive.html#classP"><span class="hs-identifier hs-var">classP</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">ArrowChoice</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055234"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">]</span><span>
</span><a name="line-430"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#classP"><span class="hs-identifier hs-var">classP</span></a><span> </span><span class="hs-special">''</span><span class="hs-identifier">ArrowApply</span><span>  </span><span class="hs-special">[</span><a href="#local-6989586621679055234"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">]</span><span>
</span><a name="line-431"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055240"><span class="hs-identifier hs-var">failP</span></a><span>
</span><a name="line-432"></a><span>                            </span><span class="hs-special">]</span><span>
</span><a name="line-433"></a><span>         </span><a name="local-6989586621679055242"><a href="#local-6989586621679055242"><span class="hs-identifier">body</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055230"><span class="hs-identifier hs-var">total</span></a><span>
</span><a name="line-434"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Poly.html#point"><span class="hs-identifier hs-var">Poly</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">point</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Label.Point.html#Point"><span class="hs-identifier hs-var">Point</span></a><span> </span><a href="#local-6989586621679055236"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">getT</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#modifier"><span class="hs-identifier hs-var">modifier</span></a><span> </span><a href="#local-6989586621679055236"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">getT</span></a><span> </span><a href="#local-6989586621679055237"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">putT</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-435"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Poly.html#point"><span class="hs-identifier hs-var">Poly</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">point</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Label.Point.html#Point"><span class="hs-identifier hs-var">Point</span></a><span> </span><a href="#local-6989586621679055238"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">getP</span></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#modifier"><span class="hs-identifier hs-var">modifier</span></a><span> </span><a href="#local-6989586621679055238"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">getP</span></a><span> </span><a href="#local-6989586621679055239"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">putP</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-436"></a><span>         </span><a name="local-6989586621679055243"><a href="#local-6989586621679055243"><span class="hs-identifier">cont</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055220"><span class="hs-identifier hs-var">concrete</span></a><span>
</span><a name="line-437"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">cxt</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-438"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679055241"><span class="hs-identifier hs-var">ctx</span></a><span>
</span><a name="line-439"></a><span>         </span><a name="local-6989586621679055244"><a href="#local-6989586621679055244"><span class="hs-identifier">partial</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055219"><span class="hs-identifier hs-var">failing</span></a><span>
</span><a name="line-440"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Point.html#Failing"><span class="hs-identifier hs-type">Failing</span></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-441"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Point.html#Partial"><span class="hs-identifier hs-type">Partial</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-442"></a><span>         </span><a name="local-6989586621679055245"><a href="#local-6989586621679055245"><span class="hs-identifier">concTy</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055230"><span class="hs-identifier hs-var">total</span></a><span>
</span><a name="line-443"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055231"><span class="hs-identifier hs-var">mono</span></a><span>
</span><a name="line-444"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Mono.html#Lens"><span class="hs-identifier hs-type">Mono</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="Data.Label.Point.html#Total"><span class="hs-identifier hs-type">Total</span></a><span> </span><a href="#local-6989586621679055232"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><a href="#local-6989586621679055233"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-445"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Poly.html#Lens"><span class="hs-identifier hs-type">Poly</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="Data.Label.Point.html#Total"><span class="hs-identifier hs-type">Total</span></a><span> </span><a href="#local-6989586621679055232"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><a href="#local-6989586621679055233"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-446"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055231"><span class="hs-identifier hs-var">mono</span></a><span>
</span><a name="line-447"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Mono.html#Lens"><span class="hs-identifier hs-type">Mono</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="#local-6989586621679055244"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">partial</span></a><span> </span><a href="#local-6989586621679055232"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><a href="#local-6989586621679055233"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-448"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Poly.html#Lens"><span class="hs-identifier hs-type">Poly</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="#local-6989586621679055244"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">partial</span></a><span> </span><a href="#local-6989586621679055232"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><a href="#local-6989586621679055233"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-449"></a><span>         </span><a name="local-6989586621679055246"><a href="#local-6989586621679055246"><span class="hs-identifier">ty</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055220"><span class="hs-identifier hs-var">concrete</span></a><span>
</span><a name="line-450"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679055245"><span class="hs-identifier hs-var">concTy</span></a><span>
</span><a name="line-451"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055231"><span class="hs-identifier hs-var">mono</span></a><span>
</span><a name="line-452"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Mono.html#Lens"><span class="hs-identifier hs-type">Mono</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="#local-6989586621679055234"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">cat</span></a><span> </span><a href="#local-6989586621679055232"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><a href="#local-6989586621679055233"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-453"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Data.Label.Poly.html#Lens"><span class="hs-identifier hs-type">Poly</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="#local-6989586621679055234"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">cat</span></a><span> </span><a href="#local-6989586621679055232"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><a href="#local-6989586621679055233"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span>     </span><a name="local-6989586621679055275"><a href="#local-6989586621679055275"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Label.Derive.html#binderFromType"><span class="hs-identifier hs-var">binderFromType</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055246"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-456"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-457"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055225"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-458"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#LabelExpr"><span class="hs-identifier hs-var">LabelExpr</span></a><span> </span><a href="#local-6989586621679055275"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679055243"><span class="hs-identifier hs-var">cont</span></a><span> </span><a href="#local-6989586621679055246"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679055242"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-459"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055276"><a href="#local-6989586621679055276"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,8,0)</span><span>
</span><a name="line-462"></a><span>           </span><span class="hs-comment">-- Generate an inline declaration for the label.</span><span>
</span><a name="line-463"></a><span>           </span><span class="hs-comment">-- Type of InlineSpec removed in TH-2.8.0 (GHC 7.6)</span><span>
</span><a name="line-464"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055277"><a href="#local-6989586621679055277"><span class="hs-identifier">inline</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InlineP</span><span> </span><a href="#local-6989586621679055276"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-identifier hs-var">Inline</span><span> </span><span class="hs-identifier hs-var">FunLike</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromPhase</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-466"></a><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">inline</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">InlineP</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InlineSpec</span><span> </span><span class="hs-identifier">True</span><span> </span><span class="hs-identifier">True</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">True</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-468"></a><span>            </span><span class="hs-keyword">in</span><span> </span><a href="Data.Label.Derive.html#LabelDecl"><span class="hs-identifier hs-var">LabelDecl</span></a><span> </span><a href="#local-6989586621679055276"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PragmaD</span><span> </span><a href="#local-6989586621679055277"><span class="hs-identifier hs-var">inline</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055275"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621679055243"><span class="hs-identifier hs-var">cont</span></a><span> </span><a href="#local-6989586621679055246"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679055242"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-comment">-- Build a total polymorphic modification function from a getter and setter.</span><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-identifier">modifier</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ArrowApply</span><span> </span><a href="#local-6989586621679053964"><span class="hs-identifier hs-type">cat</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679053964"><span class="hs-identifier hs-type">cat</span></a><span> </span><a href="#local-6989586621679053965"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679053966"><span class="hs-identifier hs-type">o</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679053964"><span class="hs-identifier hs-type">cat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679053967"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679053965"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679053968"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679053964"><span class="hs-identifier hs-type">cat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679053964"><span class="hs-identifier hs-type">cat</span></a><span> </span><a href="#local-6989586621679053966"><span class="hs-identifier hs-type">o</span></a><span> </span><a href="#local-6989586621679053967"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679053965"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679053968"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-473"></a><a name="modifier"><a href="Data.Label.Derive.html#modifier"><span class="hs-identifier">modifier</span></a></a><span> </span><a name="local-6989586621679055278"><a href="#local-6989586621679055278"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679055279"><a href="#local-6989586621679055279"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055279"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">app</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">arr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679055280"><a href="#local-6989586621679055280"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679055281"><a href="#local-6989586621679055281"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055282"><a href="#local-6989586621679055282"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679055280"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055282"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055281"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><a href="#local-6989586621679055278"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-474"></a><span class="hs-pragma">{-# INLINE modifier #-}</span><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-identifier">getter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-type">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-type">Context</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a name="line-479"></a><a name="getter"><a href="Data.Label.Derive.html#getter"><span class="hs-identifier">getter</span></a></a><span> </span><a name="local-6989586621679055283"><a href="#local-6989586621679055283"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679055284"><a href="#local-6989586621679055284"><span class="hs-identifier">total</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a name="local-6989586621679055285"><a href="#local-6989586621679055285"><span class="hs-identifier">mn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679055286"><a href="#local-6989586621679055286"><span class="hs-identifier">cons</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-480"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055308"><a href="#local-6989586621679055308"><span class="hs-identifier">pt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;f&quot;</span><span>
</span><a name="line-481"></a><span>         </span><a name="local-6989586621679055309"><a href="#local-6989586621679055309"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupE</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">litE</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">guard</span><span> </span><a href="#local-6989586621679055283"><span class="hs-identifier hs-var">failing</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679055285"><span class="hs-identifier hs-var">mn</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>         </span><a name="local-6989586621679055310"><a href="#local-6989586621679055310"><span class="hs-identifier">wild</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055284"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">match</span><span> </span><span class="hs-identifier hs-var">wildP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">normalB</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679055309"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-483"></a><span>         </span><a name="local-6989586621679055311"><a href="#local-6989586621679055311"><span class="hs-identifier">rght</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055284"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">appE</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-484"></a><span>         </span><a name="local-6989586621679055312"><a href="#local-6989586621679055312"><span class="hs-identifier">mkCase</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a name="local-6989586621679055314"><a href="#local-6989586621679055314"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055315"><a href="#local-6989586621679055315"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679055316"><a href="#local-6989586621679055316"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055317"><a href="#local-6989586621679055317"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">match</span><span> </span><a href="#local-6989586621679055316"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">normalB</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055311"><span class="hs-identifier hs-var">rght</span></a><span> </span><a href="#local-6989586621679055317"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055287"><span class="hs-identifier hs-var">case1</span></a><span> </span><a href="#local-6989586621679055314"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055315"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span>     </span><span class="hs-identifier hs-var">lamE</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">varP</span><span> </span><a href="#local-6989586621679055308"><span class="hs-identifier hs-var">pt</span></a><span class="hs-special">]</span><span>
</span><a name="line-486"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">caseE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">varE</span><span> </span><a href="#local-6989586621679055308"><span class="hs-identifier hs-var">pt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621679055312"><span class="hs-identifier hs-var">mkCase</span></a><span> </span><a href="#local-6989586621679055286"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055310"><span class="hs-identifier hs-var">wild</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-487"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-488"></a><span>  </span><span class="hs-identifier">case1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-489"></a><span>  </span><a name="local-6989586621679055287"><a href="#local-6989586621679055287"><span class="hs-identifier">case1</span></a></a><span> </span><a name="local-6989586621679055288"><a href="#local-6989586621679055288"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679055289"><a href="#local-6989586621679055289"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-490"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055289"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-491"></a><span>      </span><span class="hs-identifier hs-var">NormalC</span><span>  </span><a name="local-6989586621679055298"><a href="#local-6989586621679055298"><span class="hs-identifier">c</span></a></a><span>  </span><a name="local-6989586621679055299"><a href="#local-6989586621679055299"><span class="hs-identifier">fs</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055294"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055299"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621679055298"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-492"></a><span>      </span><span class="hs-identifier hs-var">RecC</span><span>     </span><a name="local-6989586621679055300"><a href="#local-6989586621679055300"><span class="hs-identifier">c</span></a></a><span>  </span><a name="local-6989586621679055301"><a href="#local-6989586621679055301"><span class="hs-identifier">fs</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055294"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055301"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621679055300"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-493"></a><span>      </span><span class="hs-identifier hs-var">InfixC</span><span>   </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621679055302"><a href="#local-6989586621679055302"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">infixP</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055292"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055302"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055292"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055293"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-494"></a><span>      </span><span class="hs-identifier hs-var">ForallC</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621679055303"><a href="#local-6989586621679055303"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055287"><span class="hs-identifier hs-var">case1</span></a><span> </span><a href="#local-6989586621679055288"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055303"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-495"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-496"></a><span>      </span><span class="hs-identifier hs-var">GadtC</span><span>    </span><a name="local-6989586621679055304"><a href="#local-6989586621679055304"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679055305"><a href="#local-6989586621679055305"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055294"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055305"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055304"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-497"></a><span>      </span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679055306"><a href="#local-6989586621679055306"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679055307"><a href="#local-6989586621679055307"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055294"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055307"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055306"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-498"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055290"><a href="#local-6989586621679055290"><span class="hs-identifier">fresh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">delete</span><span> </span><span class="hs-string">&quot;f&quot;</span><span> </span><a href="Data.Label.Derive.html#freshNames"><span class="hs-identifier hs-var">freshNames</span></a><span>
</span><a name="line-500"></a><span>          </span><a name="local-6989586621679055291"><a href="#local-6989586621679055291"><span class="hs-identifier">pats1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varP</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055290"><span class="hs-identifier hs-var">fresh</span></a><span>
</span><a name="line-501"></a><span>          </span><a name="local-6989586621679055292"><a href="#local-6989586621679055292"><span class="hs-identifier">pats</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679055288"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">wildP</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055291"><span class="hs-identifier hs-var">pats1</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><a href="#local-6989586621679055288"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><span class="hs-identifier hs-var">wildP</span><span>
</span><a name="line-502"></a><span>          </span><a name="local-6989586621679055293"><a href="#local-6989586621679055293"><span class="hs-identifier">var</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varE</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055290"><span class="hs-identifier hs-var">fresh</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><a href="#local-6989586621679055288"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>          </span><a name="local-6989586621679055294"><a href="#local-6989586621679055294"><span class="hs-identifier">one</span></a></a><span> </span><a name="local-6989586621679055295"><a href="#local-6989586621679055295"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679055296"><a href="#local-6989586621679055296"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055297"><a href="#local-6989586621679055297"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679055295"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">conP</span><span> </span><a href="#local-6989586621679055296"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055297"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679055292"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055293"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-identifier">setter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-type">Field</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-type">Context</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a name="line-506"></a><a name="setter"><a href="Data.Label.Derive.html#setter"><span class="hs-identifier">setter</span></a></a><span> </span><a name="local-6989586621679055318"><a href="#local-6989586621679055318"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679055319"><a href="#local-6989586621679055319"><span class="hs-identifier">total</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Field"><span class="hs-identifier hs-var">Field</span></a><span> </span><a name="local-6989586621679055320"><a href="#local-6989586621679055320"><span class="hs-identifier">mn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679055321"><a href="#local-6989586621679055321"><span class="hs-identifier">cons</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-507"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055428"><a href="#local-6989586621679055428"><span class="hs-identifier">pt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;f&quot;</span><span>
</span><a name="line-508"></a><span>         </span><a name="local-6989586621679055429"><a href="#local-6989586621679055429"><span class="hs-identifier">md</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;v&quot;</span><span>
</span><a name="line-509"></a><span>         </span><a name="local-6989586621679055430"><a href="#local-6989586621679055430"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupE</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">litE</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">StringL</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">guard</span><span> </span><a href="#local-6989586621679055318"><span class="hs-identifier hs-var">failing</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679055320"><span class="hs-identifier hs-var">mn</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>         </span><a name="local-6989586621679055431"><a href="#local-6989586621679055431"><span class="hs-identifier">wild</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055319"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">match</span><span> </span><span class="hs-identifier hs-var">wildP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">normalB</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679055430"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-511"></a><span>         </span><a name="local-6989586621679055432"><a href="#local-6989586621679055432"><span class="hs-identifier">rght</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055319"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">appE</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-512"></a><span>         </span><a name="local-6989586621679055433"><a href="#local-6989586621679055433"><span class="hs-identifier">mkCase</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#Context"><span class="hs-identifier hs-var">Context</span></a><span> </span><a name="local-6989586621679055435"><a href="#local-6989586621679055435"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679055436"><a href="#local-6989586621679055436"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679055437"><a href="#local-6989586621679055437"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055438"><a href="#local-6989586621679055438"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">match</span><span> </span><a href="#local-6989586621679055437"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">normalB</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055432"><span class="hs-identifier hs-var">rght</span></a><span> </span><a href="#local-6989586621679055438"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055322"><span class="hs-identifier hs-var">case1</span></a><span> </span><a href="#local-6989586621679055435"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055436"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>     </span><span class="hs-identifier hs-var">lamE</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">tupP</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">varP</span><span> </span><a href="#local-6989586621679055429"><span class="hs-identifier hs-var">md</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varP</span><span> </span><a href="#local-6989586621679055428"><span class="hs-identifier hs-var">pt</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-514"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">caseE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">varE</span><span> </span><a href="#local-6989586621679055428"><span class="hs-identifier hs-var">pt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621679055433"><span class="hs-identifier hs-var">mkCase</span></a><span> </span><a href="#local-6989586621679055321"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055431"><span class="hs-identifier hs-var">wild</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-516"></a><span>  </span><a name="local-6989586621679055322"><a href="#local-6989586621679055322"><span class="hs-identifier">case1</span></a></a><span> </span><a name="local-6989586621679055323"><a href="#local-6989586621679055323"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679055324"><a href="#local-6989586621679055324"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-517"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055324"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-518"></a><span>      </span><span class="hs-identifier hs-var">NormalC</span><span>  </span><a name="local-6989586621679055418"><a href="#local-6989586621679055418"><span class="hs-identifier">c</span></a></a><span>  </span><a name="local-6989586621679055419"><a href="#local-6989586621679055419"><span class="hs-identifier">fs</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055332"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055419"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621679055418"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-519"></a><span>      </span><span class="hs-identifier hs-var">RecC</span><span>     </span><a name="local-6989586621679055420"><a href="#local-6989586621679055420"><span class="hs-identifier">c</span></a></a><span>  </span><a name="local-6989586621679055421"><a href="#local-6989586621679055421"><span class="hs-identifier">fs</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055332"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055421"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621679055420"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-520"></a><span>      </span><span class="hs-identifier hs-var">InfixC</span><span>   </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621679055422"><a href="#local-6989586621679055422"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">infixP</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055327"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055422"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055327"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">infixE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055330"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">conE</span><span> </span><a href="#local-6989586621679055422"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055330"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>                          </span><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>                         </span><span class="hs-special">]</span><span>
</span><a name="line-524"></a><span>      </span><span class="hs-identifier hs-var">ForallC</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621679055423"><a href="#local-6989586621679055423"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055322"><span class="hs-identifier hs-var">case1</span></a><span> </span><a href="#local-6989586621679055323"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055423"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-525"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a name="line-526"></a><span>      </span><span class="hs-identifier hs-var">GadtC</span><span>    </span><a name="local-6989586621679055424"><a href="#local-6989586621679055424"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679055425"><a href="#local-6989586621679055425"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055332"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055425"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055424"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-527"></a><span>      </span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><a name="local-6989586621679055426"><a href="#local-6989586621679055426"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621679055427"><a href="#local-6989586621679055427"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055332"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="#local-6989586621679055427"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055426"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-528"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055325"><a href="#local-6989586621679055325"><span class="hs-identifier">fresh</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">delete</span><span> </span><span class="hs-string">&quot;f&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">delete</span><span> </span><span class="hs-string">&quot;v&quot;</span><span> </span><a href="Data.Label.Derive.html#freshNames"><span class="hs-identifier hs-var">freshNames</span></a><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>          </span><a name="local-6989586621679055326"><a href="#local-6989586621679055326"><span class="hs-identifier">pats1</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varP</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055325"><span class="hs-identifier hs-var">fresh</span></a><span>
</span><a name="line-531"></a><span>          </span><a name="local-6989586621679055327"><a href="#local-6989586621679055327"><span class="hs-identifier">pats</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679055323"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055326"><span class="hs-identifier hs-var">pats1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">wildP</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055323"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055326"><span class="hs-identifier hs-var">pats1</span></a><span>
</span><a name="line-532"></a><span>          </span><a name="local-6989586621679055328"><a href="#local-6989586621679055328"><span class="hs-identifier">vars1</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varE</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055325"><span class="hs-identifier hs-var">fresh</span></a><span>
</span><a name="line-533"></a><span>          </span><a name="local-6989586621679055329"><a href="#local-6989586621679055329"><span class="hs-identifier">v</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;v&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>          </span><a name="local-6989586621679055330"><a href="#local-6989586621679055330"><span class="hs-identifier">vars</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679055323"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679055328"><span class="hs-identifier hs-var">vars1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055329"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055323"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055328"><span class="hs-identifier hs-var">vars1</span></a><span>
</span><a name="line-535"></a><span>          </span><a name="local-6989586621679055331"><a href="#local-6989586621679055331"><span class="hs-identifier">apps</span></a></a><span> </span><a name="local-6989586621679055413"><a href="#local-6989586621679055413"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-identifier hs-var">appE</span><span> </span><a href="#local-6989586621679055413"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-536"></a><span>          </span><a name="local-6989586621679055332"><a href="#local-6989586621679055332"><span class="hs-identifier">one</span></a></a><span> </span><a name="local-6989586621679055415"><a href="#local-6989586621679055415"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679055416"><a href="#local-6989586621679055416"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055417"><a href="#local-6989586621679055417"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679055415"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">conP</span><span> </span><a href="#local-6989586621679055416"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055417"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679055327"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055331"><span class="hs-identifier hs-var">apps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">conE</span><span> </span><a href="#local-6989586621679055416"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055417"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679055330"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-identifier">freshNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-539"></a><a name="freshNames"><a href="Data.Label.Derive.html#freshNames"><span class="hs-identifier">freshNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-char">'a'</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-identifier">computeTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><a href="Data.Label.Derive.html#Typing"><span class="hs-identifier hs-type">Typing</span></a><span>
</span><a name="line-544"></a><a name="computeTypes"><a href="Data.Label.Derive.html#computeTypes"><span class="hs-identifier">computeTypes</span></a></a><span> </span><a name="local-6989586621679055439"><a href="#local-6989586621679055439"><span class="hs-identifier">forcedMono</span></a></a><span> </span><a name="local-6989586621679055440"><a href="#local-6989586621679055440"><span class="hs-identifier">fieldtype</span></a></a><span> </span><a name="local-6989586621679055441"><a href="#local-6989586621679055441"><span class="hs-identifier">datatype</span></a></a><span> </span><a name="local-6989586621679055442"><a href="#local-6989586621679055442"><span class="hs-identifier">dtVars_</span></a></a><span> </span><a name="local-6989586621679055443"><a href="#local-6989586621679055443"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055444"><a href="#local-6989586621679055444"><span class="hs-identifier">fieldVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055440"><span class="hs-identifier hs-var">fieldtype</span></a><span>
</span><a name="line-547"></a><span>         </span><a name="local-6989586621679055445"><a href="#local-6989586621679055445"><span class="hs-identifier">tyO</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055440"><span class="hs-identifier hs-var">fieldtype</span></a><span>
</span><a name="line-548"></a><span>         </span><a name="local-6989586621679055446"><a href="#local-6989586621679055446"><span class="hs-identifier">dtTypes</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#substitute"><span class="hs-identifier hs-var">substitute</span></a><span> </span><a href="#local-6989586621679055443"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Label.Derive.html#typeFromBinder"><span class="hs-identifier hs-var">typeFromBinder</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055442"><span class="hs-identifier hs-var">dtVars_</span></a><span>
</span><a name="line-549"></a><span>         </span><a name="local-6989586621679055447"><a href="#local-6989586621679055447"><span class="hs-identifier">dtBinders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Data.Label.Derive.html#binderFromType"><span class="hs-identifier hs-var">binderFromType</span></a><span> </span><a href="#local-6989586621679055446"><span class="hs-identifier hs-var">dtTypes</span></a><span>
</span><a name="line-550"></a><span>         </span><a name="local-6989586621679055448"><a href="#local-6989586621679055448"><span class="hs-identifier">varNames</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#nameFromBinder"><span class="hs-identifier hs-var">nameFromBinder</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055447"><span class="hs-identifier hs-var">dtBinders</span></a><span>
</span><a name="line-551"></a><span>         </span><a name="local-6989586621679055449"><a href="#local-6989586621679055449"><span class="hs-identifier">usedVars</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679055444"><span class="hs-identifier hs-var">fieldVars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055448"><span class="hs-identifier hs-var">varNames</span></a><span>
</span><a name="line-552"></a><span>         </span><a name="local-6989586621679055450"><a href="#local-6989586621679055450"><span class="hs-identifier">tyI</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">AppT</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a href="#local-6989586621679055441"><span class="hs-identifier hs-var">datatype</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679055446"><span class="hs-identifier hs-var">dtTypes</span></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>         </span><a name="local-6989586621679055451"><a href="#local-6989586621679055451"><span class="hs-identifier">pretties</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#mapTyVarBndr"><span class="hs-identifier hs-var">mapTyVarBndr</span></a><span> </span><a href="Data.Label.Derive.html#pretty"><span class="hs-identifier hs-var">pretty</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055447"><span class="hs-identifier hs-var">dtBinders</span></a><span>
</span><a name="line-554"></a><span>         </span><a name="local-6989586621679055452"><a href="#local-6989586621679055452"><span class="hs-identifier">mono</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055439"><span class="hs-identifier hs-var">forcedMono</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Data.Label.Derive.html#isMonomorphic"><span class="hs-identifier hs-var">isMonomorphic</span></a><span> </span><a href="#local-6989586621679055440"><span class="hs-identifier hs-var">fieldtype</span></a><span> </span><a href="#local-6989586621679055447"><span class="hs-identifier hs-var">dtBinders</span></a><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span>     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055452"><span class="hs-identifier hs-var">mono</span></a><span>
</span><a name="line-557"></a><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Label.Derive.html#Typing"><span class="hs-identifier hs-var">Typing</span></a><span>
</span><a name="line-558"></a><span>               </span><a href="#local-6989586621679055452"><span class="hs-identifier hs-var">mono</span></a><span>
</span><a name="line-559"></a><span>               </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#prettyType"><span class="hs-identifier hs-var">prettyType</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055450"><span class="hs-identifier hs-var">tyI</span></a><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>               </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#prettyType"><span class="hs-identifier hs-var">prettyType</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055445"><span class="hs-identifier hs-var">tyO</span></a><span class="hs-special">)</span><span>
</span><a name="line-561"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nub</span><span> </span><a href="#local-6989586621679055451"><span class="hs-identifier hs-var">pretties</span></a><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>       </span><span class="hs-keyword">else</span><span>
</span><a name="line-563"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055453"><a href="#local-6989586621679055453"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span>
</span><a name="line-564"></a><span>                </span><a name="local-6989586621679055454"><a href="#local-6989586621679055454"><span class="hs-identifier">used</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Label.Derive.html#pretty"><span class="hs-identifier hs-var">pretty</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055448"><span class="hs-identifier hs-var">varNames</span></a><span>
</span><a name="line-565"></a><span>                </span><a name="local-6989586621679055455"><a href="#local-6989586621679055455"><span class="hs-identifier">free</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679055454"><span class="hs-identifier hs-var">used</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055453"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-566"></a><span>            </span><a name="local-6989586621679055458"><a href="#local-6989586621679055458"><span class="hs-identifier">subs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679055449"><span class="hs-identifier hs-var">usedVars</span></a><span> </span><a href="#local-6989586621679055455"><span class="hs-identifier hs-var">free</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679055456"><a href="#local-6989586621679055456"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679055457"><a href="#local-6989586621679055457"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055456"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">newName</span><span> </span><a href="#local-6989586621679055457"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-567"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055459"><a href="#local-6989586621679055459"><span class="hs-identifier">rename</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#mapTypeVariables"><span class="hs-identifier hs-var">mapTypeVariables</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679055460"><a href="#local-6989586621679055460"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055460"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679055460"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679055458"><span class="hs-identifier hs-var">subs</span></a><span class="hs-special">)</span><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Label.Derive.html#Typing"><span class="hs-identifier hs-var">Typing</span></a><span>
</span><a name="line-570"></a><span>              </span><a href="#local-6989586621679055452"><span class="hs-identifier hs-var">mono</span></a><span>
</span><a name="line-571"></a><span>              </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#prettyType"><span class="hs-identifier hs-var">prettyType</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679055450"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679055459"><span class="hs-identifier hs-var">rename</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055450"><span class="hs-identifier hs-var">tyI</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>              </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#prettyType"><span class="hs-identifier hs-var">prettyType</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679055445"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tyO</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679055459"><span class="hs-identifier hs-var">rename</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055445"><span class="hs-identifier hs-var">tyO</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055451"><span class="hs-identifier hs-var">pretties</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#mapTyVarBndr"><span class="hs-identifier hs-var">mapTyVarBndr</span></a><span> </span><a href="Data.Label.Derive.html#pretty"><span class="hs-identifier hs-var">pretty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PlainTV</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055458"><span class="hs-identifier hs-var">subs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-identifier">isMonomorphic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-576"></a><a name="isMonomorphic"><a href="Data.Label.Derive.html#isMonomorphic"><span class="hs-identifier">isMonomorphic</span></a></a><span> </span><a name="local-6989586621679055465"><a href="#local-6989586621679055465"><span class="hs-identifier">field</span></a></a><span> </span><a name="local-6989586621679055466"><a href="#local-6989586621679055466"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-577"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679055467"><a href="#local-6989586621679055467"><span class="hs-identifier">fieldVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier hs-var">typeVariables</span></a><span> </span><a href="#local-6989586621679055465"><span class="hs-identifier hs-var">field</span></a><span>
</span><a name="line-578"></a><span>      </span><a name="local-6989586621679055468"><a href="#local-6989586621679055468"><span class="hs-identifier">varNames</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#nameFromBinder"><span class="hs-identifier hs-var">nameFromBinder</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055466"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-579"></a><span>      </span><a name="local-6989586621679055469"><a href="#local-6989586621679055469"><span class="hs-identifier">usedVars</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679055467"><span class="hs-identifier hs-var">fieldVars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055468"><span class="hs-identifier hs-var">varNames</span></a><span>
</span><a name="line-580"></a><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679055469"><span class="hs-identifier hs-var">usedVars</span></a><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-583"></a><span class="hs-comment">-- Generic helper functions dealing with Template Haskell</span><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span class="hs-identifier">typeVariables</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-586"></a><a name="typeVariables"><a href="Data.Label.Derive.html#typeVariables"><span class="hs-identifier">typeVariables</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Data.Label.Derive.html#nameFromBinder"><span class="hs-identifier hs-var">nameFromBinder</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Label.Derive.html#binderFromType"><span class="hs-identifier hs-var">binderFromType</span></a><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span class="hs-identifier">typeFromBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyVarBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-589"></a><a name="typeFromBinder"><a href="Data.Label.Derive.html#typeFromBinder"><span class="hs-identifier">typeFromBinder</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PlainTV</span><span>  </span><a name="local-6989586621679055470"><a href="#local-6989586621679055470"><span class="hs-identifier">tv</span></a></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">VarT</span><span> </span><a href="#local-6989586621679055470"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-590"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,8,0)</span><span>
</span><a name="line-591"></a><span class="hs-identifier">typeFromBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTV</span><span> </span><a name="local-6989586621679055471"><a href="#local-6989586621679055471"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier hs-var">StarT</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">VarT</span><span> </span><a href="#local-6989586621679055471"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-592"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-593"></a><span class="hs-identifier">typeFromBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">KindedTV</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-identifier">StarK</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">VarT</span><span> </span><span class="hs-identifier">tv</span><span>
</span><a name="line-594"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-595"></a><span class="hs-identifier">typeFromBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTV</span><span> </span><a name="local-6989586621679055472"><a href="#local-6989586621679055472"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679055473"><a href="#local-6989586621679055473"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SigT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarT</span><span> </span><a href="#local-6989586621679055472"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055473"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-identifier">binderFromType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span>
</span><a name="line-598"></a><a name="binderFromType"><a href="Data.Label.Derive.html#binderFromType"><span class="hs-identifier">binderFromType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055474"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-599"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>  </span><a name="local-6989586621679055474"><a href="#local-6989586621679055474"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679055475"><a href="#local-6989586621679055475"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-601"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055475"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-602"></a><span>      </span><span class="hs-identifier hs-var">ForallT</span><span> </span><a name="local-6989586621679055476"><a href="#local-6989586621679055476"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055476"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-603"></a><span>      </span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055477"><a href="#local-6989586621679055477"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055478"><a href="#local-6989586621679055478"><span class="hs-identifier">b</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055474"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055477"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055474"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055478"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-604"></a><span>      </span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679055479"><a href="#local-6989586621679055479"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055474"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055479"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-605"></a><span>      </span><span class="hs-identifier hs-var">VarT</span><span> </span><a name="local-6989586621679055480"><a href="#local-6989586621679055480"><span class="hs-identifier">n</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">PlainTV</span><span> </span><a href="#local-6989586621679055480"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-606"></a><span>      </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-607"></a><span>
</span><a name="line-608"></a><span class="hs-identifier">mapTypeVariables</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-609"></a><a name="mapTypeVariables"><a href="Data.Label.Derive.html#mapTypeVariables"><span class="hs-identifier">mapTypeVariables</span></a></a><span> </span><a name="local-6989586621679055481"><a href="#local-6989586621679055481"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055482"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-610"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-611"></a><span>  </span><a name="local-6989586621679055482"><a href="#local-6989586621679055482"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679055483"><a href="#local-6989586621679055483"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-612"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055483"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-613"></a><span>      </span><span class="hs-identifier hs-var">ForallT</span><span> </span><a name="local-6989586621679055484"><a href="#local-6989586621679055484"><span class="hs-identifier">ts</span></a></a><span> </span><a name="local-6989586621679055485"><a href="#local-6989586621679055485"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055486"><a href="#local-6989586621679055486"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#mapTyVarBndr"><span class="hs-identifier hs-var">mapTyVarBndr</span></a><span> </span><a href="#local-6989586621679055481"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055484"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>                                </span><span class="hs-special">(</span><a href="Data.Label.Derive.html#mapPred"><span class="hs-identifier hs-var">mapPred</span></a><span> </span><a href="#local-6989586621679055481"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679055485"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055482"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055486"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-615"></a><span>      </span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055487"><a href="#local-6989586621679055487"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055488"><a href="#local-6989586621679055488"><span class="hs-identifier">b</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055482"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055487"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055482"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055488"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-616"></a><span>      </span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679055489"><a href="#local-6989586621679055489"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679055490"><a href="#local-6989586621679055490"><span class="hs-identifier">a</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">SigT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055482"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055489"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055490"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-617"></a><span>      </span><span class="hs-identifier hs-var">VarT</span><span> </span><a name="local-6989586621679055491"><a href="#local-6989586621679055491"><span class="hs-identifier">n</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">VarT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055481"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055491"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>      </span><a name="local-6989586621679055492"><a href="#local-6989586621679055492"><span class="hs-identifier">t</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055492"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-identifier">mapType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-621"></a><a name="mapType"><a href="Data.Label.Derive.html#mapType"><span class="hs-identifier">mapType</span></a></a><span> </span><a name="local-6989586621679055493"><a href="#local-6989586621679055493"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055494"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-622"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-623"></a><span>  </span><a name="local-6989586621679055494"><a href="#local-6989586621679055494"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679055495"><a href="#local-6989586621679055495"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-624"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055495"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-625"></a><span>      </span><span class="hs-identifier hs-var">ForallT</span><span> </span><a name="local-6989586621679055496"><a href="#local-6989586621679055496"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679055497"><a href="#local-6989586621679055497"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679055498"><a href="#local-6989586621679055498"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><a href="#local-6989586621679055496"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679055497"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055494"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055498"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span>      </span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679055499"><a href="#local-6989586621679055499"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679055500"><a href="#local-6989586621679055500"><span class="hs-identifier">b</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055494"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055499"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055494"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055500"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>      </span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679055501"><a href="#local-6989586621679055501"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679055502"><a href="#local-6989586621679055502"><span class="hs-identifier">k</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055494"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679055501"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055502"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span>      </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055495"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-629"></a><span>
</span><a name="line-630"></a><span class="hs-identifier">substitute</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Label.Derive.html#Subst"><span class="hs-identifier hs-type">Subst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-631"></a><a name="substitute"><a href="Data.Label.Derive.html#substitute"><span class="hs-identifier">substitute</span></a></a><span> </span><a name="local-6989586621679055503"><a href="#local-6989586621679055503"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="#local-6989586621679055504"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-632"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055504"><a href="#local-6989586621679055504"><span class="hs-identifier">sub</span></a></a><span> </span><a name="local-6989586621679055505"><a href="#local-6989586621679055505"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679055505"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679055503"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-633"></a><span>                  </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055505"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-634"></a><span>                  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055506"><a href="#local-6989586621679055506"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055506"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span class="hs-identifier">nameFromBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyVarBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-637"></a><a name="nameFromBinder"><a href="Data.Label.Derive.html#nameFromBinder"><span class="hs-identifier">nameFromBinder</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PlainTV</span><span>  </span><a name="local-6989586621679055507"><a href="#local-6989586621679055507"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055507"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-638"></a><span class="hs-identifier">nameFromBinder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTV</span><span> </span><a name="local-6989586621679055508"><a href="#local-6989586621679055508"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055508"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span class="hs-identifier">mapPred</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pred</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pred</span><span>
</span><a name="line-641"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,10,0)</span><span>
</span><a name="line-642"></a><a name="mapPred"><a href="Data.Label.Derive.html#mapPred"><span class="hs-identifier">mapPred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#mapTypeVariables"><span class="hs-identifier hs-var">mapTypeVariables</span></a><span>
</span><a name="line-643"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-644"></a><span class="hs-identifier">mapPred</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClassP</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">ts</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ClassP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mapTypeVariables</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">ts</span><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span class="hs-identifier">mapPred</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">EqualP</span><span> </span><span class="hs-identifier">t</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">EqualP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mapTypeVariables</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">t</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mapTypeVariables</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-identifier">mapTyVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyVarBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyVarBndr</span><span>
</span><a name="line-649"></a><a name="mapTyVarBndr"><a href="Data.Label.Derive.html#mapTyVarBndr"><span class="hs-identifier">mapTyVarBndr</span></a></a><span> </span><a name="local-6989586621679055509"><a href="#local-6989586621679055509"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PlainTV</span><span>  </span><a name="local-6989586621679055510"><a href="#local-6989586621679055510"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PlainTV</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055509"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055510"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span class="hs-identifier">mapTyVarBndr</span><span> </span><a name="local-6989586621679055511"><a href="#local-6989586621679055511"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTV</span><span> </span><a name="local-6989586621679055512"><a href="#local-6989586621679055512"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679055513"><a href="#local-6989586621679055513"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">KindedTV</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055511"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055512"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055513"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-comment">-- Prettify a TH name.</span><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span class="hs-identifier">pretty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-655"></a><a name="pretty"><a href="Data.Label.Derive.html#pretty"><span class="hs-identifier">pretty</span></a></a><span> </span><a name="local-6989586621679055514"><a href="#local-6989586621679055514"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'_'</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055514"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><span class="hs-comment">-- Prettify a type.</span><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-identifier">prettyType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-660"></a><a name="prettyType"><a href="Data.Label.Derive.html#prettyType"><span class="hs-identifier">prettyType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Label.Derive.html#mapTypeVariables"><span class="hs-identifier hs-var">mapTypeVariables</span></a><span> </span><a href="Data.Label.Derive.html#pretty"><span class="hs-identifier hs-var">pretty</span></a><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span class="hs-comment">-- Reify a name into a declaration.</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-identifier">reifyDec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Dec</span><span>
</span><a name="line-665"></a><a name="reifyDec"><a href="Data.Label.Derive.html#reifyDec"><span class="hs-identifier">reifyDec</span></a></a><span> </span><a name="local-6989586621679055515"><a href="#local-6989586621679055515"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-666"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055516"><a href="#local-6989586621679055516"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reify</span><span> </span><a href="#local-6989586621679055515"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-667"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055516"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-668"></a><span>       </span><span class="hs-identifier hs-var">TyConI</span><span> </span><a name="local-6989586621679055517"><a href="#local-6989586621679055517"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055517"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-669"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Label.Derive.html#fclError"><span class="hs-identifier hs-var">fclError</span></a><span> </span><span class="hs-string">&quot;Info must be type declaration type.&quot;</span><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span class="hs-comment">-- Throw a fclabels specific error.</span><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span class="hs-identifier">fclError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679053963"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-674"></a><a name="fclError"><a href="Data.Label.Derive.html#fclError"><span class="hs-identifier">fclError</span></a></a><span> </span><a name="local-6989586621679055518"><a href="#local-6989586621679055518"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Data.Label.Derive: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055518"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,10,0)</span><span>
</span><a name="line-677"></a><span class="hs-identifier">classP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Pred</span><span>
</span><a name="line-678"></a><a name="classP"><a href="Data.Label.Derive.html#classP"><span class="hs-identifier">classP</span></a></a><span> </span><a name="local-6989586621679055533"><a href="#local-6989586621679055533"><span class="hs-identifier">cla</span></a></a><span> </span><a name="local-6989586621679055534"><a href="#local-6989586621679055534"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-679"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055535"><a href="#local-6989586621679055535"><span class="hs-identifier">tysl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="#local-6989586621679055534"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-680"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a href="#local-6989586621679055533"><span class="hs-identifier hs-var">cla</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055535"><span class="hs-identifier hs-var">tysl</span></a><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-identifier">trd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679053960"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679053961"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679053962"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679053962"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-684"></a><a name="trd"><a href="Data.Label.Derive.html#trd"><span class="hs-identifier">trd</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679055536"><a href="#local-6989586621679055536"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055536"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-685"></a></pre></body></html>