<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Module      :  Distribution.Simple.GHC</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Copyright   :  Isaac Jones 2003-2007</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- License     :  BSD3</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Maintainer  :  cabal-devel@haskell.org</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- This is a fairly large module. It contains most of the GHC-specific code for</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- configuring, building and installing packages. It also exports a function</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- for finding out what packages are already installed. Configuring involves</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- finding the @ghc@ and @ghc-pkg@ programs, finding what language extensions</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- this version of ghc supports and returning a 'Compiler' value.</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- 'getInstalledPackages' involves calling the @ghc-pkg@ program to find out</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- what packages are installed.</span><span>
</span><a name="line-22"></a><span class="hs-comment">--</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- Building is somewhat complex as there is quite a bit of information to take</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- into account. We have to build libs and programs, possibly for profiling and</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- shared libs. We have to support building libraries that will be usable by</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- GHCi and also ghc's @-split-objs@ feature. We have to compile any C files</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- using ghc. Linking, especially for @split-objs@ is remarkably complex,</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- partly because there tend to be 1,000's of @.o@ files and this can often be</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- more than we can pass to the @ld@ or @ar@ programs in one go.</span><span>
</span><a name="line-30"></a><span class="hs-comment">--</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- Installing for libs and exes involves finding the right files and copying</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- them to the right places. One of the more tricky things about this module is</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- remembering the layout of files in the build directory (which is not</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- explicitly documented) and thus what search dirs are used for various kinds</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- of files.</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">GHC</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-38"></a><span>        </span><a href="Distribution.Simple.GHC.html#getGhcInfo"><span class="hs-identifier hs-var">getGhcInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="Distribution.Simple.GHC.html#configure"><span class="hs-identifier hs-var">configure</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Distribution.Simple.GHC.html#getInstalledPackages"><span class="hs-identifier hs-var">getInstalledPackages</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Distribution.Simple.GHC.html#getInstalledPackagesMonitorFiles"><span class="hs-identifier hs-var">getInstalledPackagesMonitorFiles</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="Distribution.Simple.GHC.html#getPackageDBContents"><span class="hs-identifier hs-var">getPackageDBContents</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="Distribution.Simple.GHC.html#buildLib"><span class="hs-identifier hs-var">buildLib</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.GHC.html#buildFLib"><span class="hs-identifier hs-var">buildFLib</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.GHC.html#buildExe"><span class="hs-identifier hs-var">buildExe</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="Distribution.Simple.GHC.html#replLib"><span class="hs-identifier hs-var">replLib</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.GHC.html#replFLib"><span class="hs-identifier hs-var">replFLib</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.GHC.html#replExe"><span class="hs-identifier hs-var">replExe</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="Distribution.Simple.GHC.html#startInterpreter"><span class="hs-identifier hs-var">startInterpreter</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="Distribution.Simple.GHC.html#installLib"><span class="hs-identifier hs-var">installLib</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.GHC.html#installFLib"><span class="hs-identifier hs-var">installFLib</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.GHC.html#installExe"><span class="hs-identifier hs-var">installExe</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="Distribution.Simple.GHC.html#libAbiHash"><span class="hs-identifier hs-var">libAbiHash</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="Distribution.Simple.GHC.html#hcPkgInfo"><span class="hs-identifier hs-var">hcPkgInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Distribution.Simple.GHC.html#registerPackage"><span class="hs-identifier hs-var">registerPackage</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="Distribution.Simple.GHC.html#componentGhcOptions"><span class="hs-identifier hs-var">componentGhcOptions</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="Distribution.Simple.GHC.html#componentCcGhcOptions"><span class="hs-identifier hs-var">componentCcGhcOptions</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Distribution.Simple.GHC.html#getLibDir"><span class="hs-identifier hs-var">getLibDir</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Distribution.Simple.GHC.html#isDynamic"><span class="hs-identifier hs-var">isDynamic</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="Distribution.Simple.GHC.html#getGlobalPackageDB"><span class="hs-identifier hs-var">getGlobalPackageDB</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="Distribution.Simple.GHC.html#pkgRoot"><span class="hs-identifier hs-var">pkgRoot</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><span class="hs-comment">-- * Constructing GHC environment files</span><span>
</span><a name="line-57"></a><span>        </span><a href="Distribution.Simple.GHC.Internal.html#GhcEnvironmentFileEntry"><span class="hs-identifier hs-type">Internal</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">GhcEnvironmentFileEntry</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>        </span><a href="Distribution.Simple.GHC.Internal.html#simpleGhcEnvironmentFile"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">simpleGhcEnvironmentFile</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>        </span><a href="Distribution.Simple.GHC.Internal.html#writeGhcEnvironmentFile"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeGhcEnvironmentFile</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>        </span><span class="hs-comment">-- * Version-specific implementation quirks</span><span>
</span><a name="line-61"></a><span>        </span><a href="Distribution.Simple.GHC.ImplInfo.html#getImplInfo"><span class="hs-identifier hs-var">getImplInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>        </span><a href="Distribution.Simple.GHC.ImplInfo.html#GhcImplInfo"><span class="hs-identifier hs-type">GhcImplInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Compat</span><span class="hs-operator">.</span><span class="hs-identifier">Prelude</span></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.GHC.IPI642.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">IPI642</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IPI642</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.GHC.Internal.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Internal</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">ImplInfo</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.PackageDescription.Utils.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">PackageDescription</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.PackageDescription.Utils.html#cabalBug"><span class="hs-identifier hs-var">cabalBug</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.PackageDescription.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">PackageDescription</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PD</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.InstalledPackageInfo.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">InstalledPackageInfo</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.InstalledPackageInfo.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">InstalledPackageInfo</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">InstalledPackageInfo</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.PackageIndex.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">PackageIndex</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.PackageIndex.html#InstalledPackageIndex"><span class="hs-identifier hs-type">InstalledPackageIndex</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.PackageIndex.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">PackageIndex</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PackageIndex</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">LocalBuildInfo</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">ComponentLocalBuildInfo</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Hpc.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Hpc</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Hpc</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.BuildPaths.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">BuildPaths</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Package.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Package</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.ModuleName.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">ModuleName</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ModuleName</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.ModuleName.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">ModuleName</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.Builtin.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span><span class="hs-operator">.</span><span class="hs-identifier">Builtin</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Builtin.html#runghcProgram"><span class="hs-identifier hs-var">runghcProgram</span></a><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Program.HcPkg.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span><span class="hs-operator">.</span><span class="hs-identifier">HcPkg</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">HcPkg</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Program.Ar.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span><span class="hs-operator">.</span><span class="hs-identifier">Ar</span></a><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ar</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Program.Ld.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span><span class="hs-operator">.</span><span class="hs-identifier">Ld</span></a><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ld</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Program.Strip.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span><span class="hs-operator">.</span><span class="hs-identifier">Strip</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Strip</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.GHC.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Program</span><span class="hs-operator">.</span><span class="hs-identifier">GHC</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Setup.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Setup</span></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Setup.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Setup</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Cabal</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Compiler.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Simple</span><span class="hs-operator">.</span><span class="hs-identifier">Compiler</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Version.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Version</span></a><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.System.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">System</span></a><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Verbosity.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Verbosity</span></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Text.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ForeignLib.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignLib</span></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ForeignLibType.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignLibType</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ForeignLibOption.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignLibOption</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.UnqualComponentName.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">UnqualComponentName</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Utils.NubList.html"><span class="hs-identifier">Distribution</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span class="hs-operator">.</span><span class="hs-identifier">NubList</span></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Extension.html"><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">Extension</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">msum</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isLower</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span><span>
</span><a name="line-110"></a><span>         </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">doesFileExist</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">getAppUserDataDirectory</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">createDirectoryIfMissing</span><span>
</span><a name="line-111"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">canonicalizePath</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">removeFile</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">renameFile</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;/&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;.&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">takeExtension</span><span>
</span><a name="line-113"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">takeDirectory</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">replaceExtension</span><span>
</span><a name="line-114"></a><span>                                </span><span class="hs-special">,</span><span class="hs-identifier hs-var">isRelative</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Info</span><span>
</span><a name="line-116"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS</span><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">createSymbolicLink</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span class="hs-cpp">#endif /* mingw32_HOST_OS */</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- Configuring</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-identifier">configure</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-124"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-125"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><a name="configure"><a href="Distribution.Simple.GHC.html#configure"><span class="hs-identifier">configure</span></a></a><span> </span><a name="local-6989586621679290646"><a href="#local-6989586621679290646"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290647"><a href="#local-6989586621679290647"><span class="hs-identifier">hcPath</span></a></a><span> </span><a name="local-6989586621679290648"><a href="#local-6989586621679290648"><span class="hs-identifier">hcPkgPath</span></a></a><span> </span><a name="local-6989586621679290649"><a href="#local-6989586621679290649"><span class="hs-identifier">conf0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679290650"><a href="#local-6989586621679290650"><span class="hs-identifier">ghcProg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290651"><a href="#local-6989586621679290651"><span class="hs-identifier">ghcVersion</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290652"><a href="#local-6989586621679290652"><span class="hs-identifier">progdb1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-129"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#requireProgramVersion"><span class="hs-identifier hs-var">requireProgramVersion</span></a><span> </span><a href="#local-6989586621679290646"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span>
</span><a name="line-130"></a><span>      </span><span class="hs-special">(</span><a href="Distribution.Version.html#orLaterVersion"><span class="hs-identifier hs-var">orLaterVersion</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>      </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#userMaybeSpecifyPath"><span class="hs-identifier hs-var">userMaybeSpecifyPath</span></a><span> </span><span class="hs-string">&quot;ghc&quot;</span><span> </span><a href="#local-6989586621679290647"><span class="hs-identifier hs-var">hcPath</span></a><span> </span><a href="#local-6989586621679290649"><span class="hs-identifier hs-var">conf0</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290653"><a href="#local-6989586621679290653"><span class="hs-identifier">implInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#ghcVersionImplInfo"><span class="hs-identifier hs-var">ghcVersionImplInfo</span></a><span> </span><a href="#local-6989586621679290651"><span class="hs-identifier hs-var">ghcVersion</span></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>  </span><span class="hs-comment">-- This is slightly tricky, we have to configure ghc first, then we use the</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-comment">-- location of ghc to help find ghc-pkg in the case that the user did not</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-comment">-- specify the location of ghc-pkg directly:</span><span>
</span><a name="line-137"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679290654"><a href="#local-6989586621679290654"><span class="hs-identifier">ghcPkgProg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290655"><a href="#local-6989586621679290655"><span class="hs-identifier">ghcPkgVersion</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290656"><a href="#local-6989586621679290656"><span class="hs-identifier">progdb2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-138"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#requireProgramVersion"><span class="hs-identifier hs-var">requireProgramVersion</span></a><span> </span><a href="#local-6989586621679290646"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcPkgProgram"><span class="hs-identifier hs-var">ghcPkgProgram</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-139"></a><span>      </span><span class="hs-identifier">programFindLocation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessGhcPkgFromGhcPath"><span class="hs-identifier hs-var">guessGhcPkgFromGhcPath</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-140"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-141"></a><span>    </span><a href="Distribution.Version.html#anyVersion"><span class="hs-identifier hs-var">anyVersion</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#userMaybeSpecifyPath"><span class="hs-identifier hs-var">userMaybeSpecifyPath</span></a><span> </span><span class="hs-string">&quot;ghc-pkg&quot;</span><span> </span><a href="#local-6989586621679290648"><span class="hs-identifier hs-var">hcPkgPath</span></a><span> </span><a href="#local-6989586621679290652"><span class="hs-identifier hs-var">progdb1</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290651"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679290655"><span class="hs-identifier hs-var">ghcPkgVersion</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679290646"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-144"></a><span>       </span><span class="hs-string">&quot;Version mismatch between ghc and ghc-pkg: &quot;</span><span>
</span><a name="line-145"></a><span>    </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.Program.Types.html#programPath"><span class="hs-identifier hs-var">programPath</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is version &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679290651"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span>
</span><a name="line-146"></a><span>    </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.Program.Types.html#programPath"><span class="hs-identifier hs-var">programPath</span></a><span> </span><a href="#local-6989586621679290654"><span class="hs-identifier hs-var">ghcPkgProg</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is version &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679290655"><span class="hs-identifier hs-var">ghcPkgVersion</span></a><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span>  </span><span class="hs-comment">-- Likewise we try to find the matching hsc2hs and haddock programs.</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290657"><a href="#local-6989586621679290657"><span class="hs-identifier">hsc2hsProgram'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Builtin.html#hsc2hsProgram"><span class="hs-identifier hs-var">hsc2hsProgram</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-150"></a><span>                           </span><span class="hs-identifier">programFindLocation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessHsc2hsFromGhcPath"><span class="hs-identifier hs-var">guessHsc2hsFromGhcPath</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-151"></a><span>                       </span><span class="hs-special">}</span><span>
</span><a name="line-152"></a><span>      </span><a name="local-6989586621679290658"><a href="#local-6989586621679290658"><span class="hs-identifier">haddockProgram'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Builtin.html#haddockProgram"><span class="hs-identifier hs-var">haddockProgram</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-153"></a><span>                           </span><span class="hs-identifier">programFindLocation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessHaddockFromGhcPath"><span class="hs-identifier hs-var">guessHaddockFromGhcPath</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-154"></a><span>                       </span><span class="hs-special">}</span><span>
</span><a name="line-155"></a><span>      </span><a name="local-6989586621679290659"><a href="#local-6989586621679290659"><span class="hs-identifier">hpcProgram'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Builtin.html#hpcProgram"><span class="hs-identifier hs-var">hpcProgram</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-156"></a><span>                        </span><span class="hs-identifier">programFindLocation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessHpcFromGhcPath"><span class="hs-identifier hs-var">guessHpcFromGhcPath</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-157"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-158"></a><span>      </span><a name="local-6989586621679290660"><a href="#local-6989586621679290660"><span class="hs-identifier">runghcProgram'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Builtin.html#runghcProgram"><span class="hs-identifier hs-var">runghcProgram</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-159"></a><span>                        </span><span class="hs-identifier">programFindLocation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessRunghcFromGhcPath"><span class="hs-identifier hs-var">guessRunghcFromGhcPath</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-160"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-161"></a><span>      </span><a name="local-6989586621679290661"><a href="#local-6989586621679290661"><span class="hs-identifier">progdb3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier hs-var">addKnownProgram</span></a><span> </span><a href="#local-6989586621679290658"><span class="hs-identifier hs-var">haddockProgram'</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-162"></a><span>              </span><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier hs-var">addKnownProgram</span></a><span> </span><a href="#local-6989586621679290657"><span class="hs-identifier hs-var">hsc2hsProgram'</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-163"></a><span>              </span><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier hs-var">addKnownProgram</span></a><span> </span><a href="#local-6989586621679290659"><span class="hs-identifier hs-var">hpcProgram'</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-164"></a><span>              </span><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier hs-var">addKnownProgram</span></a><span> </span><a href="#local-6989586621679290660"><span class="hs-identifier hs-var">runghcProgram'</span></a><span> </span><a href="#local-6989586621679290656"><span class="hs-identifier hs-var">progdb2</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>  </span><a name="local-6989586621679290662"><a href="#local-6989586621679290662"><span class="hs-identifier">languages</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getLanguages"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getLanguages</span></a><span> </span><a href="#local-6989586621679290646"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290653"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-167"></a><span>  </span><a name="local-6989586621679290663"><a href="#local-6989586621679290663"><span class="hs-identifier">extensions0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getExtensions"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getExtensions</span></a><span> </span><a href="#local-6989586621679290646"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290653"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>  </span><a name="local-6989586621679290664"><a href="#local-6989586621679290664"><span class="hs-identifier">ghcInfo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getGhcInfo"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getGhcInfo</span></a><span> </span><a href="#local-6989586621679290646"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290653"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290665"><a href="#local-6989586621679290665"><span class="hs-identifier">ghcInfoMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679290664"><span class="hs-identifier hs-var">ghcInfo</span></a><span>
</span><a name="line-171"></a><span>      </span><a name="local-6989586621679290666"><a href="#local-6989586621679290666"><span class="hs-identifier">extensions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- workaround https://ghc.haskell.org/ticket/11214</span><span>
</span><a name="line-172"></a><span>                   </span><a href="#local-6989586621679290668"><span class="hs-identifier hs-var">filterExt</span></a><span> </span><a href="Language.Haskell.Extension.html#JavaScriptFFI"><span class="hs-identifier hs-var">JavaScriptFFI</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-173"></a><span>                   </span><span class="hs-comment">-- see 'filterExtTH' comment below</span><span>
</span><a name="line-174"></a><span>                   </span><a href="#local-6989586621679290667"><span class="hs-identifier hs-var">filterExtTH</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679290663"><span class="hs-identifier hs-var">extensions0</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>      </span><span class="hs-comment">-- starting with GHC 8.0, `TemplateHaskell` will be omitted from</span><span>
</span><a name="line-177"></a><span>      </span><span class="hs-comment">-- `--supported-extensions` when it's not available.</span><span>
</span><a name="line-178"></a><span>      </span><span class="hs-comment">-- for older GHCs we can use the &quot;Have interpreter&quot; property to</span><span>
</span><a name="line-179"></a><span>      </span><span class="hs-comment">-- filter out `TemplateHaskell`</span><span>
</span><a name="line-180"></a><span>      </span><a name="local-6989586621679290667"><a href="#local-6989586621679290667"><span class="hs-identifier">filterExtTH</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290651"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">8</span><span class="hs-special">]</span><span>
</span><a name="line-181"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;NO&quot;</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;Have interpreter&quot;</span><span> </span><a href="#local-6989586621679290665"><span class="hs-identifier hs-var">ghcInfoMap</span></a><span>
</span><a name="line-182"></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290668"><span class="hs-identifier hs-var">filterExt</span></a><span> </span><a href="Language.Haskell.Extension.html#TemplateHaskell"><span class="hs-identifier hs-var">TemplateHaskell</span></a><span>
</span><a name="line-183"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>      </span><a name="local-6989586621679290668"><a href="#local-6989586621679290668"><span class="hs-identifier">filterExt</span></a></a><span> </span><a name="local-6989586621679290669"><a href="#local-6989586621679290669"><span class="hs-identifier">ext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="Language.Haskell.Extension.html#EnableExtension"><span class="hs-identifier hs-var">EnableExtension</span></a><span> </span><a href="#local-6989586621679290669"><span class="hs-identifier hs-var">ext</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290670"><a href="#local-6989586621679290670"><span class="hs-identifier">comp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-var">Compiler</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-188"></a><span>        </span><span class="hs-identifier">compilerId</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Compiler.html#CompilerId"><span class="hs-identifier hs-var">CompilerId</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290651"><span class="hs-identifier hs-var">ghcVersion</span></a><span class="hs-special">,</span><span>
</span><a name="line-189"></a><span>        </span><span class="hs-identifier">compilerAbiTag</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Compiler.html#NoAbiTag"><span class="hs-identifier hs-var">NoAbiTag</span></a><span class="hs-special">,</span><span>
</span><a name="line-190"></a><span>        </span><span class="hs-identifier">compilerCompat</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-191"></a><span>        </span><span class="hs-identifier">compilerLanguages</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290662"><span class="hs-identifier hs-var">languages</span></a><span class="hs-special">,</span><span>
</span><a name="line-192"></a><span>        </span><span class="hs-identifier">compilerExtensions</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290666"><span class="hs-identifier hs-var">extensions</span></a><span class="hs-special">,</span><span>
</span><a name="line-193"></a><span>        </span><span class="hs-identifier">compilerProperties</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290665"><span class="hs-identifier hs-var">ghcInfoMap</span></a><span>
</span><a name="line-194"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-195"></a><span>      </span><a name="local-6989586621679290671"><a href="#local-6989586621679290671"><span class="hs-identifier">compPlatform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#targetPlatform"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621679290664"><span class="hs-identifier hs-var">ghcInfo</span></a><span>
</span><a name="line-196"></a><span>      </span><span class="hs-comment">-- configure gcc and ld</span><span>
</span><a name="line-197"></a><span>      </span><a name="local-6989586621679290672"><a href="#local-6989586621679290672"><span class="hs-identifier">progdb4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#configureToolchain"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">configureToolchain</span></a><span> </span><a href="#local-6989586621679290653"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290650"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><a href="#local-6989586621679290665"><span class="hs-identifier hs-var">ghcInfoMap</span></a><span> </span><a href="#local-6989586621679290661"><span class="hs-identifier hs-var">progdb3</span></a><span>
</span><a name="line-198"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290670"><span class="hs-identifier hs-var">comp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290671"><span class="hs-identifier hs-var">compPlatform</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290672"><span class="hs-identifier hs-var">progdb4</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Given something like /usr/local/bin/ghc-6.6.1(.exe) we try and find</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- the corresponding tool; e.g. if the tool is ghc-pkg, we try looking</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- for a versioned or unversioned ghc-pkg in the same dir, that is:</span><span>
</span><a name="line-203"></a><span class="hs-comment">--</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- &gt; /usr/local/bin/ghc-pkg-ghc-6.6.1(.exe)</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- &gt; /usr/local/bin/ghc-pkg-6.6.1(.exe)</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- &gt; /usr/local/bin/ghc-pkg(.exe)</span><span>
</span><a name="line-207"></a><span class="hs-comment">--</span><span>
</span><a name="line-208"></a><span class="hs-identifier">guessToolFromGhcPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-209"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-210"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><a name="guessToolFromGhcPath"><a href="Distribution.Simple.GHC.html#guessToolFromGhcPath"><span class="hs-identifier">guessToolFromGhcPath</span></a></a><span> </span><a name="local-6989586621679290673"><a href="#local-6989586621679290673"><span class="hs-identifier">tool</span></a></a><span> </span><a name="local-6989586621679290674"><a href="#local-6989586621679290674"><span class="hs-identifier">ghcProg</span></a></a><span> </span><a name="local-6989586621679290675"><a href="#local-6989586621679290675"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290676"><a href="#local-6989586621679290676"><span class="hs-identifier">searchpath</span></a></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290680"><a href="#local-6989586621679290680"><span class="hs-identifier">toolname</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679290673"><span class="hs-identifier hs-var">tool</span></a><span>
</span><a name="line-213"></a><span>           </span><a name="local-6989586621679290681"><a href="#local-6989586621679290681"><span class="hs-identifier">given_path</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Types.html#programPath"><span class="hs-identifier hs-var">programPath</span></a><span> </span><a href="#local-6989586621679290674"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-214"></a><span>           </span><a name="local-6989586621679290682"><a href="#local-6989586621679290682"><span class="hs-identifier">given_dir</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">takeDirectory</span><span> </span><a href="#local-6989586621679290681"><span class="hs-identifier hs-var">given_path</span></a><span>
</span><a name="line-215"></a><span>       </span><a name="local-6989586621679290683"><a href="#local-6989586621679290683"><span class="hs-identifier">real_path</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">canonicalizePath</span><span> </span><a href="#local-6989586621679290681"><span class="hs-identifier hs-var">given_path</span></a><span>
</span><a name="line-216"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290684"><a href="#local-6989586621679290684"><span class="hs-identifier">real_dir</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">takeDirectory</span><span> </span><a href="#local-6989586621679290683"><span class="hs-identifier hs-var">real_path</span></a><span>
</span><a name="line-217"></a><span>           </span><a name="local-6989586621679290685"><a href="#local-6989586621679290685"><span class="hs-identifier">versionSuffix</span></a></a><span> </span><a name="local-6989586621679290693"><a href="#local-6989586621679290693"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290677"><span class="hs-identifier hs-var">takeVersionSuffix</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Utils.html#dropExeExtension"><span class="hs-identifier hs-var">dropExeExtension</span></a><span> </span><a href="#local-6989586621679290693"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>           </span><a name="local-6989586621679290686"><a href="#local-6989586621679290686"><span class="hs-identifier">given_suf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290685"><span class="hs-identifier hs-var">versionSuffix</span></a><span> </span><a href="#local-6989586621679290681"><span class="hs-identifier hs-var">given_path</span></a><span>
</span><a name="line-219"></a><span>           </span><a name="local-6989586621679290687"><a href="#local-6989586621679290687"><span class="hs-identifier">real_suf</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290685"><span class="hs-identifier hs-var">versionSuffix</span></a><span> </span><a href="#local-6989586621679290683"><span class="hs-identifier hs-var">real_path</span></a><span>
</span><a name="line-220"></a><span>           </span><a name="local-6989586621679290688"><a href="#local-6989586621679290688"><span class="hs-identifier">guessNormal</span></a></a><span>       </span><a name="local-6989586621679290694"><a href="#local-6989586621679290694"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290694"><span class="hs-identifier hs-var">dir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679290680"><span class="hs-identifier hs-var">toolname</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#exeExtension"><span class="hs-identifier hs-var">exeExtension</span></a><span>
</span><a name="line-221"></a><span>           </span><a name="local-6989586621679290689"><a href="#local-6989586621679290689"><span class="hs-identifier">guessGhcVersioned</span></a></a><span> </span><a name="local-6989586621679290695"><a href="#local-6989586621679290695"><span class="hs-identifier">dir</span></a></a><span> </span><a name="local-6989586621679290696"><a href="#local-6989586621679290696"><span class="hs-identifier">suf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290695"><span class="hs-identifier hs-var">dir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290680"><span class="hs-identifier hs-var">toolname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;-ghc&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290696"><span class="hs-identifier hs-var">suf</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>                                           </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#exeExtension"><span class="hs-identifier hs-var">exeExtension</span></a><span>
</span><a name="line-223"></a><span>           </span><a name="local-6989586621679290690"><a href="#local-6989586621679290690"><span class="hs-identifier">guessVersioned</span></a></a><span>    </span><a name="local-6989586621679290697"><a href="#local-6989586621679290697"><span class="hs-identifier">dir</span></a></a><span> </span><a name="local-6989586621679290698"><a href="#local-6989586621679290698"><span class="hs-identifier">suf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290697"><span class="hs-identifier hs-var">dir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290680"><span class="hs-identifier hs-var">toolname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290698"><span class="hs-identifier hs-var">suf</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>                                           </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#exeExtension"><span class="hs-identifier hs-var">exeExtension</span></a><span>
</span><a name="line-225"></a><span>           </span><a name="local-6989586621679290691"><a href="#local-6989586621679290691"><span class="hs-identifier">mkGuesses</span></a></a><span> </span><a name="local-6989586621679290699"><a href="#local-6989586621679290699"><span class="hs-identifier">dir</span></a></a><span> </span><a name="local-6989586621679290700"><a href="#local-6989586621679290700"><span class="hs-identifier">suf</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290700"><span class="hs-identifier hs-var">suf</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290688"><span class="hs-identifier hs-var">guessNormal</span></a><span> </span><a href="#local-6989586621679290699"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">]</span><span>
</span><a name="line-226"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290689"><span class="hs-identifier hs-var">guessGhcVersioned</span></a><span> </span><a href="#local-6989586621679290699"><span class="hs-identifier hs-var">dir</span></a><span> </span><a href="#local-6989586621679290700"><span class="hs-identifier hs-var">suf</span></a><span class="hs-special">,</span><span>
</span><a name="line-227"></a><span>                                            </span><a href="#local-6989586621679290690"><span class="hs-identifier hs-var">guessVersioned</span></a><span> </span><a href="#local-6989586621679290699"><span class="hs-identifier hs-var">dir</span></a><span> </span><a href="#local-6989586621679290700"><span class="hs-identifier hs-var">suf</span></a><span class="hs-special">,</span><span>
</span><a name="line-228"></a><span>                                            </span><a href="#local-6989586621679290688"><span class="hs-identifier hs-var">guessNormal</span></a><span> </span><a href="#local-6989586621679290699"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">]</span><span>
</span><a name="line-229"></a><span>           </span><a name="local-6989586621679290692"><a href="#local-6989586621679290692"><span class="hs-identifier">guesses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290691"><span class="hs-identifier hs-var">mkGuesses</span></a><span> </span><a href="#local-6989586621679290682"><span class="hs-identifier hs-var">given_dir</span></a><span> </span><a href="#local-6989586621679290686"><span class="hs-identifier hs-var">given_suf</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-230"></a><span>                            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290683"><span class="hs-identifier hs-var">real_path</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679290681"><span class="hs-identifier hs-var">given_path</span></a><span>
</span><a name="line-231"></a><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-232"></a><span>                                </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679290691"><span class="hs-identifier hs-var">mkGuesses</span></a><span> </span><a href="#local-6989586621679290684"><span class="hs-identifier hs-var">real_dir</span></a><span> </span><a href="#local-6989586621679290687"><span class="hs-identifier hs-var">real_suf</span></a><span>
</span><a name="line-233"></a><span>       </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290675"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;looking for tool &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290680"><span class="hs-identifier hs-var">toolname</span></a><span>
</span><a name="line-234"></a><span>         </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; near compiler in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290682"><span class="hs-identifier hs-var">given_dir</span></a><span>
</span><a name="line-235"></a><span>       </span><a href="Distribution.Simple.Utils.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><a href="#local-6989586621679290675"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;candidate locations: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679290692"><span class="hs-identifier hs-var">guesses</span></a><span>
</span><a name="line-236"></a><span>       </span><a name="local-6989586621679290701"><a href="#local-6989586621679290701"><span class="hs-identifier">exists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-identifier hs-var">doesFileExist</span><span> </span><a href="#local-6989586621679290692"><span class="hs-identifier hs-var">guesses</span></a><span>
</span><a name="line-237"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679290702"><span class="hs-identifier hs-var">file</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679290702"><a href="#local-6989586621679290702"><span class="hs-identifier">file</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679290692"><span class="hs-identifier hs-var">guesses</span></a><span> </span><a href="#local-6989586621679290701"><span class="hs-identifier hs-var">exists</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-238"></a><span>                   </span><span class="hs-comment">-- If we can't find it near ghc, fall back to the usual</span><span>
</span><a name="line-239"></a><span>                   </span><span class="hs-comment">-- method.</span><span>
</span><a name="line-240"></a><span>         </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">programFindLocation</span><span> </span><a href="#local-6989586621679290673"><span class="hs-identifier hs-var">tool</span></a><span> </span><a href="#local-6989586621679290675"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290676"><span class="hs-identifier hs-var">searchpath</span></a><span>
</span><a name="line-241"></a><span>         </span><span class="hs-special">(</span><a name="local-6989586621679290703"><a href="#local-6989586621679290703"><span class="hs-identifier">fp</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290675"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;found &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290680"><span class="hs-identifier hs-var">toolname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290703"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-242"></a><span>                      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290704"><a href="#local-6989586621679290704"><span class="hs-identifier">lookedAt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span>
</span><a name="line-243"></a><span>                                   </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679290705"><a href="#local-6989586621679290705"><span class="hs-identifier">_file</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290706"><a href="#local-6989586621679290706"><span class="hs-identifier">exist</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679290706"><span class="hs-identifier hs-var">exist</span></a><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>                                   </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679290692"><span class="hs-identifier hs-var">guesses</span></a><span> </span><a href="#local-6989586621679290701"><span class="hs-identifier hs-var">exists</span></a><span>
</span><a name="line-245"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290703"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290704"><span class="hs-identifier hs-var">lookedAt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">takeVersionSuffix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-248"></a><span>        </span><a name="local-6989586621679290677"><a href="#local-6989586621679290677"><span class="hs-identifier">takeVersionSuffix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.Generic.html#takeWhileEndLE"><span class="hs-identifier hs-var">takeWhileEndLE</span></a><span> </span><a href="#local-6989586621679290678"><span class="hs-identifier hs-var">isSuffixChar</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>        </span><span class="hs-identifier">isSuffixChar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-251"></a><span>        </span><a name="local-6989586621679290678"><a href="#local-6989586621679290678"><span class="hs-identifier">isSuffixChar</span></a></a><span> </span><a name="local-6989586621679290679"><a href="#local-6989586621679290679"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isDigit</span><span> </span><a href="#local-6989586621679290679"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679290679"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'.'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679290679"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-comment">-- | Given something like /usr/local/bin/ghc-6.6.1(.exe) we try and find a</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- corresponding ghc-pkg, we try looking for both a versioned and unversioned</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- ghc-pkg in the same dir, that is:</span><span>
</span><a name="line-256"></a><span class="hs-comment">--</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- &gt; /usr/local/bin/ghc-pkg-ghc-6.6.1(.exe)</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- &gt; /usr/local/bin/ghc-pkg-6.6.1(.exe)</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- &gt; /usr/local/bin/ghc-pkg(.exe)</span><span>
</span><a name="line-260"></a><span class="hs-comment">--</span><span>
</span><a name="line-261"></a><span class="hs-identifier">guessGhcPkgFromGhcPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-262"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-263"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-264"></a><a name="guessGhcPkgFromGhcPath"><a href="Distribution.Simple.GHC.html#guessGhcPkgFromGhcPath"><span class="hs-identifier">guessGhcPkgFromGhcPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessToolFromGhcPath"><span class="hs-identifier hs-var">guessToolFromGhcPath</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcPkgProgram"><span class="hs-identifier hs-var">ghcPkgProgram</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- | Given something like /usr/local/bin/ghc-6.6.1(.exe) we try and find a</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- corresponding hsc2hs, we try looking for both a versioned and unversioned</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- hsc2hs in the same dir, that is:</span><span>
</span><a name="line-269"></a><span class="hs-comment">--</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- &gt; /usr/local/bin/hsc2hs-ghc-6.6.1(.exe)</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- &gt; /usr/local/bin/hsc2hs-6.6.1(.exe)</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- &gt; /usr/local/bin/hsc2hs(.exe)</span><span>
</span><a name="line-273"></a><span class="hs-comment">--</span><span>
</span><a name="line-274"></a><span class="hs-identifier">guessHsc2hsFromGhcPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-275"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-276"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><a name="guessHsc2hsFromGhcPath"><a href="Distribution.Simple.GHC.html#guessHsc2hsFromGhcPath"><span class="hs-identifier">guessHsc2hsFromGhcPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessToolFromGhcPath"><span class="hs-identifier hs-var">guessToolFromGhcPath</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#hsc2hsProgram"><span class="hs-identifier hs-var">hsc2hsProgram</span></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- | Given something like /usr/local/bin/ghc-6.6.1(.exe) we try and find a</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- corresponding haddock, we try looking for both a versioned and unversioned</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- haddock in the same dir, that is:</span><span>
</span><a name="line-282"></a><span class="hs-comment">--</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- &gt; /usr/local/bin/haddock-ghc-6.6.1(.exe)</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- &gt; /usr/local/bin/haddock-6.6.1(.exe)</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- &gt; /usr/local/bin/haddock(.exe)</span><span>
</span><a name="line-286"></a><span class="hs-comment">--</span><span>
</span><a name="line-287"></a><span class="hs-identifier">guessHaddockFromGhcPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-288"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-289"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><a name="guessHaddockFromGhcPath"><a href="Distribution.Simple.GHC.html#guessHaddockFromGhcPath"><span class="hs-identifier">guessHaddockFromGhcPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessToolFromGhcPath"><span class="hs-identifier hs-var">guessToolFromGhcPath</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#haddockProgram"><span class="hs-identifier hs-var">haddockProgram</span></a><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">guessHpcFromGhcPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-293"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-294"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-295"></a><a name="guessHpcFromGhcPath"><a href="Distribution.Simple.GHC.html#guessHpcFromGhcPath"><span class="hs-identifier">guessHpcFromGhcPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessToolFromGhcPath"><span class="hs-identifier hs-var">guessToolFromGhcPath</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#hpcProgram"><span class="hs-identifier hs-var">hpcProgram</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-identifier">guessRunghcFromGhcPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-298"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-299"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-300"></a><a name="guessRunghcFromGhcPath"><a href="Distribution.Simple.GHC.html#guessRunghcFromGhcPath"><span class="hs-identifier">guessRunghcFromGhcPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#guessToolFromGhcPath"><span class="hs-identifier hs-var">guessToolFromGhcPath</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#runghcProgram"><span class="hs-identifier hs-var">runghcProgram</span></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-identifier">getGhcInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-304"></a><a name="getGhcInfo"><a href="Distribution.Simple.GHC.html#getGhcInfo"><span class="hs-identifier">getGhcInfo</span></a></a><span> </span><a name="local-6989586621679290707"><a href="#local-6989586621679290707"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290708"><a href="#local-6989586621679290708"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getGhcInfo"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getGhcInfo</span></a><span> </span><a href="#local-6989586621679290707"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290710"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290708"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-305"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-306"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290709"><a href="#local-6989586621679290709"><span class="hs-identifier">version</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programVersion</span><span> </span><a href="#local-6989586621679290708"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-307"></a><span>    </span><a name="local-6989586621679290710"><a href="#local-6989586621679290710"><span class="hs-identifier">implInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#ghcVersionImplInfo"><span class="hs-identifier hs-var">ghcVersionImplInfo</span></a><span> </span><a href="#local-6989586621679290709"><span class="hs-identifier hs-var">version</span></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | Given a single package DB, return all installed packages.</span><span>
</span><a name="line-310"></a><span class="hs-identifier">getPackageDBContents</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-311"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.PackageIndex.html#InstalledPackageIndex"><span class="hs-identifier hs-type">InstalledPackageIndex</span></a><span>
</span><a name="line-312"></a><a name="getPackageDBContents"><a href="Distribution.Simple.GHC.html#getPackageDBContents"><span class="hs-identifier">getPackageDBContents</span></a></a><span> </span><a name="local-6989586621679290711"><a href="#local-6989586621679290711"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290712"><a href="#local-6989586621679290712"><span class="hs-identifier">packagedb</span></a></a><span> </span><a name="local-6989586621679290713"><a href="#local-6989586621679290713"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-313"></a><span>  </span><a name="local-6989586621679290714"><a href="#local-6989586621679290714"><span class="hs-identifier">pkgss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#getInstalledPackages%27"><span class="hs-identifier hs-var">getInstalledPackages'</span></a><span> </span><a href="#local-6989586621679290711"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290712"><span class="hs-identifier hs-var">packagedb</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679290713"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-314"></a><span>  </span><a href="Distribution.Simple.GHC.html#toPackageIndex"><span class="hs-identifier hs-var">toPackageIndex</span></a><span> </span><a href="#local-6989586621679290711"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290714"><span class="hs-identifier hs-var">pkgss</span></a><span> </span><a href="#local-6989586621679290713"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">-- | Given a package DB stack, return all installed packages.</span><span>
</span><a name="line-317"></a><span class="hs-identifier">getInstalledPackages</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDBStack"><span class="hs-identifier hs-type">PackageDBStack</span></a><span>
</span><a name="line-318"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-319"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.PackageIndex.html#InstalledPackageIndex"><span class="hs-identifier hs-type">InstalledPackageIndex</span></a><span>
</span><a name="line-320"></a><a name="getInstalledPackages"><a href="Distribution.Simple.GHC.html#getInstalledPackages"><span class="hs-identifier">getInstalledPackages</span></a></a><span> </span><a name="local-6989586621679290715"><a href="#local-6989586621679290715"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290716"><a href="#local-6989586621679290716"><span class="hs-identifier">comp</span></a></a><span> </span><a name="local-6989586621679290717"><a href="#local-6989586621679290717"><span class="hs-identifier">packagedbs</span></a></a><span> </span><a name="local-6989586621679290718"><a href="#local-6989586621679290718"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-321"></a><span>  </span><a href="Distribution.Simple.GHC.html#checkPackageDbEnvVar"><span class="hs-identifier hs-var">checkPackageDbEnvVar</span></a><span> </span><a href="#local-6989586621679290715"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-322"></a><span>  </span><a href="Distribution.Simple.GHC.html#checkPackageDbStack"><span class="hs-identifier hs-var">checkPackageDbStack</span></a><span> </span><a href="#local-6989586621679290715"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290716"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679290717"><span class="hs-identifier hs-var">packagedbs</span></a><span>
</span><a name="line-323"></a><span>  </span><a name="local-6989586621679290722"><a href="#local-6989586621679290722"><span class="hs-identifier">pkgss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#getInstalledPackages%27"><span class="hs-identifier hs-var">getInstalledPackages'</span></a><span> </span><a href="#local-6989586621679290715"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290717"><span class="hs-identifier hs-var">packagedbs</span></a><span> </span><a href="#local-6989586621679290718"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-324"></a><span>  </span><a name="local-6989586621679290723"><a href="#local-6989586621679290723"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#toPackageIndex"><span class="hs-identifier hs-var">toPackageIndex</span></a><span> </span><a href="#local-6989586621679290715"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290722"><span class="hs-identifier hs-var">pkgss</span></a><span> </span><a href="#local-6989586621679290718"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-325"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-6989586621679290719"><span class="hs-identifier hs-var">hackRtsPackage</span></a><span> </span><a href="#local-6989586621679290723"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-328"></a><span>    </span><a name="local-6989586621679290719"><a href="#local-6989586621679290719"><span class="hs-identifier">hackRtsPackage</span></a></a><span> </span><a name="local-6989586621679290720"><a href="#local-6989586621679290720"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-329"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.PackageIndex.html#lookupPackageName"><span class="hs-identifier hs-var">PackageIndex</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookupPackageName</span></a><span> </span><a href="#local-6989586621679290720"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Types.PackageName.html#mkPackageName"><span class="hs-identifier hs-var">mkPackageName</span></a><span> </span><span class="hs-string">&quot;rts&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-330"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621679290721"><a href="#local-6989586621679290721"><span class="hs-identifier">rts</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-331"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.PackageIndex.html#insert"><span class="hs-identifier hs-var">PackageIndex</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#removeMingwIncludeDir"><span class="hs-identifier hs-var">removeMingwIncludeDir</span></a><span> </span><a href="#local-6989586621679290721"><span class="hs-identifier hs-var">rts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290720"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-332"></a><span>        </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290720"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-comment">-- No (or multiple) ghc rts package is registered!!</span><span>
</span><a name="line-333"></a><span>                    </span><span class="hs-comment">-- Feh, whatever, the ghc test suite does some crazy stuff.</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- | Given a list of @(PackageDB, InstalledPackageInfo)@ pairs, produce a</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- @PackageIndex@. Helper function used by 'getPackageDBContents' and</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- 'getInstalledPackages'.</span><span>
</span><a name="line-338"></a><span class="hs-identifier">toPackageIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-339"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-340"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-341"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.PackageIndex.html#InstalledPackageIndex"><span class="hs-identifier hs-type">InstalledPackageIndex</span></a><span>
</span><a name="line-342"></a><a name="toPackageIndex"><a href="Distribution.Simple.GHC.html#toPackageIndex"><span class="hs-identifier">toPackageIndex</span></a></a><span> </span><a name="local-6989586621679290724"><a href="#local-6989586621679290724"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290725"><a href="#local-6989586621679290725"><span class="hs-identifier">pkgss</span></a></a><span> </span><a name="local-6989586621679290726"><a href="#local-6989586621679290726"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-comment">-- On Windows, various fields have $topdir/foo rather than full</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-comment">-- paths. We need to substitute the right value in so that when</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-comment">-- we, for example, call gcc, we have proper paths to give it.</span><span>
</span><a name="line-346"></a><span>  </span><a name="local-6989586621679290728"><a href="#local-6989586621679290728"><span class="hs-identifier">topDir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#getLibDir%27"><span class="hs-identifier hs-var">getLibDir'</span></a><span> </span><a href="#local-6989586621679290724"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290727"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-347"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290729"><a href="#local-6989586621679290729"><span class="hs-identifier">indices</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Distribution.Simple.PackageIndex.html#fromList"><span class="hs-identifier hs-var">PackageIndex</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.Internal.html#substTopDir"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">substTopDir</span></a><span> </span><a href="#local-6989586621679290728"><span class="hs-identifier hs-var">topDir</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290730"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679290730"><a href="#local-6989586621679290730"><span class="hs-identifier">pkgs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679290725"><span class="hs-identifier hs-var">pkgss</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-349"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span> </span><a href="#local-6989586621679290729"><span class="hs-identifier hs-var">indices</span></a><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290727"><a href="#local-6989586621679290727"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><a href="#local-6989586621679290726"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-identifier">getLibDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-355"></a><a name="getLibDir"><a href="Distribution.Simple.GHC.html#getLibDir"><span class="hs-identifier">getLibDir</span></a></a><span> </span><a name="local-6989586621679290731"><a href="#local-6989586621679290731"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290732"><a href="#local-6989586621679290732"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-356"></a><span>    </span><a href="Distribution.Utils.Generic.html#dropWhileEndLE"><span class="hs-identifier hs-var">dropWhileEndLE</span></a><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span>
</span><a name="line-357"></a><span>     </span><a href="Distribution.Simple.Program.html#getDbProgramOutput"><span class="hs-identifier hs-var">getDbProgramOutput</span></a><span> </span><a href="#local-6989586621679290731"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span>
</span><a name="line-358"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679290732"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--print-libdir&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-identifier">getLibDir'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-361"></a><a name="getLibDir%27"><a href="Distribution.Simple.GHC.html#getLibDir%27"><span class="hs-identifier">getLibDir'</span></a></a><span> </span><a name="local-6989586621679290733"><a href="#local-6989586621679290733"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290734"><a href="#local-6989586621679290734"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-362"></a><span>    </span><a href="Distribution.Utils.Generic.html#dropWhileEndLE"><span class="hs-identifier hs-var">dropWhileEndLE</span></a><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span>
</span><a name="line-363"></a><span>     </span><a href="Distribution.Simple.Program.html#getProgramOutput"><span class="hs-identifier hs-var">getProgramOutput</span></a><span> </span><a href="#local-6989586621679290733"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290734"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--print-libdir&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">-- | Return the 'FilePath' to the global GHC package database.</span><span>
</span><a name="line-367"></a><span class="hs-identifier">getGlobalPackageDB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-368"></a><a name="getGlobalPackageDB"><a href="Distribution.Simple.GHC.html#getGlobalPackageDB"><span class="hs-identifier">getGlobalPackageDB</span></a></a><span> </span><a name="local-6989586621679290735"><a href="#local-6989586621679290735"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290736"><a href="#local-6989586621679290736"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-369"></a><span>    </span><a href="Distribution.Utils.Generic.html#dropWhileEndLE"><span class="hs-identifier hs-var">dropWhileEndLE</span></a><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span>
</span><a name="line-370"></a><span>     </span><a href="Distribution.Simple.Program.html#getProgramOutput"><span class="hs-identifier hs-var">getProgramOutput</span></a><span> </span><a href="#local-6989586621679290735"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290736"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--print-global-package-db&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-comment">-- | Return the 'FilePath' to the per-user GHC package database.</span><span>
</span><a name="line-373"></a><span class="hs-identifier">getUserPackageDB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#NoCallStackIO"><span class="hs-identifier hs-type">NoCallStackIO</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-374"></a><a name="getUserPackageDB"><a href="Distribution.Simple.GHC.html#getUserPackageDB"><span class="hs-identifier">getUserPackageDB</span></a></a><span> </span><a name="local-6989586621679290737"><a href="#local-6989586621679290737"><span class="hs-identifier">_verbosity</span></a></a><span> </span><a name="local-6989586621679290738"><a href="#local-6989586621679290738"><span class="hs-identifier">ghcProg</span></a></a><span> </span><a name="local-6989586621679290739"><a href="#local-6989586621679290739"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-comment">-- It's rather annoying that we have to reconstruct this, because ghc</span><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- hides this information from us otherwise. But for certain use cases</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-comment">-- like change monitoring it really can't remain hidden.</span><span>
</span><a name="line-378"></a><span>    </span><a name="local-6989586621679290743"><a href="#local-6989586621679290743"><span class="hs-identifier">appdir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getAppUserDataDirectory</span><span> </span><span class="hs-string">&quot;ghc&quot;</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290743"><span class="hs-identifier hs-var">appdir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679290740"><span class="hs-identifier hs-var">platformAndVersion</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679290741"><span class="hs-identifier hs-var">packageConfFileName</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-381"></a><span>    </span><a name="local-6989586621679290740"><a href="#local-6989586621679290740"><span class="hs-identifier">platformAndVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#ghcPlatformAndVersionString"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ghcPlatformAndVersionString</span></a><span>
</span><a name="line-382"></a><span>                           </span><a href="#local-6989586621679290739"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621679290742"><span class="hs-identifier hs-var">ghcVersion</span></a><span>
</span><a name="line-383"></a><span>    </span><a name="local-6989586621679290741"><a href="#local-6989586621679290741"><span class="hs-identifier">packageConfFileName</span></a></a><span>
</span><a name="line-384"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290742"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">12</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;package.conf.d&quot;</span><span>
</span><a name="line-385"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;package.conf&quot;</span><span>
</span><a name="line-386"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290742"><a href="#local-6989586621679290742"><span class="hs-identifier">ghcVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programVersion</span><span> </span><a href="#local-6989586621679290738"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-identifier">checkPackageDbEnvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-389"></a><a name="checkPackageDbEnvVar"><a href="Distribution.Simple.GHC.html#checkPackageDbEnvVar"><span class="hs-identifier">checkPackageDbEnvVar</span></a></a><span> </span><a name="local-6989586621679290744"><a href="#local-6989586621679290744"><span class="hs-identifier">verbosity</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-390"></a><span>    </span><a href="Distribution.Simple.GHC.Internal.html#checkPackageDbEnvVar"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">checkPackageDbEnvVar</span></a><span> </span><a href="#local-6989586621679290744"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;GHC&quot;</span><span> </span><span class="hs-string">&quot;GHC_PACKAGE_PATH&quot;</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-identifier">checkPackageDbStack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDBStack"><span class="hs-identifier hs-type">PackageDBStack</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-393"></a><a name="checkPackageDbStack"><a href="Distribution.Simple.GHC.html#checkPackageDbStack"><span class="hs-identifier">checkPackageDbStack</span></a></a><span> </span><a name="local-6989586621679290745"><a href="#local-6989586621679290745"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290746"><a href="#local-6989586621679290746"><span class="hs-identifier">comp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-394"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">flagPackageConf</span><span> </span><a href="#local-6989586621679290747"><span class="hs-identifier hs-var">implInfo</span></a><span>
</span><a name="line-395"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.GHC.html#checkPackageDbStackPre76"><span class="hs-identifier hs-var">checkPackageDbStackPre76</span></a><span> </span><a href="#local-6989586621679290745"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-396"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Simple.GHC.html#checkPackageDbStackPost76"><span class="hs-identifier hs-var">checkPackageDbStackPost76</span></a><span> </span><a href="#local-6989586621679290745"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-397"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679290747"><a href="#local-6989586621679290747"><span class="hs-identifier">implInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#ghcVersionImplInfo"><span class="hs-identifier hs-var">ghcVersionImplInfo</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#compilerVersion"><span class="hs-identifier hs-var">compilerVersion</span></a><span> </span><a href="#local-6989586621679290746"><span class="hs-identifier hs-var">comp</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">checkPackageDbStackPost76</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDBStack"><span class="hs-identifier hs-type">PackageDBStack</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-400"></a><a name="checkPackageDbStackPost76"><a href="Distribution.Simple.GHC.html#checkPackageDbStackPost76"><span class="hs-identifier">checkPackageDbStackPost76</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span class="hs-glyph">:</span><a name="local-6989586621679290748"><a href="#local-6989586621679290748"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-401"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679290748"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span class="hs-identifier">checkPackageDbStackPost76</span><span> </span><a name="local-6989586621679290749"><a href="#local-6989586621679290749"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290750"><a href="#local-6989586621679290750"><span class="hs-identifier">rest</span></a></a><span>
</span><a name="line-403"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679290750"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-404"></a><span>  </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679290749"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;If the global package db is specified, it must be &quot;</span><span>
</span><a name="line-405"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;specified first and cannot be specified multiple times&quot;</span><span>
</span><a name="line-406"></a><span class="hs-identifier">checkPackageDbStackPost76</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-identifier">checkPackageDbStackPre76</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDBStack"><span class="hs-identifier hs-type">PackageDBStack</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-409"></a><a name="checkPackageDbStackPre76"><a href="Distribution.Simple.GHC.html#checkPackageDbStackPre76"><span class="hs-identifier">checkPackageDbStackPre76</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span class="hs-glyph">:</span><a name="local-6989586621679290751"><a href="#local-6989586621679290751"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679290751"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span class="hs-identifier">checkPackageDbStackPre76</span><span> </span><a name="local-6989586621679290752"><a href="#local-6989586621679290752"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290753"><a href="#local-6989586621679290753"><span class="hs-identifier">rest</span></a></a><span>
</span><a name="line-412"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679290753"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-413"></a><span>  </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679290752"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;With current ghc versions the global package db is always used &quot;</span><span>
</span><a name="line-414"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;and must be listed first. This ghc limitation is lifted in GHC 7.6,&quot;</span><span>
</span><a name="line-415"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;see http://hackage.haskell.org/trac/ghc/ticket/5977&quot;</span><span>
</span><a name="line-416"></a><span class="hs-identifier">checkPackageDbStackPre76</span><span> </span><a name="local-6989586621679290754"><a href="#local-6989586621679290754"><span class="hs-identifier">verbosity</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-417"></a><span>  </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679290754"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;If the global package db is specified, it must be &quot;</span><span>
</span><a name="line-418"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;specified first and cannot be specified multiple times&quot;</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-comment">-- GHC &lt; 6.10 put &quot;$topdir/include/mingw&quot; in rts's installDirs. This</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- breaks when you want to use a different gcc, so we need to filter</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- it out.</span><span>
</span><a name="line-423"></a><span class="hs-identifier">removeMingwIncludeDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span>
</span><a name="line-424"></a><a name="removeMingwIncludeDir"><a href="Distribution.Simple.GHC.html#removeMingwIncludeDir"><span class="hs-identifier">removeMingwIncludeDir</span></a></a><span> </span><a name="local-6989586621679290755"><a href="#local-6989586621679290755"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-425"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290756"><a href="#local-6989586621679290756"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">InstalledPackageInfo</span><span class="hs-operator">.</span><span class="hs-identifier">includeDirs</span><span> </span><a href="#local-6989586621679290755"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-426"></a><span>        </span><a name="local-6989586621679290757"><a href="#local-6989586621679290757"><span class="hs-identifier">ids'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;mingw&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isSuffixOf</span><span class="hs-special">`</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290756"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-427"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679290755"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">InstalledPackageInfo</span><span class="hs-operator">.</span><span class="hs-identifier">includeDirs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290757"><span class="hs-identifier hs-var">ids'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span class="hs-comment">-- | Get the packages from specific PackageDBs, not cumulative.</span><span>
</span><a name="line-430"></a><span class="hs-comment">--</span><span>
</span><a name="line-431"></a><span class="hs-identifier">getInstalledPackages'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-432"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-433"></a><a name="getInstalledPackages%27"><a href="Distribution.Simple.GHC.html#getInstalledPackages%27"><span class="hs-identifier">getInstalledPackages'</span></a></a><span> </span><a name="local-6989586621679290758"><a href="#local-6989586621679290758"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290759"><a href="#local-6989586621679290759"><span class="hs-identifier">packagedbs</span></a></a><span> </span><a name="local-6989586621679290760"><a href="#local-6989586621679290760"><span class="hs-identifier">progdb</span></a></a><span>
</span><a name="line-434"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290762"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">9</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-435"></a><span>  </span><span class="hs-identifier hs-var">sequenceA</span><span>
</span><a name="line-436"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679290764"><a href="#local-6989586621679290764"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.HcPkg.html#dump"><span class="hs-identifier hs-var">HcPkg</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">dump</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#hcPkgInfo"><span class="hs-identifier hs-var">hcPkgInfo</span></a><span> </span><a href="#local-6989586621679290760"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290758"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290763"><span class="hs-identifier hs-var">packagedb</span></a><span>
</span><a name="line-437"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290763"><span class="hs-identifier hs-var">packagedb</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290764"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679290763"><a href="#local-6989586621679290763"><span class="hs-identifier">packagedb</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679290759"><span class="hs-identifier hs-var">packagedbs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290761"><a href="#local-6989586621679290761"><span class="hs-identifier">ghcProg</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><a href="#local-6989586621679290760"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-442"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290762"><a href="#local-6989586621679290762"><span class="hs-identifier">ghcVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programVersion</span><span> </span><a href="#local-6989586621679290761"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-identifier">getInstalledPackages'</span><span> </span><a name="local-6989586621679290765"><a href="#local-6989586621679290765"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290766"><a href="#local-6989586621679290766"><span class="hs-identifier">packagedbs</span></a></a><span> </span><a name="local-6989586621679290767"><a href="#local-6989586621679290767"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-445"></a><span>    </span><a name="local-6989586621679290777"><a href="#local-6989586621679290777"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.html#getDbProgramOutput"><span class="hs-identifier hs-var">getDbProgramOutput</span></a><span> </span><a href="#local-6989586621679290765"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcPkgProgram"><span class="hs-identifier hs-var">ghcPkgProgram</span></a><span> </span><a href="#local-6989586621679290767"><span class="hs-identifier hs-var">progdb</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;list&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-446"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290778"><a href="#local-6989586621679290778"><span class="hs-identifier">pkgFiles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">init</span><span> </span><a href="#local-6989586621679290780"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679290780"><a href="#local-6989586621679290780"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lines</span><span> </span><a href="#local-6989586621679290777"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">last</span><span> </span><a href="#local-6989586621679290780"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">':'</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-447"></a><span>        </span><a name="local-6989586621679290779"><a href="#local-6989586621679290779"><span class="hs-identifier">dbFile</span></a></a><span> </span><a name="local-6989586621679290781"><a href="#local-6989586621679290781"><span class="hs-identifier">packagedb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290781"><span class="hs-identifier hs-var">packagedb</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290778"><span class="hs-identifier hs-var">pkgFiles</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-448"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290782"><a href="#local-6989586621679290782"><span class="hs-identifier">global</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679290782"><span class="hs-identifier hs-var">global</span></a><span>
</span><a name="line-449"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#UserPackageDB"><span class="hs-identifier hs-var">UserPackageDB</span></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679290783"><a href="#local-6989586621679290783"><span class="hs-identifier">_global</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679290784"><a href="#local-6989586621679290784"><span class="hs-identifier">user</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679290784"><span class="hs-identifier hs-var">user</span></a><span>
</span><a name="line-450"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#UserPackageDB"><span class="hs-identifier hs-var">UserPackageDB</span></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679290785"><a href="#local-6989586621679290785"><span class="hs-identifier">_global</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-451"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#SpecificPackageDB"><span class="hs-identifier hs-var">SpecificPackageDB</span></a><span> </span><a name="local-6989586621679290786"><a href="#local-6989586621679290786"><span class="hs-identifier">specific</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679290786"><span class="hs-identifier hs-var">specific</span></a><span>
</span><a name="line-452"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679290765"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;cannot read ghc-pkg package listing&quot;</span><span>
</span><a name="line-453"></a><span>    </span><a name="local-6989586621679290787"><a href="#local-6989586621679290787"><span class="hs-identifier">pkgFiles'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621679290779"><span class="hs-identifier hs-var">dbFile</span></a><span> </span><a href="#local-6989586621679290766"><span class="hs-identifier hs-var">packagedbs</span></a><span>
</span><a name="line-454"></a><span>    </span><span class="hs-identifier hs-var">sequenceA</span><span> </span><span class="hs-special">[</span><span> </span><a href="Distribution.Utils.Generic.html#withFileContents"><span class="hs-identifier hs-var">withFileContents</span></a><span> </span><a href="#local-6989586621679290789"><span class="hs-identifier hs-var">file</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679290790"><a href="#local-6989586621679290790"><span class="hs-identifier">content</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-455"></a><span>                  </span><a name="local-6989586621679290791"><a href="#local-6989586621679290791"><span class="hs-identifier">pkgs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679290768"><span class="hs-identifier hs-var">readPackages</span></a><span> </span><a href="#local-6989586621679290789"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="#local-6989586621679290790"><span class="hs-identifier hs-var">content</span></a><span>
</span><a name="line-456"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290788"><span class="hs-identifier hs-var">db</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290791"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679290788"><a href="#local-6989586621679290788"><span class="hs-identifier">db</span></a></a><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290789"><a href="#local-6989586621679290789"><span class="hs-identifier">file</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679290766"><span class="hs-identifier hs-var">packagedbs</span></a><span> </span><a href="#local-6989586621679290787"><span class="hs-identifier hs-var">pkgFiles'</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-458"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-459"></a><span>    </span><span class="hs-comment">-- Depending on the version of ghc we use a different type's Read</span><span>
</span><a name="line-460"></a><span>    </span><span class="hs-comment">-- instance to parse the package file and then convert.</span><span>
</span><a name="line-461"></a><span>    </span><span class="hs-comment">-- It's a bit yuck. But that's what we get for using Read/Show.</span><span>
</span><a name="line-462"></a><span>    </span><a name="local-6989586621679290768"><a href="#local-6989586621679290768"><span class="hs-identifier">readPackages</span></a></a><span>
</span><a name="line-463"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290770"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">]</span><span>
</span><a name="line-464"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679290772"><a href="#local-6989586621679290772"><span class="hs-identifier">file</span></a></a><span> </span><a name="local-6989586621679290773"><a href="#local-6989586621679290773"><span class="hs-identifier">content</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621679290773"><span class="hs-identifier hs-var">content</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-465"></a><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621679290774"><a href="#local-6989586621679290774"><span class="hs-identifier">pkgs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Distribution.Simple.GHC.IPI642.html#toCurrent"><span class="hs-identifier hs-var">IPI642</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toCurrent</span></a><span> </span><a href="#local-6989586621679290774"><span class="hs-identifier hs-var">pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>          </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290771"><span class="hs-identifier hs-var">failToRead</span></a><span> </span><a href="#local-6989586621679290772"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-467"></a><span>      </span><span class="hs-comment">-- We dropped support for 6.4.2 and earlier.</span><span>
</span><a name="line-468"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-469"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679290775"><a href="#local-6989586621679290775"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290771"><span class="hs-identifier hs-var">failToRead</span></a><span> </span><a href="#local-6989586621679290775"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-470"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290769"><a href="#local-6989586621679290769"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><a href="#local-6989586621679290767"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-471"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290770"><a href="#local-6989586621679290770"><span class="hs-identifier">ghcVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programVersion</span><span> </span><a href="#local-6989586621679290769"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-472"></a><span>    </span><a name="local-6989586621679290771"><a href="#local-6989586621679290771"><span class="hs-identifier">failToRead</span></a></a><span> </span><a name="local-6989586621679290776"><a href="#local-6989586621679290776"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679290765"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;cannot read ghc package database &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290776"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-identifier">getInstalledPackagesMonitorFiles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span>
</span><a name="line-475"></a><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-476"></a><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span class="hs-special">]</span><span>
</span><a name="line-477"></a><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>
</span><a name="line-478"></a><a name="getInstalledPackagesMonitorFiles"><a href="Distribution.Simple.GHC.html#getInstalledPackagesMonitorFiles"><span class="hs-identifier">getInstalledPackagesMonitorFiles</span></a></a><span> </span><a name="local-6989586621679290792"><a href="#local-6989586621679290792"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290793"><a href="#local-6989586621679290793"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679290794"><a href="#local-6989586621679290794"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-479"></a><span>    </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621679290795"><span class="hs-identifier hs-var">getPackageDBPath</span></a><span>
</span><a name="line-480"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-481"></a><span>    </span><span class="hs-identifier">getPackageDBPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-482"></a><span>    </span><a name="local-6989586621679290795"><a href="#local-6989586621679290795"><span class="hs-identifier">getPackageDBPath</span></a></a><span> </span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-483"></a><span>      </span><a href="#local-6989586621679290796"><span class="hs-identifier hs-var">selectMonitorFile</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Distribution.Simple.GHC.html#getGlobalPackageDB"><span class="hs-identifier hs-var">getGlobalPackageDB</span></a><span> </span><a href="#local-6989586621679290792"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290797"><span class="hs-identifier hs-var">ghcProg</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>    </span><span class="hs-identifier">getPackageDBPath</span><span> </span><a href="Distribution.Simple.Compiler.html#UserPackageDB"><span class="hs-identifier hs-var">UserPackageDB</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-486"></a><span>      </span><a href="#local-6989586621679290796"><span class="hs-identifier hs-var">selectMonitorFile</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Distribution.Simple.GHC.html#getUserPackageDB"><span class="hs-identifier hs-var">getUserPackageDB</span></a><span> </span><a href="#local-6989586621679290792"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290797"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><a href="#local-6989586621679290793"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span>    </span><span class="hs-identifier">getPackageDBPath</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#SpecificPackageDB"><span class="hs-identifier hs-var">SpecificPackageDB</span></a><span> </span><a name="local-6989586621679290798"><a href="#local-6989586621679290798"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290796"><span class="hs-identifier hs-var">selectMonitorFile</span></a><span> </span><a href="#local-6989586621679290798"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span>    </span><span class="hs-comment">-- GHC has old style file dbs, and new style directory dbs.</span><span>
</span><a name="line-491"></a><span>    </span><span class="hs-comment">-- Note that for dir style dbs, we only need to monitor the cache file, not</span><span>
</span><a name="line-492"></a><span>    </span><span class="hs-comment">-- the whole directory. The ghc program itself only reads the cache file</span><span>
</span><a name="line-493"></a><span>    </span><span class="hs-comment">-- so it's safe to only monitor this one file.</span><span>
</span><a name="line-494"></a><span>    </span><a name="local-6989586621679290796"><a href="#local-6989586621679290796"><span class="hs-identifier">selectMonitorFile</span></a></a><span> </span><a name="local-6989586621679290799"><a href="#local-6989586621679290799"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-495"></a><span>      </span><a name="local-6989586621679290800"><a href="#local-6989586621679290800"><span class="hs-identifier">isFileStyle</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">doesFileExist</span><span> </span><a href="#local-6989586621679290799"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-496"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290800"><span class="hs-identifier hs-var">isFileStyle</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679290799"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-497"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290799"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-string">&quot;package.cache&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679290797"><a href="#local-6989586621679290797"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><a href="#local-6989586621679290794"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-503"></a><span class="hs-comment">-- Building a library</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-identifier">buildLib</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">replLib</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-type">Cabal</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-507"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.Library.html#Library"><span class="hs-identifier hs-type">Library</span></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-508"></a><a name="buildLib"><a href="Distribution.Simple.GHC.html#buildLib"><span class="hs-identifier">buildLib</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#buildOrReplLib"><span class="hs-identifier hs-var">buildOrReplLib</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-509"></a><a name="replLib"><a href="Distribution.Simple.GHC.html#replLib"><span class="hs-identifier">replLib</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#buildOrReplLib"><span class="hs-identifier hs-var">buildOrReplLib</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span class="hs-identifier">buildOrReplLib</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-type">Cabal</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-513"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.Library.html#Library"><span class="hs-identifier hs-type">Library</span></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-514"></a><a name="buildOrReplLib"><a href="Distribution.Simple.GHC.html#buildOrReplLib"><span class="hs-identifier">buildOrReplLib</span></a></a><span> </span><a name="local-6989586621679290801"><a href="#local-6989586621679290801"><span class="hs-identifier">forRepl</span></a></a><span> </span><a name="local-6989586621679290802"><a href="#local-6989586621679290802"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290803"><a href="#local-6989586621679290803"><span class="hs-identifier">numJobs</span></a></a><span> </span><a name="local-6989586621679290804"><a href="#local-6989586621679290804"><span class="hs-identifier">pkg_descr</span></a></a><span> </span><a name="local-6989586621679290805"><a href="#local-6989586621679290805"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679290806"><a href="#local-6989586621679290806"><span class="hs-identifier">lib</span></a></a><span> </span><a name="local-6989586621679290807"><a href="#local-6989586621679290807"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-515"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290808"><a href="#local-6989586621679290808"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-516"></a><span>      </span><a name="local-6989586621679290809"><a href="#local-6989586621679290809"><span class="hs-identifier">libTargetDir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier hs-var">componentBuildDir</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-517"></a><span>      </span><a name="local-6989586621679290810"><a href="#local-6989586621679290810"><span class="hs-identifier">whenVanillaLib</span></a></a><span> </span><a name="local-6989586621679290822"><a href="#local-6989586621679290822"><span class="hs-identifier">forceVanilla</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-518"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290822"><span class="hs-identifier hs-var">forceVanilla</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">withVanillaLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>      </span><a name="local-6989586621679290811"><a href="#local-6989586621679290811"><span class="hs-identifier">whenProfLib</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withProfLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>      </span><a name="local-6989586621679290812"><a href="#local-6989586621679290812"><span class="hs-identifier">whenSharedLib</span></a></a><span> </span><a name="local-6989586621679290823"><a href="#local-6989586621679290823"><span class="hs-identifier">forceShared</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-521"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290823"><span class="hs-identifier hs-var">forceShared</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">withSharedLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>      </span><a name="local-6989586621679290813"><a href="#local-6989586621679290813"><span class="hs-identifier">whenGHCiLib</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withGHCiLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">withVanillaLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>      </span><a name="local-6989586621679290814"><a href="#local-6989586621679290814"><span class="hs-identifier">ifReplLib</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679290801"><span class="hs-identifier hs-var">forRepl</span></a><span>
</span><a name="line-524"></a><span>      </span><a name="local-6989586621679290815"><a href="#local-6989586621679290815"><span class="hs-identifier">comp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-525"></a><span>      </span><a name="local-6989586621679290816"><a href="#local-6989586621679290816"><span class="hs-identifier">ghcVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Compiler.html#compilerVersion"><span class="hs-identifier hs-var">compilerVersion</span></a><span> </span><a href="#local-6989586621679290815"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-526"></a><span>      </span><a name="local-6989586621679290817"><a href="#local-6989586621679290817"><span class="hs-identifier">implInfo</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#getImplInfo"><span class="hs-identifier hs-var">getImplInfo</span></a><span> </span><a href="#local-6989586621679290815"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-527"></a><span>      </span><a name="local-6989586621679290818"><a href="#local-6989586621679290818"><span class="hs-identifier">platform</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><a name="local-6989586621679290819"><a href="#local-6989586621679290819"><span class="hs-identifier">_hostArch</span></a></a><span> </span><a name="local-6989586621679290820"><a href="#local-6989586621679290820"><span class="hs-identifier">hostOS</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-528"></a><span>      </span><a name="local-6989586621679290821"><a href="#local-6989586621679290821"><span class="hs-identifier">has_code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.ComponentLocalBuildInfo.html#componentIsIndefinite"><span class="hs-identifier hs-var">componentIsIndefinite</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679290824"><a href="#local-6989586621679290824"><span class="hs-identifier">ghcProg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-var">requireProgram</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290825"><a href="#local-6989586621679290825"><span class="hs-identifier">runGhcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.GHC.html#runGHC"><span class="hs-identifier hs-var">runGHC</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290824"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><a href="#local-6989586621679290815"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679290818"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span>  </span><a name="local-6989586621679290826"><a href="#local-6989586621679290826"><span class="hs-identifier">libBi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#hackThreadedFlag"><span class="hs-identifier hs-var">hackThreadedFlag</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-534"></a><span>             </span><a href="#local-6989586621679290815"><span class="hs-identifier hs-var">comp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withProfLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">libBuildInfo</span><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290827"><a href="#local-6989586621679290827"><span class="hs-identifier">isGhcDynamic</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#isDynamic"><span class="hs-identifier hs-var">isDynamic</span></a><span> </span><a href="#local-6989586621679290815"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-537"></a><span>      </span><a name="local-6989586621679290828"><a href="#local-6989586621679290828"><span class="hs-identifier">dynamicTooSupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#supportsDynamicToo"><span class="hs-identifier hs-var">supportsDynamicToo</span></a><span> </span><a href="#local-6989586621679290815"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-538"></a><span>      </span><a name="local-6989586621679290829"><a href="#local-6989586621679290829"><span class="hs-identifier">doingTH</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.Extension.html#EnableExtension"><span class="hs-identifier hs-var">EnableExtension</span></a><span> </span><a href="Language.Haskell.Extension.html#TemplateHaskell"><span class="hs-identifier hs-var">TemplateHaskell</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="Distribution.Types.BuildInfo.html#allExtensions"><span class="hs-identifier hs-var">allExtensions</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span>
</span><a name="line-539"></a><span>      </span><a name="local-6989586621679290830"><a href="#local-6989586621679290830"><span class="hs-identifier">forceVanillaLib</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290829"><span class="hs-identifier hs-var">doingTH</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679290827"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>
</span><a name="line-540"></a><span>      </span><a name="local-6989586621679290831"><a href="#local-6989586621679290831"><span class="hs-identifier">forceSharedLib</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290829"><span class="hs-identifier hs-var">doingTH</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>     </span><a href="#local-6989586621679290827"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>
</span><a name="line-541"></a><span>      </span><span class="hs-comment">-- TH always needs default libs, even when building for profiling</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span>  </span><span class="hs-comment">-- Determine if program coverage should be enabled and if so, what</span><span>
</span><a name="line-544"></a><span>  </span><span class="hs-comment">-- '-hpcdir' should be.</span><span>
</span><a name="line-545"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290832"><a href="#local-6989586621679290832"><span class="hs-identifier">isCoverageEnabled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">libCoverage</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-546"></a><span>      </span><span class="hs-comment">-- TODO: Historically HPC files have been put into a directory which</span><span>
</span><a name="line-547"></a><span>      </span><span class="hs-comment">-- has the package name.  I'm going to avoid changing this for</span><span>
</span><a name="line-548"></a><span>      </span><span class="hs-comment">-- now, but it would probably be better for this to be the</span><span>
</span><a name="line-549"></a><span>      </span><span class="hs-comment">-- component ID instead...</span><span>
</span><a name="line-550"></a><span>      </span><a name="local-6989586621679290833"><a href="#local-6989586621679290833"><span class="hs-identifier">pkg_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">package</span><span> </span><a href="#local-6989586621679290804"><span class="hs-identifier hs-var">pkg_descr</span></a><span class="hs-special">)</span><span>
</span><a name="line-551"></a><span>      </span><a name="local-6989586621679290834"><a href="#local-6989586621679290834"><span class="hs-identifier">distPref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">configDistPref</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">configFlags</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-552"></a><span>      </span><a name="local-6989586621679290835"><a href="#local-6989586621679290835"><span class="hs-identifier">hpcdir</span></a></a><span> </span><a name="local-6989586621679290836"><a href="#local-6989586621679290836"><span class="hs-identifier">way</span></a></a><span>
</span><a name="line-553"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290801"><span class="hs-identifier hs-var">forRepl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>  </span><span class="hs-comment">-- HPC is not supported in ghci</span><span>
</span><a name="line-554"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290832"><span class="hs-identifier hs-var">isCoverageEnabled</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Hpc.html#mixDir"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mixDir</span></a><span> </span><a href="#local-6989586621679290834"><span class="hs-identifier hs-var">distPref</span></a><span> </span><a href="#local-6989586621679290836"><span class="hs-identifier hs-var">way</span></a><span> </span><a href="#local-6989586621679290833"><span class="hs-identifier hs-var">pkg_name</span></a><span>
</span><a name="line-555"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-556"></a><span>
</span><a name="line-557"></a><span>  </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span>
</span><a name="line-558"></a><span>  </span><span class="hs-comment">-- TODO: do we need to put hs-boot files into place for mutually recursive</span><span>
</span><a name="line-559"></a><span>  </span><span class="hs-comment">-- modules?</span><span>
</span><a name="line-560"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290837"><a href="#local-6989586621679290837"><span class="hs-identifier">cObjs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">replaceExtension</span><span class="hs-special">`</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">)</span><span>
</span><a name="line-561"></a><span>      </span><a name="local-6989586621679290838"><a href="#local-6989586621679290838"><span class="hs-identifier">baseOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#componentGhcOptions"><span class="hs-identifier hs-var">componentGhcOptions</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span>
</span><a name="line-562"></a><span>      </span><a name="local-6989586621679290839"><a href="#local-6989586621679290839"><span class="hs-identifier">vanillaOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290838"><span class="hs-identifier hs-var">baseOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-563"></a><span>                      </span><span class="hs-identifier">ghcOptMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcModeMake"><span class="hs-identifier hs-var">GhcModeMake</span></a><span class="hs-special">,</span><span>
</span><a name="line-564"></a><span>                      </span><span class="hs-identifier">ghcOptNumJobs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290803"><span class="hs-identifier hs-var">numJobs</span></a><span class="hs-special">,</span><span>
</span><a name="line-565"></a><span>                      </span><span class="hs-identifier">ghcOptInputModules</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">,</span><span>
</span><a name="line-566"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290835"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Vanilla"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Vanilla</span></a><span>
</span><a name="line-567"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span>      </span><a name="local-6989586621679290840"><a href="#local-6989586621679290840"><span class="hs-identifier">profOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290839"><span class="hs-identifier hs-var">vanillaOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-570"></a><span>                      </span><span class="hs-identifier">ghcOptProfilingMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-571"></a><span>                      </span><span class="hs-identifier">ghcOptProfilingAuto</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#profDetailLevelFlag"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">profDetailLevelFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-572"></a><span>                                              </span><span class="hs-special">(</span><span class="hs-identifier">withProfLibDetail</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-573"></a><span>                      </span><span class="hs-identifier">ghcOptHiSuffix</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-574"></a><span>                      </span><span class="hs-identifier">ghcOptObjSuffix</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-575"></a><span>                      </span><span class="hs-identifier">ghcOptExtra</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Types.BuildInfo.html#hcProfOptions"><span class="hs-identifier hs-var">hcProfOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-576"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290835"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Prof"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Prof</span></a><span>
</span><a name="line-577"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>      </span><a name="local-6989586621679290841"><a href="#local-6989586621679290841"><span class="hs-identifier">sharedOpts</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290839"><span class="hs-identifier hs-var">vanillaOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-580"></a><span>                      </span><span class="hs-identifier">ghcOptDynLinkMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-var">GhcDynamicOnly</span></a><span class="hs-special">,</span><span>
</span><a name="line-581"></a><span>                      </span><span class="hs-identifier">ghcOptFPic</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-582"></a><span>                      </span><span class="hs-identifier">ghcOptHiSuffix</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-583"></a><span>                      </span><span class="hs-identifier">ghcOptObjSuffix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-584"></a><span>                      </span><span class="hs-identifier">ghcOptExtra</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-585"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290835"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Dyn</span></a><span>
</span><a name="line-586"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-587"></a><span>      </span><a name="local-6989586621679290842"><a href="#local-6989586621679290842"><span class="hs-identifier">linkerOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-588"></a><span>                      </span><span class="hs-identifier">ghcOptLinkOptions</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">ldOptions</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-589"></a><span>                      </span><span class="hs-identifier">ghcOptLinkLibs</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">extraLibs</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-590"></a><span>                      </span><span class="hs-identifier">ghcOptLinkLibPath</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">extraLibDirs</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-591"></a><span>                      </span><span class="hs-identifier">ghcOptLinkFrameworks</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-592"></a><span>                                                </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">frameworks</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-593"></a><span>                      </span><span class="hs-identifier">ghcOptLinkFrameworkDirs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-594"></a><span>                                                </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">extraFrameworkDirs</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-595"></a><span>                      </span><span class="hs-identifier">ghcOptInputFiles</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span>
</span><a name="line-596"></a><span>                                             </span><span class="hs-special">[</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679290845"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679290845"><a href="#local-6989586621679290845"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679290837"><span class="hs-identifier hs-var">cObjs</span></a><span class="hs-special">]</span><span>
</span><a name="line-597"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-598"></a><span>      </span><a name="local-6989586621679290843"><a href="#local-6989586621679290843"><span class="hs-identifier">replOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290839"><span class="hs-identifier hs-var">vanillaOpts</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-599"></a><span>                      </span><span class="hs-identifier">ghcOptExtra</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#overNubListR"><span class="hs-identifier hs-var">overNubListR</span></a><span>
</span><a name="line-600"></a><span>                                           </span><a href="Distribution.Simple.GHC.Internal.html#filterGhciFlags"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filterGhciFlags</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-601"></a><span>                                           </span><span class="hs-identifier">ghcOptExtra</span><span> </span><a href="#local-6989586621679290839"><span class="hs-identifier hs-var">vanillaOpts</span></a><span class="hs-special">,</span><span>
</span><a name="line-602"></a><span>                      </span><span class="hs-identifier">ghcOptNumJobs</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-603"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-604"></a><span>                    </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679290842"><span class="hs-identifier hs-var">linkerOpts</span></a><span>
</span><a name="line-605"></a><span>                    </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-606"></a><span>                      </span><span class="hs-identifier">ghcOptMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcModeInteractive"><span class="hs-identifier hs-var">GhcModeInteractive</span></a><span class="hs-special">,</span><span>
</span><a name="line-607"></a><span>                      </span><span class="hs-identifier">ghcOptOptimisation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcNoOptimisation"><span class="hs-identifier hs-var">GhcNoOptimisation</span></a><span>
</span><a name="line-608"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span>      </span><a name="local-6989586621679290844"><a href="#local-6989586621679290844"><span class="hs-identifier">vanillaSharedOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290839"><span class="hs-identifier hs-var">vanillaOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-611"></a><span>                      </span><span class="hs-identifier">ghcOptDynLinkMode</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcStaticAndDynamic"><span class="hs-identifier hs-var">GhcStaticAndDynamic</span></a><span class="hs-special">,</span><span>
</span><a name="line-612"></a><span>                      </span><span class="hs-identifier">ghcOptDynHiSuffix</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-613"></a><span>                      </span><span class="hs-identifier">ghcOptDynObjSuffix</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-614"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290835"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Dyn</span></a><span>
</span><a name="line-615"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290801"><span class="hs-identifier hs-var">forRepl</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-618"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290846"><a href="#local-6989586621679290846"><span class="hs-identifier">vanilla</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290810"><span class="hs-identifier hs-var">whenVanillaLib</span></a><span> </span><a href="#local-6989586621679290830"><span class="hs-identifier hs-var">forceVanillaLib</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290839"><span class="hs-identifier hs-var">vanillaOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-619"></a><span>           </span><a name="local-6989586621679290847"><a href="#local-6989586621679290847"><span class="hs-identifier">shared</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290812"><span class="hs-identifier hs-var">whenSharedLib</span></a><span>  </span><a href="#local-6989586621679290831"><span class="hs-identifier hs-var">forceSharedLib</span></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290841"><span class="hs-identifier hs-var">sharedOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-620"></a><span>           </span><a name="local-6989586621679290848"><a href="#local-6989586621679290848"><span class="hs-identifier">useDynToo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290828"><span class="hs-identifier hs-var">dynamicTooSupported</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-621"></a><span>                       </span><span class="hs-special">(</span><a href="#local-6989586621679290830"><span class="hs-identifier hs-var">forceVanillaLib</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">withVanillaLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-622"></a><span>                       </span><span class="hs-special">(</span><a href="#local-6989586621679290831"><span class="hs-identifier hs-var">forceSharedLib</span></a><span>  </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">withSharedLib</span><span>  </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-623"></a><span>                       </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">)</span><span>
</span><a name="line-624"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679290821"><span class="hs-identifier hs-var">has_code</span></a><span>
</span><a name="line-625"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679290846"><span class="hs-identifier hs-var">vanilla</span></a><span>
</span><a name="line-626"></a><span>        </span><span class="hs-keyword">else</span><span>
</span><a name="line-627"></a><span>         </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290848"><span class="hs-identifier hs-var">useDynToo</span></a><span>
</span><a name="line-628"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-629"></a><span>              </span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290844"><span class="hs-identifier hs-var">vanillaSharedOpts</span></a><span>
</span><a name="line-630"></a><span>              </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290835"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Dyn</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679290835"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Vanilla"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Vanilla</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-631"></a><span>                </span><span class="hs-special">(</span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-var">Cabal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Flag</span></a><span> </span><a name="local-6989586621679290849"><a href="#local-6989586621679290849"><span class="hs-identifier">dynDir</span></a></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-var">Cabal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Flag</span></a><span> </span><a name="local-6989586621679290850"><a href="#local-6989586621679290850"><span class="hs-identifier">vanillaDir</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-632"></a><span>                    </span><span class="hs-comment">-- When the vanilla and shared library builds are done</span><span>
</span><a name="line-633"></a><span>                    </span><span class="hs-comment">-- in one pass, only one set of HPC module interfaces</span><span>
</span><a name="line-634"></a><span>                    </span><span class="hs-comment">-- are generated. This set should suffice for both</span><span>
</span><a name="line-635"></a><span>                    </span><span class="hs-comment">-- static and dynamically linked executables. We copy</span><span>
</span><a name="line-636"></a><span>                    </span><span class="hs-comment">-- the modules interfaces so they are available under</span><span>
</span><a name="line-637"></a><span>                    </span><span class="hs-comment">-- both ways.</span><span>
</span><a name="line-638"></a><span>                    </span><a href="Distribution.Simple.Utils.html#copyDirectoryRecursive"><span class="hs-identifier hs-var">copyDirectoryRecursive</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290849"><span class="hs-identifier hs-var">dynDir</span></a><span> </span><a href="#local-6989586621679290850"><span class="hs-identifier hs-var">vanillaDir</span></a><span>
</span><a name="line-639"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290827"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>
</span><a name="line-641"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="#local-6989586621679290847"><span class="hs-identifier hs-var">shared</span></a><span class="hs-special">;</span><span>  </span><a href="#local-6989586621679290846"><span class="hs-identifier hs-var">vanilla</span></a><span>
</span><a name="line-642"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="#local-6989586621679290846"><span class="hs-identifier hs-var">vanilla</span></a><span class="hs-special">;</span><span> </span><a href="#local-6989586621679290847"><span class="hs-identifier hs-var">shared</span></a><span>
</span><a name="line-643"></a><span>       </span><a href="#local-6989586621679290811"><span class="hs-identifier hs-var">whenProfLib</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290840"><span class="hs-identifier hs-var">profOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span>  </span><span class="hs-comment">-- build any C sources</span><span>
</span><a name="line-646"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679290821"><span class="hs-identifier hs-var">has_code</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-647"></a><span>    </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;Building C Sources...&quot;</span><span>
</span><a name="line-648"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span>
</span><a name="line-649"></a><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290852"><a href="#local-6989586621679290852"><span class="hs-identifier">baseCcOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#componentCcGhcOptions"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">componentCcGhcOptions</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290817"><span class="hs-identifier hs-var">implInfo</span></a><span>
</span><a name="line-650"></a><span>                               </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><a href="#local-6989586621679290851"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-651"></a><span>               </span><a name="local-6989586621679290853"><a href="#local-6989586621679290853"><span class="hs-identifier">vanillaCcOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290827"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>
</span><a name="line-652"></a><span>                               </span><span class="hs-comment">-- Dynamic GHC requires C sources to be built</span><span>
</span><a name="line-653"></a><span>                               </span><span class="hs-comment">-- with -fPIC for REPL to work. See #2207.</span><span>
</span><a name="line-654"></a><span>                               </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679290852"><span class="hs-identifier hs-var">baseCcOpts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptFPic</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-655"></a><span>                               </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679290852"><span class="hs-identifier hs-var">baseCcOpts</span></a><span>
</span><a name="line-656"></a><span>               </span><a name="local-6989586621679290854"><a href="#local-6989586621679290854"><span class="hs-identifier">profCcOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290853"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-657"></a><span>                                 </span><span class="hs-identifier">ghcOptProfilingMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-658"></a><span>                                 </span><span class="hs-identifier">ghcOptObjSuffix</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_o&quot;</span><span>
</span><a name="line-659"></a><span>                               </span><span class="hs-special">}</span><span>
</span><a name="line-660"></a><span>               </span><a name="local-6989586621679290855"><a href="#local-6989586621679290855"><span class="hs-identifier">sharedCcOpts</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290853"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-661"></a><span>                                 </span><span class="hs-identifier">ghcOptFPic</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-662"></a><span>                                 </span><span class="hs-identifier">ghcOptDynLinkMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-var">GhcDynamicOnly</span></a><span class="hs-special">,</span><span>
</span><a name="line-663"></a><span>                                 </span><span class="hs-identifier">ghcOptObjSuffix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_o&quot;</span><span>
</span><a name="line-664"></a><span>                               </span><span class="hs-special">}</span><span>
</span><a name="line-665"></a><span>               </span><a name="local-6989586621679290856"><a href="#local-6989586621679290856"><span class="hs-identifier">odir</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcOptObjDir</span><span> </span><a href="#local-6989586621679290853"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>           </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679290856"><span class="hs-identifier hs-var">odir</span></a><span>
</span><a name="line-667"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290857"><a href="#local-6989586621679290857"><span class="hs-identifier">runGhcProgIfNeeded</span></a></a><span> </span><a name="local-6989586621679290858"><a href="#local-6989586621679290858"><span class="hs-identifier">ccOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-668"></a><span>                 </span><a name="local-6989586621679290859"><a href="#local-6989586621679290859"><span class="hs-identifier">needsRecomp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#checkNeedsRecompilation"><span class="hs-identifier hs-var">checkNeedsRecompilation</span></a><span> </span><a href="#local-6989586621679290851"><span class="hs-identifier hs-var">filename</span></a><span> </span><a href="#local-6989586621679290858"><span class="hs-identifier hs-var">ccOpts</span></a><span>
</span><a name="line-669"></a><span>                 </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679290859"><span class="hs-identifier hs-var">needsRecomp</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290858"><span class="hs-identifier hs-var">ccOpts</span></a><span>
</span><a name="line-670"></a><span>           </span><a href="#local-6989586621679290857"><span class="hs-identifier hs-var">runGhcProgIfNeeded</span></a><span> </span><a href="#local-6989586621679290853"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span>
</span><a name="line-671"></a><span>           </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679290801"><span class="hs-identifier hs-var">forRepl</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-672"></a><span>             </span><a href="#local-6989586621679290812"><span class="hs-identifier hs-var">whenSharedLib</span></a><span> </span><a href="#local-6989586621679290831"><span class="hs-identifier hs-var">forceSharedLib</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290857"><span class="hs-identifier hs-var">runGhcProgIfNeeded</span></a><span> </span><a href="#local-6989586621679290855"><span class="hs-identifier hs-var">sharedCcOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-673"></a><span>           </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679290801"><span class="hs-identifier hs-var">forRepl</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679290811"><span class="hs-identifier hs-var">whenProfLib</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290857"><span class="hs-identifier hs-var">runGhcProgIfNeeded</span></a><span> </span><a href="#local-6989586621679290854"><span class="hs-identifier hs-var">profCcOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679290851"><a href="#local-6989586621679290851"><span class="hs-identifier">filename</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">]</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span>  </span><span class="hs-comment">-- TODO: problem here is we need the .c files built first, so we can load them</span><span>
</span><a name="line-677"></a><span>  </span><span class="hs-comment">-- with ghci, but .c files can depend on .h files generated by ghc by ffi</span><span>
</span><a name="line-678"></a><span>  </span><span class="hs-comment">-- exports.</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679290821"><span class="hs-identifier hs-var">has_code</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679290814"><span class="hs-identifier hs-var">ifReplLib</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-681"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Utils.html#warn"><span class="hs-identifier hs-var">warn</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;No exposed modules&quot;</span><span>
</span><a name="line-682"></a><span>    </span><a href="#local-6989586621679290814"><span class="hs-identifier hs-var">ifReplLib</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290843"><span class="hs-identifier hs-var">replOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span>  </span><span class="hs-comment">-- link:</span><span>
</span><a name="line-685"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679290821"><span class="hs-identifier hs-var">has_code</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679290801"><span class="hs-identifier hs-var">forRepl</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-686"></a><span>    </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;Linking...&quot;</span><span>
</span><a name="line-687"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290860"><a href="#local-6989586621679290860"><span class="hs-identifier">cProfObjs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">replaceExtension</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;p_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-688"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">)</span><span>
</span><a name="line-689"></a><span>        </span><a name="local-6989586621679290861"><a href="#local-6989586621679290861"><span class="hs-identifier">cSharedObjs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">replaceExtension</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;dyn_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-690"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span>        </span><a name="local-6989586621679290862"><a href="#local-6989586621679290862"><span class="hs-identifier">compiler_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compilerId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-692"></a><span>        </span><a name="local-6989586621679290863"><a href="#local-6989586621679290863"><span class="hs-identifier">vanillaLibFilePath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#mkLibName"><span class="hs-identifier hs-var">mkLibName</span></a><span> </span><a href="#local-6989586621679290808"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-693"></a><span>        </span><a name="local-6989586621679290864"><a href="#local-6989586621679290864"><span class="hs-identifier">profileLibFilePath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#mkProfLibName"><span class="hs-identifier hs-var">mkProfLibName</span></a><span> </span><a href="#local-6989586621679290808"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-694"></a><span>        </span><a name="local-6989586621679290865"><a href="#local-6989586621679290865"><span class="hs-identifier">sharedLibFilePath</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#mkSharedLibName"><span class="hs-identifier hs-var">mkSharedLibName</span></a><span> </span><a href="#local-6989586621679290862"><span class="hs-identifier hs-var">compiler_id</span></a><span> </span><a href="#local-6989586621679290808"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-695"></a><span>        </span><a name="local-6989586621679290866"><a href="#local-6989586621679290866"><span class="hs-identifier">ghciLibFilePath</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#mkGHCiLibName"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mkGHCiLibName</span></a><span> </span><a href="#local-6989586621679290808"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-696"></a><span>        </span><a name="local-6989586621679290867"><a href="#local-6989586621679290867"><span class="hs-identifier">libInstallPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">libdir</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#absoluteComponentInstallDirs"><span class="hs-identifier hs-var">absoluteComponentInstallDirs</span></a><span> </span><a href="#local-6989586621679290804"><span class="hs-identifier hs-var">pkg_descr</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290808"><span class="hs-identifier hs-var">uid</span></a><span> </span><a href="Distribution.Simple.InstallDirs.html#NoCopyDest"><span class="hs-identifier hs-var">NoCopyDest</span></a><span>
</span><a name="line-697"></a><span>        </span><a name="local-6989586621679290868"><a href="#local-6989586621679290868"><span class="hs-identifier">sharedLibInstallPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290867"><span class="hs-identifier hs-var">libInstallPath</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#mkSharedLibName"><span class="hs-identifier hs-var">mkSharedLibName</span></a><span> </span><a href="#local-6989586621679290862"><span class="hs-identifier hs-var">compiler_id</span></a><span> </span><a href="#local-6989586621679290808"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span>    </span><a name="local-6989586621679290870"><a href="#local-6989586621679290870"><span class="hs-identifier">stubObjs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">sequenceA</span><span>
</span><a name="line-700"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="Distribution.Simple.Utils.html#findFileWithExtension"><span class="hs-identifier hs-var">findFileWithExtension</span></a><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span class="hs-special">]</span><span>
</span><a name="line-701"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.ModuleName.html#toFilePath"><span class="hs-identifier hs-var">ModuleName</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toFilePath</span></a><span> </span><a href="#local-6989586621679290869"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;_stub&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-702"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290816"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ghc-7.2+ does not make _stub.o files</span><span>
</span><a name="line-703"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679290869"><a href="#local-6989586621679290869"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-704"></a><span>    </span><a name="local-6989586621679290872"><a href="#local-6989586621679290872"><span class="hs-identifier">stubProfObjs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">sequenceA</span><span>
</span><a name="line-705"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="Distribution.Simple.Utils.html#findFileWithExtension"><span class="hs-identifier hs-var">findFileWithExtension</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;p_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span class="hs-special">]</span><span>
</span><a name="line-706"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.ModuleName.html#toFilePath"><span class="hs-identifier hs-var">ModuleName</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toFilePath</span></a><span> </span><a href="#local-6989586621679290871"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;_stub&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-707"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290816"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ghc-7.2+ does not make _stub.o files</span><span>
</span><a name="line-708"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679290871"><a href="#local-6989586621679290871"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-709"></a><span>    </span><a name="local-6989586621679290874"><a href="#local-6989586621679290874"><span class="hs-identifier">stubSharedObjs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">sequenceA</span><span>
</span><a name="line-710"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="Distribution.Simple.Utils.html#findFileWithExtension"><span class="hs-identifier hs-var">findFileWithExtension</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;dyn_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span class="hs-special">]</span><span>
</span><a name="line-711"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.ModuleName.html#toFilePath"><span class="hs-identifier hs-var">ModuleName</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toFilePath</span></a><span> </span><a href="#local-6989586621679290873"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;_stub&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-712"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679290816"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ghc-7.2+ does not make _stub.o files</span><span>
</span><a name="line-713"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679290873"><a href="#local-6989586621679290873"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span>    </span><a name="local-6989586621679290875"><a href="#local-6989586621679290875"><span class="hs-identifier">hObjs</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getHaskellObjects"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getHaskellObjects</span></a><span> </span><a href="#local-6989586621679290817"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-716"></a><span>                      </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-717"></a><span>    </span><a name="local-6989586621679290876"><a href="#local-6989586621679290876"><span class="hs-identifier">hProfObjs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-718"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">withProfLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-719"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getHaskellObjects"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getHaskellObjects</span></a><span> </span><a href="#local-6989586621679290817"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-720"></a><span>                      </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;p_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-721"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-722"></a><span>    </span><a name="local-6989586621679290877"><a href="#local-6989586621679290877"><span class="hs-identifier">hSharedObjs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-723"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">withSharedLib</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-724"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#getHaskellObjects"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getHaskellObjects</span></a><span> </span><a href="#local-6989586621679290817"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679290806"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-725"></a><span>                      </span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;dyn_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-726"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-727"></a><span>
</span><a name="line-728"></a><span>    </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290875"><span class="hs-identifier hs-var">hObjs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290837"><span class="hs-identifier hs-var">cObjs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290870"><span class="hs-identifier hs-var">stubObjs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-729"></a><span>      </span><a name="local-6989586621679290878"><a href="#local-6989586621679290878"><span class="hs-identifier">rpaths</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#getRPaths"><span class="hs-identifier hs-var">getRPaths</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290879"><a href="#local-6989586621679290879"><span class="hs-identifier">staticObjectFiles</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-732"></a><span>                 </span><a href="#local-6989586621679290875"><span class="hs-identifier hs-var">hObjs</span></a><span>
</span><a name="line-733"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290837"><span class="hs-identifier hs-var">cObjs</span></a><span>
</span><a name="line-734"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290870"><span class="hs-identifier hs-var">stubObjs</span></a><span>
</span><a name="line-735"></a><span>          </span><a name="local-6989586621679290880"><a href="#local-6989586621679290880"><span class="hs-identifier">profObjectFiles</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-736"></a><span>                 </span><a href="#local-6989586621679290876"><span class="hs-identifier hs-var">hProfObjs</span></a><span>
</span><a name="line-737"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290860"><span class="hs-identifier hs-var">cProfObjs</span></a><span>
</span><a name="line-738"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290872"><span class="hs-identifier hs-var">stubProfObjs</span></a><span>
</span><a name="line-739"></a><span>          </span><a name="local-6989586621679290881"><a href="#local-6989586621679290881"><span class="hs-identifier">ghciObjFiles</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-740"></a><span>                 </span><a href="#local-6989586621679290875"><span class="hs-identifier hs-var">hObjs</span></a><span>
</span><a name="line-741"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290837"><span class="hs-identifier hs-var">cObjs</span></a><span>
</span><a name="line-742"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290870"><span class="hs-identifier hs-var">stubObjs</span></a><span>
</span><a name="line-743"></a><span>          </span><a name="local-6989586621679290882"><a href="#local-6989586621679290882"><span class="hs-identifier">dynamicObjectFiles</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-744"></a><span>                 </span><a href="#local-6989586621679290877"><span class="hs-identifier hs-var">hSharedObjs</span></a><span>
</span><a name="line-745"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290809"><span class="hs-identifier hs-var">libTargetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290861"><span class="hs-identifier hs-var">cSharedObjs</span></a><span>
</span><a name="line-746"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290874"><span class="hs-identifier hs-var">stubSharedObjs</span></a><span>
</span><a name="line-747"></a><span>          </span><span class="hs-comment">-- After the relocation lib is created we invoke ghc -shared</span><span>
</span><a name="line-748"></a><span>          </span><span class="hs-comment">-- with the dependencies spelled out as -package arguments</span><span>
</span><a name="line-749"></a><span>          </span><span class="hs-comment">-- and ghc invokes the linker with the proper library paths</span><span>
</span><a name="line-750"></a><span>          </span><a name="local-6989586621679290883"><a href="#local-6989586621679290883"><span class="hs-identifier">ghcSharedLinkArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-751"></a><span>              </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-752"></a><span>                </span><span class="hs-identifier">ghcOptShared</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-753"></a><span>                </span><span class="hs-identifier">ghcOptDynLinkMode</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-var">GhcDynamicOnly</span></a><span class="hs-special">,</span><span>
</span><a name="line-754"></a><span>                </span><span class="hs-identifier">ghcOptInputFiles</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><a href="#local-6989586621679290882"><span class="hs-identifier hs-var">dynamicObjectFiles</span></a><span class="hs-special">,</span><span>
</span><a name="line-755"></a><span>                </span><span class="hs-identifier">ghcOptOutputFile</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="#local-6989586621679290865"><span class="hs-identifier hs-var">sharedLibFilePath</span></a><span class="hs-special">,</span><span>
</span><a name="line-756"></a><span>                </span><span class="hs-identifier">ghcOptExtra</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-757"></a><span>                                           </span><a href="Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-758"></a><span>                </span><span class="hs-comment">-- For dynamic libs, Mac OS/X needs to know the install location</span><span>
</span><a name="line-759"></a><span>                </span><span class="hs-comment">-- at build time. This only applies to GHC &lt; 7.8 - see the</span><span>
</span><a name="line-760"></a><span>                </span><span class="hs-comment">-- discussion in #1660.</span><span>
</span><a name="line-761"></a><span>                </span><span class="hs-identifier">ghcOptDylibName</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290820"><span class="hs-identifier hs-var">hostOS</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Distribution.System.html#OSX"><span class="hs-identifier hs-var">OSX</span></a><span>
</span><a name="line-762"></a><span>                                              </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679290816"><span class="hs-identifier hs-var">ghcVersion</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">]</span><span>
</span><a name="line-763"></a><span>                                            </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="#local-6989586621679290868"><span class="hs-identifier hs-var">sharedLibInstallPath</span></a><span>
</span><a name="line-764"></a><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span>
</span><a name="line-765"></a><span>                </span><span class="hs-identifier">ghcOptHideAllPackages</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-766"></a><span>                </span><span class="hs-identifier">ghcOptNoAutoLinkPackages</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-767"></a><span>                </span><span class="hs-identifier">ghcOptPackageDBs</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withPackageDB</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">,</span><span>
</span><a name="line-768"></a><span>                </span><span class="hs-identifier">ghcOptThisUnitId</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-769"></a><span>                    </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#LibComponentLocalBuildInfo"><span class="hs-identifier hs-var">LibComponentLocalBuildInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">componentCompatPackageKey</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290884"><a href="#local-6989586621679290884"><span class="hs-identifier">pk</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-770"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="#local-6989586621679290884"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-771"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span>
</span><a name="line-772"></a><span>                </span><span class="hs-identifier">ghcOptThisComponentId</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-773"></a><span>                    </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#LibComponentLocalBuildInfo"><span class="hs-identifier hs-var">LibComponentLocalBuildInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">componentInstantiatedWith</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290885"><a href="#local-6989586621679290885"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-774"></a><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290885"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-775"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-776"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentComponentId</span><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span>
</span><a name="line-778"></a><span>                </span><span class="hs-identifier">ghcOptInstantiatedWith</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-779"></a><span>                    </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#LibComponentLocalBuildInfo"><span class="hs-identifier hs-var">LibComponentLocalBuildInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">componentInstantiatedWith</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290886"><a href="#local-6989586621679290886"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-780"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290886"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-781"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-782"></a><span>                </span><span class="hs-identifier">ghcOptPackages</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-783"></a><span>                                           </span><a href="Distribution.Simple.GHC.Internal.html#mkGhcOptPackages"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mkGhcOptPackages</span></a><span> </span><a href="#local-6989586621679290807"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-special">,</span><span>
</span><a name="line-784"></a><span>                </span><span class="hs-identifier">ghcOptLinkLibs</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">extraLibs</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-785"></a><span>                </span><span class="hs-identifier">ghcOptLinkLibPath</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">extraLibDirs</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-786"></a><span>                </span><span class="hs-identifier">ghcOptLinkFrameworks</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">frameworks</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-787"></a><span>                </span><span class="hs-identifier">ghcOptLinkFrameworkDirs</span><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-788"></a><span>                  </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">extraFrameworkDirs</span><span> </span><a href="#local-6989586621679290826"><span class="hs-identifier hs-var">libBi</span></a><span class="hs-special">,</span><span>
</span><a name="line-789"></a><span>                </span><span class="hs-identifier">ghcOptRPaths</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290878"><span class="hs-identifier hs-var">rpaths</span></a><span>
</span><a name="line-790"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-791"></a><span>
</span><a name="line-792"></a><span>      </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcOptPackages</span><span> </span><a href="#local-6989586621679290883"><span class="hs-identifier hs-var">ghcSharedLinkArgs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span>      </span><a href="#local-6989586621679290810"><span class="hs-identifier hs-var">whenVanillaLib</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-795"></a><span>        </span><a href="Distribution.Simple.Program.Ar.html#createArLibArchive"><span class="hs-identifier hs-var">Ar</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">createArLibArchive</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290863"><span class="hs-identifier hs-var">vanillaLibFilePath</span></a><span> </span><a href="#local-6989586621679290879"><span class="hs-identifier hs-var">staticObjectFiles</span></a><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span>      </span><a href="#local-6989586621679290811"><span class="hs-identifier hs-var">whenProfLib</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-798"></a><span>        </span><a href="Distribution.Simple.Program.Ar.html#createArLibArchive"><span class="hs-identifier hs-var">Ar</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">createArLibArchive</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290864"><span class="hs-identifier hs-var">profileLibFilePath</span></a><span> </span><a href="#local-6989586621679290880"><span class="hs-identifier hs-var">profObjectFiles</span></a><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span>      </span><a href="#local-6989586621679290813"><span class="hs-identifier hs-var">whenGHCiLib</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-801"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679290887"><a href="#local-6989586621679290887"><span class="hs-identifier">ldProg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-var">requireProgram</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ldProgram"><span class="hs-identifier hs-var">ldProgram</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679290805"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-802"></a><span>        </span><a href="Distribution.Simple.Program.Ld.html#combineObjectFiles"><span class="hs-identifier hs-var">Ld</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">combineObjectFiles</span></a><span> </span><a href="#local-6989586621679290802"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290887"><span class="hs-identifier hs-var">ldProg</span></a><span>
</span><a name="line-803"></a><span>          </span><a href="#local-6989586621679290866"><span class="hs-identifier hs-var">ghciLibFilePath</span></a><span> </span><a href="#local-6989586621679290881"><span class="hs-identifier hs-var">ghciObjFiles</span></a><span>
</span><a name="line-804"></a><span>
</span><a name="line-805"></a><span>      </span><a href="#local-6989586621679290812"><span class="hs-identifier hs-var">whenSharedLib</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-806"></a><span>        </span><a href="#local-6989586621679290825"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679290883"><span class="hs-identifier hs-var">ghcSharedLinkArgs</span></a><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-comment">-- | Start a REPL without loading any source files.</span><span>
</span><a name="line-809"></a><span class="hs-identifier">startInterpreter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span>
</span><a name="line-810"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDBStack"><span class="hs-identifier hs-type">PackageDBStack</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-811"></a><a name="startInterpreter"><a href="Distribution.Simple.GHC.html#startInterpreter"><span class="hs-identifier">startInterpreter</span></a></a><span> </span><a name="local-6989586621679290888"><a href="#local-6989586621679290888"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290889"><a href="#local-6989586621679290889"><span class="hs-identifier">progdb</span></a></a><span> </span><a name="local-6989586621679290890"><a href="#local-6989586621679290890"><span class="hs-identifier">comp</span></a></a><span> </span><a name="local-6989586621679290891"><a href="#local-6989586621679290891"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679290892"><a href="#local-6989586621679290892"><span class="hs-identifier">packageDBs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-812"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290893"><a href="#local-6989586621679290893"><span class="hs-identifier">replOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-813"></a><span>        </span><span class="hs-identifier">ghcOptMode</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcModeInteractive"><span class="hs-identifier hs-var">GhcModeInteractive</span></a><span class="hs-special">,</span><span>
</span><a name="line-814"></a><span>        </span><span class="hs-identifier">ghcOptPackageDBs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290892"><span class="hs-identifier hs-var">packageDBs</span></a><span>
</span><a name="line-815"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-816"></a><span>  </span><a href="Distribution.Simple.GHC.html#checkPackageDbStack"><span class="hs-identifier hs-var">checkPackageDbStack</span></a><span> </span><a href="#local-6989586621679290888"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290890"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679290892"><span class="hs-identifier hs-var">packageDBs</span></a><span>
</span><a name="line-817"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679290894"><a href="#local-6989586621679290894"><span class="hs-identifier">ghcProg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-var">requireProgram</span></a><span> </span><a href="#local-6989586621679290888"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><a href="#local-6989586621679290889"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-818"></a><span>  </span><a href="Distribution.Simple.Program.GHC.html#runGHC"><span class="hs-identifier hs-var">runGHC</span></a><span> </span><a href="#local-6989586621679290888"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290894"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><a href="#local-6989586621679290890"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679290891"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621679290893"><span class="hs-identifier hs-var">replOpts</span></a><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-821"></a><span class="hs-comment">-- Building an executable or foreign library</span><span>
</span><a name="line-822"></a><span>
</span><a name="line-823"></a><span class="hs-comment">-- | Build a foreign library</span><span>
</span><a name="line-824"></a><span class="hs-identifier">buildFLib</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">replFLib</span><span>
</span><a name="line-825"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-type">Cabal</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-826"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-827"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-828"></a><a name="buildFLib"><a href="Distribution.Simple.GHC.html#buildFLib"><span class="hs-identifier">buildFLib</span></a></a><span> </span><a name="local-6989586621679290895"><a href="#local-6989586621679290895"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679290896"><a href="#local-6989586621679290896"><span class="hs-identifier">njobs</span></a></a><span> </span><a name="local-6989586621679290897"><a href="#local-6989586621679290897"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679290898"><a href="#local-6989586621679290898"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#gbuild"><span class="hs-identifier hs-var">gbuild</span></a><span> </span><a href="#local-6989586621679290895"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679290896"><span class="hs-identifier hs-var">njobs</span></a><span> </span><a href="#local-6989586621679290897"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679290898"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span>
</span><a name="line-829"></a><a name="replFLib"><a href="Distribution.Simple.GHC.html#replFLib"><span class="hs-identifier">replFLib</span></a></a><span>  </span><a name="local-6989586621679290899"><a href="#local-6989586621679290899"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679290900"><a href="#local-6989586621679290900"><span class="hs-identifier">njobs</span></a></a><span> </span><a name="local-6989586621679290901"><a href="#local-6989586621679290901"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679290902"><a href="#local-6989586621679290902"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#gbuild"><span class="hs-identifier hs-var">gbuild</span></a><span> </span><a href="#local-6989586621679290899"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679290900"><span class="hs-identifier hs-var">njobs</span></a><span> </span><a href="#local-6989586621679290901"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679290902"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>
</span><a name="line-830"></a><span>
</span><a name="line-831"></a><span class="hs-comment">-- | Build an executable with GHC.</span><span>
</span><a name="line-832"></a><span class="hs-comment">--</span><span>
</span><a name="line-833"></a><span class="hs-identifier">buildExe</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">replExe</span><span>
</span><a name="line-834"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-type">Cabal</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-836"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-837"></a><a name="buildExe"><a href="Distribution.Simple.GHC.html#buildExe"><span class="hs-identifier">buildExe</span></a></a><span> </span><a name="local-6989586621679290903"><a href="#local-6989586621679290903"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679290904"><a href="#local-6989586621679290904"><span class="hs-identifier">njobs</span></a></a><span> </span><a name="local-6989586621679290905"><a href="#local-6989586621679290905"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679290906"><a href="#local-6989586621679290906"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#gbuild"><span class="hs-identifier hs-var">gbuild</span></a><span> </span><a href="#local-6989586621679290903"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679290904"><span class="hs-identifier hs-var">njobs</span></a><span> </span><a href="#local-6989586621679290905"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679290906"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>
</span><a name="line-838"></a><a name="replExe"><a href="Distribution.Simple.GHC.html#replExe"><span class="hs-identifier">replExe</span></a></a><span>  </span><a name="local-6989586621679290907"><a href="#local-6989586621679290907"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679290908"><a href="#local-6989586621679290908"><span class="hs-identifier">njobs</span></a></a><span> </span><a name="local-6989586621679290909"><a href="#local-6989586621679290909"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679290910"><a href="#local-6989586621679290910"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#gbuild"><span class="hs-identifier hs-var">gbuild</span></a><span> </span><a href="#local-6989586621679290907"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679290908"><span class="hs-identifier hs-var">njobs</span></a><span> </span><a href="#local-6989586621679290909"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679290910"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span class="hs-comment">-- | Building an executable, starting the REPL, and building foreign</span><span>
</span><a name="line-841"></a><span class="hs-comment">-- libraries are all very similar and implemented in 'gbuild'. The</span><span>
</span><a name="line-842"></a><span class="hs-comment">-- 'GBuildMode' distinguishes between the various kinds of operation.</span><span>
</span><a name="line-843"></a><span class="hs-keyword">data</span><span> </span><a name="GBuildMode"><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier">GBuildMode</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-844"></a><span>    </span><a name="GBuildExe"><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier">GBuildExe</span></a></a><span>  </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span>
</span><a name="line-845"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GReplExe"><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier">GReplExe</span></a></a><span>   </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span>
</span><a name="line-846"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GBuildFLib"><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier">GBuildFLib</span></a></a><span> </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span>
</span><a name="line-847"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GReplFLib"><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier">GReplFLib</span></a></a><span>  </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span>
</span><a name="line-848"></a><span>
</span><a name="line-849"></a><span class="hs-identifier">gbuildInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.BuildInfo.html#BuildInfo"><span class="hs-identifier hs-type">BuildInfo</span></a><span>
</span><a name="line-850"></a><a name="gbuildInfo"><a href="Distribution.Simple.GHC.html#gbuildInfo"><span class="hs-identifier">gbuildInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>  </span><a name="local-6989586621679290911"><a href="#local-6989586621679290911"><span class="hs-identifier">exe</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">buildInfo</span><span> </span><a href="#local-6989586621679290911"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-851"></a><span class="hs-identifier">gbuildInfo</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>   </span><a name="local-6989586621679290912"><a href="#local-6989586621679290912"><span class="hs-identifier">exe</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">buildInfo</span><span> </span><a href="#local-6989586621679290912"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-852"></a><span class="hs-identifier">gbuildInfo</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679290913"><a href="#local-6989586621679290913"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foreignLibBuildInfo</span><span> </span><a href="#local-6989586621679290913"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-853"></a><span class="hs-identifier">gbuildInfo</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><a name="local-6989586621679290914"><a href="#local-6989586621679290914"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foreignLibBuildInfo</span><span> </span><a href="#local-6989586621679290914"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-identifier">gbuildName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-856"></a><a name="gbuildName"><a href="Distribution.Simple.GHC.html#gbuildName"><span class="hs-identifier">gbuildName</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>  </span><a name="local-6989586621679290915"><a href="#local-6989586621679290915"><span class="hs-identifier">exe</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">exeName</span><span> </span><a href="#local-6989586621679290915"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-857"></a><span class="hs-identifier">gbuildName</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>   </span><a name="local-6989586621679290916"><a href="#local-6989586621679290916"><span class="hs-identifier">exe</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">exeName</span><span> </span><a href="#local-6989586621679290916"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-858"></a><span class="hs-identifier">gbuildName</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679290917"><a href="#local-6989586621679290917"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">foreignLibName</span><span> </span><a href="#local-6989586621679290917"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-859"></a><span class="hs-identifier">gbuildName</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><a name="local-6989586621679290918"><a href="#local-6989586621679290918"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">foreignLibName</span><span> </span><a href="#local-6989586621679290918"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span class="hs-identifier">gbuildTargetName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-862"></a><a name="gbuildTargetName"><a href="Distribution.Simple.GHC.html#gbuildTargetName"><span class="hs-identifier">gbuildTargetName</span></a></a><span> </span><a name="local-6989586621679290919"><a href="#local-6989586621679290919"><span class="hs-identifier">_lbi</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>  </span><a name="local-6989586621679290920"><a href="#local-6989586621679290920"><span class="hs-identifier">exe</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#exeTargetName"><span class="hs-identifier hs-var">exeTargetName</span></a><span> </span><a href="#local-6989586621679290920"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-863"></a><span class="hs-identifier">gbuildTargetName</span><span> </span><a name="local-6989586621679290921"><a href="#local-6989586621679290921"><span class="hs-identifier">_lbi</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>   </span><a name="local-6989586621679290922"><a href="#local-6989586621679290922"><span class="hs-identifier">exe</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#exeTargetName"><span class="hs-identifier hs-var">exeTargetName</span></a><span> </span><a href="#local-6989586621679290922"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-864"></a><span class="hs-identifier">gbuildTargetName</span><span>  </span><a name="local-6989586621679290923"><a href="#local-6989586621679290923"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679290924"><a href="#local-6989586621679290924"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#flibTargetName"><span class="hs-identifier hs-var">flibTargetName</span></a><span> </span><a href="#local-6989586621679290923"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290924"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-865"></a><span class="hs-identifier">gbuildTargetName</span><span>  </span><a name="local-6989586621679290925"><a href="#local-6989586621679290925"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><a name="local-6989586621679290926"><a href="#local-6989586621679290926"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#flibTargetName"><span class="hs-identifier hs-var">flibTargetName</span></a><span> </span><a href="#local-6989586621679290925"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290926"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-866"></a><span>
</span><a name="line-867"></a><span class="hs-identifier">exeTargetName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-868"></a><a name="exeTargetName"><a href="Distribution.Simple.GHC.html#exeTargetName"><span class="hs-identifier">exeTargetName</span></a></a><span> </span><a name="local-6989586621679290927"><a href="#local-6989586621679290927"><span class="hs-identifier">exe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">exeName</span><span> </span><a href="#local-6989586621679290927"><span class="hs-identifier hs-var">exe</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Distribution.Simple.GHC.html#withExt"><span class="hs-identifier hs-var">withExt</span></a><span class="hs-special">`</span><span> </span><a href="Distribution.Simple.BuildPaths.html#exeExtension"><span class="hs-identifier hs-var">exeExtension</span></a><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-comment">-- | Target name for a foreign library (the actual file name)</span><span>
</span><a name="line-871"></a><span class="hs-comment">--</span><span>
</span><a name="line-872"></a><span class="hs-comment">-- We do not use mkLibName and co here because the naming for foreign libraries</span><span>
</span><a name="line-873"></a><span class="hs-comment">-- is slightly different (we don't use &quot;_p&quot; or compiler version suffices, and we</span><span>
</span><a name="line-874"></a><span class="hs-comment">-- don't want the &quot;lib&quot; prefix on Windows).</span><span>
</span><a name="line-875"></a><span class="hs-comment">--</span><span>
</span><a name="line-876"></a><span class="hs-comment">-- TODO: We do use `dllExtension` and co here, but really that's wrong: they</span><span>
</span><a name="line-877"></a><span class="hs-comment">-- use the OS used to build cabal to determine which extension to use, rather</span><span>
</span><a name="line-878"></a><span class="hs-comment">-- than the target OS (but this is wrong elsewhere in Cabal as well).</span><span>
</span><a name="line-879"></a><span class="hs-identifier">flibTargetName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-880"></a><a name="flibTargetName"><a href="Distribution.Simple.GHC.html#flibTargetName"><span class="hs-identifier">flibTargetName</span></a></a><span> </span><a name="local-6989586621679290928"><a href="#local-6989586621679290928"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679290929"><a href="#local-6989586621679290929"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-881"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290931"><span class="hs-identifier hs-var">os</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">foreignLibType</span><span> </span><a href="#local-6989586621679290929"><span class="hs-identifier hs-var">flib</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-882"></a><span>      </span><span class="hs-special">(</span><a href="Distribution.System.html#Windows"><span class="hs-identifier hs-var">Windows</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeShared"><span class="hs-identifier hs-var">ForeignLibNativeShared</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290930"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><span class="hs-string">&quot;dll&quot;</span><span>
</span><a name="line-883"></a><span>      </span><span class="hs-special">(</span><a href="Distribution.System.html#Windows"><span class="hs-identifier hs-var">Windows</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeStatic"><span class="hs-identifier hs-var">ForeignLibNativeStatic</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290930"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span>
</span><a name="line-884"></a><span>      </span><span class="hs-special">(</span><a href="Distribution.System.html#Linux"><span class="hs-identifier hs-var">Linux</span></a><span class="hs-special">,</span><span>   </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeShared"><span class="hs-identifier hs-var">ForeignLibNativeShared</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290930"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="#local-6989586621679290932"><span class="hs-identifier hs-var">versionedExt</span></a><span>
</span><a name="line-885"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679290935"><a href="#local-6989586621679290935"><span class="hs-identifier">_other</span></a></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeShared"><span class="hs-identifier hs-var">ForeignLibNativeShared</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290930"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#dllExtension"><span class="hs-identifier hs-var">dllExtension</span></a><span>
</span><a name="line-886"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679290936"><a href="#local-6989586621679290936"><span class="hs-identifier">_other</span></a></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeStatic"><span class="hs-identifier hs-var">ForeignLibNativeStatic</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290930"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#staticLibExtension"><span class="hs-identifier hs-var">staticLibExtension</span></a><span>
</span><a name="line-887"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679290937"><a href="#local-6989586621679290937"><span class="hs-identifier">_any</span></a></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibTypeUnknown"><span class="hs-identifier hs-var">ForeignLibTypeUnknown</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.PackageDescription.Utils.html#cabalBug"><span class="hs-identifier hs-var">cabalBug</span></a><span> </span><span class="hs-string">&quot;unknown foreign lib type&quot;</span><span>
</span><a name="line-888"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-889"></a><span>    </span><span class="hs-identifier">nm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-890"></a><span>    </span><a name="local-6989586621679290930"><a href="#local-6989586621679290930"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">foreignLibName</span><span> </span><a href="#local-6989586621679290929"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-891"></a><span>
</span><a name="line-892"></a><span>    </span><span class="hs-identifier">os</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.System.html#OS"><span class="hs-identifier hs-type">OS</span></a><span>
</span><a name="line-893"></a><span>    </span><a name="local-6989586621679290931"><a href="#local-6989586621679290931"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679290933"><a href="#local-6989586621679290933"><span class="hs-identifier">os'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679290928"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-894"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679290933"><span class="hs-identifier hs-var">os'</span></a><span>
</span><a name="line-895"></a><span>
</span><a name="line-896"></a><span>    </span><span class="hs-comment">-- If a foreign lib foo has lib-version-info 5:1:2 or</span><span>
</span><a name="line-897"></a><span>    </span><span class="hs-comment">-- lib-version-linux 3.2.1, it should be built as libfoo.so.3.2.1</span><span>
</span><a name="line-898"></a><span>    </span><span class="hs-comment">-- Libtool's version-info data is translated into library versions in a</span><span>
</span><a name="line-899"></a><span>    </span><span class="hs-comment">-- nontrivial way: so refer to libtool documentation.</span><span>
</span><a name="line-900"></a><span>    </span><span class="hs-identifier">versionedExt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-901"></a><span>    </span><a name="local-6989586621679290932"><a href="#local-6989586621679290932"><span class="hs-identifier">versionedExt</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-902"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290934"><a href="#local-6989586621679290934"><span class="hs-identifier">nums</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.ForeignLib.html#foreignLibVersion"><span class="hs-identifier hs-var">foreignLibVersion</span></a><span> </span><a href="#local-6989586621679290929"><span class="hs-identifier hs-var">flib</span></a><span> </span><a href="#local-6989586621679290931"><span class="hs-identifier hs-var">os</span></a><span>
</span><a name="line-903"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;.&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;so&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679290934"><span class="hs-identifier hs-var">nums</span></a><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span>
</span><a name="line-905"></a><span class="hs-comment">-- | Name for the library when building.</span><span>
</span><a name="line-906"></a><span class="hs-comment">--</span><span>
</span><a name="line-907"></a><span class="hs-comment">-- If the `lib-version-info` field or the `lib-version-linux` field of</span><span>
</span><a name="line-908"></a><span class="hs-comment">-- a foreign library target is set, we need to incorporate that</span><span>
</span><a name="line-909"></a><span class="hs-comment">-- version into the SONAME field.</span><span>
</span><a name="line-910"></a><span class="hs-comment">--</span><span>
</span><a name="line-911"></a><span class="hs-comment">-- If a foreign library foo has lib-version-info 5:1:2, it should be</span><span>
</span><a name="line-912"></a><span class="hs-comment">-- built as libfoo.so.3.2.1.  We want it to get soname libfoo.so.3.</span><span>
</span><a name="line-913"></a><span class="hs-comment">-- However, GHC does not allow overriding soname by setting linker</span><span>
</span><a name="line-914"></a><span class="hs-comment">-- options, as it sets a soname of its own (namely the output</span><span>
</span><a name="line-915"></a><span class="hs-comment">-- filename), after the user-supplied linker options.  Hence, we have</span><span>
</span><a name="line-916"></a><span class="hs-comment">-- to compile the library with the soname as its filename.  We rename</span><span>
</span><a name="line-917"></a><span class="hs-comment">-- the compiled binary afterwards.</span><span>
</span><a name="line-918"></a><span class="hs-comment">--</span><span>
</span><a name="line-919"></a><span class="hs-comment">-- This method allows to adjust the name of the library at build time</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- such that the correct soname can be set.</span><span>
</span><a name="line-921"></a><span class="hs-identifier">flibBuildName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-922"></a><a name="flibBuildName"><a href="Distribution.Simple.GHC.html#flibBuildName"><span class="hs-identifier">flibBuildName</span></a></a><span> </span><a name="local-6989586621679290938"><a href="#local-6989586621679290938"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679290939"><a href="#local-6989586621679290939"><span class="hs-identifier">flib</span></a></a><span>
</span><a name="line-923"></a><span>  </span><span class="hs-comment">-- On linux, if a foreign-library has version data, the first digit is used</span><span>
</span><a name="line-924"></a><span>  </span><span class="hs-comment">-- to produce the SONAME.</span><span>
</span><a name="line-925"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290940"><span class="hs-identifier hs-var">os</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">foreignLibType</span><span> </span><a href="#local-6989586621679290939"><span class="hs-identifier hs-var">flib</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span>
</span><a name="line-926"></a><span>    </span><span class="hs-special">(</span><a href="Distribution.System.html#Linux"><span class="hs-identifier hs-var">Linux</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeShared"><span class="hs-identifier hs-var">ForeignLibNativeShared</span></a><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290943"><a href="#local-6989586621679290943"><span class="hs-identifier">nums</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.ForeignLib.html#foreignLibVersion"><span class="hs-identifier hs-var">foreignLibVersion</span></a><span> </span><a href="#local-6989586621679290939"><span class="hs-identifier hs-var">flib</span></a><span> </span><a href="#local-6989586621679290940"><span class="hs-identifier hs-var">os</span></a><span>
</span><a name="line-928"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679290941"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;.&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;so&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679290943"><span class="hs-identifier hs-var">nums</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-929"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#flibTargetName"><span class="hs-identifier hs-var">flibTargetName</span></a><span> </span><a href="#local-6989586621679290938"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290939"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-930"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-931"></a><span>    </span><span class="hs-identifier">os</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.System.html#OS"><span class="hs-identifier hs-type">OS</span></a><span>
</span><a name="line-932"></a><span>    </span><a name="local-6989586621679290940"><a href="#local-6989586621679290940"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679290942"><a href="#local-6989586621679290942"><span class="hs-identifier">os'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679290938"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-933"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679290942"><span class="hs-identifier hs-var">os'</span></a><span>
</span><a name="line-934"></a><span>
</span><a name="line-935"></a><span>    </span><span class="hs-identifier">nm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-936"></a><span>    </span><a name="local-6989586621679290941"><a href="#local-6989586621679290941"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">foreignLibName</span><span> </span><a href="#local-6989586621679290939"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-937"></a><span>
</span><a name="line-938"></a><span class="hs-identifier">gbuildIsRepl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-939"></a><a name="gbuildIsRepl"><a href="Distribution.Simple.GHC.html#gbuildIsRepl"><span class="hs-identifier">gbuildIsRepl</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>  </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-940"></a><span class="hs-identifier">gbuildIsRepl</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>   </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-941"></a><span class="hs-identifier">gbuildIsRepl</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-942"></a><span class="hs-identifier">gbuildIsRepl</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-943"></a><span>
</span><a name="line-944"></a><span class="hs-identifier">gbuildNeedDynamic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-945"></a><a name="gbuildNeedDynamic"><a href="Distribution.Simple.GHC.html#gbuildNeedDynamic"><span class="hs-identifier">gbuildNeedDynamic</span></a></a><span> </span><a name="local-6989586621679290944"><a href="#local-6989586621679290944"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679290945"><a href="#local-6989586621679290945"><span class="hs-identifier">bm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-946"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679290945"><span class="hs-identifier hs-var">bm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-947"></a><span>      </span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">withDynExe</span><span> </span><a href="#local-6989586621679290944"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-948"></a><span>      </span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>   </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">withDynExe</span><span> </span><a href="#local-6989586621679290944"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-949"></a><span>      </span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679290948"><a href="#local-6989586621679290948"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290946"><span class="hs-identifier hs-var">withDynFLib</span></a><span> </span><a href="#local-6989586621679290948"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-950"></a><span>      </span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><a name="local-6989586621679290949"><a href="#local-6989586621679290949"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290946"><span class="hs-identifier hs-var">withDynFLib</span></a><span> </span><a href="#local-6989586621679290949"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-951"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-952"></a><span>    </span><a name="local-6989586621679290946"><a href="#local-6989586621679290946"><span class="hs-identifier">withDynFLib</span></a></a><span> </span><a name="local-6989586621679290947"><a href="#local-6989586621679290947"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-953"></a><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">foreignLibType</span><span> </span><a href="#local-6989586621679290947"><span class="hs-identifier hs-var">flib</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-954"></a><span>        </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeShared"><span class="hs-identifier hs-var">ForeignLibNativeShared</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-955"></a><span>          </span><a href="Distribution.Types.ForeignLibOption.html#ForeignLibStandalone"><span class="hs-identifier hs-var">ForeignLibStandalone</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">foreignLibOptions</span><span> </span><a href="#local-6989586621679290947"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-956"></a><span>        </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeStatic"><span class="hs-identifier hs-var">ForeignLibNativeStatic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-957"></a><span>          </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-958"></a><span>        </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibTypeUnknown"><span class="hs-identifier hs-var">ForeignLibTypeUnknown</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-959"></a><span>          </span><a href="Distribution.PackageDescription.Utils.html#cabalBug"><span class="hs-identifier hs-var">cabalBug</span></a><span> </span><span class="hs-string">&quot;unknown foreign lib type&quot;</span><span>
</span><a name="line-960"></a><span>
</span><a name="line-961"></a><span class="hs-identifier">gbuildModDefFiles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>
</span><a name="line-962"></a><a name="gbuildModDefFiles"><a href="Distribution.Simple.GHC.html#gbuildModDefFiles"><span class="hs-identifier">gbuildModDefFiles</span></a></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-963"></a><span class="hs-identifier">gbuildModDefFiles</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>  </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-964"></a><span class="hs-identifier">gbuildModDefFiles</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679290950"><a href="#local-6989586621679290950"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foreignLibModDefFile</span><span> </span><a href="#local-6989586621679290950"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-965"></a><span class="hs-identifier">gbuildModDefFiles</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><a name="local-6989586621679290951"><a href="#local-6989586621679290951"><span class="hs-identifier">flib</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foreignLibModDefFile</span><span> </span><a href="#local-6989586621679290951"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-966"></a><span>
</span><a name="line-967"></a><span class="hs-comment">-- | &quot;Main&quot; module name when overridden by @ghc-options: -main-is ...@</span><span>
</span><a name="line-968"></a><span class="hs-comment">-- or 'Nothing' if no @-main-is@ flag could be found.</span><span>
</span><a name="line-969"></a><span class="hs-comment">--</span><span>
</span><a name="line-970"></a><span class="hs-comment">-- In case of 'Nothing', 'Distribution.ModuleName.main' can be assumed.</span><span>
</span><a name="line-971"></a><span class="hs-identifier">exeMainModuleName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-972"></a><a name="exeMainModuleName"><a href="Distribution.Simple.GHC.html#exeMainModuleName"><span class="hs-identifier">exeMainModuleName</span></a></a><span> </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-var">Executable</span></a><span class="hs-special">{</span><span class="hs-identifier">buildInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290952"><a href="#local-6989586621679290952"><span class="hs-identifier">bnfo</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-973"></a><span>    </span><span class="hs-comment">-- GHC honors the last occurence of a module name updated via -main-is</span><span>
</span><a name="line-974"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-975"></a><span>    </span><span class="hs-comment">-- Moreover, -main-is when parsed left-to-right can update either</span><span>
</span><a name="line-976"></a><span>    </span><span class="hs-comment">-- the &quot;Main&quot; module name, or the &quot;main&quot; function name, or both,</span><span>
</span><a name="line-977"></a><span>    </span><span class="hs-comment">-- see also 'decodeMainIsArg'.</span><span>
</span><a name="line-978"></a><span>    </span><span class="hs-identifier hs-var">msum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Distribution.Simple.GHC.html#decodeMainIsArg"><span class="hs-identifier hs-var">decodeMainIsArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679290954"><span class="hs-identifier hs-var">findIsMainArgs</span></a><span> </span><a href="#local-6989586621679290953"><span class="hs-identifier hs-var">ghcopts</span></a><span>
</span><a name="line-979"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-980"></a><span>    </span><a name="local-6989586621679290953"><a href="#local-6989586621679290953"><span class="hs-identifier">ghcopts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.BuildInfo.html#hcOptions"><span class="hs-identifier hs-var">hcOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290952"><span class="hs-identifier hs-var">bnfo</span></a><span>
</span><a name="line-981"></a><span>
</span><a name="line-982"></a><span>    </span><a name="local-6989586621679290954"><a href="#local-6989586621679290954"><span class="hs-identifier">findIsMainArgs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-983"></a><span>    </span><span class="hs-identifier">findIsMainArgs</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;-main-is&quot;</span><span class="hs-glyph">:</span><a name="local-6989586621679290955"><a href="#local-6989586621679290955"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679290956"><a href="#local-6989586621679290956"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290955"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679290954"><span class="hs-identifier hs-var">findIsMainArgs</span></a><span> </span><a href="#local-6989586621679290956"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-984"></a><span>    </span><span class="hs-identifier">findIsMainArgs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679290957"><a href="#local-6989586621679290957"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290954"><span class="hs-identifier hs-var">findIsMainArgs</span></a><span> </span><a href="#local-6989586621679290957"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-985"></a><span>
</span><a name="line-986"></a><span class="hs-comment">-- | Decode argument to '-main-is'</span><span>
</span><a name="line-987"></a><span class="hs-comment">--</span><span>
</span><a name="line-988"></a><span class="hs-comment">-- Returns 'Nothing' if argument set only the function name.</span><span>
</span><a name="line-989"></a><span class="hs-comment">--</span><span>
</span><a name="line-990"></a><span class="hs-comment">-- This code has been stolen/refactored from GHC's DynFlags.setMainIs</span><span>
</span><a name="line-991"></a><span class="hs-comment">-- function. The logic here is deliberately imperfect as it is</span><span>
</span><a name="line-992"></a><span class="hs-comment">-- intended to be bug-compatible with GHC's parser. See discussion in</span><span>
</span><a name="line-993"></a><span class="hs-comment">-- https://github.com/haskell/cabal/pull/4539#discussion_r118981753.</span><span>
</span><a name="line-994"></a><span class="hs-identifier">decodeMainIsArg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-995"></a><a name="decodeMainIsArg"><a href="Distribution.Simple.GHC.html#decodeMainIsArg"><span class="hs-identifier">decodeMainIsArg</span></a></a><span> </span><a name="local-6989586621679290958"><a href="#local-6989586621679290958"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-996"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290960"><span class="hs-identifier hs-var">main_fn</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isLower</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679290960"><span class="hs-identifier hs-var">main_fn</span></a><span class="hs-special">)</span><span>
</span><a name="line-997"></a><span>                        </span><span class="hs-comment">-- The arg looked like &quot;Foo.Bar.baz&quot;</span><span>
</span><a name="line-998"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ModuleName</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromString</span><span> </span><a href="#local-6989586621679290959"><span class="hs-identifier hs-var">main_mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-999"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isUpper</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679290958"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- The arg looked like &quot;Foo&quot; or &quot;Foo.Bar&quot;</span><span>
</span><a name="line-1000"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ModuleName</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromString</span><span> </span><a href="#local-6989586621679290958"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-comment">-- The arg looked like &quot;baz&quot;</span><span>
</span><a name="line-1002"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1003"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1004"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679290959"><a href="#local-6989586621679290959"><span class="hs-identifier">main_mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290960"><a href="#local-6989586621679290960"><span class="hs-identifier">main_fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290961"><span class="hs-identifier hs-var">splitLongestPrefix</span></a><span> </span><a href="#local-6989586621679290958"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'.'</span><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><span>
</span><a name="line-1006"></a><span>    </span><span class="hs-identifier">splitLongestPrefix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-1007"></a><span>    </span><a name="local-6989586621679290961"><a href="#local-6989586621679290961"><span class="hs-identifier">splitLongestPrefix</span></a></a><span> </span><a name="local-6989586621679290962"><a href="#local-6989586621679290962"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679290963"><a href="#local-6989586621679290963"><span class="hs-identifier">pred'</span></a></a><span>
</span><a name="line-1008"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679290965"><span class="hs-identifier hs-var">r_pre</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290962"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1009"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679290965"><span class="hs-identifier hs-var">r_pre</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679290964"><span class="hs-identifier hs-var">r_suf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1010"></a><span>                           </span><span class="hs-comment">-- 'tail' drops the char satisfying 'pred'</span><span>
</span><a name="line-1011"></a><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679290964"><a href="#local-6989586621679290964"><span class="hs-identifier">r_suf</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679290965"><a href="#local-6989586621679290965"><span class="hs-identifier">r_pre</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><a href="#local-6989586621679290963"><span class="hs-identifier hs-var">pred'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679290962"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-1012"></a><span>
</span><a name="line-1013"></a><span class="hs-comment">-- | Return C sources, GHC input files and GHC input modules</span><span>
</span><a name="line-1014"></a><span class="hs-identifier">gbuildSources</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-1015"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a><span> </span><span class="hs-comment">-- ^ specVersion</span><span>
</span><a name="line-1016"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1017"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span>
</span><a name="line-1018"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1019"></a><a name="gbuildSources"><a href="Distribution.Simple.GHC.html#gbuildSources"><span class="hs-identifier">gbuildSources</span></a></a><span> </span><a name="local-6989586621679290966"><a href="#local-6989586621679290966"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290967"><a href="#local-6989586621679290967"><span class="hs-identifier">specVer</span></a></a><span> </span><a name="local-6989586621679290968"><a href="#local-6989586621679290968"><span class="hs-identifier">tmpDir</span></a></a><span> </span><a name="local-6989586621679290969"><a href="#local-6989586621679290969"><span class="hs-identifier">bm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1020"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679290969"><span class="hs-identifier hs-var">bm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1021"></a><span>      </span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span>  </span><a name="local-6989586621679290982"><a href="#local-6989586621679290982"><span class="hs-identifier">exe</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290970"><span class="hs-identifier hs-var">exeSources</span></a><span> </span><a href="#local-6989586621679290982"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-1022"></a><span>      </span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>   </span><a name="local-6989586621679290983"><a href="#local-6989586621679290983"><span class="hs-identifier">exe</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290970"><span class="hs-identifier hs-var">exeSources</span></a><span> </span><a href="#local-6989586621679290983"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-1023"></a><span>      </span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679290984"><a href="#local-6989586621679290984"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679290971"><span class="hs-identifier hs-var">flibSources</span></a><span> </span><a href="#local-6989586621679290984"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-1024"></a><span>      </span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span>  </span><a name="local-6989586621679290985"><a href="#local-6989586621679290985"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679290971"><span class="hs-identifier hs-var">flibSources</span></a><span> </span><a href="#local-6989586621679290985"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-1025"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1026"></a><span>    </span><span class="hs-identifier">exeSources</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><span>    </span><a name="local-6989586621679290970"><a href="#local-6989586621679290970"><span class="hs-identifier">exeSources</span></a></a><span> </span><a name="local-6989586621679290973"><a href="#local-6989586621679290973"><span class="hs-identifier">exe</span></a></a><span class="hs-glyph">@</span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-var">Executable</span></a><span class="hs-special">{</span><span class="hs-identifier">buildInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290974"><a href="#local-6989586621679290974"><span class="hs-identifier">bnfo</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">modulePath</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290975"><a href="#local-6989586621679290975"><span class="hs-identifier">modPath</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1028"></a><span>      </span><a name="local-6989586621679290976"><a href="#local-6989586621679290976"><span class="hs-identifier">main</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Utils.html#findFile"><span class="hs-identifier hs-var">findFile</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290968"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">hsSourceDirs</span><span> </span><a href="#local-6989586621679290974"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679290975"><span class="hs-identifier hs-var">modPath</span></a><span>
</span><a name="line-1029"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290977"><a href="#local-6989586621679290977"><span class="hs-identifier">mainModName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><a href="Distribution.ModuleName.html#main"><span class="hs-identifier hs-var">ModuleName</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">main</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.GHC.html#exeMainModuleName"><span class="hs-identifier hs-var">exeMainModuleName</span></a><span> </span><a href="#local-6989586621679290973"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-1030"></a><span>          </span><a name="local-6989586621679290978"><a href="#local-6989586621679290978"><span class="hs-identifier">otherModNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.Executable.html#exeModules"><span class="hs-identifier hs-var">exeModules</span></a><span> </span><a href="#local-6989586621679290973"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290972"><span class="hs-identifier hs-var">isHaskell</span></a><span> </span><a href="#local-6989586621679290976"><span class="hs-identifier hs-var">main</span></a><span>
</span><a name="line-1033"></a><span>        </span><span class="hs-keyword">then</span><span>
</span><a name="line-1034"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679290967"><span class="hs-identifier hs-var">specVer</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">2</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290977"><span class="hs-identifier hs-var">mainModName</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679290978"><span class="hs-identifier hs-var">otherModNames</span></a><span class="hs-special">)</span><span>
</span><a name="line-1035"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1036"></a><span>             </span><span class="hs-comment">-- The cabal manual clearly states that `other-modules` is</span><span>
</span><a name="line-1037"></a><span>             </span><span class="hs-comment">-- intended for non-main modules.  However, there's at least one</span><span>
</span><a name="line-1038"></a><span>             </span><span class="hs-comment">-- important package on Hackage (happy-1.19.5) which</span><span>
</span><a name="line-1039"></a><span>             </span><span class="hs-comment">-- violates this. We workaround this here so that we don't</span><span>
</span><a name="line-1040"></a><span>             </span><span class="hs-comment">-- invoke GHC with e.g.  'ghc --make Main src/Main.hs' which</span><span>
</span><a name="line-1041"></a><span>             </span><span class="hs-comment">-- would result in GHC complaining about duplicate Main</span><span>
</span><a name="line-1042"></a><span>             </span><span class="hs-comment">-- modules.</span><span>
</span><a name="line-1043"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-1044"></a><span>             </span><span class="hs-comment">-- Finally, we only enable this workaround for</span><span>
</span><a name="line-1045"></a><span>             </span><span class="hs-comment">-- specVersion &lt; 2, as 'cabal-version:&gt;=2.0' cabal files</span><span>
</span><a name="line-1046"></a><span>             </span><span class="hs-comment">-- have no excuse anymore to keep doing it wrong... ;-)</span><span>
</span><a name="line-1047"></a><span>             </span><a href="Distribution.Simple.Utils.html#warn"><span class="hs-identifier hs-var">warn</span></a><span> </span><a href="#local-6989586621679290966"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Enabling workaround for Main module '&quot;</span><span>
</span><a name="line-1048"></a><span>                            </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679290977"><span class="hs-identifier hs-var">mainModName</span></a><span>
</span><a name="line-1049"></a><span>                            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;' listed in 'other-modules' illegaly!&quot;</span><span>
</span><a name="line-1050"></a><span>
</span><a name="line-1051"></a><span>             </span><span class="hs-identifier hs-var">return</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290974"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290976"><span class="hs-identifier hs-var">main</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1052"></a><span>                       </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679290977"><span class="hs-identifier hs-var">mainModName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Executable.html#exeModules"><span class="hs-identifier hs-var">exeModules</span></a><span> </span><a href="#local-6989586621679290973"><span class="hs-identifier hs-var">exe</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1053"></a><span>
</span><a name="line-1054"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290974"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679290976"><span class="hs-identifier hs-var">main</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Executable.html#exeModules"><span class="hs-identifier hs-var">exeModules</span></a><span> </span><a href="#local-6989586621679290973"><span class="hs-identifier hs-var">exe</span></a><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290976"><span class="hs-identifier hs-var">main</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290974"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Executable.html#exeModules"><span class="hs-identifier hs-var">exeModules</span></a><span> </span><a href="#local-6989586621679290973"><span class="hs-identifier hs-var">exe</span></a><span class="hs-special">)</span><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span>    </span><span class="hs-identifier">flibSources</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1058"></a><span>    </span><a name="local-6989586621679290971"><a href="#local-6989586621679290971"><span class="hs-identifier">flibSources</span></a></a><span> </span><a name="local-6989586621679290979"><a href="#local-6989586621679290979"><span class="hs-identifier">flib</span></a></a><span class="hs-glyph">@</span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-var">ForeignLib</span></a><span class="hs-special">{</span><span class="hs-identifier">foreignLibBuildInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679290980"><a href="#local-6989586621679290980"><span class="hs-identifier">bnfo</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1059"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><a href="#local-6989586621679290980"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ForeignLib.html#foreignLibModules"><span class="hs-identifier hs-var">foreignLibModules</span></a><span> </span><a href="#local-6989586621679290979"><span class="hs-identifier hs-var">flib</span></a><span class="hs-special">)</span><span>
</span><a name="line-1060"></a><span>
</span><a name="line-1061"></a><span>    </span><span class="hs-identifier">isHaskell</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1062"></a><span>    </span><a name="local-6989586621679290972"><a href="#local-6989586621679290972"><span class="hs-identifier">isHaskell</span></a></a><span> </span><a name="local-6989586621679290981"><a href="#local-6989586621679290981"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">elem</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">takeExtension</span><span> </span><a href="#local-6989586621679290981"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;.hs&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;.lhs&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1063"></a><span>
</span><a name="line-1064"></a><span class="hs-comment">-- | Generic build function. See comment for 'GBuildMode'.</span><span>
</span><a name="line-1065"></a><span class="hs-identifier">gbuild</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#Flag"><span class="hs-identifier hs-type">Cabal</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-1066"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1067"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.GHC.html#GBuildMode"><span class="hs-identifier hs-type">GBuildMode</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1068"></a><a name="gbuild"><a href="Distribution.Simple.GHC.html#gbuild"><span class="hs-identifier">gbuild</span></a></a><span> </span><a name="local-6989586621679290986"><a href="#local-6989586621679290986"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679290987"><a href="#local-6989586621679290987"><span class="hs-identifier">numJobs</span></a></a><span> </span><a name="local-6989586621679290988"><a href="#local-6989586621679290988"><span class="hs-identifier">pkg_descr</span></a></a><span> </span><a name="local-6989586621679290989"><a href="#local-6989586621679290989"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679290990"><a href="#local-6989586621679290990"><span class="hs-identifier">bm</span></a></a><span> </span><a name="local-6989586621679290991"><a href="#local-6989586621679290991"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1069"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679290992"><a href="#local-6989586621679290992"><span class="hs-identifier">ghcProg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-var">requireProgram</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1070"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290993"><a href="#local-6989586621679290993"><span class="hs-identifier">comp</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1071"></a><span>      </span><a name="local-6989586621679290994"><a href="#local-6989586621679290994"><span class="hs-identifier">platform</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1072"></a><span>      </span><a name="local-6989586621679290995"><a href="#local-6989586621679290995"><span class="hs-identifier">implInfo</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#getImplInfo"><span class="hs-identifier hs-var">getImplInfo</span></a><span> </span><a href="#local-6989586621679290993"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-1073"></a><span>      </span><a name="local-6989586621679290996"><a href="#local-6989586621679290996"><span class="hs-identifier">runGhcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.GHC.html#runGHC"><span class="hs-identifier hs-var">runGHC</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290992"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><a href="#local-6989586621679290993"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679290994"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span>  </span><a name="local-6989586621679290997"><a href="#local-6989586621679290997"><span class="hs-identifier">bnfo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#hackThreadedFlag"><span class="hs-identifier hs-var">hackThreadedFlag</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1076"></a><span>            </span><a href="#local-6989586621679290993"><span class="hs-identifier hs-var">comp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withProfExe</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#gbuildInfo"><span class="hs-identifier hs-var">gbuildInfo</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span>  </span><span class="hs-comment">-- the name that GHC really uses (e.g., with .exe on Windows for executables)</span><span>
</span><a name="line-1079"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290998"><a href="#local-6989586621679290998"><span class="hs-identifier">targetName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#gbuildTargetName"><span class="hs-identifier hs-var">gbuildTargetName</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span>
</span><a name="line-1080"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679290999"><a href="#local-6989586621679290999"><span class="hs-identifier">targetDir</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">buildDir</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#gbuildName"><span class="hs-identifier hs-var">gbuildName</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1081"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291000"><a href="#local-6989586621679291000"><span class="hs-identifier">tmpDir</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290999"><span class="hs-identifier hs-var">targetDir</span></a><span>    </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#gbuildName"><span class="hs-identifier hs-var">gbuildName</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;-tmp&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1082"></a><span>  </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679290999"><span class="hs-identifier hs-var">targetDir</span></a><span>
</span><a name="line-1083"></a><span>  </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679291000"><span class="hs-identifier hs-var">tmpDir</span></a><span>
</span><a name="line-1084"></a><span>
</span><a name="line-1085"></a><span>  </span><span class="hs-comment">-- TODO: do we need to put hs-boot files into place for mutually recursive</span><span>
</span><a name="line-1086"></a><span>  </span><span class="hs-comment">-- modules?  FIX: what about exeName.hi-boot?</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span>  </span><span class="hs-comment">-- Determine if program coverage should be enabled and if so, what</span><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-comment">-- '-hpcdir' should be.</span><span>
</span><a name="line-1090"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291001"><a href="#local-6989586621679291001"><span class="hs-identifier">isCoverageEnabled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">exeCoverage</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1091"></a><span>      </span><a name="local-6989586621679291002"><a href="#local-6989586621679291002"><span class="hs-identifier">distPref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">configDistPref</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">configFlags</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1092"></a><span>      </span><a name="local-6989586621679291003"><a href="#local-6989586621679291003"><span class="hs-identifier">hpcdir</span></a></a><span> </span><a name="local-6989586621679291004"><a href="#local-6989586621679291004"><span class="hs-identifier">way</span></a></a><span>
</span><a name="line-1093"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Simple.GHC.html#gbuildIsRepl"><span class="hs-identifier hs-var">gbuildIsRepl</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>  </span><span class="hs-comment">-- HPC is not supported in ghci</span><span>
</span><a name="line-1094"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291001"><span class="hs-identifier hs-var">isCoverageEnabled</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Hpc.html#mixDir"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mixDir</span></a><span> </span><a href="#local-6989586621679291002"><span class="hs-identifier hs-var">distPref</span></a><span> </span><a href="#local-6989586621679291004"><span class="hs-identifier hs-var">way</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#gbuildName"><span class="hs-identifier hs-var">gbuildName</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1095"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1096"></a><span>
</span><a name="line-1097"></a><span>  </span><a name="local-6989586621679291005"><a href="#local-6989586621679291005"><span class="hs-identifier">rpaths</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#getRPaths"><span class="hs-identifier hs-var">getRPaths</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290991"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-1098"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679291006"><a href="#local-6989586621679291006"><span class="hs-identifier">cSrcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679291007"><a href="#local-6989586621679291007"><span class="hs-identifier">inputFiles</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679291008"><a href="#local-6989586621679291008"><span class="hs-identifier">inputModules</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#gbuildSources"><span class="hs-identifier hs-var">gbuildSources</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1099"></a><span>                                       </span><span class="hs-special">(</span><a href="Distribution.Types.PackageDescription.html#specVersion"><span class="hs-identifier hs-var">specVersion</span></a><span> </span><a href="#local-6989586621679290988"><span class="hs-identifier hs-var">pkg_descr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291000"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span>
</span><a name="line-1100"></a><span>
</span><a name="line-1101"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291009"><a href="#local-6989586621679291009"><span class="hs-identifier">isGhcDynamic</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#isDynamic"><span class="hs-identifier hs-var">isDynamic</span></a><span> </span><a href="#local-6989586621679290993"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-1102"></a><span>      </span><a name="local-6989586621679291010"><a href="#local-6989586621679291010"><span class="hs-identifier">dynamicTooSupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#supportsDynamicToo"><span class="hs-identifier hs-var">supportsDynamicToo</span></a><span> </span><a href="#local-6989586621679290993"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-1103"></a><span>      </span><a name="local-6989586621679291011"><a href="#local-6989586621679291011"><span class="hs-identifier">cObjs</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">replaceExtension</span><span class="hs-special">`</span><span> </span><a href="Distribution.Simple.BuildPaths.html#objExtension"><span class="hs-identifier hs-var">objExtension</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291006"><span class="hs-identifier hs-var">cSrcs</span></a><span>
</span><a name="line-1104"></a><span>      </span><a name="local-6989586621679291012"><a href="#local-6989586621679291012"><span class="hs-identifier">needDynamic</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#gbuildNeedDynamic"><span class="hs-identifier hs-var">gbuildNeedDynamic</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span>
</span><a name="line-1105"></a><span>      </span><a name="local-6989586621679291013"><a href="#local-6989586621679291013"><span class="hs-identifier">needProfiling</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withProfExe</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span>  </span><span class="hs-comment">-- build executables</span><span>
</span><a name="line-1108"></a><span>      </span><a name="local-6989586621679291014"><a href="#local-6989586621679291014"><span class="hs-identifier">baseOpts</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#componentGhcOptions"><span class="hs-identifier hs-var">componentGhcOptions</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span> </span><a href="#local-6989586621679290991"><span class="hs-identifier hs-var">clbi</span></a><span> </span><a href="#local-6989586621679291000"><span class="hs-identifier hs-var">tmpDir</span></a><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>                    </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1110"></a><span>                      </span><span class="hs-identifier">ghcOptMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcModeMake"><span class="hs-identifier hs-var">GhcModeMake</span></a><span class="hs-special">,</span><span>
</span><a name="line-1111"></a><span>                      </span><span class="hs-identifier">ghcOptInputFiles</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><a href="#local-6989586621679291007"><span class="hs-identifier hs-var">inputFiles</span></a><span class="hs-special">,</span><span>
</span><a name="line-1112"></a><span>                      </span><span class="hs-identifier">ghcOptInputModules</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><a href="#local-6989586621679291008"><span class="hs-identifier hs-var">inputModules</span></a><span>
</span><a name="line-1113"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-1114"></a><span>      </span><a name="local-6989586621679291015"><a href="#local-6989586621679291015"><span class="hs-identifier">staticOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291014"><span class="hs-identifier hs-var">baseOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1115"></a><span>                      </span><span class="hs-identifier">ghcOptDynLinkMode</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcStaticOnly"><span class="hs-identifier hs-var">GhcStaticOnly</span></a><span class="hs-special">,</span><span>
</span><a name="line-1116"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291003"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Vanilla"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Vanilla</span></a><span>
</span><a name="line-1117"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-1118"></a><span>      </span><a name="local-6989586621679291016"><a href="#local-6989586621679291016"><span class="hs-identifier">profOpts</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291014"><span class="hs-identifier hs-var">baseOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1119"></a><span>                      </span><span class="hs-identifier">ghcOptProfilingMode</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1120"></a><span>                      </span><span class="hs-identifier">ghcOptProfilingAuto</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#profDetailLevelFlag"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">profDetailLevelFlag</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1121"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier">withProfExeDetail</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1122"></a><span>                      </span><span class="hs-identifier">ghcOptHiSuffix</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1123"></a><span>                      </span><span class="hs-identifier">ghcOptObjSuffix</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1124"></a><span>                      </span><span class="hs-identifier">ghcOptExtra</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span>
</span><a name="line-1125"></a><span>                                             </span><span class="hs-special">(</span><a href="Distribution.Types.BuildInfo.html#hcProfOptions"><span class="hs-identifier hs-var">hcProfOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1126"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291003"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Prof"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Prof</span></a><span>
</span><a name="line-1127"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-1128"></a><span>      </span><a name="local-6989586621679291017"><a href="#local-6989586621679291017"><span class="hs-identifier">dynOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291014"><span class="hs-identifier hs-var">baseOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1129"></a><span>                      </span><span class="hs-identifier">ghcOptDynLinkMode</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-var">GhcDynamicOnly</span></a><span class="hs-special">,</span><span>
</span><a name="line-1130"></a><span>                      </span><span class="hs-comment">-- TODO: Does it hurt to set -fPIC for executables?</span><span>
</span><a name="line-1131"></a><span>                      </span><span class="hs-identifier">ghcOptFPic</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1132"></a><span>                      </span><span class="hs-identifier">ghcOptHiSuffix</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1133"></a><span>                      </span><span class="hs-identifier">ghcOptObjSuffix</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1134"></a><span>                      </span><span class="hs-identifier">ghcOptExtra</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1135"></a><span>                                             </span><a href="Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1136"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291003"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Dyn</span></a><span>
</span><a name="line-1137"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-1138"></a><span>      </span><a name="local-6989586621679291018"><a href="#local-6989586621679291018"><span class="hs-identifier">dynTooOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291015"><span class="hs-identifier hs-var">staticOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1139"></a><span>                      </span><span class="hs-identifier">ghcOptDynLinkMode</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcStaticAndDynamic"><span class="hs-identifier hs-var">GhcStaticAndDynamic</span></a><span class="hs-special">,</span><span>
</span><a name="line-1140"></a><span>                      </span><span class="hs-identifier">ghcOptDynHiSuffix</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1141"></a><span>                      </span><span class="hs-identifier">ghcOptDynObjSuffix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1142"></a><span>                      </span><span class="hs-identifier">ghcOptHPCDir</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291003"><span class="hs-identifier hs-var">hpcdir</span></a><span> </span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Dyn</span></a><span>
</span><a name="line-1143"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-1144"></a><span>      </span><a name="local-6989586621679291019"><a href="#local-6989586621679291019"><span class="hs-identifier">linkerOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1145"></a><span>                      </span><span class="hs-identifier">ghcOptLinkOptions</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">ldOptions</span><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1146"></a><span>                      </span><span class="hs-identifier">ghcOptLinkLibs</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">extraLibs</span><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1147"></a><span>                      </span><span class="hs-identifier">ghcOptLinkLibPath</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">extraLibDirs</span><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1148"></a><span>                      </span><span class="hs-identifier">ghcOptLinkFrameworks</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1149"></a><span>                                                </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">frameworks</span><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1150"></a><span>                      </span><span class="hs-identifier">ghcOptLinkFrameworkDirs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1151"></a><span>                                                </span><span class="hs-identifier">PD</span><span class="hs-operator">.</span><span class="hs-identifier">extraFrameworkDirs</span><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1152"></a><span>                      </span><span class="hs-identifier">ghcOptInputFiles</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span>
</span><a name="line-1153"></a><span>                                             </span><span class="hs-special">[</span><a href="#local-6989586621679291000"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291029"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679291029"><a href="#local-6989586621679291029"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679291011"><span class="hs-identifier hs-var">cObjs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1154"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-1155"></a><span>      </span><a name="local-6989586621679291020"><a href="#local-6989586621679291020"><span class="hs-identifier">dynLinkerOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1156"></a><span>                      </span><span class="hs-identifier">ghcOptRPaths</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291005"><span class="hs-identifier hs-var">rpaths</span></a><span>
</span><a name="line-1157"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-1158"></a><span>      </span><a name="local-6989586621679291021"><a href="#local-6989586621679291021"><span class="hs-identifier">replOpts</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291014"><span class="hs-identifier hs-var">baseOpts</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1159"></a><span>                    </span><span class="hs-identifier">ghcOptExtra</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#overNubListR"><span class="hs-identifier hs-var">overNubListR</span></a><span>
</span><a name="line-1160"></a><span>                                             </span><a href="Distribution.Simple.GHC.Internal.html#filterGhciFlags"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filterGhciFlags</span></a><span>
</span><a name="line-1161"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier">ghcOptExtra</span><span> </span><a href="#local-6989586621679291014"><span class="hs-identifier hs-var">baseOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1162"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-1163"></a><span>                   </span><span class="hs-comment">-- For a normal compile we do separate invocations of ghc for</span><span>
</span><a name="line-1164"></a><span>                   </span><span class="hs-comment">-- compiling as for linking. But for repl we have to do just</span><span>
</span><a name="line-1165"></a><span>                   </span><span class="hs-comment">-- the one invocation, so that one has to include all the</span><span>
</span><a name="line-1166"></a><span>                   </span><span class="hs-comment">-- linker stuff too, like -l flags and any .o files from C</span><span>
</span><a name="line-1167"></a><span>                   </span><span class="hs-comment">-- files etc.</span><span>
</span><a name="line-1168"></a><span>                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679291019"><span class="hs-identifier hs-var">linkerOpts</span></a><span>
</span><a name="line-1169"></a><span>                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1170"></a><span>                      </span><span class="hs-identifier">ghcOptMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcModeInteractive"><span class="hs-identifier hs-var">GhcModeInteractive</span></a><span class="hs-special">,</span><span>
</span><a name="line-1171"></a><span>                      </span><span class="hs-identifier">ghcOptOptimisation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcNoOptimisation"><span class="hs-identifier hs-var">GhcNoOptimisation</span></a><span>
</span><a name="line-1172"></a><span>                     </span><span class="hs-special">}</span><span>
</span><a name="line-1173"></a><span>      </span><a name="local-6989586621679291022"><a href="#local-6989586621679291022"><span class="hs-identifier">commonOpts</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291013"><span class="hs-identifier hs-var">needProfiling</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291016"><span class="hs-identifier hs-var">profOpts</span></a><span>
</span><a name="line-1174"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291012"><span class="hs-identifier hs-var">needDynamic</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291017"><span class="hs-identifier hs-var">dynOpts</span></a><span>
</span><a name="line-1175"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291015"><span class="hs-identifier hs-var">staticOpts</span></a><span>
</span><a name="line-1176"></a><span>      </span><a name="local-6989586621679291023"><a href="#local-6989586621679291023"><span class="hs-identifier">compileOpts</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291026"><span class="hs-identifier hs-var">useDynToo</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291018"><span class="hs-identifier hs-var">dynTooOpts</span></a><span>
</span><a name="line-1177"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291022"><span class="hs-identifier hs-var">commonOpts</span></a><span>
</span><a name="line-1178"></a><span>      </span><a name="local-6989586621679291024"><a href="#local-6989586621679291024"><span class="hs-identifier">withStaticExe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679291013"><span class="hs-identifier hs-var">needProfiling</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679291012"><span class="hs-identifier hs-var">needDynamic</span></a><span>
</span><a name="line-1179"></a><span>
</span><a name="line-1180"></a><span>      </span><span class="hs-comment">-- For building exe's that use TH with -prof or -dynamic we actually have</span><span>
</span><a name="line-1181"></a><span>      </span><span class="hs-comment">-- to build twice, once without -prof/-dynamic and then again with</span><span>
</span><a name="line-1182"></a><span>      </span><span class="hs-comment">-- -prof/-dynamic. This is because the code that TH needs to run at</span><span>
</span><a name="line-1183"></a><span>      </span><span class="hs-comment">-- compile time needs to be the vanilla ABI so it can be loaded up and run</span><span>
</span><a name="line-1184"></a><span>      </span><span class="hs-comment">-- by the compiler.</span><span>
</span><a name="line-1185"></a><span>      </span><span class="hs-comment">-- With dynamic-by-default GHC the TH object files loaded at compile-time</span><span>
</span><a name="line-1186"></a><span>      </span><span class="hs-comment">-- need to be .dyn_o instead of .o.</span><span>
</span><a name="line-1187"></a><span>      </span><a name="local-6989586621679291025"><a href="#local-6989586621679291025"><span class="hs-identifier">doingTH</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.Extension.html#EnableExtension"><span class="hs-identifier hs-var">EnableExtension</span></a><span> </span><a href="Language.Haskell.Extension.html#TemplateHaskell"><span class="hs-identifier hs-var">TemplateHaskell</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="Distribution.Types.BuildInfo.html#allExtensions"><span class="hs-identifier hs-var">allExtensions</span></a><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span>
</span><a name="line-1188"></a><span>      </span><span class="hs-comment">-- Should we use -dynamic-too instead of compiling twice?</span><span>
</span><a name="line-1189"></a><span>      </span><a name="local-6989586621679291026"><a href="#local-6989586621679291026"><span class="hs-identifier">useDynToo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291010"><span class="hs-identifier hs-var">dynamicTooSupported</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679291009"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>
</span><a name="line-1190"></a><span>                  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679291025"><span class="hs-identifier hs-var">doingTH</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679291024"><span class="hs-identifier hs-var">withStaticExe</span></a><span>
</span><a name="line-1191"></a><span>                  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-1192"></a><span>      </span><a name="local-6989586621679291027"><a href="#local-6989586621679291027"><span class="hs-identifier">compileTHOpts</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291009"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291017"><span class="hs-identifier hs-var">dynOpts</span></a><span>
</span><a name="line-1193"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291015"><span class="hs-identifier hs-var">staticOpts</span></a><span>
</span><a name="line-1194"></a><span>      </span><a name="local-6989586621679291028"><a href="#local-6989586621679291028"><span class="hs-identifier">compileForTH</span></a></a><span>
</span><a name="line-1195"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Simple.GHC.html#gbuildIsRepl"><span class="hs-identifier hs-var">gbuildIsRepl</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1196"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291026"><span class="hs-identifier hs-var">useDynToo</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1197"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291009"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291025"><span class="hs-identifier hs-var">doingTH</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291013"><span class="hs-identifier hs-var">needProfiling</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679291024"><span class="hs-identifier hs-var">withStaticExe</span></a><span class="hs-special">)</span><span>
</span><a name="line-1198"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291025"><span class="hs-identifier hs-var">doingTH</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291013"><span class="hs-identifier hs-var">needProfiling</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679291012"><span class="hs-identifier hs-var">needDynamic</span></a><span class="hs-special">)</span><span>
</span><a name="line-1199"></a><span>
</span><a name="line-1200"></a><span>   </span><span class="hs-comment">-- Build static/dynamic object files for TH, if needed.</span><span>
</span><a name="line-1201"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679291028"><span class="hs-identifier hs-var">compileForTH</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1202"></a><span>    </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291027"><span class="hs-identifier hs-var">compileTHOpts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptNoLink</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1203"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ghcOptNumJobs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290987"><span class="hs-identifier hs-var">numJobs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#gbuildIsRepl"><span class="hs-identifier hs-var">gbuildIsRepl</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1206"></a><span>    </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291023"><span class="hs-identifier hs-var">compileOpts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptNoLink</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1207"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ghcOptNumJobs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290987"><span class="hs-identifier hs-var">numJobs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1208"></a><span>
</span><a name="line-1209"></a><span>  </span><span class="hs-comment">-- build any C sources</span><span>
</span><a name="line-1210"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679291006"><span class="hs-identifier hs-var">cSrcs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1211"></a><span>   </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;Building C Sources...&quot;</span><span>
</span><a name="line-1212"></a><span>   </span><span class="hs-identifier hs-var">sequence_</span><span>
</span><a name="line-1213"></a><span>     </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291031"><a href="#local-6989586621679291031"><span class="hs-identifier">baseCcOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#componentCcGhcOptions"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">componentCcGhcOptions</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679290995"><span class="hs-identifier hs-var">implInfo</span></a><span>
</span><a name="line-1214"></a><span>                              </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679290997"><span class="hs-identifier hs-var">bnfo</span></a><span> </span><a href="#local-6989586621679290991"><span class="hs-identifier hs-var">clbi</span></a><span> </span><a href="#local-6989586621679291000"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><a href="#local-6989586621679291030"><span class="hs-identifier hs-var">filename</span></a><span>
</span><a name="line-1215"></a><span>              </span><a name="local-6989586621679291032"><a href="#local-6989586621679291032"><span class="hs-identifier">vanillaCcOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679291009"><span class="hs-identifier hs-var">isGhcDynamic</span></a><span>
</span><a name="line-1216"></a><span>                              </span><span class="hs-comment">-- Dynamic GHC requires C sources to be built</span><span>
</span><a name="line-1217"></a><span>                              </span><span class="hs-comment">-- with -fPIC for REPL to work. See #2207.</span><span>
</span><a name="line-1218"></a><span>                              </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679291031"><span class="hs-identifier hs-var">baseCcOpts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptFPic</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1219"></a><span>                              </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679291031"><span class="hs-identifier hs-var">baseCcOpts</span></a><span>
</span><a name="line-1220"></a><span>              </span><a name="local-6989586621679291033"><a href="#local-6989586621679291033"><span class="hs-identifier">profCcOpts</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291032"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1221"></a><span>                                </span><span class="hs-identifier">ghcOptProfilingMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1222"></a><span>                              </span><span class="hs-special">}</span><span>
</span><a name="line-1223"></a><span>              </span><a name="local-6989586621679291034"><a href="#local-6989586621679291034"><span class="hs-identifier">sharedCcOpts</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291032"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1224"></a><span>                                </span><span class="hs-identifier">ghcOptFPic</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1225"></a><span>                                </span><span class="hs-identifier">ghcOptDynLinkMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-var">GhcDynamicOnly</span></a><span>
</span><a name="line-1226"></a><span>                              </span><span class="hs-special">}</span><span>
</span><a name="line-1227"></a><span>              </span><a name="local-6989586621679291035"><a href="#local-6989586621679291035"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291013"><span class="hs-identifier hs-var">needProfiling</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291033"><span class="hs-identifier hs-var">profCcOpts</span></a><span>
</span><a name="line-1228"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291012"><span class="hs-identifier hs-var">needDynamic</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291034"><span class="hs-identifier hs-var">sharedCcOpts</span></a><span>
</span><a name="line-1229"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291032"><span class="hs-identifier hs-var">vanillaCcOpts</span></a><span>
</span><a name="line-1230"></a><span>              </span><a name="local-6989586621679291036"><a href="#local-6989586621679291036"><span class="hs-identifier">odir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcOptObjDir</span><span> </span><a href="#local-6989586621679291035"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>          </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679291036"><span class="hs-identifier hs-var">odir</span></a><span>
</span><a name="line-1232"></a><span>          </span><a name="local-6989586621679291037"><a href="#local-6989586621679291037"><span class="hs-identifier">needsRecomp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#checkNeedsRecompilation"><span class="hs-identifier hs-var">checkNeedsRecompilation</span></a><span> </span><a href="#local-6989586621679291030"><span class="hs-identifier hs-var">filename</span></a><span> </span><a href="#local-6989586621679291035"><span class="hs-identifier hs-var">opts</span></a><span>
</span><a name="line-1233"></a><span>          </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679291037"><span class="hs-identifier hs-var">needsRecomp</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1234"></a><span>            </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291035"><span class="hs-identifier hs-var">opts</span></a><span>
</span><a name="line-1235"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679291030"><a href="#local-6989586621679291030"><span class="hs-identifier">filename</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679291006"><span class="hs-identifier hs-var">cSrcs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1236"></a><span>
</span><a name="line-1237"></a><span>  </span><span class="hs-comment">-- TODO: problem here is we need the .c files built first, so we can load them</span><span>
</span><a name="line-1238"></a><span>  </span><span class="hs-comment">-- with ghci, but .c files can depend on .h files generated by ghc by ffi</span><span>
</span><a name="line-1239"></a><span>  </span><span class="hs-comment">-- exports.</span><span>
</span><a name="line-1240"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1241"></a><span>    </span><a href="Distribution.Simple.GHC.html#GReplExe"><span class="hs-identifier hs-var">GReplExe</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291021"><span class="hs-identifier hs-var">replOpts</span></a><span>
</span><a name="line-1242"></a><span>    </span><a href="Distribution.Simple.GHC.html#GReplFLib"><span class="hs-identifier hs-var">GReplFLib</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291021"><span class="hs-identifier hs-var">replOpts</span></a><span>
</span><a name="line-1243"></a><span>    </span><a href="Distribution.Simple.GHC.html#GBuildExe"><span class="hs-identifier hs-var">GBuildExe</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1244"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291038"><a href="#local-6989586621679291038"><span class="hs-identifier">linkOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291022"><span class="hs-identifier hs-var">commonOpts</span></a><span>
</span><a name="line-1245"></a><span>                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679291019"><span class="hs-identifier hs-var">linkerOpts</span></a><span>
</span><a name="line-1246"></a><span>                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1247"></a><span>                      </span><span class="hs-identifier">ghcOptLinkNoHsMain</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679291007"><span class="hs-identifier hs-var">inputFiles</span></a><span class="hs-special">)</span><span>
</span><a name="line-1248"></a><span>                     </span><span class="hs-special">}</span><span>
</span><a name="line-1249"></a><span>                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">withDynExe</span><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679291020"><span class="hs-identifier hs-var">dynLinkerOpts</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">)</span><span>
</span><a name="line-1250"></a><span>
</span><a name="line-1251"></a><span>      </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;Linking...&quot;</span><span>
</span><a name="line-1252"></a><span>      </span><span class="hs-comment">-- Work around old GHCs not relinking in this</span><span>
</span><a name="line-1253"></a><span>      </span><span class="hs-comment">-- situation, see #3294</span><span>
</span><a name="line-1254"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291039"><a href="#local-6989586621679291039"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679290999"><span class="hs-identifier hs-var">targetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679290998"><span class="hs-identifier hs-var">targetName</span></a><span>
</span><a name="line-1255"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#compilerVersion"><span class="hs-identifier hs-var">compilerVersion</span></a><span> </span><a href="#local-6989586621679290993"><span class="hs-identifier hs-var">comp</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1256"></a><span>        </span><a name="local-6989586621679291040"><a href="#local-6989586621679291040"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">doesFileExist</span><span> </span><a href="#local-6989586621679291039"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-1257"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679291040"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">removeFile</span><span> </span><a href="#local-6989586621679291039"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-1258"></a><span>      </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291038"><span class="hs-identifier hs-var">linkOpts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptOutputFile</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="#local-6989586621679291039"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1259"></a><span>    </span><a href="Distribution.Simple.GHC.html#GBuildFLib"><span class="hs-identifier hs-var">GBuildFLib</span></a><span> </span><a name="local-6989586621679291041"><a href="#local-6989586621679291041"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1260"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291042"><a href="#local-6989586621679291042"><span class="hs-identifier">rtsInfo</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#extractRtsInfo"><span class="hs-identifier hs-var">extractRtsInfo</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1261"></a><span>          </span><a name="local-6989586621679291043"><a href="#local-6989586621679291043"><span class="hs-identifier">linkOpts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">foreignLibType</span><span> </span><a href="#local-6989586621679291041"><span class="hs-identifier hs-var">flib</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1262"></a><span>            </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeShared"><span class="hs-identifier hs-var">ForeignLibNativeShared</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1263"></a><span>                        </span><a href="#local-6989586621679291022"><span class="hs-identifier hs-var">commonOpts</span></a><span>
</span><a name="line-1264"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679291019"><span class="hs-identifier hs-var">linkerOpts</span></a><span>
</span><a name="line-1265"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679291020"><span class="hs-identifier hs-var">dynLinkerOpts</span></a><span>
</span><a name="line-1266"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1267"></a><span>                 </span><span class="hs-identifier">ghcOptLinkNoHsMain</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1268"></a><span>                 </span><span class="hs-identifier">ghcOptShared</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1269"></a><span>                 </span><span class="hs-identifier">ghcOptLinkLibs</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1270"></a><span>                                           </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679291012"><span class="hs-identifier hs-var">needDynamic</span></a><span>
</span><a name="line-1271"></a><span>                                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">rtsDynamicLib</span><span> </span><a href="#local-6989586621679291042"><span class="hs-identifier hs-var">rtsInfo</span></a><span>
</span><a name="line-1272"></a><span>                                             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">rtsStaticLib</span><span>  </span><a href="#local-6989586621679291042"><span class="hs-identifier hs-var">rtsInfo</span></a><span>
</span><a name="line-1273"></a><span>                                           </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1274"></a><span>                 </span><span class="hs-identifier">ghcOptLinkLibPath</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">rtsLibPaths</span><span> </span><a href="#local-6989586621679291042"><span class="hs-identifier hs-var">rtsInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1275"></a><span>                 </span><span class="hs-identifier">ghcOptFPic</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1276"></a><span>                 </span><span class="hs-identifier">ghcOptLinkModDefFiles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.GHC.html#gbuildModDefFiles"><span class="hs-identifier hs-var">gbuildModDefFiles</span></a><span> </span><a href="#local-6989586621679290990"><span class="hs-identifier hs-var">bm</span></a><span>
</span><a name="line-1277"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-1278"></a><span>              </span><span class="hs-comment">-- See Note [RPATH]</span><span>
</span><a name="line-1279"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="Distribution.Simple.GHC.html#ifNeedsRPathWorkaround"><span class="hs-identifier hs-var">ifNeedsRPathWorkaround</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1280"></a><span>                  </span><span class="hs-identifier">ghcOptLinkOptions</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;-Wl,--no-as-needed&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1281"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ghcOptLinkLibs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;ffi&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1282"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-1283"></a><span>            </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibNativeStatic"><span class="hs-identifier hs-var">ForeignLibNativeStatic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1284"></a><span>              </span><span class="hs-comment">-- this should be caught by buildFLib</span><span>
</span><a name="line-1285"></a><span>              </span><span class="hs-comment">-- (and if we do implement tihs, we probably don't even want to call</span><span>
</span><a name="line-1286"></a><span>              </span><span class="hs-comment">-- ghc here, but rather Ar.createArLibArchive or something)</span><span>
</span><a name="line-1287"></a><span>              </span><a href="Distribution.PackageDescription.Utils.html#cabalBug"><span class="hs-identifier hs-var">cabalBug</span></a><span> </span><span class="hs-string">&quot;static libraries not yet implemented&quot;</span><span>
</span><a name="line-1288"></a><span>            </span><a href="Distribution.Types.ForeignLibType.html#ForeignLibTypeUnknown"><span class="hs-identifier hs-var">ForeignLibTypeUnknown</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1289"></a><span>              </span><a href="Distribution.PackageDescription.Utils.html#cabalBug"><span class="hs-identifier hs-var">cabalBug</span></a><span> </span><span class="hs-string">&quot;unknown foreign lib type&quot;</span><span>
</span><a name="line-1290"></a><span>      </span><span class="hs-comment">-- We build under a (potentially) different filename to set a</span><span>
</span><a name="line-1291"></a><span>      </span><span class="hs-comment">-- soname on supported platforms.  See also the note for</span><span>
</span><a name="line-1292"></a><span>      </span><span class="hs-comment">-- @flibBuildName@.</span><span>
</span><a name="line-1293"></a><span>      </span><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679290986"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-string">&quot;Linking...&quot;</span><span>
</span><a name="line-1294"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291044"><a href="#local-6989586621679291044"><span class="hs-identifier">buildName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#flibBuildName"><span class="hs-identifier hs-var">flibBuildName</span></a><span> </span><a href="#local-6989586621679290989"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291041"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-1295"></a><span>      </span><a href="#local-6989586621679290996"><span class="hs-identifier hs-var">runGhcProg</span></a><span> </span><a href="#local-6989586621679291043"><span class="hs-identifier hs-var">linkOpts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptOutputFile</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290999"><span class="hs-identifier hs-var">targetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291044"><span class="hs-identifier hs-var">buildName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1296"></a><span>      </span><span class="hs-identifier hs-var">renameFile</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290999"><span class="hs-identifier hs-var">targetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291044"><span class="hs-identifier hs-var">buildName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679290999"><span class="hs-identifier hs-var">targetDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679290998"><span class="hs-identifier hs-var">targetName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1297"></a><span>
</span><a name="line-1298"></a><span class="hs-comment">{-
Note [RPATH]
~~~~~~~~~~~~

Suppose that the dynamic library depends on `base`, but not (directly) on
`integer-gmp` (which, however, is a dependency of `base`). We will link the
library as

    gcc ... -lHSbase-4.7.0.2-ghc7.8.4 -lHSinteger-gmp-0.5.1.0-ghc7.8.4 ...

However, on systems (like Ubuntu) where the linker gets called with `-as-needed`
by default, the linker will notice that `integer-gmp` isn't actually a direct
dependency and hence omit the link.

Then when we attempt to link a C program against this dynamic library, the
_static_ linker will attempt to verify that all symbols can be resolved.  The
dynamic library itself does not require any symbols from `integer-gmp`, but
`base` does. In order to verify that the symbols used by `base` can be
resolved, the static linker needs to be able to _find_ integer-gmp.

Finding the `base` dependency is simple, because the dynamic elf header
(`readelf -d`) for the library that we have created looks something like

    (NEEDED) Shared library: [libHSbase-4.7.0.2-ghc7.8.4.so]
    (RPATH)  Library rpath: [/path/to/base-4.7.0.2:...]

However, when it comes to resolving the dependency on `integer-gmp`, it needs
to look at the dynamic header for `base`. On modern ghc (7.8 and higher) this
looks something like

    (NEEDED) Shared library: [libHSinteger-gmp-0.5.1.0-ghc7.8.4.so]
    (RPATH)  Library rpath: [$ORIGIN/../integer-gmp-0.5.1.0:...]

This specifies the location of `integer-gmp` _in terms of_ the location of base
(using the `$ORIGIN`) variable. But here's the crux: when the static linker
attempts to verify that all symbols can be resolved, [**IT DOES NOT RESOLVE
`$ORIGIN`**](http://stackoverflow.com/questions/6323603/ld-using-rpath-origin-inside-a-shared-library-recursive).
As a consequence, it will not be able to resolve the symbols and report the
missing symbols as errors, _even though the dynamic linker **would** be able to
resolve these symbols_. We can tell the static linker not to report these
errors by using `--unresolved-symbols=ignore-all` and all will be fine when we
run the program ([(indeed, this is what the gold linker
does)](https://sourceware.org/ml/binutils/2013-05/msg00038.html), but it makes
the resulting library more difficult to use.

Instead what we can do is make sure that the generated dynamic library has
explicit top-level dependencies on these libraries. This means that the static
linker knows where to find them, and when we have transitive dependencies on
the same libraries the linker will only load them once, so we avoid needing to
look at the `RPATH` of our dependencies. We can do this by passing
`--no-as-needed` to the linker, so that it doesn't omit any libraries.

Note that on older ghc (7.6 and before) the Haskell libraries don't have an
RPATH set at all, which makes it even more important that we make these
top-level dependencies.

Finally, we have to explicitly link against `libffi` for the same reason. For
newer ghc this _happens_ to be unnecessary on many systems because `libffi` is
a library which is not specific to GHC, and when the static linker verifies
that all symbols can be resolved it will find the `libffi` that is globally
installed (completely independent from ghc). Of course, this may well be the
_wrong_ version of `libffi`, but it's quite possible that symbol resolution
happens to work. This is of course the wrong approach, which is why we link
explicitly against `libffi` so that we will find the _right_ version of
`libffi`.
-}</span><span>
</span><a name="line-1364"></a><span>
</span><a name="line-1365"></a><span class="hs-comment">-- | Do we need the RPATH workaround?</span><span>
</span><a name="line-1366"></a><span class="hs-comment">--</span><span>
</span><a name="line-1367"></a><span class="hs-comment">-- See Note [RPATH].</span><span>
</span><a name="line-1368"></a><span class="hs-identifier">ifNeedsRPathWorkaround</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679290645"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290645"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679290645"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1369"></a><a name="ifNeedsRPathWorkaround"><a href="Distribution.Simple.GHC.html#ifNeedsRPathWorkaround"><span class="hs-identifier">ifNeedsRPathWorkaround</span></a></a><span> </span><a name="local-6989586621679291045"><a href="#local-6989586621679291045"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679291046"><a href="#local-6989586621679291046"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1370"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679291045"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1371"></a><span>    </span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Distribution.System.html#Linux"><span class="hs-identifier hs-var">Linux</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679291046"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1372"></a><span>    </span><a name="local-6989586621679291047"><a href="#local-6989586621679291047"><span class="hs-identifier">_otherwise</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1373"></a><span>
</span><a name="line-1374"></a><span class="hs-keyword">data</span><span> </span><a name="RtsInfo"><a href="Distribution.Simple.GHC.html#RtsInfo"><span class="hs-identifier">RtsInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RtsInfo"><a href="Distribution.Simple.GHC.html#RtsInfo"><span class="hs-identifier">RtsInfo</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1375"></a><span>    </span><a name="rtsDynamicLib"><a href="Distribution.Simple.GHC.html#rtsDynamicLib"><span class="hs-identifier">rtsDynamicLib</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1376"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="rtsStaticLib"><a href="Distribution.Simple.GHC.html#rtsStaticLib"><span class="hs-identifier">rtsStaticLib</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1377"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="rtsLibPaths"><a href="Distribution.Simple.GHC.html#rtsLibPaths"><span class="hs-identifier">rtsLibPaths</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>
</span><a name="line-1378"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-comment">-- | Extract (and compute) information about the RTS library</span><span>
</span><a name="line-1381"></a><span class="hs-comment">--</span><span>
</span><a name="line-1382"></a><span class="hs-comment">-- TODO: This hardcodes the name as @HSrts-ghc&lt;version&gt;@. I don't know if we can</span><span>
</span><a name="line-1383"></a><span class="hs-comment">-- find this information somewhere. We can lookup the 'hsLibraries' field of</span><span>
</span><a name="line-1384"></a><span class="hs-comment">-- 'InstalledPackageInfo' but it will tell us @[&quot;HSrts&quot;, &quot;Cffi&quot;]@, which</span><span>
</span><a name="line-1385"></a><span class="hs-comment">-- doesn't really help.</span><span>
</span><a name="line-1386"></a><span class="hs-identifier">extractRtsInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.GHC.html#RtsInfo"><span class="hs-identifier hs-type">RtsInfo</span></a><span>
</span><a name="line-1387"></a><a name="extractRtsInfo"><a href="Distribution.Simple.GHC.html#extractRtsInfo"><span class="hs-identifier">extractRtsInfo</span></a></a><span> </span><a name="local-6989586621679291048"><a href="#local-6989586621679291048"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1388"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.PackageIndex.html#lookupPackageName"><span class="hs-identifier hs-var">PackageIndex</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookupPackageName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">installedPkgs</span><span> </span><a href="#local-6989586621679291048"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.PackageName.html#mkPackageName"><span class="hs-identifier hs-var">mkPackageName</span></a><span> </span><span class="hs-string">&quot;rts&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1389"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679291052"><a href="#local-6989586621679291052"><span class="hs-identifier">rts</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679291049"><span class="hs-identifier hs-var">aux</span></a><span> </span><a href="#local-6989586621679291052"><span class="hs-identifier hs-var">rts</span></a><span>
</span><a name="line-1390"></a><span>      </span><a name="local-6989586621679291053"><a href="#local-6989586621679291053"><span class="hs-identifier">_otherwise</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No (or multiple) ghc rts package is registered&quot;</span><span>
</span><a name="line-1391"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1392"></a><span>    </span><span class="hs-identifier">aux</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.GHC.html#RtsInfo"><span class="hs-identifier hs-type">RtsInfo</span></a><span>
</span><a name="line-1393"></a><span>    </span><a name="local-6989586621679291049"><a href="#local-6989586621679291049"><span class="hs-identifier">aux</span></a></a><span> </span><a name="local-6989586621679291051"><a href="#local-6989586621679291051"><span class="hs-identifier">rts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#RtsInfo"><span class="hs-identifier hs-var">RtsInfo</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1394"></a><span>        </span><span class="hs-identifier">rtsDynamicLib</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;HSrts-ghc&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679291050"><span class="hs-identifier hs-var">ghcVersion</span></a><span>
</span><a name="line-1395"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtsStaticLib</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;HSrts&quot;</span><span>
</span><a name="line-1396"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtsLibPaths</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">InstalledPackageInfo</span><span class="hs-operator">.</span><span class="hs-identifier">libraryDirs</span><span> </span><a href="#local-6989586621679291051"><span class="hs-identifier hs-var">rts</span></a><span>
</span><a name="line-1397"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-1398"></a><span>    </span><span class="hs-identifier">ghcVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a><span>
</span><a name="line-1399"></a><span>    </span><a name="local-6989586621679291050"><a href="#local-6989586621679291050"><span class="hs-identifier">ghcVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Compiler.html#compilerVersion"><span class="hs-identifier hs-var">compilerVersion</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291048"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1400"></a><span>
</span><a name="line-1401"></a><span class="hs-comment">-- | Returns True if the modification date of the given source file is newer than</span><span>
</span><a name="line-1402"></a><span class="hs-comment">-- the object file we last compiled for it, or if no object file exists yet.</span><span>
</span><a name="line-1403"></a><span class="hs-identifier">checkNeedsRecompilation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcOptions"><span class="hs-identifier hs-type">GhcOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#NoCallStackIO"><span class="hs-identifier hs-type">NoCallStackIO</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1404"></a><a name="checkNeedsRecompilation"><a href="Distribution.Simple.GHC.html#checkNeedsRecompilation"><span class="hs-identifier">checkNeedsRecompilation</span></a></a><span> </span><a name="local-6989586621679291054"><a href="#local-6989586621679291054"><span class="hs-identifier">filename</span></a></a><span> </span><a name="local-6989586621679291055"><a href="#local-6989586621679291055"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291054"><span class="hs-identifier hs-var">filename</span></a><span> </span><span class="hs-special">`</span><a href="Distribution.Simple.Utils.html#moreRecentFile"><span class="hs-identifier hs-var">moreRecentFile</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679291056"><span class="hs-identifier hs-var">oname</span></a><span>
</span><a name="line-1405"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679291056"><a href="#local-6989586621679291056"><span class="hs-identifier">oname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#getObjectFileName"><span class="hs-identifier hs-var">getObjectFileName</span></a><span> </span><a href="#local-6989586621679291054"><span class="hs-identifier hs-var">filename</span></a><span> </span><a href="#local-6989586621679291055"><span class="hs-identifier hs-var">opts</span></a><span>
</span><a name="line-1406"></a><span>
</span><a name="line-1407"></a><span class="hs-comment">-- | Finds the object file name of the given source file</span><span>
</span><a name="line-1408"></a><span class="hs-identifier">getObjectFileName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcOptions"><span class="hs-identifier hs-type">GhcOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1409"></a><a name="getObjectFileName"><a href="Distribution.Simple.GHC.html#getObjectFileName"><span class="hs-identifier">getObjectFileName</span></a></a><span> </span><a name="local-6989586621679291057"><a href="#local-6989586621679291057"><span class="hs-identifier">filename</span></a></a><span> </span><a name="local-6989586621679291058"><a href="#local-6989586621679291058"><span class="hs-identifier">opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291061"><span class="hs-identifier hs-var">oname</span></a><span>
</span><a name="line-1410"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679291059"><a href="#local-6989586621679291059"><span class="hs-identifier">odir</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcOptObjDir</span><span> </span><a href="#local-6989586621679291058"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1411"></a><span>          </span><a name="local-6989586621679291060"><a href="#local-6989586621679291060"><span class="hs-identifier">oext</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#fromFlagOrDefault"><span class="hs-identifier hs-var">fromFlagOrDefault</span></a><span> </span><span class="hs-string">&quot;o&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcOptObjSuffix</span><span> </span><a href="#local-6989586621679291058"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>          </span><a name="local-6989586621679291061"><a href="#local-6989586621679291061"><span class="hs-identifier">oname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291059"><span class="hs-identifier hs-var">odir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-identifier hs-var">replaceExtension</span><span> </span><a href="#local-6989586621679291057"><span class="hs-identifier hs-var">filename</span></a><span> </span><a href="#local-6989586621679291060"><span class="hs-identifier hs-var">oext</span></a><span>
</span><a name="line-1413"></a><span>
</span><a name="line-1414"></a><span class="hs-comment">-- | Calculate the RPATHs for the component we are building.</span><span>
</span><a name="line-1415"></a><span class="hs-comment">--</span><span>
</span><a name="line-1416"></a><span class="hs-comment">-- Calculates relative RPATHs when 'relocatable' is set.</span><span>
</span><a name="line-1417"></a><span class="hs-identifier">getRPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1418"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-comment">-- ^ Component we are building</span><span>
</span><a name="line-1419"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#NoCallStackIO"><span class="hs-identifier hs-type">NoCallStackIO</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Utils.NubList.html#NubListR"><span class="hs-identifier hs-type">NubListR</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>
</span><a name="line-1420"></a><a name="getRPaths"><a href="Distribution.Simple.GHC.html#getRPaths"><span class="hs-identifier">getRPaths</span></a></a><span> </span><a name="local-6989586621679291062"><a href="#local-6989586621679291062"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679291063"><a href="#local-6989586621679291063"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679291065"><span class="hs-identifier hs-var">supportRPaths</span></a><span> </span><a href="#local-6989586621679291064"><span class="hs-identifier hs-var">hostOS</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1421"></a><span>    </span><a name="local-6989586621679291066"><a href="#local-6989586621679291066"><span class="hs-identifier">libraryPaths</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#depLibraryPaths"><span class="hs-identifier hs-var">depLibraryPaths</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">relocatable</span><span> </span><a href="#local-6989586621679291062"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291062"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291063"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-1422"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291067"><a href="#local-6989586621679291067"><span class="hs-identifier">hostPref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679291064"><span class="hs-identifier hs-var">hostOS</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1423"></a><span>                     </span><a href="Distribution.System.html#OSX"><span class="hs-identifier hs-var">OSX</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;@loader_path&quot;</span><span>
</span><a name="line-1424"></a><span>                     </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;$ORIGIN&quot;</span><span>
</span><a name="line-1425"></a><span>        </span><a name="local-6989586621679291068"><a href="#local-6989586621679291068"><span class="hs-identifier">relPath</span></a></a><span> </span><a name="local-6989586621679291070"><a href="#local-6989586621679291070"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isRelative</span><span> </span><a href="#local-6989586621679291070"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679291067"><span class="hs-identifier hs-var">hostPref</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291070"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679291070"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1426"></a><span>        </span><a name="local-6989586621679291069"><a href="#local-6989586621679291069"><span class="hs-identifier">rpaths</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679291068"><span class="hs-identifier hs-var">relPath</span></a><span> </span><a href="#local-6989586621679291066"><span class="hs-identifier hs-var">libraryPaths</span></a><span class="hs-special">)</span><span>
</span><a name="line-1427"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679291069"><span class="hs-identifier hs-var">rpaths</span></a><span>
</span><a name="line-1428"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1429"></a><span>    </span><span class="hs-special">(</span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679291064"><a href="#local-6989586621679291064"><span class="hs-identifier">hostOS</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679291062"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1430"></a><span>
</span><a name="line-1431"></a><span>    </span><span class="hs-comment">-- The list of RPath-supported operating systems below reflects the</span><span>
</span><a name="line-1432"></a><span>    </span><span class="hs-comment">-- platforms on which Cabal's RPATH handling is tested. It does _NOT_</span><span>
</span><a name="line-1433"></a><span>    </span><span class="hs-comment">-- reflect whether the OS supports RPATH.</span><span>
</span><a name="line-1434"></a><span>
</span><a name="line-1435"></a><span>    </span><span class="hs-comment">-- E.g. when this comment was written, the *BSD operating systems were</span><span>
</span><a name="line-1436"></a><span>    </span><span class="hs-comment">-- untested with regards to Cabal RPATH handling, and were hence set to</span><span>
</span><a name="line-1437"></a><span>    </span><span class="hs-comment">-- 'False', while those operating systems themselves do support RPATH.</span><span>
</span><a name="line-1438"></a><span>    </span><a name="local-6989586621679291065"><a href="#local-6989586621679291065"><span class="hs-identifier">supportRPaths</span></a></a><span> </span><a href="Distribution.System.html#Linux"><span class="hs-identifier hs-var">Linux</span></a><span>   &#160;   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1439"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#Windows"><span class="hs-identifier hs-var">Windows</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1440"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#OSX"><span class="hs-identifier hs-var">OSX</span></a><span>     &#160;   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1441"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#FreeBSD"><span class="hs-identifier hs-var">FreeBSD</span></a><span> &#160;   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1442"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#OpenBSD"><span class="hs-identifier hs-var">OpenBSD</span></a><span> &#160;   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1443"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#NetBSD"><span class="hs-identifier hs-var">NetBSD</span></a><span>  &#160;   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1444"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#DragonFly"><span class="hs-identifier hs-var">DragonFly</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1445"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#Solaris"><span class="hs-identifier hs-var">Solaris</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1446"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#AIX"><span class="hs-identifier hs-var">AIX</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1447"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#HPUX"><span class="hs-identifier hs-var">HPUX</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1448"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#IRIX"><span class="hs-identifier hs-var">IRIX</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1449"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#HaLVM"><span class="hs-identifier hs-var">HaLVM</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1450"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#IOS"><span class="hs-identifier hs-var">IOS</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1451"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#Android"><span class="hs-identifier hs-var">Android</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1452"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#Ghcjs"><span class="hs-identifier hs-var">Ghcjs</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1453"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><a href="Distribution.System.html#Hurd"><span class="hs-identifier hs-var">Hurd</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1454"></a><span>    </span><span class="hs-identifier">supportRPaths</span><span> </span><span class="hs-special">(</span><a href="Distribution.System.html#OtherOS"><span class="hs-identifier hs-var">OtherOS</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1455"></a><span>    </span><span class="hs-comment">-- Do _not_ add a default case so that we get a warning here when a new OS</span><span>
</span><a name="line-1456"></a><span>    </span><span class="hs-comment">-- is added.</span><span>
</span><a name="line-1457"></a><span>
</span><a name="line-1458"></a><span class="hs-identifier">getRPaths</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1459"></a><span>
</span><a name="line-1460"></a><span class="hs-comment">-- | Filter the &quot;-threaded&quot; flag when profiling as it does not</span><span>
</span><a name="line-1461"></a><span class="hs-comment">--   work with ghc-6.8 and older.</span><span>
</span><a name="line-1462"></a><span class="hs-identifier">hackThreadedFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.BuildInfo.html#BuildInfo"><span class="hs-identifier hs-type">BuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Types.BuildInfo.html#BuildInfo"><span class="hs-identifier hs-type">BuildInfo</span></a><span>
</span><a name="line-1463"></a><a name="hackThreadedFlag"><a href="Distribution.Simple.GHC.html#hackThreadedFlag"><span class="hs-identifier">hackThreadedFlag</span></a></a><span> </span><a name="local-6989586621679291071"><a href="#local-6989586621679291071"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291072"><a href="#local-6989586621679291072"><span class="hs-identifier">comp</span></a></a><span> </span><a name="local-6989586621679291073"><a href="#local-6989586621679291073"><span class="hs-identifier">prof</span></a></a><span> </span><a name="local-6989586621679291074"><a href="#local-6989586621679291074"><span class="hs-identifier">bi</span></a></a><span>
</span><a name="line-1464"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679291075"><span class="hs-identifier hs-var">mustFilterThreaded</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679291074"><span class="hs-identifier hs-var">bi</span></a><span>
</span><a name="line-1465"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1466"></a><span>    </span><a href="Distribution.Simple.Utils.html#warn"><span class="hs-identifier hs-var">warn</span></a><span> </span><a href="#local-6989586621679291071"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;The ghc flag '-threaded' is not compatible with &quot;</span><span>
</span><a name="line-1467"></a><span>                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;profiling in ghc-6.8 and older. It will be disabled.&quot;</span><span>
</span><a name="line-1468"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679291074"><span class="hs-identifier hs-var">bi</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">options</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291076"><span class="hs-identifier hs-var">filterHcOptions</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;-threaded&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">options</span><span> </span><a href="#local-6989586621679291074"><span class="hs-identifier hs-var">bi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1469"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1470"></a><span>    </span><a name="local-6989586621679291075"><a href="#local-6989586621679291075"><span class="hs-identifier">mustFilterThreaded</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291073"><span class="hs-identifier hs-var">prof</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Distribution.Simple.Compiler.html#compilerVersion"><span class="hs-identifier hs-var">compilerVersion</span></a><span> </span><a href="#local-6989586621679291072"><span class="hs-identifier hs-var">comp</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Distribution.Version.html#mkVersion"><span class="hs-identifier hs-var">mkVersion</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span> </span><span class="hs-number">10</span><span class="hs-special">]</span><span>
</span><a name="line-1471"></a><span>                      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-string">&quot;-threaded&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="Distribution.Types.BuildInfo.html#hcOptions"><span class="hs-identifier hs-var">hcOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679291074"><span class="hs-identifier hs-var">bi</span></a><span>
</span><a name="line-1472"></a><span>    </span><a name="local-6989586621679291076"><a href="#local-6989586621679291076"><span class="hs-identifier">filterHcOptions</span></a></a><span> </span><a name="local-6989586621679291077"><a href="#local-6989586621679291077"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679291078"><a href="#local-6989586621679291078"><span class="hs-identifier">hcoptss</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1473"></a><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291079"><span class="hs-identifier hs-var">hc</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679291079"><span class="hs-identifier hs-var">hc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621679291077"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679291080"><span class="hs-identifier hs-var">opts</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679291080"><span class="hs-identifier hs-var">opts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1474"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679291079"><a href="#local-6989586621679291079"><span class="hs-identifier">hc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679291080"><a href="#local-6989586621679291080"><span class="hs-identifier">opts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679291078"><span class="hs-identifier hs-var">hcoptss</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1475"></a><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span class="hs-comment">-- | Extracts a String representing a hash of the ABI of a built</span><span>
</span><a name="line-1478"></a><span class="hs-comment">-- library.  It can fail if the library has not yet been built.</span><span>
</span><a name="line-1479"></a><span class="hs-comment">--</span><span>
</span><a name="line-1480"></a><span class="hs-identifier">libAbiHash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1481"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.Library.html#Library"><span class="hs-identifier hs-type">Library</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1482"></a><a name="libAbiHash"><a href="Distribution.Simple.GHC.html#libAbiHash"><span class="hs-identifier">libAbiHash</span></a></a><span> </span><a name="local-6989586621679291081"><a href="#local-6989586621679291081"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291082"><a href="#local-6989586621679291082"><span class="hs-identifier">_pkg_descr</span></a></a><span> </span><a name="local-6989586621679291083"><a href="#local-6989586621679291083"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679291084"><a href="#local-6989586621679291084"><span class="hs-identifier">lib</span></a></a><span> </span><a name="local-6989586621679291085"><a href="#local-6989586621679291085"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1483"></a><span>  </span><a name="local-6989586621679291086"><a href="#local-6989586621679291086"><span class="hs-identifier">libBi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.GHC.html#hackThreadedFlag"><span class="hs-identifier hs-var">hackThreadedFlag</span></a><span> </span><a href="#local-6989586621679291081"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1484"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withProfLib</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">libBuildInfo</span><span> </span><a href="#local-6989586621679291084"><span class="hs-identifier hs-var">lib</span></a><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-1486"></a><span>      </span><a name="local-6989586621679291087"><a href="#local-6989586621679291087"><span class="hs-identifier">comp</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1487"></a><span>      </span><a name="local-6989586621679291088"><a href="#local-6989586621679291088"><span class="hs-identifier">platform</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1488"></a><span>      </span><a name="local-6989586621679291089"><a href="#local-6989586621679291089"><span class="hs-identifier">vanillaArgs0</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1489"></a><span>        </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#componentGhcOptions"><span class="hs-identifier hs-var">componentGhcOptions</span></a><span> </span><a href="#local-6989586621679291081"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291086"><span class="hs-identifier hs-var">libBi</span></a><span> </span><a href="#local-6989586621679291085"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier hs-var">componentBuildDir</span></a><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291085"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1491"></a><span>          </span><span class="hs-identifier">ghcOptMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcModeAbiHash"><span class="hs-identifier hs-var">GhcModeAbiHash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1492"></a><span>          </span><span class="hs-identifier">ghcOptInputModules</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">exposedModules</span><span> </span><a href="#local-6989586621679291084"><span class="hs-identifier hs-var">lib</span></a><span>
</span><a name="line-1493"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-1494"></a><span>      </span><a name="local-6989586621679291090"><a href="#local-6989586621679291090"><span class="hs-identifier">vanillaArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1495"></a><span>          </span><span class="hs-comment">-- Package DBs unnecessary, and break ghc-cabal. See #3633</span><span>
</span><a name="line-1496"></a><span>          </span><span class="hs-comment">-- BUT, put at least the global database so that 7.4 doesn't</span><span>
</span><a name="line-1497"></a><span>          </span><span class="hs-comment">-- break.</span><span>
</span><a name="line-1498"></a><span>          </span><a href="#local-6989586621679291089"><span class="hs-identifier hs-var">vanillaArgs0</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ghcOptPackageDBs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span class="hs-special">]</span><span>
</span><a name="line-1499"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ghcOptPackages</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1500"></a><span>      </span><a name="local-6989586621679291091"><a href="#local-6989586621679291091"><span class="hs-identifier">sharedArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291090"><span class="hs-identifier hs-var">vanillaArgs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1501"></a><span>                       </span><span class="hs-identifier">ghcOptDynLinkMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-var">GhcDynamicOnly</span></a><span class="hs-special">,</span><span>
</span><a name="line-1502"></a><span>                       </span><span class="hs-identifier">ghcOptFPic</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1503"></a><span>                       </span><span class="hs-identifier">ghcOptHiSuffix</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1504"></a><span>                       </span><span class="hs-identifier">ghcOptObjSuffix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;dyn_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1505"></a><span>                       </span><span class="hs-identifier">ghcOptExtra</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679291086"><span class="hs-identifier hs-var">libBi</span></a><span>
</span><a name="line-1506"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-1507"></a><span>      </span><a name="local-6989586621679291092"><a href="#local-6989586621679291092"><span class="hs-identifier">profArgs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291090"><span class="hs-identifier hs-var">vanillaArgs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1508"></a><span>                     </span><span class="hs-identifier">ghcOptProfilingMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-1509"></a><span>                     </span><span class="hs-identifier">ghcOptProfilingAuto</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#profDetailLevelFlag"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">profDetailLevelFlag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1510"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier">withProfLibDetail</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1511"></a><span>                     </span><span class="hs-identifier">ghcOptHiSuffix</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_hi&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1512"></a><span>                     </span><span class="hs-identifier">ghcOptObjSuffix</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span> </span><span class="hs-string">&quot;p_o&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1513"></a><span>                     </span><span class="hs-identifier">ghcOptExtra</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-var">toNubListR</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Types.BuildInfo.html#hcProfOptions"><span class="hs-identifier hs-var">hcProfOptions</span></a><span> </span><a href="Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a><span> </span><a href="#local-6989586621679291086"><span class="hs-identifier hs-var">libBi</span></a><span>
</span><a name="line-1514"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-1515"></a><span>      </span><a name="local-6989586621679291093"><a href="#local-6989586621679291093"><span class="hs-identifier">ghcArgs</span></a></a><span>
</span><a name="line-1516"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">withVanillaLib</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291090"><span class="hs-identifier hs-var">vanillaArgs</span></a><span>
</span><a name="line-1517"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">withSharedLib</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291091"><span class="hs-identifier hs-var">sharedArgs</span></a><span>
</span><a name="line-1518"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">withProfLib</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291092"><span class="hs-identifier hs-var">profArgs</span></a><span>
</span><a name="line-1519"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;libAbiHash: Can't find an enabled library way&quot;</span><span>
</span><a name="line-1520"></a><span>
</span><a name="line-1521"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679291094"><a href="#local-6989586621679291094"><span class="hs-identifier">ghcProg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-var">requireProgram</span></a><span> </span><a href="#local-6989586621679291081"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679291083"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>  </span><a name="local-6989586621679291095"><a href="#local-6989586621679291095"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Run.html#getProgramInvocationOutput"><span class="hs-identifier hs-var">getProgramInvocationOutput</span></a><span> </span><a href="#local-6989586621679291081"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1523"></a><span>          </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.GHC.html#ghcInvocation"><span class="hs-identifier hs-var">ghcInvocation</span></a><span> </span><a href="#local-6989586621679291094"><span class="hs-identifier hs-var">ghcProg</span></a><span> </span><a href="#local-6989586621679291087"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679291088"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621679291093"><span class="hs-identifier hs-var">ghcArgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291095"><span class="hs-identifier hs-var">hash</span></a><span class="hs-special">)</span><span>
</span><a name="line-1525"></a><span>
</span><a name="line-1526"></a><span class="hs-identifier">componentGhcOptions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1527"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.BuildInfo.html#BuildInfo"><span class="hs-identifier hs-type">BuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1528"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcOptions"><span class="hs-identifier hs-type">GhcOptions</span></a><span>
</span><a name="line-1529"></a><a name="componentGhcOptions"><a href="Distribution.Simple.GHC.html#componentGhcOptions"><span class="hs-identifier">componentGhcOptions</span></a></a><span> </span><a name="local-6989586621679291096"><a href="#local-6989586621679291096"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291097"><a href="#local-6989586621679291097"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1530"></a><span>  </span><a href="Distribution.Simple.GHC.Internal.html#componentGhcOptions"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">componentGhcOptions</span></a><span> </span><a href="#local-6989586621679291096"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291099"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679291097"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1531"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1532"></a><span>    </span><a name="local-6989586621679291098"><a href="#local-6989586621679291098"><span class="hs-identifier">comp</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291097"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1533"></a><span>    </span><a name="local-6989586621679291099"><a href="#local-6989586621679291099"><span class="hs-identifier">implInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#getImplInfo"><span class="hs-identifier hs-var">getImplInfo</span></a><span> </span><a href="#local-6989586621679291098"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-1534"></a><span>
</span><a name="line-1535"></a><span class="hs-identifier">componentCcGhcOptions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1536"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.BuildInfo.html#BuildInfo"><span class="hs-identifier hs-type">BuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span>
</span><a name="line-1537"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1538"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.GHC.html#GhcOptions"><span class="hs-identifier hs-type">GhcOptions</span></a><span>
</span><a name="line-1539"></a><a name="componentCcGhcOptions"><a href="Distribution.Simple.GHC.html#componentCcGhcOptions"><span class="hs-identifier">componentCcGhcOptions</span></a></a><span> </span><a name="local-6989586621679291100"><a href="#local-6989586621679291100"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291101"><a href="#local-6989586621679291101"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1540"></a><span>    </span><a href="Distribution.Simple.GHC.Internal.html#componentCcGhcOptions"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">componentCcGhcOptions</span></a><span> </span><a href="#local-6989586621679291100"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291103"><span class="hs-identifier hs-var">implInfo</span></a><span> </span><a href="#local-6989586621679291101"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1541"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1542"></a><span>    </span><a name="local-6989586621679291102"><a href="#local-6989586621679291102"><span class="hs-identifier">comp</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291101"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1543"></a><span>    </span><a name="local-6989586621679291103"><a href="#local-6989586621679291103"><span class="hs-identifier">implInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.ImplInfo.html#getImplInfo"><span class="hs-identifier hs-var">getImplInfo</span></a><span> </span><a href="#local-6989586621679291102"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-1544"></a><span>
</span><a name="line-1545"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1546"></a><span class="hs-comment">-- Installing</span><span>
</span><a name="line-1547"></a><span>
</span><a name="line-1548"></a><span class="hs-comment">-- |Install executables for GHC.</span><span>
</span><a name="line-1549"></a><span class="hs-identifier">installExe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-1550"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1551"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-comment">-- ^Where to copy the files to</span><span>
</span><a name="line-1552"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>  </span><span class="hs-comment">-- ^Build location</span><span>
</span><a name="line-1553"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^Executable (prefix,suffix)</span><span>
</span><a name="line-1554"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span>
</span><a name="line-1555"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span>
</span><a name="line-1556"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1557"></a><a name="installExe"><a href="Distribution.Simple.GHC.html#installExe"><span class="hs-identifier">installExe</span></a></a><span> </span><a name="local-6989586621679291104"><a href="#local-6989586621679291104"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291105"><a href="#local-6989586621679291105"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679291106"><a href="#local-6989586621679291106"><span class="hs-identifier">binDir</span></a></a><span> </span><a name="local-6989586621679291107"><a href="#local-6989586621679291107"><span class="hs-identifier">buildPref</span></a></a><span>
</span><a name="line-1558"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679291108"><a href="#local-6989586621679291108"><span class="hs-identifier">progprefix</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679291109"><a href="#local-6989586621679291109"><span class="hs-identifier">progsuffix</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679291110"><a href="#local-6989586621679291110"><span class="hs-identifier">_pkg</span></a></a><span> </span><a name="local-6989586621679291111"><a href="#local-6989586621679291111"><span class="hs-identifier">exe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1559"></a><span>  </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679291104"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679291106"><span class="hs-identifier hs-var">binDir</span></a><span>
</span><a name="line-1560"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291112"><a href="#local-6989586621679291112"><span class="hs-identifier">exeName'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">exeName</span><span> </span><a href="#local-6989586621679291111"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-1561"></a><span>      </span><a name="local-6989586621679291113"><a href="#local-6989586621679291113"><span class="hs-identifier">exeFileName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#exeTargetName"><span class="hs-identifier hs-var">exeTargetName</span></a><span> </span><a href="#local-6989586621679291111"><span class="hs-identifier hs-var">exe</span></a><span>
</span><a name="line-1562"></a><span>      </span><a name="local-6989586621679291114"><a href="#local-6989586621679291114"><span class="hs-identifier">fixedExeBaseName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291108"><span class="hs-identifier hs-var">progprefix</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679291112"><span class="hs-identifier hs-var">exeName'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679291109"><span class="hs-identifier hs-var">progsuffix</span></a><span>
</span><a name="line-1563"></a><span>      </span><a name="local-6989586621679291115"><a href="#local-6989586621679291115"><span class="hs-identifier">installBinary</span></a></a><span> </span><a name="local-6989586621679291116"><a href="#local-6989586621679291116"><span class="hs-identifier">dest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1564"></a><span>          </span><a href="Distribution.Simple.Utils.html#installExecutableFile"><span class="hs-identifier hs-var">installExecutableFile</span></a><span> </span><a href="#local-6989586621679291104"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1565"></a><span>            </span><span class="hs-special">(</span><a href="#local-6989586621679291107"><span class="hs-identifier hs-var">buildPref</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291112"><span class="hs-identifier hs-var">exeName'</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291113"><span class="hs-identifier hs-var">exeFileName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>            </span><span class="hs-special">(</span><a href="#local-6989586621679291116"><span class="hs-identifier hs-var">dest</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#exeExtension"><span class="hs-identifier hs-var">exeExtension</span></a><span class="hs-special">)</span><span>
</span><a name="line-1567"></a><span>          </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">stripExes</span><span> </span><a href="#local-6989586621679291105"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1568"></a><span>            </span><a href="Distribution.Simple.Program.Strip.html#stripExe"><span class="hs-identifier hs-var">Strip</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">stripExe</span></a><span> </span><a href="#local-6989586621679291104"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679291105"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679291105"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1569"></a><span>                           </span><span class="hs-special">(</span><a href="#local-6989586621679291116"><span class="hs-identifier hs-var">dest</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="Distribution.Simple.BuildPaths.html#exeExtension"><span class="hs-identifier hs-var">exeExtension</span></a><span class="hs-special">)</span><span>
</span><a name="line-1570"></a><span>  </span><a href="#local-6989586621679291115"><span class="hs-identifier hs-var">installBinary</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291106"><span class="hs-identifier hs-var">binDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291114"><span class="hs-identifier hs-var">fixedExeBaseName</span></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span class="hs-comment">-- |Install foreign library for GHC.</span><span>
</span><a name="line-1573"></a><span class="hs-identifier">installFLib</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-1574"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1575"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>  </span><span class="hs-comment">-- ^install location</span><span>
</span><a name="line-1576"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>  </span><span class="hs-comment">-- ^Build location</span><span>
</span><a name="line-1577"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span>
</span><a name="line-1578"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ForeignLib.html#ForeignLib"><span class="hs-identifier hs-type">ForeignLib</span></a><span>
</span><a name="line-1579"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1580"></a><a name="installFLib"><a href="Distribution.Simple.GHC.html#installFLib"><span class="hs-identifier">installFLib</span></a></a><span> </span><a name="local-6989586621679291117"><a href="#local-6989586621679291117"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291118"><a href="#local-6989586621679291118"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679291119"><a href="#local-6989586621679291119"><span class="hs-identifier">targetDir</span></a></a><span> </span><a name="local-6989586621679291120"><a href="#local-6989586621679291120"><span class="hs-identifier">builtDir</span></a></a><span> </span><a name="local-6989586621679291121"><a href="#local-6989586621679291121"><span class="hs-identifier">_pkg</span></a></a><span> </span><a name="local-6989586621679291122"><a href="#local-6989586621679291122"><span class="hs-identifier">flib</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1581"></a><span>    </span><a href="#local-6989586621679291123"><span class="hs-identifier hs-var">install</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Types.ForeignLib.html#foreignLibIsShared"><span class="hs-identifier hs-var">foreignLibIsShared</span></a><span> </span><a href="#local-6989586621679291122"><span class="hs-identifier hs-var">flib</span></a><span class="hs-special">)</span><span>
</span><a name="line-1582"></a><span>            </span><a href="#local-6989586621679291120"><span class="hs-identifier hs-var">builtDir</span></a><span>
</span><a name="line-1583"></a><span>            </span><a href="#local-6989586621679291119"><span class="hs-identifier hs-var">targetDir</span></a><span>
</span><a name="line-1584"></a><span>            </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#flibTargetName"><span class="hs-identifier hs-var">flibTargetName</span></a><span> </span><a href="#local-6989586621679291118"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291122"><span class="hs-identifier hs-var">flib</span></a><span class="hs-special">)</span><span>
</span><a name="line-1585"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1586"></a><span>    </span><a name="local-6989586621679291123"><a href="#local-6989586621679291123"><span class="hs-identifier">install</span></a></a><span> </span><a name="local-6989586621679291124"><a href="#local-6989586621679291124"><span class="hs-identifier">isShared</span></a></a><span> </span><a name="local-6989586621679291125"><a href="#local-6989586621679291125"><span class="hs-identifier">srcDir</span></a></a><span> </span><a name="local-6989586621679291126"><a href="#local-6989586621679291126"><span class="hs-identifier">dstDir</span></a></a><span> </span><a name="local-6989586621679291127"><a href="#local-6989586621679291127"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1587"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291129"><a href="#local-6989586621679291129"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291125"><span class="hs-identifier hs-var">srcDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291127"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1588"></a><span>          </span><a name="local-6989586621679291130"><a href="#local-6989586621679291130"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291126"><span class="hs-identifier hs-var">dstDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291127"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1589"></a><span>      </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679291117"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679291119"><span class="hs-identifier hs-var">targetDir</span></a><span>
</span><a name="line-1590"></a><span>      </span><span class="hs-comment">-- TODO: Should we strip? (stripLibs lbi)</span><span>
</span><a name="line-1591"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679291124"><span class="hs-identifier hs-var">isShared</span></a><span>
</span><a name="line-1592"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.Utils.html#installExecutableFile"><span class="hs-identifier hs-var">installExecutableFile</span></a><span> </span><a href="#local-6989586621679291117"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291129"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679291130"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1593"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Simple.Utils.html#installOrdinaryFile"><span class="hs-identifier hs-var">installOrdinaryFile</span></a><span>   </span><a href="#local-6989586621679291117"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291129"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679291130"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1594"></a><span>      </span><span class="hs-comment">-- Now install appropriate symlinks if library is versioned</span><span>
</span><a name="line-1595"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="Distribution.System.html#Platform"><span class="hs-identifier hs-var">Platform</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679291131"><a href="#local-6989586621679291131"><span class="hs-identifier">os</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679291118"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-1596"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.ForeignLib.html#foreignLibVersion"><span class="hs-identifier hs-var">foreignLibVersion</span></a><span> </span><a href="#local-6989586621679291122"><span class="hs-identifier hs-var">flib</span></a><span> </span><a href="#local-6989586621679291131"><span class="hs-identifier hs-var">os</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1597"></a><span>          </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291131"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="Distribution.System.html#Linux"><span class="hs-identifier hs-var">Linux</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679291117"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1598"></a><span>            </span><span class="hs-comment">-- It should be impossible to get here.</span><span>
</span><a name="line-1599"></a><span>            </span><span class="hs-string">&quot;Can't install foreign-library symlink on non-Linux OS&quot;</span><span>
</span><a name="line-1600"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS</span><span>
</span><a name="line-1601"></a><span>          </span><span class="hs-comment">-- 'createSymbolicLink file1 file2' creates a symbolic link</span><span>
</span><a name="line-1602"></a><span>          </span><span class="hs-comment">-- named 'file2' which points to the file 'file1'.</span><span>
</span><a name="line-1603"></a><span>          </span><span class="hs-comment">-- Note that we do want a symlink to 'name' rather than</span><span>
</span><a name="line-1604"></a><span>          </span><span class="hs-comment">-- 'dst', because the symlink will be relative to the</span><span>
</span><a name="line-1605"></a><span>          </span><span class="hs-comment">-- directory it's created in.</span><span>
</span><a name="line-1606"></a><span>          </span><span class="hs-comment">-- Finally, we first create the symlinks in a temporary</span><span>
</span><a name="line-1607"></a><span>          </span><span class="hs-comment">-- directory and then rename to simulate 'ln --force'.</span><span>
</span><a name="line-1608"></a><span>          </span><a href="Distribution.Simple.Utils.html#withTempDirectory"><span class="hs-identifier hs-var">withTempDirectory</span></a><span> </span><a href="#local-6989586621679291117"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291126"><span class="hs-identifier hs-var">dstDir</span></a><span> </span><a href="#local-6989586621679291128"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679291132"><a href="#local-6989586621679291132"><span class="hs-identifier">tmpDir</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1609"></a><span>              </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291133"><a href="#local-6989586621679291133"><span class="hs-identifier">link1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.html#flibBuildName"><span class="hs-identifier hs-var">flibBuildName</span></a><span> </span><a href="#local-6989586621679291118"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291122"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-1610"></a><span>                  </span><a name="local-6989586621679291134"><a href="#local-6989586621679291134"><span class="hs-identifier">link2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679291128"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><span class="hs-string">&quot;so&quot;</span><span>
</span><a name="line-1611"></a><span>              </span><span class="hs-identifier hs-var">createSymbolicLink</span><span> </span><a href="#local-6989586621679291127"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291132"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291133"><span class="hs-identifier hs-var">link1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1612"></a><span>              </span><span class="hs-identifier hs-var">renameFile</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291132"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291133"><span class="hs-identifier hs-var">link1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291126"><span class="hs-identifier hs-var">dstDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291133"><span class="hs-identifier hs-var">link1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1613"></a><span>              </span><span class="hs-identifier hs-var">createSymbolicLink</span><span> </span><a href="#local-6989586621679291127"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291132"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291134"><span class="hs-identifier hs-var">link2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1614"></a><span>              </span><span class="hs-identifier hs-var">renameFile</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291132"><span class="hs-identifier hs-var">tmpDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291134"><span class="hs-identifier hs-var">link2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291126"><span class="hs-identifier hs-var">dstDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291134"><span class="hs-identifier hs-var">link2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1615"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1616"></a><span>          </span><span class="hs-identifier">nm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1617"></a><span>          </span><a name="local-6989586621679291128"><a href="#local-6989586621679291128"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">foreignLibName</span><span> </span><a href="#local-6989586621679291122"><span class="hs-identifier hs-var">flib</span></a><span>
</span><a name="line-1618"></a><span class="hs-cpp">#endif /* mingw32_HOST_OS */</span><span>
</span><a name="line-1619"></a><span>
</span><a name="line-1620"></a><span>
</span><a name="line-1621"></a><span class="hs-comment">-- |Install for ghc, .hi, .a and, if --with-ghci given, .o</span><span>
</span><a name="line-1622"></a><span class="hs-identifier">installLib</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-1623"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-1624"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>  </span><span class="hs-comment">-- ^install location</span><span>
</span><a name="line-1625"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>  </span><span class="hs-comment">-- ^install location for dynamic libraries</span><span>
</span><a name="line-1626"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>  </span><span class="hs-comment">-- ^Build location</span><span>
</span><a name="line-1627"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span>
</span><a name="line-1628"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.Library.html#Library"><span class="hs-identifier hs-type">Library</span></a><span>
</span><a name="line-1629"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span>
</span><a name="line-1630"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1631"></a><a name="installLib"><a href="Distribution.Simple.GHC.html#installLib"><span class="hs-identifier">installLib</span></a></a><span> </span><a name="local-6989586621679291271"><a href="#local-6989586621679291271"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291272"><a href="#local-6989586621679291272"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679291273"><a href="#local-6989586621679291273"><span class="hs-identifier">targetDir</span></a></a><span> </span><a name="local-6989586621679291274"><a href="#local-6989586621679291274"><span class="hs-identifier">dynlibTargetDir</span></a></a><span> </span><a name="local-6989586621679291275"><a href="#local-6989586621679291275"><span class="hs-identifier">_builtDir</span></a></a><span> </span><a name="local-6989586621679291276"><a href="#local-6989586621679291276"><span class="hs-identifier">_pkg</span></a></a><span> </span><a name="local-6989586621679291277"><a href="#local-6989586621679291277"><span class="hs-identifier">lib</span></a></a><span> </span><a name="local-6989586621679291278"><a href="#local-6989586621679291278"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1632"></a><span>  </span><span class="hs-comment">-- copy .hi files over:</span><span>
</span><a name="line-1633"></a><span>  </span><a href="#local-6989586621679291293"><span class="hs-identifier hs-var">whenVanilla</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291283"><span class="hs-identifier hs-var">copyModuleFiles</span></a><span> </span><span class="hs-string">&quot;hi&quot;</span><span>
</span><a name="line-1634"></a><span>  </span><a href="#local-6989586621679291294"><span class="hs-identifier hs-var">whenProf</span></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291283"><span class="hs-identifier hs-var">copyModuleFiles</span></a><span> </span><span class="hs-string">&quot;p_hi&quot;</span><span>
</span><a name="line-1635"></a><span>  </span><a href="#local-6989586621679291296"><span class="hs-identifier hs-var">whenShared</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291283"><span class="hs-identifier hs-var">copyModuleFiles</span></a><span> </span><span class="hs-string">&quot;dyn_hi&quot;</span><span>
</span><a name="line-1636"></a><span>
</span><a name="line-1637"></a><span>  </span><span class="hs-comment">-- copy the built library files over:</span><span>
</span><a name="line-1638"></a><span>  </span><a href="#local-6989586621679291292"><span class="hs-identifier hs-var">whenHasCode</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1639"></a><span>    </span><a href="#local-6989586621679291293"><span class="hs-identifier hs-var">whenVanilla</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291281"><span class="hs-identifier hs-var">installOrdinary</span></a><span> </span><a href="#local-6989586621679291279"><span class="hs-identifier hs-var">builtDir</span></a><span> </span><a href="#local-6989586621679291273"><span class="hs-identifier hs-var">targetDir</span></a><span>       </span><a href="#local-6989586621679291286"><span class="hs-identifier hs-var">vanillaLibName</span></a><span>
</span><a name="line-1640"></a><span>    </span><a href="#local-6989586621679291294"><span class="hs-identifier hs-var">whenProf</span></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291281"><span class="hs-identifier hs-var">installOrdinary</span></a><span> </span><a href="#local-6989586621679291279"><span class="hs-identifier hs-var">builtDir</span></a><span> </span><a href="#local-6989586621679291273"><span class="hs-identifier hs-var">targetDir</span></a><span>       </span><a href="#local-6989586621679291287"><span class="hs-identifier hs-var">profileLibName</span></a><span>
</span><a name="line-1641"></a><span>    </span><a href="#local-6989586621679291295"><span class="hs-identifier hs-var">whenGHCi</span></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291281"><span class="hs-identifier hs-var">installOrdinary</span></a><span> </span><a href="#local-6989586621679291279"><span class="hs-identifier hs-var">builtDir</span></a><span> </span><a href="#local-6989586621679291273"><span class="hs-identifier hs-var">targetDir</span></a><span>       </span><a href="#local-6989586621679291288"><span class="hs-identifier hs-var">ghciLibName</span></a><span>
</span><a name="line-1642"></a><span>    </span><a href="#local-6989586621679291296"><span class="hs-identifier hs-var">whenShared</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679291282"><span class="hs-identifier hs-var">installShared</span></a><span>   </span><a href="#local-6989586621679291279"><span class="hs-identifier hs-var">builtDir</span></a><span> </span><a href="#local-6989586621679291274"><span class="hs-identifier hs-var">dynlibTargetDir</span></a><span> </span><a href="#local-6989586621679291289"><span class="hs-identifier hs-var">sharedLibName</span></a><span>
</span><a name="line-1643"></a><span>
</span><a name="line-1644"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1645"></a><span>    </span><a name="local-6989586621679291279"><a href="#local-6989586621679291279"><span class="hs-identifier">builtDir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier hs-var">componentBuildDir</span></a><span> </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679291278"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-1646"></a><span>
</span><a name="line-1647"></a><span>    </span><a name="local-6989586621679291280"><a href="#local-6989586621679291280"><span class="hs-identifier">install</span></a></a><span> </span><a name="local-6989586621679291297"><a href="#local-6989586621679291297"><span class="hs-identifier">isShared</span></a></a><span> </span><a name="local-6989586621679291298"><a href="#local-6989586621679291298"><span class="hs-identifier">srcDir</span></a></a><span> </span><a name="local-6989586621679291299"><a href="#local-6989586621679291299"><span class="hs-identifier">dstDir</span></a></a><span> </span><a name="local-6989586621679291300"><a href="#local-6989586621679291300"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1648"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291301"><a href="#local-6989586621679291301"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291298"><span class="hs-identifier hs-var">srcDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291300"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1649"></a><span>          </span><a name="local-6989586621679291302"><a href="#local-6989586621679291302"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291299"><span class="hs-identifier hs-var">dstDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291300"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1650"></a><span>      </span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a><span> </span><a href="#local-6989586621679291271"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679291299"><span class="hs-identifier hs-var">dstDir</span></a><span>
</span><a name="line-1651"></a><span>
</span><a name="line-1652"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679291297"><span class="hs-identifier hs-var">isShared</span></a><span>
</span><a name="line-1653"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.Utils.html#installExecutableFile"><span class="hs-identifier hs-var">installExecutableFile</span></a><span> </span><a href="#local-6989586621679291271"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291301"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679291302"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1654"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Simple.Utils.html#installOrdinaryFile"><span class="hs-identifier hs-var">installOrdinaryFile</span></a><span>   </span><a href="#local-6989586621679291271"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291301"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679291302"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1655"></a><span>
</span><a name="line-1656"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">stripLibs</span><span> </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Program.Strip.html#stripLib"><span class="hs-identifier hs-var">Strip</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">stripLib</span></a><span> </span><a href="#local-6989586621679291271"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-1657"></a><span>                             </span><span class="hs-special">(</span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291302"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1658"></a><span>
</span><a name="line-1659"></a><span>    </span><a name="local-6989586621679291281"><a href="#local-6989586621679291281"><span class="hs-identifier">installOrdinary</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291280"><span class="hs-identifier hs-var">install</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1660"></a><span>    </span><a name="local-6989586621679291282"><a href="#local-6989586621679291282"><span class="hs-identifier">installShared</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291280"><span class="hs-identifier hs-var">install</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1661"></a><span>
</span><a name="line-1662"></a><span>    </span><a name="local-6989586621679291283"><a href="#local-6989586621679291283"><span class="hs-identifier">copyModuleFiles</span></a></a><span> </span><a name="local-6989586621679291303"><a href="#local-6989586621679291303"><span class="hs-identifier">ext</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1663"></a><span>      </span><a href="Distribution.Simple.Utils.html#findModuleFiles"><span class="hs-identifier hs-var">findModuleFiles</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679291279"><span class="hs-identifier hs-var">builtDir</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679291303"><span class="hs-identifier hs-var">ext</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679291277"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679291278"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1664"></a><span>      </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Distribution.Simple.Utils.html#installOrdinaryFiles"><span class="hs-identifier hs-var">installOrdinaryFiles</span></a><span> </span><a href="#local-6989586621679291271"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291273"><span class="hs-identifier hs-var">targetDir</span></a><span>
</span><a name="line-1665"></a><span>
</span><a name="line-1666"></a><span>    </span><a name="local-6989586621679291284"><a href="#local-6989586621679291284"><span class="hs-identifier">compiler_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compilerId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span>    </span><a name="local-6989586621679291285"><a href="#local-6989586621679291285"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679291278"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-1668"></a><span>    </span><a name="local-6989586621679291286"><a href="#local-6989586621679291286"><span class="hs-identifier">vanillaLibName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.BuildPaths.html#mkLibName"><span class="hs-identifier hs-var">mkLibName</span></a><span>              </span><a href="#local-6989586621679291285"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-1669"></a><span>    </span><a name="local-6989586621679291287"><a href="#local-6989586621679291287"><span class="hs-identifier">profileLibName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.BuildPaths.html#mkProfLibName"><span class="hs-identifier hs-var">mkProfLibName</span></a><span>          </span><a href="#local-6989586621679291285"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-1670"></a><span>    </span><a name="local-6989586621679291288"><a href="#local-6989586621679291288"><span class="hs-identifier">ghciLibName</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#mkGHCiLibName"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mkGHCiLibName</span></a><span> </span><a href="#local-6989586621679291285"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-1671"></a><span>    </span><a name="local-6989586621679291289"><a href="#local-6989586621679291289"><span class="hs-identifier">sharedLibName</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.BuildPaths.html#mkSharedLibName"><span class="hs-identifier hs-var">mkSharedLibName</span></a><span> </span><a href="#local-6989586621679291284"><span class="hs-identifier hs-var">compiler_id</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291285"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-1672"></a><span>
</span><a name="line-1673"></a><span>    </span><a name="local-6989586621679291290"><a href="#local-6989586621679291290"><span class="hs-identifier">hasLib</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span> </span><a href="#local-6989586621679291277"><span class="hs-identifier hs-var">lib</span></a><span> </span><a href="#local-6989586621679291278"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1674"></a><span>                   </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cSources</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">libBuildInfo</span><span> </span><a href="#local-6989586621679291277"><span class="hs-identifier hs-var">lib</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1675"></a><span>    </span><a name="local-6989586621679291291"><a href="#local-6989586621679291291"><span class="hs-identifier">has_code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.ComponentLocalBuildInfo.html#componentIsIndefinite"><span class="hs-identifier hs-var">componentIsIndefinite</span></a><span> </span><a href="#local-6989586621679291278"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1676"></a><span>    </span><a name="local-6989586621679291292"><a href="#local-6989586621679291292"><span class="hs-identifier">whenHasCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679291291"><span class="hs-identifier hs-var">has_code</span></a><span>
</span><a name="line-1677"></a><span>    </span><a name="local-6989586621679291293"><a href="#local-6989586621679291293"><span class="hs-identifier">whenVanilla</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291290"><span class="hs-identifier hs-var">hasLib</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">withVanillaLib</span><span> </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1678"></a><span>    </span><a name="local-6989586621679291294"><a href="#local-6989586621679291294"><span class="hs-identifier">whenProf</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291290"><span class="hs-identifier hs-var">hasLib</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">withProfLib</span><span>    </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679291291"><span class="hs-identifier hs-var">has_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1679"></a><span>    </span><a name="local-6989586621679291295"><a href="#local-6989586621679291295"><span class="hs-identifier">whenGHCi</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291290"><span class="hs-identifier hs-var">hasLib</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">withGHCiLib</span><span>    </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679291291"><span class="hs-identifier hs-var">has_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1680"></a><span>    </span><a name="local-6989586621679291296"><a href="#local-6989586621679291296"><span class="hs-identifier">whenShared</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679291290"><span class="hs-identifier hs-var">hasLib</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">withSharedLib</span><span>  </span><a href="#local-6989586621679291272"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679291291"><span class="hs-identifier hs-var">has_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1681"></a><span>
</span><a name="line-1682"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1683"></a><span class="hs-comment">-- Registering</span><span>
</span><a name="line-1684"></a><span>
</span><a name="line-1685"></a><span class="hs-identifier">hcPkgInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.HcPkg.html#HcPkgInfo"><span class="hs-identifier hs-type">HcPkg</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">HcPkgInfo</span></a><span>
</span><a name="line-1686"></a><a name="hcPkgInfo"><a href="Distribution.Simple.GHC.html#hcPkgInfo"><span class="hs-identifier">hcPkgInfo</span></a></a><span> </span><a name="local-6989586621679291304"><a href="#local-6989586621679291304"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.HcPkg.html#HcPkgInfo"><span class="hs-identifier hs-var">HcPkg</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">HcPkgInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">hcPkgProgram</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291306"><span class="hs-identifier hs-var">ghcPkgProg</span></a><span>
</span><a name="line-1687"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">noPkgDbStack</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">9</span><span class="hs-special">]</span><span>
</span><a name="line-1688"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">noVerboseFlag</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">]</span><span>
</span><a name="line-1689"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">flagPackageConf</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">]</span><span>
</span><a name="line-1690"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">supportsDirDbs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">]</span><span>
</span><a name="line-1691"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">requiresDirDbs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">10</span><span class="hs-special">]</span><span>
</span><a name="line-1692"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">nativeMultiInstance</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-special">[</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">10</span><span class="hs-special">]</span><span>
</span><a name="line-1693"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">recacheMultiInstance</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">12</span><span class="hs-special">]</span><span>
</span><a name="line-1694"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">HcPkg</span><span class="hs-operator">.</span><span class="hs-identifier">suppressFilesCheck</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291305"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-special">[</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">6</span><span class="hs-special">]</span><span>
</span><a name="line-1695"></a><span>                                   </span><span class="hs-special">}</span><span>
</span><a name="line-1696"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1697"></a><span>    </span><a name="local-6989586621679291305"><a href="#local-6989586621679291305"><span class="hs-identifier">v</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Version.html#versionNumbers"><span class="hs-identifier hs-var">versionNumbers</span></a><span> </span><a href="#local-6989586621679291307"><span class="hs-identifier hs-var">ver</span></a><span>
</span><a name="line-1698"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679291306"><a href="#local-6989586621679291306"><span class="hs-identifier">ghcPkgProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcPkgProgram"><span class="hs-identifier hs-var">ghcPkgProgram</span></a><span> </span><a href="#local-6989586621679291304"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-1699"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679291307"><a href="#local-6989586621679291307"><span class="hs-identifier">ver</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programVersion</span><span> </span><a href="#local-6989586621679291306"><span class="hs-identifier hs-var">ghcPkgProg</span></a><span>
</span><a name="line-1700"></a><span>
</span><a name="line-1701"></a><span class="hs-identifier">registerPackage</span><span>
</span><a name="line-1702"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-1703"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-1704"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDBStack"><span class="hs-identifier hs-type">PackageDBStack</span></a><span>
</span><a name="line-1705"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.InstalledPackageInfo.html#InstalledPackageInfo"><span class="hs-identifier hs-type">InstalledPackageInfo</span></a><span>
</span><a name="line-1706"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.HcPkg.html#RegisterOptions"><span class="hs-identifier hs-type">HcPkg</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">RegisterOptions</span></a><span>
</span><a name="line-1707"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1708"></a><a name="registerPackage"><a href="Distribution.Simple.GHC.html#registerPackage"><span class="hs-identifier">registerPackage</span></a></a><span> </span><a name="local-6989586621679291308"><a href="#local-6989586621679291308"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291309"><a href="#local-6989586621679291309"><span class="hs-identifier">progdb</span></a></a><span> </span><a name="local-6989586621679291310"><a href="#local-6989586621679291310"><span class="hs-identifier">packageDbs</span></a></a><span> </span><a name="local-6989586621679291311"><a href="#local-6989586621679291311"><span class="hs-identifier">installedPkgInfo</span></a></a><span> </span><a name="local-6989586621679291312"><a href="#local-6989586621679291312"><span class="hs-identifier">registerOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1709"></a><span>    </span><a href="Distribution.Simple.Program.HcPkg.html#register"><span class="hs-identifier hs-var">HcPkg</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">register</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#hcPkgInfo"><span class="hs-identifier hs-var">hcPkgInfo</span></a><span> </span><a href="#local-6989586621679291309"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679291308"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291310"><span class="hs-identifier hs-var">packageDbs</span></a><span>
</span><a name="line-1710"></a><span>                   </span><a href="#local-6989586621679291311"><span class="hs-identifier hs-var">installedPkgInfo</span></a><span> </span><a href="#local-6989586621679291312"><span class="hs-identifier hs-var">registerOptions</span></a><span>
</span><a name="line-1711"></a><span>
</span><a name="line-1712"></a><span class="hs-identifier">pkgRoot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1713"></a><a name="pkgRoot"><a href="Distribution.Simple.GHC.html#pkgRoot"><span class="hs-identifier">pkgRoot</span></a></a><span> </span><a name="local-6989586621679291313"><a href="#local-6989586621679291313"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679291314"><a href="#local-6989586621679291314"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291315"><span class="hs-identifier hs-var">pkgRoot'</span></a><span>
</span><a name="line-1714"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1715"></a><span>    </span><a name="local-6989586621679291315"><a href="#local-6989586621679291315"><span class="hs-identifier">pkgRoot'</span></a></a><span> </span><a href="Distribution.Simple.Compiler.html#GlobalPackageDB"><span class="hs-identifier hs-var">GlobalPackageDB</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1716"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679291316"><a href="#local-6989586621679291316"><span class="hs-identifier">ghcProg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-var">ghcProgram</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">withPrograms</span><span> </span><a href="#local-6989586621679291314"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1717"></a><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">takeDirectory</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.GHC.html#getGlobalPackageDB"><span class="hs-identifier hs-var">getGlobalPackageDB</span></a><span> </span><a href="#local-6989586621679291313"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679291316"><span class="hs-identifier hs-var">ghcProg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1718"></a><span>    </span><span class="hs-identifier">pkgRoot'</span><span> </span><a href="Distribution.Simple.Compiler.html#UserPackageDB"><span class="hs-identifier hs-var">UserPackageDB</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1719"></a><span>      </span><a name="local-6989586621679291317"><a href="#local-6989586621679291317"><span class="hs-identifier">appDir</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getAppUserDataDirectory</span><span> </span><span class="hs-string">&quot;ghc&quot;</span><span>
</span><a name="line-1720"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679291318"><a href="#local-6989586621679291318"><span class="hs-identifier">ver</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Compiler.html#compilerVersion"><span class="hs-identifier hs-var">compilerVersion</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679291314"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-1721"></a><span>          </span><a name="local-6989586621679291319"><a href="#local-6989586621679291319"><span class="hs-identifier">subdir</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">System</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Info</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">arch</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-char">'-'</span><span class="hs-glyph">:</span><span class="hs-identifier hs-var">System</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Info</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">os</span><span>
</span><a name="line-1722"></a><span>                     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-char">'-'</span><span class="hs-glyph">:</span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679291318"><span class="hs-identifier hs-var">ver</span></a><span>
</span><a name="line-1723"></a><span>          </span><a name="local-6989586621679291320"><a href="#local-6989586621679291320"><span class="hs-identifier">rootDir</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291317"><span class="hs-identifier hs-var">appDir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679291319"><span class="hs-identifier hs-var">subdir</span></a><span>
</span><a name="line-1724"></a><span>      </span><span class="hs-comment">-- We must create the root directory for the user package database if it</span><span>
</span><a name="line-1725"></a><span>      </span><span class="hs-comment">-- does not yet exists. Otherwise '${pkgroot}' will resolve to a</span><span>
</span><a name="line-1726"></a><span>      </span><span class="hs-comment">-- directory at the time of 'ghc-pkg register', and registration will</span><span>
</span><a name="line-1727"></a><span>      </span><span class="hs-comment">-- fail.</span><span>
</span><a name="line-1728"></a><span>      </span><span class="hs-identifier hs-var">createDirectoryIfMissing</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679291320"><span class="hs-identifier hs-var">rootDir</span></a><span>
</span><a name="line-1729"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679291320"><span class="hs-identifier hs-var">rootDir</span></a><span>
</span><a name="line-1730"></a><span>    </span><span class="hs-identifier">pkgRoot'</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#SpecificPackageDB"><span class="hs-identifier hs-var">SpecificPackageDB</span></a><span> </span><a name="local-6989586621679291321"><a href="#local-6989586621679291321"><span class="hs-identifier">fp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">takeDirectory</span><span> </span><a href="#local-6989586621679291321"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1731"></a><span>
</span><a name="line-1732"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1733"></a><span class="hs-comment">-- Utils</span><span>
</span><a name="line-1734"></a><span>
</span><a name="line-1735"></a><span class="hs-identifier">isDynamic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1736"></a><a name="isDynamic"><a href="Distribution.Simple.GHC.html#isDynamic"><span class="hs-identifier">isDynamic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#ghcLookupProperty"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ghcLookupProperty</span></a><span> </span><span class="hs-string">&quot;GHC Dynamic&quot;</span><span>
</span><a name="line-1737"></a><span>
</span><a name="line-1738"></a><span class="hs-identifier">supportsDynamicToo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Compiler.html#Compiler"><span class="hs-identifier hs-type">Compiler</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1739"></a><a name="supportsDynamicToo"><a href="Distribution.Simple.GHC.html#supportsDynamicToo"><span class="hs-identifier">supportsDynamicToo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.GHC.Internal.html#ghcLookupProperty"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ghcLookupProperty</span></a><span> </span><span class="hs-string">&quot;Support dynamic-too&quot;</span><span>
</span><a name="line-1740"></a><span>
</span><a name="line-1741"></a><span class="hs-identifier">withExt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1742"></a><a name="withExt"><a href="Distribution.Simple.GHC.html#withExt"><span class="hs-identifier">withExt</span></a></a><span> </span><a name="local-6989586621679291322"><a href="#local-6989586621679291322"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679291323"><a href="#local-6989586621679291323"><span class="hs-identifier">ext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679291322"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">takeExtension</span><span> </span><a href="#local-6989586621679291322"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">(</span><span class="hs-char">'.'</span><span class="hs-glyph">:</span><a href="#local-6989586621679291323"><span class="hs-identifier hs-var">ext</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679291323"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-1743"></a></pre></body></html>